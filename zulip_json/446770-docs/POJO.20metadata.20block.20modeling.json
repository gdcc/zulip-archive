[
    {
        "content": "<p>In the current \"specification\" of our metadata fields, we express in the TSV format whether a field is \"required\", where it displays in relation to others and if it will be displayed on creation of a dataset as attributes of a field. </p>\n<p>But is that truely an \"attribute\"? From my point of view it is something the surrounding block imposes on the field! The field doesn't care about being required, where it is and if it's important to be displayed during creation. <br>\nIt must care about how it is displayed (format), if it has a CV, who it's parent or children are, or if it can be used in facets/advances searches, as this influences how the field itself must behave. (Indexing in Solr, etc).</p>\n<p>So in a future data model of these things (so <em>not</em> some file format, just as in-memory Java class model), these things should rather be defined on the block, not the field, right?<br>\nChange my mind <span class=\"user-mention\" data-user-id=\"621770\">@Julian Gautier</span> <span class=\"user-mention\" data-user-id=\"598112\">@Philip Durbin üöÄ</span> <span class=\"user-mention\" data-user-id=\"637063\">@Leo Andreev</span></p>\n<p>(This is docs related as the current docs page is a mix of specification and file format. A future specification of a data model should be format agnostic and define a reliable data contract.)</p>",
        "id": 568481093,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1768582848
    },
    {
        "content": "<p>For the logic around displayOnCreate, the TSV only tells part of the story. There's a good amount of logic and configuration available in the backend. See my review of display on create starting on slide 12 of this talk I gave at <a class=\"stream-topic\" data-stream-id=\"375707\" href=\"/#narrow/channel/375707-community/topic/.23Dataverse2025/with/566743905\">#community &gt; #Dataverse2025</a> - <a href=\"https://docs.google.com/presentation/d/18tPj-t_v-5amXiaGoxFm-3LTm-reBKL3d303oydLURY/edit?usp=sharing\">https://docs.google.com/presentation/d/18tPj-t_v-5amXiaGoxFm-3LTm-reBKL3d303oydLURY/edit?usp=sharing</a></p>",
        "id": 568482862,
        "sender_full_name": "Philip Durbin üöÄ",
        "timestamp": 1768583392
    },
    {
        "content": "<p>Yeah I thought of that - you can do boatloads of stuff these days with the fields, so this is not really part of what a field \"is\", just what you \"do\" with it, right?</p>",
        "id": 568483161,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1768583480
    },
    {
        "content": "<p>Hey <span class=\"user-mention\" data-user-id=\"598183\">@Oliver Bertuch</span> this far from my expertise so I'll defer to you and others. It sounded from other conversations like <span class=\"user-mention\" data-user-id=\"602497\">@Bal√°zs Pataki</span> would be helpful too <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span></p>",
        "id": 568483550,
        "sender_full_name": "Julian Gautier",
        "timestamp": 1768583589
    },
    {
        "content": "<p>But you're the IQSS metadata expert, right?</p>",
        "id": 568483601,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1768583606
    },
    {
        "content": "<p>Technically, this POJO model in Java is as simple as it can be</p>",
        "id": 568483692,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1768583633
    },
    {
        "content": "<p>It should be the simplest and cleanest transformation between a written spec and the technical implementation</p>",
        "id": 568483785,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1768583663
    },
    {
        "content": "<p>Oh I see! <span aria-label=\"see no evil\" class=\"emoji emoji-1f648\" role=\"img\" title=\"see no evil\">:see_no_evil:</span> I always thought of you like that as others seemed to refer to you that way... <span aria-label=\"see no evil\" class=\"emoji emoji-1f648\" role=\"img\" title=\"see no evil\">:see_no_evil:</span> My bad!</p>",
        "id": 568483920,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1768583704
    },
    {
        "content": "<p>Who'd be the right person to ask? I'd prefer human experience over any LLM <span aria-label=\"wink\" class=\"emoji emoji-1f609\" role=\"img\" title=\"wink\">:wink:</span></p>",
        "id": 568484039,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1768583743
    },
    {
        "content": "<p>No worries <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span> I think input from Phil, Leonid and maybe Bal√°zs would help</p>",
        "id": 568484431,
        "sender_full_name": "Julian Gautier",
        "timestamp": 1768583861
    },
    {
        "content": "<p>And maybe Jim? Outside of Zulip of course</p>",
        "id": 568484831,
        "sender_full_name": "Julian Gautier",
        "timestamp": 1768583974
    },
    {
        "content": "<p>Do we have any domain modelling experts around? <span aria-label=\"smile\" class=\"emoji emoji-1f604\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 568484918,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1768583997
    },
    {
        "content": "<p>Where are they when you need 'em? <span aria-label=\"wink\" class=\"emoji emoji-1f609\" role=\"img\" title=\"wink\">:wink:</span></p>",
        "id": 568484984,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1768584015
    },
    {
        "content": "<p>Are you thinking along these lines?</p>\n<div class=\"codehilite\"><pre><span></span><code>Attributes:\n- name\n- title\n- description\n- watermark\n- fieldType\n- advancedSearchField\n- allowControlledVocabulary\n- allowmultiples\n- facetable\n- parent\n- metadatablock_id\n\nNon-attributes:\n- displayOrder\n- displayFormat\n- displayoncreate\n- required\n</code></pre></div>",
        "id": 568485539,
        "sender_full_name": "Philip Durbin üöÄ",
        "timestamp": 1768584167
    },
    {
        "content": "<p>Maybe even more radical:</p>\n<p>Links, provided by model building:</p>\n<ul>\n<li>metadata block (no more metadatablock_id field in the format - let containment define what's what)</li>\n<li>parent</li>\n<li>children</li>\n</ul>\n<p>Attributes:</p>\n<ul>\n<li>name</li>\n<li>title</li>\n<li>description</li>\n<li>watermark</li>\n<li>fieldType</li>\n<li>advancedSearchField</li>\n<li>allowControlledVocabulary</li>\n<li>allowmultiples (_cardinality influences storage, so important as attribute_)</li>\n<li>facetable</li>\n</ul>\n<p>DataTypes / Schema Context (part of Metadata Block):</p>\n<ul>\n<li>required</li>\n</ul>\n<p>UI Context (Metadata Block):</p>\n<ul>\n<li>displayOrder</li>\n<li>displayoncreate</li>\n<li>displayFormat</li>\n</ul>",
        "id": 568489015,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1768585249
    },
    {
        "content": "<p>I think that makes sense.</p>",
        "id": 568489227,
        "sender_full_name": "Philip Durbin üöÄ",
        "timestamp": 1768585313
    },
    {
        "content": "<p>Again, we must shake off the mental model the TSV format has burned into us (and in part also in how the database entities look like)</p>",
        "id": 568489238,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1768585317
    },
    {
        "content": "<p>Separating UI-related constraints from data constraints would be ideal.</p>\n<p>Regarding \"required\", JSON Schema handles this in a similar way: it‚Äôs defined at the object level, rather than as an inherent attribute of each property.</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n  &quot;type&quot;: &quot;object&quot;,\n  &quot;properties&quot;: {\n    &quot;name&quot;: { &quot;type&quot;: &quot;string&quot; },\n    &quot;age&quot;: { &quot;type&quot;: &quot;integer&quot; }\n  },\n  &quot;required&quot;: [&quot;name&quot;]\n}\n</code></pre></div>",
        "id": 568489705,
        "sender_full_name": "Bal√°zs Pataki",
        "timestamp": 1768585455
    },
    {
        "content": "<p>Oooh, I like that. Let's start with a JSON Schema and backward-engineer it. <span aria-label=\"smile\" class=\"emoji emoji-1f604\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 568489814,
        "sender_full_name": "Philip Durbin üöÄ",
        "timestamp": 1768585491
    },
    {
        "content": "<p>Actually, this is my mental model :-D</p>",
        "id": 568489874,
        "sender_full_name": "Bal√°zs Pataki",
        "timestamp": 1768585509
    },
    {
        "content": "<p>Another thing we did during the CEDAR integration is that we made it possible that a field can be part of multiple MDB-s. This maybe worth considering as well if we want to remodel MDB-s.</p>\n<p>For example, there's the field Frequency in \"Social Science and Humanities Metadata\". Assume its name is \"frequency\" and it is a number. What if a collection doesn't use this MDB, but wants to have its own custom MDB with a numeric \"frequency\" field. In the stock DV it is not possible, one field can belong to only one MDB and you cannot redefine it.</p>\n<p>Of course this is also tightly coupled with Solr indexing and Solr field names, so it is tricky thing both at the current data model and at the Solr end. We worked around it, but it is not nice. <span aria-label=\"face with peeking eye\" class=\"emoji emoji-1fae3\" role=\"img\" title=\"face with peeking eye\">:face_with_peeking_eye:</span></p>",
        "id": 568491228,
        "sender_full_name": "Bal√°zs Pataki",
        "timestamp": 1768585958
    },
    {
        "content": "<blockquote>\n<p>a field can be part of multiple MDB-s</p>\n</blockquote>\n<p>Any change that would improve support for including a metadata field in any grouping of metadata fields (or what we've called a metadata block) seems very worthwhile!</p>",
        "id": 568492806,
        "sender_full_name": "Julian Gautier",
        "timestamp": 1768586431
    },
    {
        "content": "<p>Just out of curiosity, here‚Äôs how CEDAR structures its model.</p>\n<p>It has 3 types of objects:</p>\n<ol>\n<li>Field: a single data field</li>\n<li>Element:  a reusable collection of Fields and/or other Elements.</li>\n<li>Template: a top-level structure made up of Fields and Elements.</li>\n</ol>\n<p>Fields and Elements are fully reusable: a Field can appear in multiple Elements, and an Element can be nested in multiple other Elements. Templates, however, act as ‚Äúroot‚Äù objects and cannot be nested within other objects.</p>\n<p>Each Field, Element, and Template includes metadata, data constraints, and UI specification. Much like what you‚Äôd expect from JSON Schema. Because it is JSON Schema. <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span></p>",
        "id": 568492864,
        "sender_full_name": "Bal√°zs Pataki",
        "timestamp": 1768586459
    },
    {
        "content": "<p>Requirement and multiplicity are defined at the point where an object is used. For example, when a Field is included in an Element, the Element determines whether that Field is required and what its multiplicity is.</p>",
        "id": 568493198,
        "sender_full_name": "Bal√°zs Pataki",
        "timestamp": 1768586561
    },
    {
        "content": "<p>In Dataverse at the moment a field (or field type) identity is effectively determined by its <strong>name</strong>. For example, <code>title</code>, <code>author</code>, <code>subject</code>, etc. Although fields have internal database identifiers, they are mapped one-to-one to Solr fields, which means the field name already functions as a unique identifier in practice.</p>\n<p>This approach has an important implication: there can be only one field named <code>frequency</code>. Even if multiple MDBs share the same field definition, they must also share the same semantics. However, this is often too restrictive. One MDB might want <code>frequency</code> to be an enumerated list (e.g., <em>Day, Week, Month</em>), while another might want it to be a numeric value.</p>\n<p>To address this limitation, our implementation binds fields to the <strong>URIs</strong> that are already associated with field and uses those URIs as their effective identifiers. We assume that if two fields share the same URI, they are semantically and syntactically the same. These URIs are also used as the corresponding field names in Solr (after some transformation, of course, because field names cannot include \"/\", etc.).</p>\n<p>At the same time, we decouple <strong>field names</strong> from <strong>field identity</strong>. This allows:</p>\n<ul>\n<li>\n<p>different field names to point to the same URI (same semantics), and</p>\n</li>\n<li>\n<p>the same field name to point to different URIs (different semantics).</p>\n</li>\n</ul>\n<p>This makes the system more flexible while preserving semantic clarity.</p>\n<p>For example:<br>\n<strong>MDB1</strong> (where <code>frequency</code> is first defined)</p>\n<ul>\n<li>\n<p>Name: <code>frequency</code></p>\n</li>\n<li>\n<p>URI: <code>http://dataverse.org/fields/frequency</code></p>\n</li>\n</ul>\n<p><strong>MDB2</strong> (<code>frequency</code> reused with the same meaning)</p>\n<ul>\n<li>\n<p>Name: <code>frequency</code></p>\n</li>\n<li>\n<p>URI: <code>http://dataverse.org/fields/frequency</code></p>\n</li>\n</ul>\n<p><strong>MDB3</strong> (<code>frequency</code> with different semantics)</p>\n<ul>\n<li>\n<p>Name: <code>frequency</code></p>\n</li>\n<li>\n<p>URI: <code>http://dataverse.org/fields/frequencyByDayWeekMonth</code></p>\n</li>\n</ul>\n<p><strong>MDB4</strong> (different name, same semantics as MDB3)</p>\n<ul>\n<li>\n<p>Name: <code>frequencyInterval</code></p>\n</li>\n<li>\n<p>URI: <code>http://dataverse.org/fields/frequencyByDayWeekMonth</code></p>\n</li>\n</ul>\n<p>Making URIs (or, to be irritatingly precise, IRIs) the effective identifiers also improves interoperability with other linked-data oriented representations like RO-Crate.</p>",
        "id": 568498598,
        "sender_full_name": "Bal√°zs Pataki",
        "timestamp": 1768588288
    },
    {
        "content": "<p>The mental model that starts forming in my head is at this current state:</p>\n<ul>\n<li>For now, the database in the core is hardcoded to a 1:1 relation between MDB and DF as well as DF and CV. The data model we create now should not stray to far from this, as we can wish for more all we want... But: it must keep a future refactoring of the core to support  this in mind without breaking the data model and starting over!</li>\n<li>Let's start treating the MDB more like a \"UI group of fields\", not the representation of a metadata schema. It never really was and we're constantly hitting the ceiling with it now.</li>\n<li>Let's keep in mind that for the future, we want to be able to have a 1:n relation between these UI groups to a DF and CV to DF, as multiple fields may have the same vocabulary and appear in multiple groups.</li>\n<li>Also, we probably want the data model be open to lift the UI restriction of only one level of parent/childs. (This is AFAIK not even a DB restriction!)</li>\n<li>Let's keep formatting out of the field data model and put it elsewhere during the domain modeling process. We're already having a hard time as it is mostly about HTML UI, but for the future we might want more than that!</li>\n</ul>\n<p>Gotchas:</p>\n<ul>\n<li>I'm not sure yet what to do with the current metadata block URL which is used for JSON-LD exports. Maybe shape into a binding of group to a context? (So multiple MDBs can have the same context but be different groups in the UI)</li>\n<li>Keep the limitation of unique names. Yes, this is unfortunate and has drawbacks. But changing that properly will require changing the DB model and index to become a tuple store. We simply don't have the concept of context available in Sole without a complete refactoring of that whole subsystem. That's a major change and seems unreasonable at this time. The POJO model is not necessarily broken if we ever change that - a DF is associated to a group/MDB, so we could keep using that as a context to it.</li>\n</ul>",
        "id": 568500705,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1768589039
    },
    {
        "content": "<p>I agree <span class=\"user-mention\" data-user-id=\"602497\">@Bal√°zs Pataki</span> that the same field name may have different semantic meanings, depending on context. As outlined above, having this context embedded is hard in how the core works at the moment.</p>",
        "id": 568500951,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1768589134
    },
    {
        "content": "<p>Especially as people use the search function and use field names in there, they would also have to add the context there... That's not an easy thing to figure out, especially from the UX side.</p>",
        "id": 568501169,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1768589208
    },
    {
        "content": "<p>So maybe for the time being, we have to live with this shortcoming <span aria-label=\"relieved\" class=\"emoji emoji-1f60c\" role=\"img\" title=\"relieved\">:relieved:</span></p>",
        "id": 568501277,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1768589247
    },
    {
        "content": "<p>yes, I know changes that deep have many implications. I‚Äôm not pushing for them, just explaining our approach. It isn‚Äôt in use today, but we built it to support future use cases.</p>",
        "id": 568501611,
        "sender_full_name": "Bal√°zs Pataki",
        "timestamp": 1768589365
    },
    {
        "content": "<p>Or actually, we had one use case already with the \"keyword\" field.</p>",
        "id": 568501741,
        "sender_full_name": "Bal√°zs Pataki",
        "timestamp": 1768589407
    },
    {
        "content": "<p>Also <span class=\"user-mention\" data-user-id=\"602497\">@Bal√°zs Pataki</span> I'm not sure that the currwnt database SQL model is the limitation here. IIRC the name of a dataset is not part of the DB keys. AFAIK the technical  limitation is in the search index! (That's good news...)</p>",
        "id": 568501879,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1768589448
    },
    {
        "content": "<p>No, actucally I think datasetfieldtype has a metadatablock_id relation which is unique.</p>",
        "id": 568502182,
        "sender_full_name": "Bal√°zs Pataki",
        "timestamp": 1768589550
    },
    {
        "content": "<p>We definitely could not add the same field to multiple MDB-s. Maybe this changed since 6.1?</p>",
        "id": 568502312,
        "sender_full_name": "Bal√°zs Pataki",
        "timestamp": 1768589590
    },
    {
        "content": "<p>Or maybe you can add but it won't appear in all of those MDB-s? <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span>  Anyway, there were some issues with them I cannot remember now without looking at the code.</p>",
        "id": 568502832,
        "sender_full_name": "Bal√°zs Pataki",
        "timestamp": 1768589759
    },
    {
        "content": "<p>Oh. Yeah. True, there is still the implication of 1:1 MDB-DF. (see above) But that's not the same as making the name a part of it!</p>",
        "id": 568502998,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1768589812
    },
    {
        "content": "<p>The name limitation mostly comes from the Sold schema... We can't have cardinal fields there. And unless we work around that somehow (multiple cores per context / field naming policy) might be hard to overcome without switching tech. Both ways: big fat project...</p>",
        "id": 568503135,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1768589856
    },
    {
        "content": "<p>We're talking about metadata field at the dataset level, but what about the file and variable level? See <a href=\"https://github.com/IQSS/dataverse-pm/issues/112\">https://github.com/IQSS/dataverse-pm/issues/112</a> and its <a href=\"https://docs.google.com/document/d/1xvmOHfRxYRD-u2EA16VbVfI4Ge_klp7h24FkW3GRnPs/edit?usp=sharing\">design doc</a>.</p>\n<p>Rather than using our existing dataset-level model, perhaps we could design something better for datasets, files, and variables. And eventually migrate the current dataset-level stuff to the new and improved model.</p>\n<p>That is to say, we could design something new without disturbing the existing infrastructure.</p>",
        "id": 568508168,
        "sender_full_name": "Philip Durbin üöÄ",
        "timestamp": 1768591586
    },
    {
        "content": "<p>Oh, yeah, file metadata! At the ‚Äúmental model‚Äù level, it should be the same, isn‚Äôt it? Even at implementation level. That would be ideal.</p>",
        "id": 568508454,
        "sender_full_name": "Bal√°zs Pataki",
        "timestamp": 1768591700
    },
    {
        "content": "<p>I mean, 10 years ago our thought was to just use the same model, the dataset model, for file metadata. But we never got around to it. Probably we should build something better, given what we've learned with our TSV adventure. <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 568508784,
        "sender_full_name": "Philip Durbin üöÄ",
        "timestamp": 1768591832
    },
    {
        "content": "<p>As you know, this is exactly why we moved fully to RO-Crate: it gives us a single, consistent model for describing Dataset and File metadata while remaining compatible with Dataverse‚Äôs existing metadata storage. With RO-Crate we can even use existing Dataverse MDBs to describe files. So, for example, you can simply drop the Geospatial MDB onto a file and instantly add location metadata to it.</p>\n<hr>\n<p>Now, the rest is just a far-fetched thought experiment for fun.</p>\n<p>Imagine a Dataverse where MDBs are represented purely as JSON Schemas (or similar), and all dataset metadata lives in a single ro-crate-metadata.json file. No separate database representation, just one JSON file per dataset, which can describe the Dataset and Files. That JSON could still be stored in a PG jsonb field for indexing and full-text search, or fed into Elasticsearch/OpenSearch for more advanced discovery. But otherwise, most metadata and schema interactions would become straightforward JSON editing and parsing operations that require no backend roundtrips or database logic and could be handled entirely within the SPA.</p>",
        "id": 568513396,
        "sender_full_name": "Bal√°zs Pataki",
        "timestamp": 1768593544
    },
    {
        "content": "<p>Interesting. We definitely considered MongoDB a decade ago when we came up with the custom metadata blocks system.</p>",
        "id": 568513737,
        "sender_full_name": "Philip Durbin üöÄ",
        "timestamp": 1768593662
    },
    {
        "content": "<p>But I like your idea of a Postgres jsonb field. Fewer moving parts. <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 568513937,
        "sender_full_name": "Philip Durbin üöÄ",
        "timestamp": 1768593727
    },
    {
        "content": "<p>I started writing a doc: <a href=\"https://docs.google.com/document/d/16qxyUejjkcSPb37d9lJlsLnuhLNLTpu5lAsJglugmbw/edit?usp=sharing\">https://docs.google.com/document/d/16qxyUejjkcSPb37d9lJlsLnuhLNLTpu5lAsJglugmbw/edit?usp=sharing</a></p>",
        "id": 568810860,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1768831881
    },
    {
        "content": "<p>As I do have a hard time writing all of this, I wanted to ease my mind by doing some coding work on this. Looks like as I probably will get my hands dirty with exporters for citations and stuff, a better way to transfer the information about which fields actually exist etc would be VERY handy. Here's a start: <a href=\"https://github.com/gdcc/dataverse-spi/blob/core/core/src/main/java/io/gdcc/spi/core/metadata/description/Field.java\">https://github.com/gdcc/dataverse-spi/blob/core/core/src/main/java/io/gdcc/spi/core/metadata/description/Field.java</a></p>",
        "id": 569344706,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1769025781
    }
]