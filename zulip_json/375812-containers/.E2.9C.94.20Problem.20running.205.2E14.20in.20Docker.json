[
    {
        "content": "<p>We are still on 5.13 but I thought we may upgrade to 5.14 so that we have the awesome docker support out of the box.</p>\n<p>I did this:</p>\n<div class=\"codehilite\"><pre><span></span><code>git checkout v5.14\nmvn -Pct -DskipTests=true clean package\nmvn -Pct docker:run\n</code></pre></div>\n<p>The containers started up but then it failes with this:</p>\n<div class=\"codehilite\"><pre><span></span><code>dev_dataverse&gt; [#|2023-11-09T14:37:07.003+0000|INFO|Payara 6.2023.8|org.jboss.weld.Bootstrap|_ThreadID=28;_ThreadName=RunLevelControllerThread-1699540613511;_TimeMillis=1699540627003;_LevelValue=800;|\ndev_dataverse&gt;   WELD-000119: Not generating any bean definitions from org.omnifaces.cdi.push.SocketSessionManager because of underlying class loading error: Type javax.websocket.CloseReason$CloseCode not found.  If this is unexpected, enable DEBUG logging to see the full error.|#]\ndev_dataverse&gt;\ndev_dataverse&gt; [#|2023-11-09T14:37:07.011+0000|SEVERE|Payara 6.2023.8|javax.enterprise.system.core|_ThreadID=28;_ThreadName=RunLevelControllerThread-1699540613511;_TimeMillis=1699540627011;_LevelValue=1000;_MessageID=NCLS-CORE-00026;|\ndev_dataverse&gt;   Exception during lifecycle processing\ndev_dataverse&gt; org.glassfish.deployment.common.DeploymentException: CDI deployment failure:javax/faces/component/behavior/ClientBehaviorHolder -- javax/faces/component/behavior/ClientBehaviorHolder\ndev_dataverse&gt;  at java.base/java.lang.ClassLoader.defineClass1(Native Method)\ndev_dataverse&gt;  at java.base/java.lang.ClassLoader.defineClass(Unknown Source)\ndev_dataverse&gt;  at java.base/java.security.SecureClassLoader.defineClass(Unknown Source)\ndev_dataverse&gt;  at org.glassfish.web.loader.WebappClassLoader.defineLoadedClass(WebappClassLoader.java:3504)\ndev_dataverse&gt;  at org.glassfish.web.loader.WebappClassLoader.findClass(WebappClassLoader.java:1246)\ndev_dataverse&gt;  at org.glassfish.web.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1818)\ndev_dataverse&gt;  at org.glassfish.web.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1696)\ndev_dataverse&gt;  at java.base/java.lang.Class.getEnclosingMethod0(Native Method)\ndev_dataverse&gt;  at java.base/java.lang.Class.hasEnclosingMethodInfo(Unknown Source)\ndev_dataverse&gt;  at java.base/java.lang.Class.isLocalOrAnonymousClass(Unknown Source)\ndev_dataverse&gt;  at java.base/java.lang.Class.isAnonymousClass(Unknown Source)\ndev_dataverse&gt;  at org.jboss.weld.bootstrap.AnnotatedTypeLoader.internalLoadAnnotatedType(AnnotatedTypeLoader.java:92)\ndev_dataverse&gt;  at org.jboss.weld.bootstrap.AnnotatedTypeLoader.loadAnnotatedType(AnnotatedTypeLoader.java:75)\ndev_dataverse&gt;  at org.jboss.weld.bootstrap.BeanDeployer.addClass(BeanDeployer.java:92)\ndev_dataverse&gt;  at org.jboss.weld.bootstrap.BeanDeployer.addLoadedClasses(BeanDeployer.java:199)\ndev_dataverse&gt;  at org.jboss.weld.bootstrap.BeanDeployment.createClasses(BeanDeployment.java:197)\ndev_dataverse&gt;  at org.jboss.weld.bootstrap.WeldStartup.startInitialization(WeldStartup.java:409)\ndev_dataverse&gt;  at org.jboss.weld.bootstrap.WeldBootstrap.startInitialization(WeldBootstrap.java:80)\ndev_dataverse&gt;  at org.glassfish.weld.WeldDeployer.processApplicationLoaded(WeldDeployer.java:579)\ndev_dataverse&gt;  at org.glassfish.weld.WeldDeployer.event(WeldDeployer.java:437)\ndev_dataverse&gt;  at org.glassfish.kernel.event.EventsImpl.send(EventsImpl.java:131)\ndev_dataverse&gt;  at org.glassfish.internal.data.ApplicationInfo.load(ApplicationInfo.java:344)\ndev_dataverse&gt;  at com.sun.enterprise.v3.server.ApplicationLifecycle.prepare(ApplicationLifecycle.java:580)\ndev_dataverse&gt;  at org.glassfish.deployment.admin.DeployCommand.execute(DeployCommand.java:570)\ndev_dataverse&gt;  at com.sun.enterprise.v3.admin.CommandRunnerImpl$2$1.run(CommandRunnerImpl.java:556)\ndev_dataverse&gt;  at com.sun.enterprise.v3.admin.CommandRunnerImpl$2$1.run(CommandRunnerImpl.java:552)\ndev_dataverse&gt;  at java.base/java.security.AccessController.doPrivileged(Unknown Source)\ndev_dataverse&gt;  at java.base/javax.security.auth.Subject.doAs(Unknown Source)\ndev_dataverse&gt;  at com.sun.enterprise.v3.admin.CommandRunnerImpl$2.execute(CommandRunnerImpl.java:551)\ndev_dataverse&gt;  at com.sun.enterprise.v3.admin.CommandRunnerImpl$3.run(CommandRunnerImpl.java:582)\ndev_dataverse&gt;  at com.sun.enterprise.v3.admin.CommandRunnerImpl$3.run(CommandRunnerImpl.java:574)\ndev_dataverse&gt;  at java.base/java.security.AccessController.doPrivileged(Unknown Source)\ndev_dataverse&gt;  at java.base/javax.security.auth.Subject.doAs(Unknown Source)\ndev_dataverse&gt;  at com.sun.enterprise.v3.admin.CommandRunnerImpl.doCommand(CommandRunnerImpl.java:573)\ndev_dataverse&gt;  at com.sun.enterprise.v3.admin.CommandRunnerImpl.doCommand(CommandRunnerImpl.java:1497)\ndev_dataverse&gt;  at com.sun.enterprise.v3.admin.CommandRunnerImpl$ExecutionContext.execute(CommandRunnerImpl.java:1879)\ndev_dataverse&gt;  at com.sun.enterprise.v3.admin.CommandRunnerImpl$ExecutionContext.execute(CommandRunnerImpl.java:1755)\ndev_dataverse&gt;  at com.sun.enterprise.admin.cli.embeddable.CommandExecutorImpl.executeCommand(CommandExecutorImpl.java:183)\ndev_dataverse&gt;  at com.sun.enterprise.admin.cli.embeddable.CommandExecutorImpl.run(CommandExecutorImpl.java:96)\ndev_dataverse&gt;  at fish.payara.boot.runtime.BootCommand.execute(BootCommand.java:69)\ndev_dataverse&gt;  at fish.payara.boot.runtime.BootCommands.executeCommands(BootCommands.java:166)\ndev_dataverse&gt;  at fish.payara.boot.runtime.BootCommands.executeCommands(BootCommands.java:160)\ndev_dataverse&gt;  at com.sun.enterprise.v3.bootstrap.BootCommandService.doBootCommands(BootCommandService.java:81)\ndev_dataverse&gt;  at com.sun.enterprise.v3.bootstrap.BootCommandService.postConstruct(BootCommandService.java:91)\ndev_dataverse&gt;  at org.jvnet.hk2.internal.ClazzCreator.postConstructMe(ClazzCreator.java:303)\ndev_dataverse&gt;  at org.jvnet.hk2.internal.ClazzCreator.create(ClazzCreator.java:351)\ndev_dataverse&gt;  at org.jvnet.hk2.internal.SystemDescriptor.create(SystemDescriptor.java:466)\ndev_dataverse&gt;  at org.glassfish.hk2.runlevel.internal.AsyncRunLevelContext.findOrCreate(AsyncRunLevelContext.java:281)\ndev_dataverse&gt;  at org.glassfish.hk2.runlevel.RunLevelContext.findOrCreate(RunLevelContext.java:65)\ndev_dataverse&gt;  at org.jvnet.hk2.internal.Utilities.createService(Utilities.java:2103)\ndev_dataverse&gt;  at org.jvnet.hk2.internal.ServiceHandleImpl.getService(ServiceHandleImpl.java:93)\ndev_dataverse&gt;  at org.jvnet.hk2.internal.ServiceHandleImpl.getService(ServiceHandleImpl.java:67)\ndev_dataverse&gt;  at org.glassfish.hk2.runlevel.internal.CurrentTaskFuture$QueueRunner.oneJob(CurrentTaskFuture.java:1213)\ndev_dataverse&gt;  at org.glassfish.hk2.runlevel.internal.CurrentTaskFuture$QueueRunner.run(CurrentTaskFuture.java:1144)\ndev_dataverse&gt;  at org.glassfish.hk2.runlevel.internal.CurrentTaskFuture$UpOneLevel.run(CurrentTaskFuture.java:762)\ndev_dataverse&gt;  at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)\ndev_dataverse&gt;  at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)\ndev_dataverse&gt;  at java.base/java.lang.Thread.run(Unknown Source)\ndev_dataverse&gt; |#]\ndev_dataverse&gt;\n</code></pre></div>\n<p>I think the problem is that it runs Payara 6.2023.8 while the 5.14 version actually is for <code>5.2022.3</code> (based on modules/dataverse-parent/pom.xml)</p>\n<p>The docker build scripts probably take the latest version of Payara that's why we end up with 6.2023.8.</p>\n<p>Can you please help me where I could set an explicit version of Payara to be installed in the container? I just couldn't find it anywhere.</p>",
        "id": 401171424,
        "sender_full_name": "Balázs Pataki",
        "timestamp": 1699541327
    },
    {
        "content": "<p>I found this issue of Phil with a similar bug:</p>\n<p><a href=\"https://github.com/IQSS/dataverse/issues/9749\">https://github.com/IQSS/dataverse/issues/9749</a></p>\n<p>So, it may not be related to the Payara version as it was 5.2022.5 in the issue.</p>",
        "id": 401179663,
        "sender_full_name": "Balázs Pataki",
        "timestamp": 1699543678
    },
    {
        "content": "<p>As we said in the call, please check your base image and let us know if it helps!</p>",
        "id": 401181074,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1699544066
    },
    {
        "content": "<p>Yes, it was the base image. So, the best way to do is:</p>\n<div class=\"codehilite\"><pre><span></span><code>git checkout v5.14\nmvn -Pct -f modules/container-base install\nmvn -Pct clean package\nmvn -Pct docker:run\n</code></pre></div>",
        "id": 401184467,
        "sender_full_name": "Balázs Pataki",
        "timestamp": 1699545118
    },
    {
        "content": "<p>Ah, I see you mentioned the fix here too: <a href=\"https://github.com/IQSS/dataverse/issues/9749#issuecomment-1804095033\">https://github.com/IQSS/dataverse/issues/9749#issuecomment-1804095033</a></p>",
        "id": 401186128,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1699545563
    },
    {
        "content": "<p>Thanks!</p>",
        "id": 401186139,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1699545565
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"602497\">Balázs Pataki</span> has marked this topic as resolved.</p>",
        "id": 401228141,
        "sender_full_name": "Notification Bot",
        "timestamp": 1699560415
    }
]