[
    {
        "content": "<p>There might be a bug in the mp config implementation of Payara. When an even low ordinal config source has a profiled value, it seems not be overrideable from a higher ordinal source. Thanks to Johannes for pointing me to this</p>",
        "id": 358512660,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684168488
    },
    {
        "content": "<p>He was trying to override the DATAVERSE_SOLR_HOST by env var and couldn't do it. Needs to be _CT_DATAVERSE_SOLR_HOST (so with the profile name we have in the container)</p>",
        "id": 358512879,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684168531
    },
    {
        "content": "<p>Sounds like a bug to me because spec says:</p>\n<blockquote>\n<p>Conforming implementations are required to search for a configuration source with the highest ordinal (priority) that provides either the property name or the \"profile-specific\" property name. If the configuration source provides the \"profile-specific\" name, the value of the \"profile-specific\" property will be returned. If it doesnâ€™t contain the \"profile-specific\" name, the value of the plain property will be returned.</p>\n</blockquote>",
        "id": 358513000,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684168559
    },
    {
        "content": "<p>Maybe it's just me being German, but to me this sound like it should work like \"if you have a value from a higher ordinal source, that one wins\"</p>",
        "id": 358513279,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684168612
    },
    {
        "content": "<p>Looking at the spec discussion in <a href=\"https://github.com/eclipse/microprofile-config/issues/418#issuecomment-618678228\">https://github.com/eclipse/microprofile-config/issues/418#issuecomment-618678228</a>, it seems my interpretation is what was intended.</p>",
        "id": 358516491,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684169294
    },
    {
        "content": "<p>Sounds like I need to ring someone at Payara about this.</p>",
        "id": 358516549,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684169306
    },
    {
        "content": "<p>Here are the problematic lines: <a href=\"https://github.com/payara/Payara/blob/0704b24df099e928276d34e115b8ab4ae492a60a/nucleus/payara-modules/nucleus-microprofile/config-service/src/main/java/fish/payara/nucleus/microprofile/config/spi/ConfigExpressionResolver.java#L91-L118\">https://github.com/payara/Payara/blob/0704b24df099e928276d34e115b8ab4ae492a60a/nucleus/payara-modules/nucleus-microprofile/config-service/src/main/java/fish/payara/nucleus/microprofile/config/spi/ConfigExpressionResolver.java#L91-L118</a></p>",
        "id": 358517651,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684169564
    },
    {
        "content": "<p>the same issue occurs for FQDN and SITEURL</p>",
        "id": 358711375,
        "sender_full_name": "Johannes D",
        "timestamp": 1684239398
    },
    {
        "content": "<p>I think you're reading the spec right.</p>",
        "id": 358712605,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1684239700
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"598112\">Philip Durbin</span> <a href=\"#narrow/stream/375812-containers/topic/MPC.20profile.20problem/near/358712605\">said</a>:</p>\n<blockquote>\n<p>I think you're reading the spec right.</p>\n</blockquote>\n<p>I believe the current behaviour is correct. Consider this example: Given a property with one profile-specific definition via Environment variables (default ordinal=300) and one <code>default</code> definition via System properties (default ordinal=400). (Higher ordinal wins.)  With an activated profile, the profile version from the Environment  should be returned, right? This is only possible if the profile specific definition have precedence over the the ordinals. Otherwise, the activation of a profile may have no effect as default properties are available with higher ordinal ranking. This follows the intuition that a profile override default definitions.</p>",
        "id": 358721574,
        "sender_full_name": "Johannes D",
        "timestamp": 1684241586
    },
    {
        "content": "<p>I still believe that the implementation in Payara is probably violating spec. <a href=\"https://forum.payara.fish/t/microprofile-config-not-using-value-from-higher-ordinal-source-with-profile/618\">https://forum.payara.fish/t/microprofile-config-not-using-value-from-higher-ordinal-source-with-profile/618</a></p>",
        "id": 358729600,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684243235
    },
    {
        "content": "<p>But I might be wrong or not have read the code correctly</p>",
        "id": 358729696,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684243258
    },
    {
        "content": "<p>Do note though that SmallRye Config does implement this differently</p>",
        "id": 358729839,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684243284
    },
    {
        "content": "<p>It seems odd to me that two apparently compliant implementations would behave differently.</p>",
        "id": 358729981,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684243316
    },
    {
        "content": "<p>Should we create an issue for this in the Dataverse repo?</p>",
        "id": 358731869,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1684243691
    },
    {
        "content": "<p>BTW - up until now _no_ response in the forum. Wondering how much does it cost to have an Enterprise license to call support</p>",
        "id": 362482647,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1685544885
    },
    {
        "content": "<p>Good question.</p>",
        "id": 362483314,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1685545044
    },
    {
        "content": "<p>Thinking about reaching out to Emily Jiang</p>",
        "id": 362483576,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1685545096
    },
    {
        "content": "<p>Or maybe knock in MPC project. Open an issue, ask about how that part of the spec was meant to be read.</p>",
        "id": 362484071,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1685545201
    },
    {
        "content": "<p><a href=\"https://github.com/eclipse/microprofile-config/issues/781\">https://github.com/eclipse/microprofile-config/issues/781</a></p>",
        "id": 362489604,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1685546328
    },
    {
        "content": "<p>Nice writeup.</p>",
        "id": 362504348,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1685549334
    },
    {
        "content": "<p>Looks like Payara is not spec compliant... <a href=\"https://github.com/eclipse/microprofile-config/pull/782\">https://github.com/eclipse/microprofile-config/pull/782</a> Sorry <span class=\"user-mention\" data-user-id=\"617722\">@Johannes D</span>!</p>",
        "id": 370940763,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1688078296
    },
    {
        "content": "<p>Uh oh, the code formatter check got ya. <span aria-label=\"big smile\" class=\"emoji emoji-1f604\" role=\"img\" title=\"big smile\">:big_smile:</span></p>",
        "id": 374247053,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1689078242
    },
    {
        "content": "<p>Nice, <a href=\"https://github.com/eclipse/microprofile-config/pull/782\">https://github.com/eclipse/microprofile-config/pull/782</a> was merged? What's next?</p>",
        "id": 389630951,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1694084886
    },
    {
        "content": "<p>Probably we should open an issue at Payara's. Now that we are about to be on P6 with DV6, we would actually be able to use a fixed future version.</p>",
        "id": 389631251,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1694084984
    },
    {
        "content": "<p>Payara 6.2023.12 claims to be MPC 3.1 compliant. Maybe we should give this another try... MPC 3.1 contains my spec fix, so we could run the TCK again and see if it works now...</p>",
        "id": 413202662,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1705425407
    },
    {
        "content": "<p>Sounds like a good reason to upgrade.</p>",
        "id": 413207194,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1705426945
    },
    {
        "content": "<p>This is kind of related to creating versioned base images... we could let the images defer from main if needed. It seems to be a container experience issue for now, although people might want to use profiled settings in other scenarios, too</p>",
        "id": 413207613,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1705427103
    },
    {
        "content": "<p>Related to <a class=\"stream-topic\" data-stream-id=\"375812\" href=\"/#narrow/stream/375812-containers/topic/change.20version.20scheme.20base.20image.3F\">#containers &gt; change version scheme base image?</a> Yes.</p>",
        "id": 413207922,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1705427184
    },
    {
        "content": "<p>It looks like I cannot reproduce this anymore... We probably need to check this manually. Bummer that the TCK doesn't fail anymore like described in <a href=\"https://notes.desy.de/iDjhL8UESlO-_RGNKLDRZQ\">https://notes.desy.de/iDjhL8UESlO-_RGNKLDRZQ#</a></p>",
        "id": 415377679,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1705445205
    },
    {
        "content": "<p>I'm having trouble setting SITEURL too: <a class=\"stream-topic\" data-stream-id=\"375812\" href=\"/#narrow/stream/375812-containers/topic/setting.20siteUrl.20in.20containers\">#containers &gt; setting siteUrl in containers</a></p>",
        "id": 418914294,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1706646354
    },
    {
        "content": "<p>I created an issue: In containers, can't set DATAVERSE_SITEURL using documented methods <a href=\"https://github.com/IQSS/dataverse/issues/10285\">#10285</a></p>",
        "id": 418917544,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1706647737
    },
    {
        "content": "<p>It looks like they did fix the failing TCK compliance hrhr <a href=\"https://github.com/payara/Payara/commit/5bf6a6f391893ebbb83fb01b520238b0f83d61fb\">https://github.com/payara/Payara/commit/5bf6a6f391893ebbb83fb01b520238b0f83d61fb</a></p>",
        "id": 418983917,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1706687525
    },
    {
        "content": "<p>It's been included since 6.2023.11 - the first release with MP 6.1 support. That's the release with the updated MPC spec and TCK. It has not been mentioned in the release notes... And it was only tracked internally as JIRA ticket \"FISH-7689\"</p>",
        "id": 418984143,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1706687656
    },
    {
        "content": "<p>Great!</p>",
        "id": 419028074,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1706703814
    },
    {
        "content": "<p>I just created <a href=\"https://github.com/IQSS/dataverse/pull/10495\">https://github.com/IQSS/dataverse/pull/10495</a> and I can verify that this is no longer a problem!!!</p>",
        "id": 433296232,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1713188959
    },
    {
        "content": "<p>With 6.2024.4 and my fix to avoid an NPE released I declare this resolved. It's now a matter of making the upgrade to 6.2024.4, see <a class=\"stream-topic\" data-stream-id=\"375812\" href=\"/#narrow/stream/375812-containers/topic/Payara.206.2E2024.2E4\">#containers &gt; Payara 6.2024.4</a></p>",
        "id": 433296557,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1713189037
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"598183\">Oliver Bertuch</span> has marked this topic as resolved.</p>",
        "id": 433296576,
        "sender_full_name": "Notification Bot",
        "timestamp": 1713189041
    }
]