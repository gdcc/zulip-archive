[
    {
        "content": "<p>Hi everyone, I have a fresh installation of Dataverse version 6.6 using Docker containers and when I try to create a new dataset it causes an Internal Server Error. The only entry I can find in server.log is the following:</p>\n<div class=\"codehilite\"><pre><span></span><code>[2025-05-14T14:26:02.331+0000] [Payara 6.2025.2] [WARNING] [] [jakarta.enterprise.web] [tid: _ThreadID=115 _ThreadName=http-thread-pool::http-listener-1(4)] [timeMillis: 1747232762331] [levelValue: 900] [[\n  StandardWrapperValve[Faces Servlet]: Servlet.service() for servlet Faces Servlet threw exception\njava.lang.IndexOutOfBoundsException: Index 0 out of bounds for length 0\n        at java.base/jdk.internal.util.Preconditions.outOfBounds(Preconditions.java:64)\n        at java.base/jdk.internal.util.Preconditions.outOfBoundsCheckIndex(Preconditions.java:70)\n        at java.base/jdk.internal.util.Preconditions.checkIndex(Preconditions.java:266)\n        at java.base/java.util.Objects.checkIndex(Objects.java:361)\n        at java.base/java.util.ArrayList.get(ArrayList.java:427)\n        at edu.harvard.iq.dataverse.DatasetPage.resetVersionUI(DatasetPage.java:2624)\n        at edu.harvard.iq.dataverse.DatasetPage.init(DatasetPage.java:2223)\n        at edu.harvard.iq.dataverse.DatasetPage.init(DatasetPage.java:1933)\n        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.base/java.lang.reflect.Method.invoke(Method.java:569)\n        at org.glassfish.expressly.util.ReflectionUtil.invokeMethod(ReflectionUtil.java:186)\n        at org.glassfish.expressly.parser.AstValue.invoke(AstValue.java:253)\n        at org.glassfish.expressly.MethodExpressionImpl.invoke(MethodExpressionImpl.java:248)\n        at org.jboss.weld.module.web.util.el.ForwardingMethodExpression.invoke(ForwardingMethodExpression.java:40)\n        at org.jboss.weld.module.web.el.WeldMethodExpression.invoke(WeldMethodExpression.java:50)\n        at com.sun.faces.facelets.el.TagMethodExpression.invoke(TagMethodExpression.java:70)\n        at com.sun.faces.application.ActionListenerImpl.getNavigationOutcome(ActionListenerImpl.java:74)\n        at com.sun.faces.application.ActionListenerImpl.processAction(ActionListenerImpl.java:62)\n        at jakarta.faces.component.UIViewAction.broadcast(UIViewAction.java:506)\n        at jakarta.faces.component.UIViewRoot.broadcastEvents(UIViewRoot.java:858)\n        at jakarta.faces.component.UIViewRoot.processApplication(UIViewRoot.java:1338)\n        at com.sun.faces.lifecycle.InvokeApplicationPhase.execute(InvokeApplicationPhase.java:56)\n        at com.sun.faces.lifecycle.Phase.doPhase(Phase.java:72)\n        at com.sun.faces.lifecycle.LifecycleImpl.execute(LifecycleImpl.java:131)\n        at jakarta.faces.webapp.FacesServlet.executeLifecyle(FacesServlet.java:691)\n        at jakarta.faces.webapp.FacesServlet.service(FacesServlet.java:449)\n        at org.apache.catalina.core.StandardWrapper.service(StandardWrapper.java:1554)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:331)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:211)\n        at org.glassfish.tyrus.servlet.TyrusServletFilter.doFilter(TyrusServletFilter.java:83)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:253)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:211)\n        at org.ocpsoft.rewrite.servlet.RewriteFilter.doFilter(RewriteFilter.java:226)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:253)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:211)\n        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:257)\n        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:166)\n        at org.apache.catalina.core.StandardPipeline.doInvoke(StandardPipeline.java:757)\n        at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:577)\n        at com.sun.enterprise.web.WebPipeline.invoke(WebPipeline.java:99)\n        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:158)\n        at org.apache.catalina.connector.CoyoteAdapter.doService(CoyoteAdapter.java:372)\n        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:239)\n        at com.sun.enterprise.v3.services.impl.ContainerMapper$HttpHandlerCallable.call(ContainerMapper.java:520)\n        at com.sun.enterprise.v3.services.impl.ContainerMapper.service(ContainerMapper.java:217)\n        at org.glassfish.grizzly.http.server.HttpHandler.runService(HttpHandler.java:174)\n        at org.glassfish.grizzly.http.server.HttpHandler.doHandle(HttpHandler.java:153)\n        at org.glassfish.grizzly.http.server.HttpServerFilter.handleRead(HttpServerFilter.java:196)\n        at org.glassfish.grizzly.filterchain.ExecutorResolver$9.execute(ExecutorResolver.java:88)\n        at org.glassfish.grizzly.filterchain.DefaultFilterChain.executeFilter(DefaultFilterChain.java:246)\n        at org.glassfish.grizzly.filterchain.DefaultFilterChain.executeChainPart(DefaultFilterChain.java:178)\n        at org.glassfish.grizzly.filterchain.DefaultFilterChain.execute(DefaultFilterChain.java:118)\n        at org.glassfish.grizzly.filterchain.DefaultFilterChain.process(DefaultFilterChain.java:96)\n        at org.glassfish.grizzly.ProcessorExecutor.execute(ProcessorExecutor.java:51)\n        at org.glassfish.grizzly.nio.transport.TCPNIOTransport.fireIOEvent(TCPNIOTransport.java:510)\n        at org.glassfish.grizzly.strategies.AbstractIOStrategy.fireIOEvent(AbstractIOStrategy.java:82)\n        at org.glassfish.grizzly.strategies.WorkerThreadIOStrategy.run0(WorkerThreadIOStrategy.java:83)\n        at org.glassfish.grizzly.strategies.WorkerThreadIOStrategy$WorkerThreadRunnable.run(WorkerThreadIOStrategy.java:101)\n        at org.glassfish.grizzly.threadpool.AbstractThreadPool$Worker.doWork(AbstractThreadPool.java:535)\n        at org.glassfish.grizzly.threadpool.AbstractThreadPool$Worker.run(AbstractThreadPool.java:515)\n        at java.base/java.lang.Thread.run(Thread.java:840)\n]]\n</code></pre></div>\n<p>Any ideas of what could be causing this error?</p>",
        "id": 518082813,
        "sender_full_name": "César Ferreira",
        "timestamp": 1747233061
    },
    {
        "content": "<p>That's the complete server.log file?</p>",
        "id": 518085239,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1747233617
    },
    {
        "content": "<p>That's only the last entry from server.log, which is the only one that appears with the error.</p>",
        "id": 518085777,
        "sender_full_name": "César Ferreira",
        "timestamp": 1747233743
    },
    {
        "content": "<p>very strange</p>",
        "id": 518086890,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1747234014
    },
    {
        "content": "<p>So you're saying you're getting that index out of bounds exception here: <a href=\"https://github.com/IQSS/dataverse/blob/v6.6/src/main/java/edu/harvard/iq/dataverse/DatasetPage.java#L2624\">https://github.com/IQSS/dataverse/blob/v6.6/src/main/java/edu/harvard/iq/dataverse/DatasetPage.java#L2624</a></p>",
        "id": 518086955,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1747234029
    },
    {
        "content": "<p>It looks like that code was touched for 6.6 in this PR: ORCID: Support authenticated ORCIDs in account profile <a href=\"https://github.com/IQSS/dataverse/issues/11222\">#11222</a></p>",
        "id": 518087653,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1747234201
    },
    {
        "content": "<p>How does the author info look when you are entering it? Can you please share a screenshot?</p>",
        "id": 518088091,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1747234300
    },
    {
        "content": "<p>I can't even get to the creation page, when I click on <code>New Dataset</code> it returns the Internal Server Error page. I am using the user dataverseAdmin. The line of the code you sent refers to first name and last name, which looks to be correctly set for that user.</p>",
        "id": 518088865,
        "sender_full_name": "César Ferreira",
        "timestamp": 1747234487
    },
    {
        "content": "<p>I created a new user, to check if it was only happening for dataverseAdmin, but it looks like it is happening for all users.</p>\n<p>While looking at <code>server.log</code>, I also found at the beginning  a lot of SEVERE entries like this, all for <code>.jar</code> files inside <code>/usr/local/payara6/glassfish/domains/domain1/applications/dataverse/WEB-INF/lib/</code>:</p>\n<div class=\"codehilite\"><pre><span></span><code>[2025-05-14T13:54:50.207+0000] [Payara 6.2025.2] [SEVERE] [] [javax.enterprise.system.tools.deployment.common] [tid: _ThreadID=166 _ThreadName=payara-executor-service-task] [timeMillis: 1747230890207] [levelValue: 1000] [[\n  Exception while parsing file file:/usr/local/payara6/glassfish/domains/domain1/applications/dataverse/WEB-INF/lib/antlr4-runtime-4.12.0.jar\njava.lang.RuntimeException: java.io.IOException: invalid zip file: file:/usr/local/payara6/glassfish/domains/domain1/applications/dataverse/WEB-INF/lib/antlr4-runtime-4.12.0.jar\n    at com.sun.enterprise.deployment.deploy.shared.InputJarArchive.entries(InputJarArchive.java:205)\n    at com.sun.enterprise.deployment.deploy.shared.InputJarArchive.entries(InputJarArchive.java:182)\n    at com.sun.enterprise.v3.server.ReadableArchiveScannerAdapter.onSelectedEntries(ReadableArchiveScannerAdapter.java:125)\n    at org.glassfish.hk2.classmodel.reflect.Parser.doJob(Parser.java:321)\n    at org.glassfish.hk2.classmodel.reflect.Parser$3.call(Parser.java:280)\n    at org.glassfish.hk2.classmodel.reflect.Parser$3.call(Parser.java:269)\n    at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n    at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n    at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n    at java.base/java.lang.Thread.run(Thread.java:840)\nCaused by: java.io.IOException: invalid zip file: file:/usr/local/payara6/glassfish/domains/domain1/applications/dataverse/WEB-INF/lib/antlr4-runtime-4.12.0.jar\n    at com.sun.enterprise.deployment.deploy.shared.InputJarArchive$ArchiveJarEntrySource.&lt;init&gt;(InputJarArchive.java:589)\n    at com.sun.enterprise.deployment.deploy.shared.InputJarArchive.createEntryEnumeration(InputJarArchive.java:458)\n    at com.sun.enterprise.deployment.deploy.shared.InputJarArchive.entries(InputJarArchive.java:203)\n    ... 9 more\n]]\n</code></pre></div>\n<p>Could this be the cause? On the dashboard page I noticed that some elements are not rendering correctly, like this:<br>\n<a href=\"/user_uploads/53090/-iFmsFLAv8qMkd1DX_RJHwZ_/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/53090/-iFmsFLAv8qMkd1DX_RJHwZ_/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"820x439\" src=\"/user_uploads/thumbnail/53090/-iFmsFLAv8qMkd1DX_RJHwZ_/image.png/840x560.webp\"></a></div>",
        "id": 518094089,
        "sender_full_name": "César Ferreira",
        "timestamp": 1747235687
    },
    {
        "content": "<p>Strange. How are you running Dataverse? You mentioned Docker. Are you following <a href=\"https://guides.dataverse.org/en/6.6/container/running/demo.html\">https://guides.dataverse.org/en/6.6/container/running/demo.html</a> ?</p>",
        "id": 518097014,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1747236400
    },
    {
        "content": "<p>No, I am following our repository <a href=\"https://gitlab.com/lip-computing/dataverse\">https://gitlab.com/lip-computing/dataverse</a>.</p>",
        "id": 518097477,
        "sender_full_name": "César Ferreira",
        "timestamp": 1747236508
    },
    {
        "content": "<p>As a sanity check, could you please try that \"demo\" tutorial?</p>",
        "id": 518099897,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1747237160
    },
    {
        "content": "<p>I was using older versions of the metadatablocks <code>.tsv</code> files, thats why I was getting that index out of bounds error.</p>",
        "id": 518102366,
        "sender_full_name": "César Ferreira",
        "timestamp": 1747237771
    },
    {
        "content": "<p>Ah, sounds like you figured it out. Great!</p>",
        "id": 518102626,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1747237832
    },
    {
        "content": "<p>Thank you for the help <span class=\"user-mention\" data-user-id=\"598112\">@Philip Durbin ☀️</span> .<br>\nTwo more things:</p>\n<ul>\n<li>\n<p>This problem is probably happening because of the language packages, right?<br>\n<a href=\"/user_uploads/53090/O1Nmec1Aq0CheKYuMI4RcmX-/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/53090/O1Nmec1Aq0CheKYuMI4RcmX-/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"524x242\" src=\"/user_uploads/thumbnail/53090/O1Nmec1Aq0CheKYuMI4RcmX-/image.png/840x560.webp\"></a></div></li>\n<li>\n<p>Regarding the SEVERE log entries for the <code>.jar</code> files, any idea of what could be causing them?</p>\n</li>\n</ul>",
        "id": 518103255,
        "sender_full_name": "César Ferreira",
        "timestamp": 1747237992
    },
    {
        "content": "<p>Yes, the ??? is probably from out of date properties files.</p>",
        "id": 518103512,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1747238052
    },
    {
        "content": "<p>I'm not sure what to say about the jar file. I have it locally too:</p>\n<div class=\"codehilite\"><pre><span></span><code>% find . | grep antlr4-runtime\n./target/dataverse/WEB-INF/lib/antlr4-runtime-4.12.0.jar\n./target/docker/gdcc/dataverse/unstable/build/maven/deps/antlr4-runtime-4.12.0.jar\n</code></pre></div>\n<p><span class=\"user-mention\" data-user-id=\"598183\">@Oliver Bertuch</span> might know. He contributes to Payara.</p>",
        "id": 518103940,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1747238163
    },
    {
        "content": "<p>For the language packages I am using the ones from <a href=\"https://github.com/GlobalDataverseCommunityConsortium/dataverse-language-packs.git\">https://github.com/GlobalDataverseCommunityConsortium/dataverse-language-packs.git</a> version 6.4. I searched in <code>Bundle.properties</code> and the var names do not match with the ones presented <a href=\"https://github.com/GlobalDataverseCommunityConsortium/dataverse-language-packs/blob/bf38c1607f87574a6a33c3f5d9d27b7c162de604/en_US/Bundle.properties#L525\">https://github.com/GlobalDataverseCommunityConsortium/dataverse-language-packs/blob/bf38c1607f87574a6a33c3f5d9d27b7c162de604/en_US/Bundle.properties#L525</a>:<br>\n<a href=\"/user_uploads/53090/ct5-Qd1oKq7t_ONI8k1TwuYj/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/53090/ct5-Qd1oKq7t_ONI8k1TwuYj/image.png\" title=\"image.png\"><img data-original-content-type=\"image/png\" data-original-dimensions=\"1129x347\" src=\"/user_uploads/thumbnail/53090/ct5-Qd1oKq7t_ONI8k1TwuYj/image.png/840x560.webp\"></a></div>",
        "id": 518105328,
        "sender_full_name": "César Ferreira",
        "timestamp": 1747238483
    },
    {
        "content": "<p>Hmm, Jayanthy knows more about that repo than I do. You could open an issue.</p>",
        "id": 518106175,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1747238669
    },
    {
        "content": "<p>What if you get them from <a href=\"https://github.com/IQSS/dataverse/tree/v6.4\">https://github.com/IQSS/dataverse/tree/v6.4</a> ?</p>",
        "id": 518106240,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1747238690
    },
    {
        "content": "<p>Actually I am using Dataverse v6.6, the language packages are v6.4 just because it is the most recent version available on that repository. For now I can remove these packages and use the ones that come bundled with Dataverse by default.</p>",
        "id": 518107073,
        "sender_full_name": "César Ferreira",
        "timestamp": 1747238927
    },
    {
        "content": "<p>Sure, sounds good.</p>",
        "id": 518107539,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1747239061
    }
]