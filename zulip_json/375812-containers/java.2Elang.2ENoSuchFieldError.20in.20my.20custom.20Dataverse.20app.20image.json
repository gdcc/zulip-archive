[
    {
        "content": "<p>Hi, I am encountering a weird error I am not sure how to fix. If someone here had an idea, I would be very grateful.</p>\n<p>I am building my own custom Dataverse app image off my own branch, which is based on the current v6.6 master branch, plus some of my own commits. Until today, this was working OK, but now I the containers I start using my custom image fail with the following error:</p>\n<div class=\"codehilite\"><pre><span></span><code>[#|2025-06-12T14:11:06.108+0000|SEVERE|Payara 6.2025.2|javax.enterprise.system.core|_ThreadID=29;_ThreadName=RunLevelControllerThread-1749737428556;_TimeMillis=1749737466108;_LevelValue=1000;|\n  Exception while loading the app : java.lang.IllegalStateException: ContainerBase.addChild: start: org.apache.catalina.LifecycleException: org.apache.catalina.LifecycleException: java.lang.NoSuchFieldError: API_BLOCKED_POLICY|#]\n\n[#|2025-06-12T14:11:06.109+0000|WARNING|Payara 6.2025.2|fish.payara.boot.runtime.BootCommand|_ThreadID=29;_ThreadName=RunLevelControllerThread-1749737428556;_TimeMillis=1749737466109;_LevelValue=900;|\n  Boot Command deploy failed PlainTextActionReporterFAILUREDescription: deploy AdminCommandError occurred during deployment: Exception while loading the app : java.lang.IllegalStateException: ContainerBase.addChild: start: org.apache.catalina.LifecycleException: org.apache.catalina.LifecycleException: java.lang.NoSuchFieldError: API_BLOCKED_POLICY. Please see server.log for more details.\n</code></pre></div>\n<p>I've actually seen this error before. I built my custom app image using the <code>unstable</code> base image, which apparently included a change that introduced <code>API_BLOCKED_POLICY</code> (which is not present in v6.6, so it's also not present in my branch). I solved it by setting <code>-Dbase.image=gdcc/base:6.6-noble</code> (instead of default <code>gdcc/base:unstable</code>).</p>\n<p>But today I built some new images and they're failing with that error again. I saw that the <code>base:6.6-noble</code> image has recently been pushed (3 days ago), and thought maybe there was a mistake made with that push. But now I've even tried to build my image with <code>-Dbase.image=gdcc/base:6.6-noble-r0</code> because that hasn't had any pushes in 2 months, and I'm still getting the error. <span aria-label=\"sweat\" class=\"emoji emoji-1f613\" role=\"img\" title=\"sweat\">:sweat:</span></p>\n<p>As I said, if anyone had an idea what's causing it, I'd be very grateful! Thanks!</p>",
        "id": 523772244,
        "sender_full_name": "Vera Clemens",
        "timestamp": 1749739173
    },
    {
        "content": "<p>Not sure what's going on here. Some notes: the -rX images are the fixed tags, so their content will not change once created. Which JDK version are you using to build the images? We've seen weird stuff happening due to this and this might be another one.</p>",
        "id": 524100563,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1749956397
    },
    {
        "content": "<p>I am not sure what you are referring to when you mention API_BLOCKED_POLICY. To my knowledge, that's not an env var the base image defines?!</p>",
        "id": 524100689,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1749956564
    },
    {
        "content": "<p>I believe API_BLOCKED_POLICY refers to this newly introduced JvmSetting: <a href=\"https://github.com/IQSS/dataverse/blob/develop/src/main/java/edu/harvard/iq/dataverse/api/filter/ApiBlockingFilter.java#L81\">https://github.com/IQSS/dataverse/blob/develop/src/main/java/edu/harvard/iq/dataverse/api/filter/ApiBlockingFilter.java#L81</a></p>",
        "id": 524204143,
        "sender_full_name": "Vera Clemens",
        "timestamp": 1750062437
    },
    {
        "content": "<p>It's present on develop, but not on master/my branch.</p>",
        "id": 524204211,
        "sender_full_name": "Vera Clemens",
        "timestamp": 1750062465
    },
    {
        "content": "<p>My JDK version is this: <code>openjdk version \"17.0.15\" 2025-04-15</code></p>",
        "id": 524204381,
        "sender_full_name": "Vera Clemens",
        "timestamp": 1750062533
    },
    {
        "content": "<p>OK, seems like I fixed it by setting <code>-Dbase.image.tag=6.6-noble</code>. It seems like <code>-Dbase.image=gdcc/base:6.6-noble</code> wasn't correct.</p>",
        "id": 524212791,
        "sender_full_name": "Vera Clemens",
        "timestamp": 1750065567
    },
    {
        "content": "<p>Yes, it was added recently, in <a href=\"https://github.com/IQSS/dataverse/issues/11454\">#11454</a>.</p>",
        "id": 524238713,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1750074792
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"616555\">@Vera Clemens</span> have you pushed your branch anywhere? Should we try it?</p>",
        "id": 524323378,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1750103322
    },
    {
        "content": "<p>I suppose the environment variable needs to be DATAVERSE_API_BLOCKED_POLICY as it uses mpconfig.</p>",
        "id": 524784976,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1750281451
    },
    {
        "content": "<p>Not sure why base.image wouldn't work for you though.</p>",
        "id": 524785131,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1750281526
    }
]