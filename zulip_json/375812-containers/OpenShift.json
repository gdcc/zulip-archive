[
    {
        "content": "<p>\"The MOC team wants to test a containerized Dataverse installation on the MOC infrastructure to support large data and computing.\" -- <a href=\"https://github.com/IQSS/dataverse-pm/issues/105\">https://github.com/IQSS/dataverse-pm/issues/105</a></p>",
        "id": 408633083,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1702912900
    },
    {
        "content": "<p>A nice update posted to Slack just now. The containers are working!</p>",
        "id": 419854249,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1707144028
    },
    {
        "content": "<p>I'm hacking on OpenShift support. Having some progress, but really slow</p>",
        "id": 420467655,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1707401950
    },
    {
        "content": "<p>Currently customizing the base image to be more OpenShift security policy friendly</p>",
        "id": 420467721,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1707401975
    },
    {
        "content": "<p>Great news!</p>",
        "id": 420469130,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1707402368
    },
    {
        "content": "<p>PROGRESS!<br>\n<a href=\"/user_uploads/53090/ejKNFgf5EQ6wEd9Hjiy2Sf4v/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/53090/ejKNFgf5EQ6wEd9Hjiy2Sf4v/image.png\" title=\"image.png\"><img src=\"/user_uploads/53090/ejKNFgf5EQ6wEd9Hjiy2Sf4v/image.png\"></a></div>",
        "id": 420700080,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1707500145
    },
    {
        "content": "<p>go go go! <img alt=\":dataverse_man:\" class=\"emoji\" src=\"https://zulip-avatars.s3.amazonaws.com/53090/emoji/images/44207.png\" title=\"dataverse man\"></p>",
        "id": 420700361,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1707500257
    },
    {
        "content": "<p><a href=\"https://github.com/IQSS/dataverse/pull/10314\">https://github.com/IQSS/dataverse/pull/10314</a></p>",
        "id": 420704075,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1707501673
    },
    {
        "content": "<p>Here's what I have so far</p>",
        "id": 420704097,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1707501680
    },
    {
        "content": "<p>Not much yet, but a start. Next up: adding Solr dependency</p>",
        "id": 420704236,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1707501724
    },
    {
        "content": "<p>At least I can start Dataverse and get to a successful deploy and bootstrap <span aria-label=\"grinning face with smiling eyes\" class=\"emoji emoji-1f601\" role=\"img\" title=\"grinning face with smiling eyes\">:grinning_face_with_smiling_eyes:</span></p>",
        "id": 420704307,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1707501749
    },
    {
        "content": "<p>Ah, you even link to CRC. Great. Doing a million things but I'll try to get it installed after lunch. This looks great! Thanks, <span class=\"user-mention\" data-user-id=\"598183\">@Oliver Bertuch</span> ! <img alt=\":dataverse_man:\" class=\"emoji\" src=\"https://zulip-avatars.s3.amazonaws.com/53090/emoji/images/44207.png\" title=\"dataverse man\"></p>",
        "id": 420704960,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1707502007
    },
    {
        "content": "<p>Technically, it _should_ also work with the K8s cluster in Docker Desktop</p>",
        "id": 420705358,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1707502162
    },
    {
        "content": "<p>There even is an extension for it: <a href=\"https://developers.redhat.com/articles/2022/05/10/introducing-red-hat-openshift-extension-docker-desktop\">https://developers.redhat.com/articles/2022/05/10/introducing-red-hat-openshift-extension-docker-desktop</a></p>",
        "id": 420705433,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1707502200
    },
    {
        "content": "<p>Your mileage may vary!</p>",
        "id": 420705518,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1707502214
    },
    {
        "content": "<p>Yes, I believe Leonid played around with that extension.</p>",
        "id": 420716057,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1707506374
    },
    {
        "content": "<p>Looks kinda abandoned...</p>",
        "id": 420716095,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1707506393
    },
    {
        "content": "<p>No commit for 2 years</p>",
        "id": 420716113,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1707506399
    },
    {
        "content": "<p>There're the docs for the normal k8s cluster in docker desktop: <a href=\"https://docs.docker.com/desktop/kubernetes/\">https://docs.docker.com/desktop/kubernetes/</a></p>",
        "id": 420716493,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1707506532
    },
    {
        "content": "<p>I'm getting an error when I try to use PR <a href=\"https://github.com/IQSS/dataverse/issues/10314\">#10314</a>:</p>\n<div class=\"codehilite\"><pre><span></span><code>pdurbin@air dataverse % mvn -Pct k8s:resource k8s:deploy\n[INFO] Scanning for projects...\nDownloading from central: https://repo.maven.apache.org/maven2/org/codehaus/mojo/maven-metadata.xml\nDownloading from central: https://repo.maven.apache.org/maven2/org/apache/maven/plugins/maven-metadata.xml\nDownloaded from central: https://repo.maven.apache.org/maven2/org/codehaus/mojo/maven-metadata.xml (21 kB at 108 kB/s)\nDownloaded from central: https://repo.maven.apache.org/maven2/org/apache/maven/plugins/maven-metadata.xml (14 kB at 75 kB/s)\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time:  0.879 s\n[INFO] Finished at: 2024-02-10T11:18:08-05:00\n[INFO] ------------------------------------------------------------------------\n[ERROR] No plugin found for prefix &#39;k8s&#39; in the current project and in the plugin groups [org.apache.maven.plugins, org.codehaus.mojo] available from the repositories [local (/Users/pdurbin/.m2/repository), central (https://repo.maven.apache.org/maven2)] -&gt; [Help 1]\n[ERROR]\n[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\n[ERROR] Re-run Maven using the -X switch to enable full debug logging.\n[ERROR]\n[ERROR] For more information about the errors and possible solutions, please read the following articles:\n[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/NoPluginFoundForPrefixException\n</code></pre></div>",
        "id": 420812544,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1707581963
    },
    {
        "content": "<p>My money <span aria-label=\"money\" class=\"emoji emoji-1f4b0\" role=\"img\" title=\"money\">:money:</span> is on you forgot to <code>cd</code> into <code>modules/container-k8s</code></p>",
        "id": 420812693,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1707582080
    },
    {
        "content": "<p><img alt=\":doh:\" class=\"emoji\" src=\"https://zulip-avatars.s3.amazonaws.com/53090/emoji/images/48103.png\" title=\"doh\"></p>",
        "id": 420840965,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1707607574
    },
    {
        "content": "<p>Thanks, something is happening!</p>\n<div class=\"codehilite\"><pre><span></span><code>pdurbin@air container-k8s % eval $(crc oc-env)\npdurbin@air container-k8s % oc get pods -w\nNAME                        READY   STATUS    RESTARTS   AGE\ndataverse-894d594c7-xdr2x   0/2     Pending   0          45s\npostgres-6c788b5588-2gvn4   1/1     Running   0          45s\n</code></pre></div>",
        "id": 420840973,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1707607587
    },
    {
        "content": "<p>I had to do just <code>crc start</code> though because <code>crc start -c 8 -d 64 -m 16384</code> (and lower amounts of memory and cpu) keeps failing on my laptop at home. <span aria-label=\"disappointed\" class=\"emoji emoji-1f61e\" role=\"img\" title=\"disappointed\">:disappointed:</span></p>",
        "id": 420841188,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1707607807
    },
    {
        "content": "<p>Nothing seems to be happening. <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 420841351,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1707607999
    },
    {
        "content": "<p>I did <code>crc stop</code> and <code>crc delete</code> and tried again with more memory <code>crc start -m 12288</code> (12 GB instead of 9). I have 16 GB on this laptop.</p>",
        "id": 420842368,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1707609120
    },
    {
        "content": "<p>Hmm, some kind of error, I guess:</p>\n<div class=\"codehilite\"><pre><span></span><code>pdurbin@air container-k8s % oc get pods -w\nNAME                        READY   STATUS              RESTARTS   AGE\ndataverse-894d594c7-xm8tw   0/2     ContainerCreating   0          6s\npostgres-6c788b5588-8vh2s   0/1     ContainerCreating   0          6s\npostgres-6c788b5588-8vh2s   0/1     Running             0          14s\npostgres-6c788b5588-8vh2s   1/1     Running             0          21s\ndataverse-894d594c7-xm8tw   1/2     Running             0          39s\ndataverse-894d594c7-xm8tw   0/2     Error               0          3m39s\ndataverse-894d594c7-xm8tw   1/2     Running             1 (2s ago)   3m40s\n</code></pre></div>",
        "id": 420842469,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1707609152
    },
    {
        "content": "<p><code>Caused by: edu.harvard.iq.dataverse.settings.ConfigCheckService$ConfigurationError: Not all configuration checks passed successfully. See logs above.</code></p>",
        "id": 420842499,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1707609216
    },
    {
        "content": "<p><code>Directory /dv/docroot for docroot space (see dataverse.files.docroot) exists, but is not writeable|#]</code></p>",
        "id": 420842632,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1707609363
    },
    {
        "content": "<p>At work, where I have double the RAM (32 GB), <code>crc start -c 8 -d 64 -m 16384</code> from <a href=\"https://github.com/IQSS/dataverse/pull/10314\">the PR</a> works, but I get the same \"directory not writeable\" error:</p>\n<p><a href=\"/user_uploads/53090/RIazioquCpf_cgd4ZhMyF-Gh/Screenshot-2024-02-12-at-1.13.59-PM.png\">Screenshot-2024-02-12-at-1.13.59-PM.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/53090/RIazioquCpf_cgd4ZhMyF-Gh/Screenshot-2024-02-12-at-1.13.59-PM.png\" title=\"Screenshot-2024-02-12-at-1.13.59-PM.png\"><img src=\"/user_uploads/53090/RIazioquCpf_cgd4ZhMyF-Gh/Screenshot-2024-02-12-at-1.13.59-PM.png\"></a></div>",
        "id": 421098589,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1707761761
    },
    {
        "content": "<p>Great meeting, thanks all. I'll post the video as soon as I get it. For now here are the notes: <a href=\"https://docs.google.com/document/d/1eKZANop8IXgM2s6h_UQ14bAO2R0Xn_xo0wEE-WdfKVg/edit?usp=sharing\">https://docs.google.com/document/d/1eKZANop8IXgM2s6h_UQ14bAO2R0Xn_xo0wEE-WdfKVg/edit?usp=sharing</a></p>",
        "id": 421684755,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1708012320
    },
    {
        "content": "<p>One thing that was bothering me was that while we did see the <code>ERROR StatusLogger</code> message on my machine too, we determined it was non-fatal, but then we didn't go on to see what the next fatal error is.</p>",
        "id": 421685057,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1708012395
    },
    {
        "content": "<p>It turns out I can get a version from the API at least:</p>\n<p><a href=\"/user_uploads/53090/RMctXWuxoi6iUpom5TkAafac/Screenshot-2024-02-15-at-10.50.58-AM.png\">Screenshot-2024-02-15-at-10.50.58-AM.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/53090/RMctXWuxoi6iUpom5TkAafac/Screenshot-2024-02-15-at-10.50.58-AM.png\" title=\"Screenshot-2024-02-15-at-10.50.58-AM.png\"><img src=\"/user_uploads/53090/RMctXWuxoi6iUpom5TkAafac/Screenshot-2024-02-15-at-10.50.58-AM.png\"></a></div>",
        "id": 421685345,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1708012469
    },
    {
        "content": "<p>One thing I'm confused about is how to access Dataverse from the host, from my Mac. Under \"details\" I can see a Pod IP of 10.217.0.63 and a Host IP of 192.168.126.11 but they both timeout when I try to reach them.</p>",
        "id": 421685840,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1708012589
    },
    {
        "content": "<p>Oh, I should point out that this is with the suggestion from Danni that I showed in the meeting, a change to <code>modules/container-k8s/src/main/jkube/dataverse-deployment.yaml</code>:</p>\n<div class=\"codehilite\"><pre><span></span><code>   replicas: 1\n   template:\n     spec:\n+      securityContext:\n+        runAsUser: 1000\n+        fsGroup: 1000\n       containers:\n         - name: dataverse\n           image: ghcr.io/gdcc/dataverse:openshift-poc\n</code></pre></div>",
        "id": 421686432,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1708012743
    },
    {
        "content": "<p>It looks like the root collection was created, great.</p>\n<div class=\"codehilite\"><pre><span></span><code>$ kubectl exec --stdin --tty dataverse-5f6bb9f895-lrfvb -- bash\nDefaulted container &quot;dataverse&quot; out of: dataverse, bootstrap\npayara@dataverse-5f6bb9f895-lrfvb:~$ curl -s localhost:8080/api/dataverses/:root | jq .\n{\n  &quot;status&quot;: &quot;OK&quot;,\n  &quot;data&quot;: {\n    &quot;id&quot;: 1,\n    &quot;alias&quot;: &quot;root&quot;,\n    &quot;name&quot;: &quot;Root&quot;,\n    &quot;dataverseContacts&quot;: [\n      {\n        &quot;displayOrder&quot;: 0,\n        &quot;contactEmail&quot;: &quot;root@mailinator.com&quot;\n      }\n    ],\n    &quot;permissionRoot&quot;: true,\n    &quot;description&quot;: &quot;The root dataverse.&quot;,\n    &quot;dataverseType&quot;: &quot;UNCATEGORIZED&quot;,\n    &quot;creationDate&quot;: &quot;2024-02-15T14:29:34Z&quot;\n  }\n}\n</code></pre></div>",
        "id": 421725928,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1708025484
    },
    {
        "content": "<p>I'm exec'ing into the container because I'm not sure how to access these API endpoints from the host, my Mac. <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 421726324,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1708025639
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"598183\">@Oliver Bertuch</span> or <span class=\"user-mention\" data-user-id=\"692013\">@Danni Shi</span> do you know?</p>",
        "id": 421726567,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1708025731
    },
    {
        "content": "<p>Oh, my bad, it's right in the description of <a href=\"https://github.com/IQSS/dataverse/issues/10314\">#10314</a>:</p>\n<div class=\"codehilite\"><pre><span></span><code>$ oc port-forward pods/dataverse-5f6bb9f895-lrfvb 8080\nForwarding from 127.0.0.1:8080 -&gt; 8080\nForwarding from [::1]:8080 -&gt; 8080\n</code></pre></div>",
        "id": 421728401,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1708026375
    },
    {
        "content": "<p>It works!</p>\n<p><a href=\"/user_uploads/53090/2dykNty-6-FhQd8fMSMc_-uH/Screenshot-2024-02-15-at-2.45.45-PM.png\">Screenshot-2024-02-15-at-2.45.45-PM.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/53090/2dykNty-6-FhQd8fMSMc_-uH/Screenshot-2024-02-15-at-2.45.45-PM.png\" title=\"Screenshot-2024-02-15-at-2.45.45-PM.png\"><img src=\"/user_uploads/53090/2dykNty-6-FhQd8fMSMc_-uH/Screenshot-2024-02-15-at-2.45.45-PM.png\"></a></div>",
        "id": 421728456,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1708026399
    },
    {
        "content": "<p>Like Oliver said during the meeting, there's Solr work to do but this is great progress!</p>",
        "id": 421728538,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1708026428
    },
    {
        "content": "<p>Shouldn't this go in a YAML file? I'd rather not run this command every time.</p>",
        "id": 421741609,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1708031512
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"598183\">@Oliver Bertuch</span> should we go ahead and add the commit above about securityContext/runAsUser to <a href=\"https://github.com/IQSS/dataverse/issues/10314\">#10314</a>? Maybe with a TODO to remove it some day?</p>",
        "id": 421847115,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1708085640
    },
    {
        "content": "<p>Ok, I just merged <a href=\"https://github.com/IQSS/dataverse/issues/10314\">#10314</a> BUT before I did, I narrowed the scope, as discussed with Oliver earlier today. We need the various fixes to get our images running under OpenShift. However, I removed the other stuff we don't need yet, the config files, etc.</p>",
        "id": 423093484,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1708721867
    },
    {
        "content": "<p>That's why I changed the title of the PR to \"OpenShift prep work\". I think this better reflects what I merged.</p>",
        "id": 423093646,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1708721918
    },
    {
        "content": "<p>Anyway, onwards with <a href=\"https://github.com/IQSS/dataverse/issues/10337\">#10337</a> and an operator! Oliver already pushed some code for us to look at! <a href=\"https://github.com/IQSS/dataverse/compare/develop...10337-k8s-operator\">https://github.com/IQSS/dataverse/compare/develop...10337-k8s-operator</a></p>",
        "id": 423093820,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1708721988
    },
    {
        "content": "<p>And there's a dedicated topic: <a class=\"stream-topic\" data-stream-id=\"375812\" href=\"/#narrow/stream/375812-containers/topic/dvopa.20K8s.20Operator.20.2310337\">#containers &gt; dvopa K8s Operator #10337</a></p>",
        "id": 423095518,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1708722664
    },
    {
        "content": "<p>I successfully followed the demo at <a href=\"https://guides.dataverse.org/en/latest/container/index.html\">Dataverse Guide</a> and was able to run it on my local WSL Docker for testing.</p>\n<p>Now, I am attempting to replicate this setup on OpenShift within my organization. However, I am encountering issues with Solr not functioning as expected. I am currently using the GDCC image of Dataverse along with Solr 9, but I am uncertain if this configuration is compatible.</p>\n<p>Additionally, I have come across the IQSS images for Dataverse and Solr. Would these be a better alternative?</p>\n<p>Are there any specific guides or images available for deploying Dataverse on OpenShift? I would appreciate any guidance you can provide.</p>\n<p>Thank you.</p>",
        "id": 502581840,
        "sender_full_name": "Gursahib",
        "timestamp": 1740750289
    },
    {
        "content": "<p>Hi! The <a href=\"https://hub.docker.com/u/iqss\">IQSS images</a> on Docker Hub are old. You shouldn't use them. I'm glad the <a href=\"https://hub.docker.com/u/gdcc\">GDCC images</a> are working for you, the demo version at least.</p>",
        "id": 502587841,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1740751986
    },
    {
        "content": "<p>We have a topic going at <a class=\"stream-topic\" data-stream-id=\"375812\" href=\"/#narrow/channel/375812-containers/topic/OpenShift/with/408633083\">#containers &gt; OpenShift</a> but it's been a while since anyone has posted anything.</p>",
        "id": 502588126,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1740752067
    },
    {
        "content": "<p>Actually, I think I'll just merge this topic into that one.</p>",
        "id": 502588219,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1740752100
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"882006\">@Gursahib</span> can you please say more about what's not working?</p>",
        "id": 502588487,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1740752163
    },
    {
        "content": "<p>Hi Philip,</p>\n<p>Thank you for your response.</p>\n<p>I am encountering an issue where the <code>dvinitializer</code> job requires root privileges, causing it to fail. However, even without it, I was able to deploy Dataverse to the UI level and log in as an admin.</p>\n<p>In this deployment, I can create datasets and upload files, but Solr is unable to perform searches or create a Dataverse. I suspect that certain Solr actions require root privileges.</p>\n<p>Below is the current pod log:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>chown:<span class=\"w\"> </span>/var/solr/data:<span class=\"w\"> </span>Operation<span class=\"w\"> </span>not<span class=\"w\"> </span>permitted\nchown:<span class=\"w\"> </span>/var/solr/data:<span class=\"w\"> </span>Operation<span class=\"w\"> </span>not<span class=\"w\"> </span>permitted\nchown:<span class=\"w\"> </span>/var/solr/logs/solr_gc.log:<span class=\"w\"> </span>Operation<span class=\"w\"> </span>not<span class=\"w\"> </span>permitted\nchown:<span class=\"w\"> </span>/var/solr/logs/solr.log:<span class=\"w\"> </span>Operation<span class=\"w\"> </span>not<span class=\"w\"> </span>permitted\nchown:<span class=\"w\"> </span>/var/solr/logs/solr_slow_requests.log:<span class=\"w\"> </span>Operation<span class=\"w\"> </span>not<span class=\"w\"> </span>permitted\nchown:<span class=\"w\"> </span>/var/solr/logs/2025_02_25.request.log:<span class=\"w\"> </span>Operation<span class=\"w\"> </span>not<span class=\"w\"> </span>permitted\nchown:<span class=\"w\"> </span>/var/solr/logs/2025_02_26.request.log:<span class=\"w\"> </span>Operation<span class=\"w\"> </span>not<span class=\"w\"> </span>permitted\nchown:<span class=\"w\"> </span>/var/solr/logs/2025_02_27.request.log:<span class=\"w\"> </span>Operation<span class=\"w\"> </span>not<span class=\"w\"> </span>permitted\nchown:<span class=\"w\"> </span>/var/solr/logs/2025_02_28.request.log:<span class=\"w\"> </span>Operation<span class=\"w\"> </span>not<span class=\"w\"> </span>permitted\nchown:<span class=\"w\"> </span>/var/solr/logs:<span class=\"w\"> </span>Operation<span class=\"w\"> </span>not<span class=\"w\"> </span>permitted\nchown:<span class=\"w\"> </span>/var/solr/logs:<span class=\"w\"> </span>Operation<span class=\"w\"> </span>not<span class=\"w\"> </span>permitted\nchown:<span class=\"w\"> </span>/var/solr/log4j2.xml:<span class=\"w\"> </span>Operation<span class=\"w\"> </span>not<span class=\"w\"> </span>permitted\nchown:<span class=\"w\"> </span>/var/solr:<span class=\"w\"> </span>Operation<span class=\"w\"> </span>not<span class=\"w\"> </span>permitted\nchown:<span class=\"w\"> </span>/var/solr:<span class=\"w\"> </span>Operation<span class=\"w\"> </span>not<span class=\"w\"> </span>permitted\n</code></pre></div>\n<p>Would you happen to have any Solr images that do not require root privileges? Any guidance on resolving this issue would be greatly appreciated.</p>",
        "id": 502592000,
        "sender_full_name": "Gursahib",
        "timestamp": 1740753162
    },
    {
        "content": "<p>Huh. I'm surprised Solr requires root. <span class=\"user-mention\" data-user-id=\"598183\">@Oliver Bertuch</span> you've been messing around with Kubernetes lately. Any insight on this?</p>",
        "id": 502594378,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1740753796
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"662399\">@zbenta</span> you use Kubernetes, right?</p>",
        "id": 502595574,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1740754115
    },
    {
        "content": "<p>Oh, wait. I think <span class=\"user-mention\" data-user-id=\"662399\">@zbenta</span> is (or was?) using OpenStack, not OpenShift, based on these slides: <a href=\"https://osf.io/fjw9t\">https://osf.io/fjw9t</a></p>",
        "id": 502596234,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1740754303
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"882006\">@Gursahib</span> I would suggest asking at <a href=\"https://groups.google.com/g/dataverse-community\">https://groups.google.com/g/dataverse-community</a> if anyone is using OpenShift and has seen this problem with Solr. You'll reach more people there.</p>",
        "id": 502596642,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1740754403
    },
    {
        "content": "<p>Technically, I am using RKE2, another distribution of K8s.</p>",
        "id": 502597000,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1740754500
    },
    {
        "content": "<p>Ah, less strict about root?</p>",
        "id": 502597110,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1740754529
    },
    {
        "content": "<p>Alright, Thank you Philip.<br>\nit seems the dv_initializer running script <a href=\"http://fix-fs-perm.sh\">fix-fs-perm.sh</a> in image gdcc/configbacker:alpha needs root.</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>8a7400b16cbd:/scripts#<span class=\"w\"> </span>cat<span class=\"w\"> </span>fix-fs-perms.sh\n<span class=\"c1\">#!/bin/bash</span>\n\n<span class=\"c1\"># [INFO]: Fix folder permissions using 'chown' to be writeable by containers not running as root.</span>\n\n<span class=\"nb\">set</span><span class=\"w\"> </span>-euo<span class=\"w\"> </span>pipefail\n\n<span class=\"k\">if</span><span class=\"w\"> </span><span class=\"o\">[[</span><span class=\"w\"> </span><span class=\"s2\">\"</span><span class=\"k\">$(</span>id<span class=\"w\"> </span>-un<span class=\"k\">)</span><span class=\"s2\">\"</span><span class=\"w\"> </span>!<span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s2\">\"root\"</span><span class=\"w\"> </span><span class=\"o\">]]</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">  </span><span class=\"nb\">echo</span><span class=\"w\"> </span><span class=\"s2\">\"This script must be run as user root (not </span><span class=\"k\">$(</span>id<span class=\"w\"> </span>-un<span class=\"k\">)</span><span class=\"s2\">), otherwise no fix is possible.\"</span>\n<span class=\"k\">fi</span>\n\n<span class=\"nv\">DEF_DV_PATH</span><span class=\"o\">=</span><span class=\"s2\">\"/dv\"</span>\n<span class=\"nv\">DEF_SOLR_PATH</span><span class=\"o\">=</span><span class=\"s2\">\"/var/solr\"</span>\n<span class=\"nv\">DEF_DV_UID</span><span class=\"o\">=</span><span class=\"s2\">\"1000\"</span>\n<span class=\"nv\">DEF_SOLR_UID</span><span class=\"o\">=</span><span class=\"s2\">\"8983\"</span>\n\n<span class=\"k\">function</span><span class=\"w\"> </span>usage<span class=\"o\">()</span><span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">  </span><span class=\"nb\">echo</span><span class=\"w\"> </span><span class=\"s2\">\"Usage: </span><span class=\"k\">$(</span>basename<span class=\"w\"> </span><span class=\"s2\">\"</span><span class=\"nv\">$0</span><span class=\"s2\">\"</span><span class=\"k\">)</span><span class=\"s2\"> (dv|solr|[1-9][0-9]{3,4}) [PATH [PATH [...]]]\"</span>\n<span class=\"w\">  </span><span class=\"nb\">echo</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span>\n<span class=\"w\">  </span><span class=\"nb\">echo</span><span class=\"w\"> </span><span class=\"s2\">\"You may omit a path when using 'dv' or 'solr' as first argument:\"</span>\n<span class=\"w\">  </span><span class=\"nb\">echo</span><span class=\"w\"> </span><span class=\"s2\">\"  - 'dv' will default to user </span><span class=\"nv\">$DEF_DV_UID</span><span class=\"s2\"> and </span><span class=\"nv\">$DEF_DV_PATH</span><span class=\"s2\">\"</span>\n<span class=\"w\">  </span><span class=\"nb\">echo</span><span class=\"w\"> </span><span class=\"s2\">\"  - 'solr' will default to user </span><span class=\"nv\">$DEF_SOLR_UID</span><span class=\"s2\"> and </span><span class=\"nv\">$DEF_SOLR_PATH</span><span class=\"s2\">\"</span>\n<span class=\"w\">  </span><span class=\"nb\">exit</span><span class=\"w\"> </span><span class=\"m\">1</span>\n<span class=\"o\">}</span>\n\n<span class=\"c1\"># Get a target name or id</span>\n<span class=\"nv\">TARGET</span><span class=\"o\">=</span><span class=\"si\">${</span><span class=\"nv\">1</span><span class=\"k\">:-</span><span class=\"nv\">help</span><span class=\"si\">}</span>\n<span class=\"c1\"># Get the rest of the arguments as paths to apply the fix to</span>\n<span class=\"nv\">PATHS</span><span class=\"o\">=(</span><span class=\"w\"> </span><span class=\"s2\">\"</span><span class=\"si\">${</span><span class=\"p\">@:</span><span class=\"nv\">2</span><span class=\"si\">}</span><span class=\"s2\">\"</span><span class=\"w\"> </span><span class=\"o\">)</span>\n\n<span class=\"nv\">ID</span><span class=\"o\">=</span><span class=\"m\">0</span>\n<span class=\"k\">case</span><span class=\"w\"> </span><span class=\"s2\">\"</span><span class=\"nv\">$TARGET</span><span class=\"s2\">\"</span><span class=\"w\"> </span><span class=\"k\">in</span>\n<span class=\"w\">  </span>dv<span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"nv\">ID</span><span class=\"o\">=</span><span class=\"s2\">\"</span><span class=\"nv\">$DEF_DV_UID</span><span class=\"s2\">\"</span>\n<span class=\"w\">    </span><span class=\"c1\"># If there is no path, add the default for our app image</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"o\">[[</span><span class=\"w\"> </span><span class=\"si\">${#</span><span class=\"nv\">PATHS</span><span class=\"p\">[@]</span><span class=\"si\">}</span><span class=\"w\"> </span>-eq<span class=\"w\"> </span><span class=\"m\">0</span><span class=\"w\"> </span><span class=\"o\">]]</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">      </span><span class=\"nv\">PATHS</span><span class=\"o\">=(</span><span class=\"w\"> </span><span class=\"s2\">\"</span><span class=\"nv\">$DEF_DV_PATH</span><span class=\"s2\">\"</span><span class=\"w\"> </span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"k\">fi</span>\n<span class=\"w\">    </span><span class=\"p\">;;</span>\n<span class=\"w\">  </span>solr<span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"nv\">ID</span><span class=\"o\">=</span><span class=\"s2\">\"</span><span class=\"nv\">$DEF_SOLR_UID</span><span class=\"s2\">\"</span>\n<span class=\"w\">    </span><span class=\"c1\"># In case there is no path, add the default path for Solr images</span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"o\">[[</span><span class=\"w\"> </span><span class=\"si\">${#</span><span class=\"nv\">PATHS</span><span class=\"p\">[@]</span><span class=\"si\">}</span><span class=\"w\"> </span>-eq<span class=\"w\"> </span><span class=\"m\">0</span><span class=\"w\"> </span><span class=\"o\">]]</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">      </span><span class=\"nv\">PATHS</span><span class=\"o\">=(</span><span class=\"w\"> </span><span class=\"s2\">\"</span><span class=\"nv\">$DEF_SOLR_PATH</span><span class=\"s2\">\"</span><span class=\"w\"> </span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"k\">fi</span>\n<span class=\"w\">    </span><span class=\"p\">;;</span>\n<span class=\"w\">  </span><span class=\"c1\"># If there is a digit in the argument, check if this is a valid UID (&gt;= 1000, ...)</span>\n<span class=\"w\">  </span>*<span class=\"o\">[[</span>:digit:<span class=\"o\">]]</span>*<span class=\"w\"> </span><span class=\"o\">)</span>\n<span class=\"w\">    </span><span class=\"nb\">echo</span><span class=\"w\"> </span><span class=\"s2\">\"</span><span class=\"nv\">$TARGET</span><span class=\"s2\">\"</span><span class=\"w\"> </span><span class=\"p\">|</span><span class=\"w\"> </span>grep<span class=\"w\"> </span>-q<span class=\"w\"> </span><span class=\"s2\">\"^[1-9][0-9]\\{3,4\\}</span>$<span class=\"s2\">\"</span><span class=\"w\"> </span><span class=\"o\">||</span><span class=\"w\"> </span>usage\n<span class=\"w\">    </span><span class=\"nv\">ID</span><span class=\"o\">=</span><span class=\"s2\">\"</span><span class=\"nv\">$TARGET</span><span class=\"s2\">\"</span>\n<span class=\"w\">    </span><span class=\"p\">;;</span>\n<span class=\"w\">  </span>*<span class=\"o\">)</span>\n<span class=\"w\">    </span>usage\n<span class=\"w\">    </span><span class=\"p\">;;</span>\n<span class=\"k\">esac</span>\n\n<span class=\"c1\"># Check that we actually have at least 1 path</span>\n<span class=\"k\">if</span><span class=\"w\"> </span><span class=\"o\">[[</span><span class=\"w\"> </span><span class=\"si\">${#</span><span class=\"nv\">PATHS</span><span class=\"p\">[@]</span><span class=\"si\">}</span><span class=\"w\"> </span>-eq<span class=\"w\"> </span><span class=\"m\">0</span><span class=\"w\"> </span><span class=\"o\">]]</span><span class=\"p\">;</span><span class=\"w\"> </span><span class=\"k\">then</span>\n<span class=\"w\">  </span>usage\n<span class=\"k\">fi</span>\n\n<span class=\"c1\"># Do what we came for</span>\nchown<span class=\"w\"> </span>-R<span class=\"w\"> </span><span class=\"s2\">\"</span><span class=\"nv\">$ID</span><span class=\"s2\">:</span><span class=\"nv\">$ID</span><span class=\"s2\">\"</span><span class=\"w\"> </span><span class=\"s2\">\"</span><span class=\"si\">${</span><span class=\"nv\">PATHS</span><span class=\"p\">[@]</span><span class=\"si\">}</span><span class=\"s2\">\"</span>\n</code></pre></div>\n<p>But i'll check with the datverse community group as well</p>",
        "id": 502597315,
        "sender_full_name": "Gursahib",
        "timestamp": 1740754571
    },
    {
        "content": "<p>And i think solr intializer also uses same image to runsame script.</p>",
        "id": 502597784,
        "sender_full_name": "Gursahib",
        "timestamp": 1740754695
    },
    {
        "content": "<p>I suppose you will be running into problems because of copying the Docker Compose stuff 1:1 onto K8s. Depending on your OpenShift environment, you probably are enforced to use a Pod Security Admission of \"restricted\" or \"baseline\". (<a href=\"https://kubernetes.io/docs/concepts/security/pod-security-admission/\">K8s docs</a>, <a href=\"https://docs.openshift.com/container-platform/4.18//authentication/understanding-and-managing-pod-security-admission.html\">OS docs</a>)</p>",
        "id": 502597918,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1740754737
    },
    {
        "content": "<p>You should not use these scripts in init containers on K8s, they are meant for Docker Compose usage.</p>",
        "id": 502598058,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1740754781
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"882006\">@Gursahib</span> that fix perms script was written by <span class=\"user-mention\" data-user-id=\"598183\">@Oliver Bertuch</span> so please listen to any advice he has! <span aria-label=\"big smile\" class=\"emoji emoji-1f604\" role=\"img\" title=\"big smile\">:big_smile:</span></p>",
        "id": 502598211,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1740754815
    },
    {
        "content": "<p>Are you backing the storage locations with PVCs?</p>",
        "id": 502598218,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1740754816
    },
    {
        "content": "<p>And are you (as you should if someone is already impossing baseline or restricted on you) setting all the necessary security bits for your <code>Deployment</code>'s <code>.spec.template.spec.securityContext</code> and <code>.spec.template.containers[].securityContext</code> ?</p>",
        "id": 502598409,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1740754868
    },
    {
        "content": "<p>Another thought is that we had a call with a Red Hat engineer almost a year ago. He's really into Solr so I assume he has it working well on OpenShift. You can see the <a href=\"https://docs.google.com/document/d/1X69Xig8vgFAMWIS0xw1FIYLT2BgrwImUOWfCt0mwYTw/edit?usp=sharing\">notes</a> from the call, watch the <a href=\"https://harvard.zoom.us/rec/share/zBqcRUfqUOJYPLXd_orU4rY2oqmIXv8mOnNRAyS-rIBJuV6Vqep6N3O3hRHSRuen.IyVubl9breyMGi8R\">recording</a>, and check out his <a href=\"https://github.com/smartabyar-smartvillage/smartvillage-operator\">https://github.com/smartabyar-smartvillage/smartvillage-operator</a> project, which uses Solr. Maybe we can even pull him in and ask questions.</p>",
        "id": 502598554,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1740754915
    },
    {
        "content": "<p>First of all i would like to clear, I am just a Technical designer exploring this for next solution <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span> <br>\nand this openshift stuff is new to me.</p>\n<p><span class=\"user-mention silent\" data-user-id=\"598183\">Oliver Bertuch</span> <a href=\"#narrow/channel/375812-containers/topic/OpenShift/near/502598218\">said</a>:</p>\n<blockquote>\n<p>Are you backing the storage locations with PVCs?</p>\n</blockquote>\n<p>Yes i have PVC's defined as well and yes the Pod security is restricted.</p>",
        "id": 502599137,
        "sender_full_name": "Gursahib",
        "timestamp": 1740755058
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"882006\">@Gursahib</span> are you using a <a href=\"https://artifacthub.io/packages/helm/bitnami/solr\">Helm Chart to deploy your Solr</a> or the <a href=\"https://solr.apache.org/operator/\">Solr Operator</a>?</p>",
        "id": 502599301,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1740755111
    },
    {
        "content": "<p>Well for exploration and evaluation I strongly suggest going for Docker Compose first. In the foreseeable future I will be working on better K8s support via Helmcharts and/or Operators for Dataverse, but there are other problems to address first.</p>",
        "id": 502599626,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1740755193
    },
    {
        "content": "<p>If you want, you can post your K8s objects here and we can try to take a look.</p>",
        "id": 502600381,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1740755395
    },
    {
        "content": "<p>Well I have already explored dataverse on Docker and of course it works flawlessly there. Now i am tasked to replicate the same in our openshift, its a big learning experience. <br>\nI believe I am using neither as I am defining my service myself. <br>\nhere is the way I create yaml:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>apiVersion:<span class=\"w\"> </span>apps/v1\nkind:<span class=\"w\"> </span>StatefulSet\n<span class=\"c1\"># kind: Deployment</span>\nmetadata:\n<span class=\"w\">  </span>name:<span class=\"w\"> </span>solr\n<span class=\"w\">  </span>labels:\n<span class=\"w\">    </span>app:<span class=\"w\"> </span>solr\nspec:\n<span class=\"w\">  </span>serviceName:<span class=\"w\"> </span>solr\n<span class=\"w\">  </span>replicas:<span class=\"w\"> </span><span class=\"m\">1</span>\n<span class=\"w\">  </span>selector:\n<span class=\"w\">    </span>matchLabels:\n<span class=\"w\">      </span>app:<span class=\"w\"> </span>solr\n<span class=\"w\">  </span>template:\n<span class=\"w\">    </span>metadata:\n<span class=\"w\">      </span>labels:\n<span class=\"w\">        </span>app:<span class=\"w\"> </span>solr\n<span class=\"w\">    </span>spec:\n<span class=\"w\">      </span>securityContext:\n<span class=\"w\">        </span>fsGroup:<span class=\"w\"> </span><span class=\"m\">1000810000</span>\n<span class=\"w\">      </span>containers:\n<span class=\"w\">      </span>-<span class=\"w\"> </span>name:<span class=\"w\"> </span>solr\n<span class=\"w\">        </span>image:<span class=\"w\"> </span>solr:9.4.1\n<span class=\"w\">        </span>ports:\n<span class=\"w\">        </span>-<span class=\"w\"> </span>containerPort:<span class=\"w\"> </span><span class=\"m\">8983</span>\n<span class=\"w\">        </span>command:<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"s2\">\"solr-precreate\"</span>,<span class=\"w\"> </span><span class=\"s2\">\"collection1\"</span>,<span class=\"w\"> </span><span class=\"s2\">\"/template\"</span><span class=\"o\">]</span>\n<span class=\"w\">        </span>volumeMounts:\n<span class=\"w\">          </span>-<span class=\"w\"> </span>name:<span class=\"w\"> </span>solr-data\n<span class=\"w\">            </span>mountPath:<span class=\"w\"> </span>/var/solr\n<span class=\"w\">          </span>-<span class=\"w\"> </span>name:<span class=\"w\"> </span>solr-template\n<span class=\"w\">            </span>mountPath:<span class=\"w\"> </span>/template\n<span class=\"w\">        </span>securityContext:\n<span class=\"w\">          </span>runAsUser:<span class=\"w\"> </span><span class=\"m\">1000810000</span>\n<span class=\"w\">          </span>runAsGroup:<span class=\"w\"> </span><span class=\"m\">1000810000</span>\n<span class=\"w\">          </span>allowPrivilegeEscalation:<span class=\"w\"> </span><span class=\"nb\">false</span>\n<span class=\"w\">      </span>volumes:\n<span class=\"w\">        </span>-<span class=\"w\"> </span>name:<span class=\"w\"> </span>solr-data\n<span class=\"w\">          </span>persistentVolumeClaim:\n<span class=\"w\">            </span>claimName:<span class=\"w\"> </span>solr-data-pvc\n<span class=\"w\">        </span>-<span class=\"w\"> </span>name:<span class=\"w\"> </span>solr-template\n<span class=\"w\">          </span>persistentVolumeClaim:\n<span class=\"w\">            </span>claimName:<span class=\"w\"> </span>solr-template-pvc\n---\napiVersion:<span class=\"w\"> </span>v1\nkind:<span class=\"w\"> </span>Service\nmetadata:\n<span class=\"w\">  </span>name:<span class=\"w\"> </span>solr\n<span class=\"w\">  </span>labels:\n<span class=\"w\">    </span>app:<span class=\"w\"> </span>solr\nspec:\n<span class=\"w\">  </span>type:<span class=\"w\"> </span>ClusterIP\n<span class=\"w\">  </span>ports:\n<span class=\"w\">    </span>-<span class=\"w\"> </span>name:<span class=\"w\"> </span>solr\n<span class=\"w\">      </span>port:<span class=\"w\"> </span><span class=\"m\">8983</span>\n<span class=\"w\">      </span>targetPort:<span class=\"w\"> </span><span class=\"m\">8983</span>\n<span class=\"w\">  </span>selector:\n<span class=\"w\">    </span>app:<span class=\"w\"> </span>solr\n</code></pre></div>",
        "id": 502600661,
        "sender_full_name": "Gursahib",
        "timestamp": 1740755461
    },
    {
        "content": "<p>Have you tried to verify in a running container if the fsGroups are properly applied to the volumes and the user is in that group?</p>",
        "id": 502602627,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1740756008
    },
    {
        "content": "<p>Yes, I have verified</p>",
        "id": 502603089,
        "sender_full_name": "Gursahib",
        "timestamp": 1740756143
    },
    {
        "content": "<p>Alright, let's see some logs. Can you share the error messages Solr gives you?</p>",
        "id": 502603379,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1740756240
    },
    {
        "content": "<p>(I don't see the configbaker image anymore here as init container, as it should be :-) )</p>",
        "id": 502603838,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1740756351
    },
    {
        "content": "<p>BTW - how do you propagate the <code>/template</code> PV? Solr will be having a hard time if there is no template in that folder...</p>",
        "id": 502603942,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1740756375
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"598183\">Oliver Bertuch</span> <a href=\"#narrow/channel/375812-containers/topic/OpenShift/near/502603942\">said</a>:</p>\n<blockquote>\n<p>BTW - how do you propagate the <code>/template</code> PV? Solr will be having a hard time if there is no template in that folder...</p>\n</blockquote>\n<p>there is a solr initializer which runs this command:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>command:<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"s2\">\"sh\"</span>,<span class=\"w\"> </span><span class=\"s2\">\"-c\"</span>,<span class=\"w\"> </span><span class=\"s2\">\"fix-fs-perms.sh solr &amp;&amp; cp -a /template/* /solr-template\"</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>which fails again due to root issues on <a href=\"http://fix-fs-perms.sh\">fix-fs-perms.sh</a> script</p>\n<hr>\n<p><span class=\"user-mention silent\" data-user-id=\"598183\">Oliver Bertuch</span> <a href=\"#narrow/channel/375812-containers/topic/OpenShift/near/502603838\">said</a>:</p>\n<blockquote>\n<p>(I don't see the configbaker image anymore here as init container, as it should be :-) )</p>\n</blockquote>\n<p>its used by solr initializer which is a deployment in itself as:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>apiVersion:<span class=\"w\"> </span>batch/v1\nkind:<span class=\"w\"> </span>Job\nmetadata:\n<span class=\"w\">  </span>name:<span class=\"w\"> </span>solr-initializer\nspec:\n<span class=\"w\">  </span>template:\n<span class=\"w\">    </span>metadata:\n<span class=\"w\">      </span>name:<span class=\"w\"> </span>solr-initializer\n<span class=\"w\">    </span>spec:\n<span class=\"w\">      </span>securityContext:\n<span class=\"w\">        </span>fsGroup:<span class=\"w\"> </span><span class=\"m\">1000810000</span>\n<span class=\"w\">      </span>containers:\n<span class=\"w\">      </span>-<span class=\"w\"> </span>name:<span class=\"w\"> </span>solr-initializer\n<span class=\"w\">        </span>image:<span class=\"w\"> </span>gdcc/configbaker:alpha\n<span class=\"w\">        </span><span class=\"c1\"># command: [\"sh\", \"-c\", \"mkdir -p /var/solr/data &amp;&amp; chown -R 8983:8983 /var/solr &amp;&amp; fix-fs-perms.sh solr &amp;&amp; cp -a /template/* /solr-template\"]</span>\n<span class=\"w\">        </span>command:<span class=\"w\"> </span><span class=\"o\">[</span><span class=\"s2\">\"sh\"</span>,<span class=\"w\"> </span><span class=\"s2\">\"-c\"</span>,<span class=\"w\"> </span><span class=\"s2\">\"fix-fs-perms.sh solr &amp;&amp; cp -a /template/* /solr-template\"</span><span class=\"o\">]</span>\n<span class=\"w\">        </span>volumeMounts:\n<span class=\"w\">          </span>-<span class=\"w\"> </span>name:<span class=\"w\"> </span>solr-data\n<span class=\"w\">            </span>mountPath:<span class=\"w\"> </span>/var/solr\n<span class=\"w\">          </span>-<span class=\"w\"> </span>name:<span class=\"w\"> </span>solr-template\n<span class=\"w\">            </span>mountPath:<span class=\"w\"> </span>/solr-template\n<span class=\"w\">        </span>securityContext:\n<span class=\"w\">          </span>runAsUser:<span class=\"w\"> </span><span class=\"m\">1000810000</span>\n<span class=\"w\">          </span>runAsGroup:<span class=\"w\"> </span><span class=\"m\">1000810000</span>\n<span class=\"w\">          </span>allowPrivilegeEscalation:<span class=\"w\"> </span><span class=\"nb\">false</span>\n<span class=\"w\">      </span>restartPolicy:<span class=\"w\"> </span>Never\n<span class=\"w\">      </span>volumes:\n<span class=\"w\">        </span>-<span class=\"w\"> </span>name:<span class=\"w\"> </span>solr-data\n<span class=\"w\">          </span>persistentVolumeClaim:\n<span class=\"w\">            </span>claimName:<span class=\"w\"> </span>solr-data-pvc\n<span class=\"w\">        </span>-<span class=\"w\"> </span>name:<span class=\"w\"> </span>solr-template\n<span class=\"w\">          </span>persistentVolumeClaim:\n<span class=\"w\">            </span>claimName:<span class=\"w\"> </span>solr-template-pvc\n</code></pre></div>",
        "id": 502605754,
        "sender_full_name": "Gursahib",
        "timestamp": 1740756861
    },
    {
        "content": "<p>Yikes! That sounds like we found the culprit!</p>",
        "id": 502605841,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1740756894
    },
    {
        "content": "<p>is it a big yikes or a small one <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 502605941,
        "sender_full_name": "Gursahib",
        "timestamp": 1740756925
    },
    {
        "content": "<p>A) Please use a proper init container within the <code>solr</code> <code>Deployment</code> object, not a separate deployment. The piece in the docker-compose is also only used as an init container. <a href=\"https://kubernetes.io/docs/concepts/workloads/pods/init-containers/\">https://kubernetes.io/docs/concepts/workloads/pods/init-containers/</a></p>",
        "id": 502606114,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1740756972
    },
    {
        "content": "<p>B) As you are on K8s, you don't need to fix the permissions. This is taken care of by K8s for you, using the <code>fsGroup</code> trick that will ensure the volume is ready to go for you. So you won't need the first part of the shell command.</p>",
        "id": 502606273,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1740757018
    },
    {
        "content": "<p>C) I suggest you use an <code>emptyDir</code> type volume for the template volume.</p>",
        "id": 502606343,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1740757040
    },
    {
        "content": "<p>D) I also suggest moving the <code>runAsUser</code> and <code>runAsGroup</code> bits to <code>.spec.template.spec.securityContext</code>, so you only need to set it once for all containers in the pod.</p>",
        "id": 502607020,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1740757225
    },
    {
        "content": "<p>Thank you <span class=\"user-mention\" data-user-id=\"598183\">@Oliver Bertuch</span>  for your insights. As I mentioned earlier, this is a new area (we are shifting to DevOps) for both myself and most of our team, so we are continuously learning these concepts over time.<br>\nI appreciate your suggestions and will incorporate them accordingly.</p>",
        "id": 502607200,
        "sender_full_name": "Gursahib",
        "timestamp": 1740757285
    },
    {
        "content": "<p>Also, it is a common (but not good/best) practice to set <code>fsGroup</code> to sth. else than <code>runAsGroup</code>. But that's just a minor thing, you can probably ignore it.</p>",
        "id": 502607233,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1740757294
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"882006\">@Gursahib</span> once you have this working, would you want to add a page about OpenShift to the Container Guide? I'm happy to help.</p>",
        "id": 502608711,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1740757705
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"882006\">@Gursahib</span>  I also <em>VERY STRONGLY</em> suggest to set limits for CPU, memory, and storage, drop the capabilities, set liveness and readiness probes, try to use read-only root fs, set a pull image policy. </p>\n<p>Also, you seem to be running in <code>default</code> namespace, which is a bad idea for production but might be OK for testing.</p>\n<p>Also, the most common labels are missing, you are using very old standards here...</p>\n<p>Here are some helpful tools: <a href=\"https://learnk8s.io/validating-kubernetes-yaml\">https://learnk8s.io/validating-kubernetes-yaml</a></p>",
        "id": 502608751,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1740757714
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"598112\">Philip Durbin â˜ƒï¸</span> <a href=\"#narrow/channel/375812-containers/topic/OpenShift/near/502608711\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"882006\">Gursahib</span> once you have this working, would you want to add a page about OpenShift to the Container Guide? I'm happy to help.</p>\n</blockquote>\n<p>Sure <span class=\"user-mention\" data-user-id=\"598112\">@Philip Durbin â˜ƒï¸</span> , Once I have this running would share what I learned and can help in documenting it as well.</p>",
        "id": 502609112,
        "sender_full_name": "Gursahib",
        "timestamp": 1740757818
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"598183\">Oliver Bertuch</span> <a href=\"#narrow/channel/375812-containers/topic/OpenShift/near/502608751\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"882006\">Gursahib</span>  I also <em>VERY STRONGLY</em> suggest to set limits for CPU, memory, and storage, drop the capabilities, set liveness and readiness probes, try to use read-only root fs, set a pull image policy. </p>\n<p>Also, you seem to be running in <code>default</code> namespace, which is a bad idea for production but might be OK for testing.</p>\n<p>Also, the most common labels are missing, you are using very old standards here...</p>\n</blockquote>\n<p>The environment i am working in is kind of a playground for testing so nothing to worry about here</p>",
        "id": 502609595,
        "sender_full_name": "Gursahib",
        "timestamp": 1740757952
    },
    {
        "content": "<p>Hey guys I am back and good news, after following Oliver's guidance the Dataverse is running on openshift environment. Last thing left is the previewers not working properly. I have tried everything but can't seem to find any solutions. The preview register is working fine. I am not sure what I am missing, if this works then I think we can have a complete documentation of deploying in Openshift.</p>\n<p>Here Is the error i get from the logs of previewers pod:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>/docker-entrypoint.sh:<span class=\"w\"> </span>/docker-entrypoint.d/<span class=\"w\"> </span>is<span class=\"w\"> </span>not<span class=\"w\"> </span>empty,<span class=\"w\"> </span>will<span class=\"w\"> </span>attempt<span class=\"w\"> </span>to<span class=\"w\"> </span>perform<span class=\"w\"> </span>configuration\n/docker-entrypoint.sh:<span class=\"w\"> </span>Looking<span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span>shell<span class=\"w\"> </span>scripts<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>/docker-entrypoint.d/\n/docker-entrypoint.sh:<span class=\"w\"> </span>Launching<span class=\"w\"> </span>/docker-entrypoint.d/10-listen-on-ipv6-by-default.sh\n<span class=\"m\">10</span>-listen-on-ipv6-by-default.sh:<span class=\"w\"> </span>info:<span class=\"w\"> </span>can<span class=\"w\"> </span>not<span class=\"w\"> </span>modify<span class=\"w\"> </span>/etc/nginx/conf.d/default.conf<span class=\"w\"> </span><span class=\"o\">(</span>read-only<span class=\"w\"> </span>file<span class=\"w\"> </span>system?<span class=\"o\">)</span>\n/docker-entrypoint.sh:<span class=\"w\"> </span>Sourcing<span class=\"w\"> </span>/docker-entrypoint.d/15-local-resolvers.envsh\n/docker-entrypoint.sh:<span class=\"w\"> </span>Launching<span class=\"w\"> </span>/docker-entrypoint.d/20-envsubst-on-templates.sh\n<span class=\"m\">20</span>-envsubst-on-templates.sh:<span class=\"w\"> </span>ERROR:<span class=\"w\"> </span>/etc/nginx/templates<span class=\"w\"> </span>exists,<span class=\"w\"> </span>but<span class=\"w\"> </span>/etc/nginx/conf.d<span class=\"w\"> </span>is<span class=\"w\"> </span>not<span class=\"w\"> </span>writable\n/docker-entrypoint.sh:<span class=\"w\"> </span>Launching<span class=\"w\"> </span>/docker-entrypoint.d/30-tune-worker-processes.sh\n/docker-entrypoint.sh:<span class=\"w\"> </span>Launching<span class=\"w\"> </span>/docker-entrypoint.d/init.sh\nUsing<span class=\"w\"> </span>Provider<span class=\"w\"> </span><span class=\"nv\">Url</span><span class=\"o\">=</span>http://previewers-provider:9000<span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span>versions<span class=\"w\"> </span>v1.4,betatest\nDownloading<span class=\"w\"> </span><span class=\"nb\">local</span><span class=\"w\"> </span>copies<span class=\"w\"> </span>of<span class=\"w\"> </span>remote<span class=\"w\"> </span>JavaScript<span class=\"w\"> </span>libraries:\n./localinstall.sh:<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">22</span>:<span class=\"w\"> </span>replace_js.sh:<span class=\"w\"> </span>Permission<span class=\"w\"> </span>denied\n./localinstall.sh:<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">23</span>:<span class=\"w\"> </span>urls_js.txt:<span class=\"w\"> </span>Permission<span class=\"w\"> </span>denied\n./localinstall.sh:<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">24</span>:<span class=\"w\"> </span>replace_js.sh:<span class=\"w\"> </span>No<span class=\"w\"> </span>such<span class=\"w\"> </span>file<span class=\"w\"> </span>or<span class=\"w\"> </span>directory\ncat:<span class=\"w\"> </span>urls_js.txt:<span class=\"w\"> </span>No<span class=\"w\"> </span>such<span class=\"w\"> </span>file<span class=\"w\"> </span>or<span class=\"w\"> </span>directory\nDownloading<span class=\"w\"> </span><span class=\"nb\">local</span><span class=\"w\"> </span>copies<span class=\"w\"> </span>of<span class=\"w\"> </span>remote<span class=\"w\"> </span>CSS<span class=\"w\"> </span>files:\n./localinstall.sh:<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">28</span>:<span class=\"w\"> </span>replace_css.sh:<span class=\"w\"> </span>Permission<span class=\"w\"> </span>denied\n./localinstall.sh:<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">29</span>:<span class=\"w\"> </span>urls_css.txt:<span class=\"w\"> </span>Permission<span class=\"w\"> </span>denied\n./localinstall.sh:<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">30</span>:<span class=\"w\"> </span>replace_css.sh:<span class=\"w\"> </span>No<span class=\"w\"> </span>such<span class=\"w\"> </span>file<span class=\"w\"> </span>or<span class=\"w\"> </span>directory\ncat:<span class=\"w\"> </span>urls_css.txt:<span class=\"w\"> </span>No<span class=\"w\"> </span>such<span class=\"w\"> </span>file<span class=\"w\"> </span>or<span class=\"w\"> </span>directory\n./localinstall.sh:<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">39</span>:<span class=\"w\"> </span>../urls_js.txt:<span class=\"w\"> </span>No<span class=\"w\"> </span>such<span class=\"w\"> </span>file<span class=\"w\"> </span>or<span class=\"w\"> </span>directory\n./localinstall.sh:<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">49</span>:<span class=\"w\"> </span>../urls_css.txt:<span class=\"w\"> </span>No<span class=\"w\"> </span>such<span class=\"w\"> </span>file<span class=\"w\"> </span>or<span class=\"w\"> </span>directory\nChanging<span class=\"w\"> </span>example<span class=\"w\"> </span>curl<span class=\"w\"> </span>commands<span class=\"w\"> </span>to<span class=\"w\"> </span>use<span class=\"w\"> </span><span class=\"nb\">local</span><span class=\"w\"> </span>URLs\nsed:<span class=\"w\"> </span>couldn<span class=\"s1\">'t open temporary file ./sedl9f3ws: Permission denied</span>\n<span class=\"s1\">Done changing example curl commands to use local URLs</span>\n<span class=\"s1\">Cleaning Up...</span>\n<span class=\"s1\">rm: cannot remove '</span>urls_js.txt<span class=\"s1\">': No such file or directory</span>\n<span class=\"s1\">rm: cannot remove '</span>urls_css.txt<span class=\"s1\">': No such file or directory</span>\n<span class=\"s1\">rm: cannot remove '</span>replace_js.sh<span class=\"s1\">': No such file or directory</span>\n<span class=\"s1\">rm: cannot remove '</span>replace_css.sh<span class=\"s1\">': No such file or directory</span>\n<span class=\"s1\">Done</span>\n<span class=\"s1\">cp: cannot create regular file '</span>previewers/v1.4/5.2curlcommands.md<span class=\"s1\">': Permission denied</span>\n<span class=\"s1\">cp: cannot create regular file '</span>previewers/v1.4/6.1curlcommands.md<span class=\"s1\">': Permission denied</span>\n<span class=\"s1\">cp: cannot create regular file '</span>previewers/v1.4/CONTRIBUTING.md<span class=\"s1\">': Permission denied</span>\n<span class=\"s1\">cp: cannot create regular file '</span>previewers/v1.4/README.md<span class=\"s1\">': Permission denied</span>\n<span class=\"s1\">cp: cannot create regular file '</span>previewers/v1.4/pre5.2curlcommands.md<span class=\"s1\">': Permission denied</span>\n<span class=\"s1\">Downloading local copies of remote JavaScript libraries:</span>\n<span class=\"s1\">./localinstall.sh: line 22: replace_js.sh: Permission denied</span>\n<span class=\"s1\">./localinstall.sh: line 23: urls_js.txt: Permission denied</span>\n<span class=\"s1\">./localinstall.sh: line 24: replace_js.sh: No such file or directory</span>\n<span class=\"s1\">cat: urls_js.txt: No such file or directory</span>\n<span class=\"s1\">Downloading local copies of remote CSS files:</span>\n<span class=\"s1\">./localinstall.sh: line 28: replace_css.sh: Permission denied</span>\n<span class=\"s1\">./localinstall.sh: line 29: urls_css.txt: Permission denied</span>\n<span class=\"s1\">./localinstall.sh: line 30: replace_css.sh: No such file or directory</span>\n<span class=\"s1\">cat: urls_css.txt: No such file or directory</span>\n<span class=\"s1\">./localinstall.sh: line 39: ../urls_js.txt: No such file or directory</span>\n<span class=\"s1\">./localinstall.sh: line 49: ../urls_css.txt: No such file or directory</span>\n<span class=\"s1\">Changing example curl commands to use local URLs</span>\n<span class=\"s1\">sed: couldn'</span>t<span class=\"w\"> </span>open<span class=\"w\"> </span>temporary<span class=\"w\"> </span>file<span class=\"w\"> </span>./sedPdDuuk:<span class=\"w\"> </span>Permission<span class=\"w\"> </span>denied\nDone<span class=\"w\"> </span>changing<span class=\"w\"> </span>example<span class=\"w\"> </span>curl<span class=\"w\"> </span>commands<span class=\"w\"> </span>to<span class=\"w\"> </span>use<span class=\"w\"> </span><span class=\"nb\">local</span><span class=\"w\"> </span>URLs\nCleaning<span class=\"w\"> </span>Up...\nrm:<span class=\"w\"> </span>cannot<span class=\"w\"> </span>remove<span class=\"w\"> </span><span class=\"s1\">'urls_js.txt'</span>:<span class=\"w\"> </span>No<span class=\"w\"> </span>such<span class=\"w\"> </span>file<span class=\"w\"> </span>or<span class=\"w\"> </span>directory\nrm:<span class=\"w\"> </span>cannot<span class=\"w\"> </span>remove<span class=\"w\"> </span><span class=\"s1\">'urls_css.txt'</span>:<span class=\"w\"> </span>No<span class=\"w\"> </span>such<span class=\"w\"> </span>file<span class=\"w\"> </span>or<span class=\"w\"> </span>directory\nrm:<span class=\"w\"> </span>cannot<span class=\"w\"> </span>remove<span class=\"w\"> </span><span class=\"s1\">'replace_js.sh'</span>:<span class=\"w\"> </span>No<span class=\"w\"> </span>such<span class=\"w\"> </span>file<span class=\"w\"> </span>or<span class=\"w\"> </span>directory\nDone\nrm:<span class=\"w\"> </span>cannot<span class=\"w\"> </span>remove<span class=\"w\"> </span><span class=\"s1\">'replace_css.sh'</span>:<span class=\"w\"> </span>No<span class=\"w\"> </span>such<span class=\"w\"> </span>file<span class=\"w\"> </span>or<span class=\"w\"> </span>directory\ncp:<span class=\"w\"> </span>cannot<span class=\"w\"> </span>create<span class=\"w\"> </span>regular<span class=\"w\"> </span>file<span class=\"w\"> </span><span class=\"s1\">'previewers/betatest/5.2curlcommands.md'</span>:<span class=\"w\"> </span>Permission<span class=\"w\"> </span>denied\ncp:<span class=\"w\"> </span>cannot<span class=\"w\"> </span>create<span class=\"w\"> </span>regular<span class=\"w\"> </span>file<span class=\"w\"> </span><span class=\"s1\">'previewers/betatest/6.1curlcommands.md'</span>:<span class=\"w\"> </span>Permission<span class=\"w\"> </span>denied\ncp:<span class=\"w\"> </span>cannot<span class=\"w\"> </span>create<span class=\"w\"> </span>regular<span class=\"w\"> </span>file<span class=\"w\"> </span><span class=\"s1\">'previewers/betatest/CONTRIBUTING.md'</span>:<span class=\"w\"> </span>Permission<span class=\"w\"> </span>denied\ncp:<span class=\"w\"> </span>cannot<span class=\"w\"> </span>create<span class=\"w\"> </span>regular<span class=\"w\"> </span>file<span class=\"w\"> </span><span class=\"s1\">'previewers/betatest/README.md'</span>:<span class=\"w\"> </span>Permission<span class=\"w\"> </span>denied\ncp:<span class=\"w\"> </span>cannot<span class=\"w\"> </span>create<span class=\"w\"> </span>regular<span class=\"w\"> </span>file<span class=\"w\"> </span><span class=\"s1\">'previewers/betatest/pre5.2curlcommands.md'</span>:<span class=\"w\"> </span>Permission<span class=\"w\"> </span>denied\n/docker-entrypoint.sh:<span class=\"w\"> </span>Configuration<span class=\"w\"> </span>complete<span class=\"p\">;</span><span class=\"w\"> </span>ready<span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span>start<span class=\"w\"> </span>up\n<span class=\"m\">2025</span>/03/24<span class=\"w\"> </span><span class=\"m\">13</span>:38:43<span class=\"w\"> </span><span class=\"o\">[</span>warn<span class=\"o\">]</span><span class=\"w\"> </span><span class=\"m\">1</span><span class=\"c1\">#1: the \"user\" directive makes sense only if the master process runs with super-user privileges, ignored in /etc/nginx/nginx.conf:2</span>\nnginx:<span class=\"w\"> </span><span class=\"o\">[</span>warn<span class=\"o\">]</span><span class=\"w\"> </span>the<span class=\"w\"> </span><span class=\"s2\">\"user\"</span><span class=\"w\"> </span>directive<span class=\"w\"> </span>makes<span class=\"w\"> </span>sense<span class=\"w\"> </span>only<span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span>the<span class=\"w\"> </span>master<span class=\"w\"> </span>process<span class=\"w\"> </span>runs<span class=\"w\"> </span>with<span class=\"w\"> </span>super-user<span class=\"w\"> </span>privileges,<span class=\"w\"> </span>ignored<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>/etc/nginx/nginx.conf:2\n<span class=\"m\">2025</span>/03/24<span class=\"w\"> </span><span class=\"m\">13</span>:38:43<span class=\"w\"> </span><span class=\"o\">[</span>notice<span class=\"o\">]</span><span class=\"w\"> </span><span class=\"m\">1</span><span class=\"c1\">#1: using the \"epoll\" event method</span>\n<span class=\"m\">2025</span>/03/24<span class=\"w\"> </span><span class=\"m\">13</span>:38:43<span class=\"w\"> </span><span class=\"o\">[</span>notice<span class=\"o\">]</span><span class=\"w\"> </span><span class=\"m\">1</span><span class=\"c1\">#1: nginx/1.27.2</span>\n<span class=\"m\">2025</span>/03/24<span class=\"w\"> </span><span class=\"m\">13</span>:38:43<span class=\"w\"> </span><span class=\"o\">[</span>notice<span class=\"o\">]</span><span class=\"w\"> </span><span class=\"m\">1</span><span class=\"c1\">#1: built by gcc 12.2.0 (Debian 12.2.0-14)</span>\n<span class=\"m\">2025</span>/03/24<span class=\"w\"> </span><span class=\"m\">13</span>:38:43<span class=\"w\"> </span><span class=\"o\">[</span>notice<span class=\"o\">]</span><span class=\"w\"> </span><span class=\"m\">1</span><span class=\"c1\">#1: OS: Linux 4.18.0-372.131.1.el8_6.x86_64</span>\n<span class=\"m\">2025</span>/03/24<span class=\"w\"> </span><span class=\"m\">13</span>:38:43<span class=\"w\"> </span><span class=\"o\">[</span>notice<span class=\"o\">]</span><span class=\"w\"> </span><span class=\"m\">1</span><span class=\"c1\">#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576</span>\n<span class=\"m\">2025</span>/03/24<span class=\"w\"> </span><span class=\"m\">13</span>:38:43<span class=\"w\"> </span><span class=\"o\">[</span>notice<span class=\"o\">]</span><span class=\"w\"> </span><span class=\"m\">1</span><span class=\"c1\">#1: start worker processes</span>\n</code></pre></div>\n<p>And here is the Yaml config:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code><span class=\"c1\"># kustomize/base/register-previewers.yaml</span>\napiVersion:<span class=\"w\"> </span>apps/v1\nkind:<span class=\"w\"> </span>Deployment\nmetadata:\n<span class=\"w\">  </span>name:<span class=\"w\"> </span>previewers-provider\n<span class=\"w\">  </span>labels:\n<span class=\"w\">    </span>app:<span class=\"w\"> </span>previewers-provider\nspec:\n<span class=\"w\">  </span>replicas:<span class=\"w\"> </span><span class=\"m\">1</span>\n<span class=\"w\">  </span>selector:\n<span class=\"w\">    </span>matchLabels:\n<span class=\"w\">      </span>app:<span class=\"w\"> </span>previewers-provider\n<span class=\"w\">  </span>template:\n<span class=\"w\">    </span>metadata:\n<span class=\"w\">      </span>labels:\n<span class=\"w\">        </span>app:<span class=\"w\"> </span>previewers-provider\n<span class=\"w\">    </span>spec:\n<span class=\"w\">      </span>securityContext:\n<span class=\"w\">        </span>fsGroup:<span class=\"w\"> </span><span class=\"m\">1000810000</span>\n<span class=\"w\">      </span>containers:\n<span class=\"w\">      </span>-<span class=\"w\"> </span>name:<span class=\"w\"> </span>previewers-provider\n<span class=\"w\">        </span>image:<span class=\"w\"> </span>dockerhub/trivadis/dataverse-previewers-provider:latest\n<span class=\"w\">        </span>securityContext:\n<span class=\"w\">          </span>runAsUser:<span class=\"w\"> </span><span class=\"m\">1000810000</span>\n<span class=\"w\">          </span>runAsGroup:<span class=\"w\"> </span><span class=\"m\">1000810000</span>\n<span class=\"w\">          </span>allowPrivilegeEscalation:<span class=\"w\"> </span><span class=\"nb\">false</span>\n<span class=\"w\">          </span>readOnlyRootFilesystem:<span class=\"w\"> </span><span class=\"nb\">false</span><span class=\"w\">  </span><span class=\"c1\"># Allow writing to mounted dirs</span>\n<span class=\"w\">        </span>ports:\n<span class=\"w\">          </span>-<span class=\"w\"> </span>containerPort:<span class=\"w\"> </span><span class=\"m\">9000</span>\n<span class=\"w\">        </span>env:\n<span class=\"w\">          </span>-<span class=\"w\"> </span>name:<span class=\"w\"> </span>NGINX_HTTP_PORT\n<span class=\"w\">            </span>value:<span class=\"w\"> </span><span class=\"s2\">\"9000\"</span>\n<span class=\"w\">          </span>-<span class=\"w\"> </span>name:<span class=\"w\"> </span>PREVIEWERS_PROVIDER_URL\n<span class=\"w\">            </span>value:<span class=\"w\"> </span><span class=\"s2\">\"http://previewers-provider:9000\"</span>\n<span class=\"w\">          </span>-<span class=\"w\"> </span>name:<span class=\"w\"> </span>VERSIONS\n<span class=\"w\">            </span>value:<span class=\"w\"> </span><span class=\"s2\">\"v1.4,betatest\"</span>\n<span class=\"w\">        </span>volumeMounts:\n<span class=\"w\">          </span>-<span class=\"w\"> </span>name:<span class=\"w\"> </span>nginx-config\n<span class=\"w\">            </span>mountPath:<span class=\"w\"> </span>/etc/nginx/conf.d/default.conf\n<span class=\"w\">            </span>subPath:<span class=\"w\"> </span>default.conf\n<span class=\"w\">          </span>-<span class=\"w\"> </span>name:<span class=\"w\"> </span>previewers-storage\n<span class=\"w\">            </span>mountPath:<span class=\"w\"> </span>/usr/share/nginx/html/previewers\n<span class=\"w\">          </span>-<span class=\"w\"> </span>name:<span class=\"w\"> </span>cache-volume\n<span class=\"w\">            </span>mountPath:<span class=\"w\"> </span>/var/cache/nginx\n<span class=\"w\">          </span>-<span class=\"w\"> </span>name:<span class=\"w\"> </span>run-volume\n<span class=\"w\">            </span>mountPath:<span class=\"w\"> </span>/var/run\n<span class=\"w\">      </span>volumes:\n<span class=\"w\">        </span>-<span class=\"w\"> </span>name:<span class=\"w\"> </span>nginx-config\n<span class=\"w\">          </span>configMap:\n<span class=\"w\">            </span>name:<span class=\"w\"> </span>nginx-config<span class=\"w\">  </span><span class=\"c1\"># Using subPath for correct mount</span>\n<span class=\"w\">        </span>-<span class=\"w\"> </span>name:<span class=\"w\"> </span>previewers-storage\n<span class=\"w\">          </span>emptyDir:<span class=\"w\"> </span><span class=\"o\">{}</span><span class=\"w\">  </span><span class=\"c1\"># Allowing writing</span>\n<span class=\"w\">        </span>-<span class=\"w\"> </span>name:<span class=\"w\"> </span>cache-volume\n<span class=\"w\">          </span>emptyDir:<span class=\"w\"> </span><span class=\"o\">{}</span>\n<span class=\"w\">        </span>-<span class=\"w\"> </span>name:<span class=\"w\"> </span>run-volume\n<span class=\"w\">          </span>emptyDir:<span class=\"w\"> </span><span class=\"o\">{}</span>\n\n---\napiVersion:<span class=\"w\"> </span>v1\nkind:<span class=\"w\"> </span>Service\nmetadata:\n<span class=\"w\">  </span>name:<span class=\"w\"> </span>previewers-provider\n<span class=\"w\">  </span>labels:\n<span class=\"w\">    </span>app:<span class=\"w\"> </span>previewers-provider\nspec:\n<span class=\"w\">  </span>type:<span class=\"w\"> </span>ClusterIP\n<span class=\"w\">  </span>ports:\n<span class=\"w\">    </span>-<span class=\"w\"> </span>port:<span class=\"w\"> </span><span class=\"m\">9000</span>\n<span class=\"w\">      </span>targetPort:<span class=\"w\"> </span><span class=\"m\">9000</span>\n<span class=\"w\">  </span>selector:\n<span class=\"w\">    </span>app:<span class=\"w\"> </span>previewers-provider\n\n---\napiVersion:<span class=\"w\"> </span>v1\nkind:<span class=\"w\"> </span>ConfigMap\nmetadata:\n<span class=\"w\">  </span>name:<span class=\"w\"> </span>nginx-config\ndata:\n<span class=\"w\">  </span>default.conf:<span class=\"w\"> </span><span class=\"p\">|</span>\n<span class=\"w\">    </span>server<span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">      </span>listen<span class=\"w\"> </span><span class=\"m\">9000</span><span class=\"p\">;</span>\n<span class=\"w\">      </span>server_name<span class=\"w\"> </span>localhost<span class=\"p\">;</span>\n\n<span class=\"w\">      </span><span class=\"c1\"># NGINX configuration to handle the requests</span>\n<span class=\"w\">      </span>location<span class=\"w\"> </span>/previewers/<span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">        </span>root<span class=\"w\"> </span>/usr/share/nginx/html<span class=\"p\">;</span>\n<span class=\"w\">        </span>try_files<span class=\"w\"> </span><span class=\"nv\">$uri</span><span class=\"w\"> </span><span class=\"nv\">$uri</span>/<span class=\"w\"> </span><span class=\"o\">=</span><span class=\"m\">404</span><span class=\"p\">;</span>\n<span class=\"w\">      </span><span class=\"o\">}</span>\n<span class=\"w\">    </span><span class=\"o\">}</span>\n</code></pre></div>",
        "id": 507768627,
        "sender_full_name": "Gursahib",
        "timestamp": 1742823991
    },
    {
        "content": "<p>That's amazing that Dataverse itself is working fine on OpenShift. <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span> </p>\n<p><span class=\"user-mention\" data-user-id=\"882006\">@Gursahib</span> do you want to <a href=\"https://guides.dataverse.org/en/6.6/contributor/documentation.html\">add something</a> about the Container Guide about this? <span aria-label=\"big smile\" class=\"emoji emoji-1f604\" role=\"img\" title=\"big smile\">:big_smile:</span></p>",
        "id": 507771743,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1742824589
    },
    {
        "content": "<p>As for the previewers, I'm not sure how to test this. Maybe using <a href=\"https://developers.redhat.com/products/openshift-local/getting-started\">OpenShift Local</a>? <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 507772065,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1742824649
    },
    {
        "content": "<p>It looks like there's also something called MicroShift: <a href=\"https://developers.redhat.com/articles/2025/02/20/why-developers-should-use-microshift\">https://developers.redhat.com/articles/2025/02/20/why-developers-should-use-microshift</a></p>",
        "id": 507772725,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1742824762
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"598112\">Philip Durbin â˜€ï¸</span> <a href=\"#narrow/channel/375812-containers/topic/OpenShift/near/507771743\">said</a>:</p>\n<blockquote>\n<p>That's amazing that Dataverse itself is working fine on OpenShift. <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span> </p>\n<p><span class=\"user-mention silent\" data-user-id=\"882006\">Gursahib</span> do you want to <a href=\"https://guides.dataverse.org/en/6.6/contributor/documentation.html\">add something</a> about the Container Guide about this? <span aria-label=\"big smile\" class=\"emoji emoji-1f604\" role=\"img\" title=\"big smile\">:big_smile:</span></p>\n</blockquote>\n<p>Sure <span class=\"user-mention\" data-user-id=\"598112\">@Philip Durbin â˜€ï¸</span>  I can contribute to the whole section on Openshift, but right now I want to deliver this to researchers I am working with. And I want it to be working 100%. I promise you I'll add a full featured document of OpenShift installation.</p>",
        "id": 507773702,
        "sender_full_name": "Gursahib",
        "timestamp": 1742824933
    },
    {
        "content": "<p>Fantastic! No rush!</p>",
        "id": 507774060,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1742825003
    },
    {
        "content": "<p>Yes, let's get this delivered to your researchers first. <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 507774142,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1742825019
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"598112\">Philip Durbin â˜€ï¸</span> <a href=\"#narrow/channel/375812-containers/topic/OpenShift/near/507772725\">said</a>:</p>\n<blockquote>\n<p>It looks like there's also something called MicroShift: <a href=\"https://developers.redhat.com/articles/2025/02/20/why-developers-should-use-microshift\">https://developers.redhat.com/articles/2025/02/20/why-developers-should-use-microshift</a></p>\n</blockquote>\n<p>I have heard of both systems but I am pretty sure these local deployments will work without a doubt, as there will be less security constraints. Still I would give it a try if nothing works.</p>",
        "id": 507774146,
        "sender_full_name": "Gursahib",
        "timestamp": 1742825020
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"882006\">@Gursahib</span> as a starting point, could you please add an issue to <a href=\"https://github.com/IQSS/dataverse/issues\">https://github.com/IQSS/dataverse/issues</a> about the trouble you're having with previewers in OpenShift?</p>",
        "id": 507774525,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1742825086
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"882006\">@Gursahib</span> these Trivadis Previewer Containers are not supported by the community. I would neither call them production ready nor well documented. Also, I wouldn't endorse using them at this point.</p>\n<p>That said, judging from looking at the <code>localinstall.sh</code> script inside the container (the sources are nowhere to be found), the scripts wants to write to <code>/app</code>, which isn't backed by a volume in your <code>Deployment</code>.</p>",
        "id": 507777161,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1742825609
    },
    {
        "content": "<p>Then what image do you suggest <span class=\"user-mention\" data-user-id=\"598183\">@Oliver Bertuch</span> ?</p>",
        "id": 507778364,
        "sender_full_name": "Gursahib",
        "timestamp": 1742825823
    },
    {
        "content": "<p>I picked the Trivadis from the <a href=\"https://guides.dataverse.org/en/6.6/container/running/demo.html\">demo docker yaml</a></p>",
        "id": 507778935,
        "sender_full_name": "Gursahib",
        "timestamp": 1742825925
    },
    {
        "content": "<p>Right, we did recently add those Trivadis images to the \"demo or eval\" use case in <a href=\"https://github.com/IQSS/dataverse/issues/11181\">#11181</a>.</p>",
        "id": 507782701,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1742826632
    },
    {
        "content": "<p>We've talked about building our own images but for now the Trivadis images are what we have.</p>",
        "id": 507782851,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1742826663
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"598183\">@Oliver Bertuch</span> you're looking for the Dockerfile? It's here: <a href=\"https://github.com/gdcc/dataverse-previewers/compare/develop...gschmutz:dataverse-previewers:develop\">https://github.com/gdcc/dataverse-previewers/compare/develop...gschmutz:dataverse-previewers:develop</a></p>",
        "id": 507783648,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1742826819
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"598112\">@Philip Durbin â˜€ï¸</span> for the link! I searched under the Trivadis repos (there is a preview register container) and tried searching, but did come up empty handed.</p>",
        "id": 507788706,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1742827764
    },
    {
        "content": "<p>Indeed, the Trivadis Preview containers are currently the only thing that's out there <span class=\"user-mention\" data-user-id=\"882006\">@Gursahib</span>, so it's probably fine that they are not production ready for your use case.</p>",
        "id": 507789109,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1742827833
    },
    {
        "content": "<p>Its Alright, I will see what I can do. If it doesnt work then that's how it is <span aria-label=\"upside down\" class=\"emoji emoji-1f643\" role=\"img\" title=\"upside down\">:upside_down:</span>.<br>\nThank you for the help <span class=\"user-mention\" data-user-id=\"598183\">@Oliver Bertuch</span>  and <span class=\"user-mention\" data-user-id=\"598112\">@Philip Durbin â˜€ï¸</span> <br>\nI'll see when i can contribute for OpenShift deployment. Probably from next week.</p>",
        "id": 507791150,
        "sender_full_name": "Gursahib",
        "timestamp": 1742828252
    },
    {
        "content": "<p>Fantastic! <span aria-label=\"heart\" class=\"emoji emoji-2764\" role=\"img\" title=\"heart\">:heart:</span></p>",
        "id": 507791583,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1742828330
    },
    {
        "content": "<p>btw I added a volume for /app as well, and as you mentioned indeed seems to be empty:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>docker-entrypoint.sh:<span class=\"w\"> </span>/docker-entrypoint.d/<span class=\"w\"> </span>is<span class=\"w\"> </span>not<span class=\"w\"> </span>empty,<span class=\"w\"> </span>will<span class=\"w\"> </span>attempt<span class=\"w\"> </span>to<span class=\"w\"> </span>perform<span class=\"w\"> </span>configuration\n/docker-entrypoint.sh:<span class=\"w\"> </span>Looking<span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span>shell<span class=\"w\"> </span>scripts<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>/docker-entrypoint.d/\n/docker-entrypoint.sh:<span class=\"w\"> </span>Launching<span class=\"w\"> </span>/docker-entrypoint.d/10-listen-on-ipv6-by-default.sh\n<span class=\"m\">10</span>-listen-on-ipv6-by-default.sh:<span class=\"w\"> </span>info:<span class=\"w\"> </span>can<span class=\"w\"> </span>not<span class=\"w\"> </span>modify<span class=\"w\"> </span>/etc/nginx/conf.d/default.conf<span class=\"w\"> </span><span class=\"o\">(</span>read-only<span class=\"w\"> </span>file<span class=\"w\"> </span>system?<span class=\"o\">)</span>\n/docker-entrypoint.sh:<span class=\"w\"> </span>Sourcing<span class=\"w\"> </span>/docker-entrypoint.d/15-local-resolvers.envsh\n/docker-entrypoint.sh:<span class=\"w\"> </span>Launching<span class=\"w\"> </span>/docker-entrypoint.d/20-envsubst-on-templates.sh\n<span class=\"m\">20</span>-envsubst-on-templates.sh:<span class=\"w\"> </span>ERROR:<span class=\"w\"> </span>/etc/nginx/templates<span class=\"w\"> </span>exists,<span class=\"w\"> </span>but<span class=\"w\"> </span>/etc/nginx/conf.d<span class=\"w\"> </span>is<span class=\"w\"> </span>not<span class=\"w\"> </span>writable\n/docker-entrypoint.sh:<span class=\"w\"> </span>Launching<span class=\"w\"> </span>/docker-entrypoint.d/30-tune-worker-processes.sh\n/docker-entrypoint.sh:<span class=\"w\"> </span>Launching<span class=\"w\"> </span>/docker-entrypoint.d/init.sh\nUsing<span class=\"w\"> </span>Provider<span class=\"w\"> </span><span class=\"nv\">Url</span><span class=\"o\">=</span>http://previewers-provider:9000<span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span>versions<span class=\"w\"> </span>v1.4,betatest\n/docker-entrypoint.d/init.sh:<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">15</span>:<span class=\"w\"> </span>./localinstall.sh:<span class=\"w\"> </span>No<span class=\"w\"> </span>such<span class=\"w\"> </span>file<span class=\"w\"> </span>or<span class=\"w\"> </span>directory\ncp:<span class=\"w\"> </span>cannot<span class=\"w\"> </span>stat<span class=\"w\"> </span><span class=\"s1\">'*.md'</span>:<span class=\"w\"> </span>No<span class=\"w\"> </span>such<span class=\"w\"> </span>file<span class=\"w\"> </span>or<span class=\"w\"> </span>directory\n/docker-entrypoint.d/init.sh:<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">19</span>:<span class=\"w\"> </span>./localinstall.sh:<span class=\"w\"> </span>No<span class=\"w\"> </span>such<span class=\"w\"> </span>file<span class=\"w\"> </span>or<span class=\"w\"> </span>directory\ncp:<span class=\"w\"> </span>cannot<span class=\"w\"> </span>stat<span class=\"w\"> </span><span class=\"s1\">'*.md'</span>:<span class=\"w\"> </span>No<span class=\"w\"> </span>such<span class=\"w\"> </span>file<span class=\"w\"> </span>or<span class=\"w\"> </span>directory\ncp:<span class=\"w\"> </span>cannot<span class=\"w\"> </span>stat<span class=\"w\"> </span><span class=\"s1\">'./previewers'</span>:<span class=\"w\"> </span>No<span class=\"w\"> </span>such<span class=\"w\"> </span>file<span class=\"w\"> </span>or<span class=\"w\"> </span>directory\n</code></pre></div>\n<p>ther error's are now limited till this</p>",
        "id": 507791873,
        "sender_full_name": "Gursahib",
        "timestamp": 1742828389
    },
    {
        "content": "<p>Ooops, yeah obviously mounting it there will make the directory empty...</p>",
        "id": 507792250,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1742828441
    },
    {
        "content": "<p>Let me take a look if we can trick the script into cooperating or if it needs to be extended</p>",
        "id": 507792414,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1742828474
    },
    {
        "content": "<p>Urgh this is hard to do... The entrypoint changes the folder to the one where the previewers are located within the container.</p>",
        "id": 507793463,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1742828668
    },
    {
        "content": "<p>And executes commands there</p>",
        "id": 507793517,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1742828677
    },
    {
        "content": "<p>That's not gonna be easy to work around. You'd have to make a fork and create your own image based on what's there...</p>",
        "id": 507793889,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1742828749
    },
    {
        "content": "<p>Would you be able to do a code contribution?</p>",
        "id": 507794102,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1742828785
    },
    {
        "content": "<p>At some point I will look into this, but don't have the bandwidth at the moment.</p>",
        "id": 507794251,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1742828814
    },
    {
        "content": "<p>exactly, this is quite challenging. </p>\n<p><span class=\"user-mention silent\" data-user-id=\"598183\">Oliver Bertuch</span> <a href=\"#narrow/channel/375812-containers/topic/OpenShift/near/507794102\">said</a>:</p>\n<blockquote>\n<p>Would you be able to do a code contribution?</p>\n</blockquote>\n<p>I will see if I achieve it on my side then sure, will take time though.</p>",
        "id": 507794666,
        "sender_full_name": "Gursahib",
        "timestamp": 1742828893
    },
    {
        "content": "<p>Don't worry its not breaking the Dataverse, its just one feature which need some polishing.<br>\nAnyways thank you for your help <span class=\"user-mention\" data-user-id=\"598183\">@Oliver Bertuch</span></p>",
        "id": 507794940,
        "sender_full_name": "Gursahib",
        "timestamp": 1742828950
    },
    {
        "content": "<p>Yeah well there's so many things that still require tweaking for a smooth container / K8s experience...</p>",
        "id": 507795095,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1742828979
    },
    {
        "content": "<p>I'd be happy to receive feedback here what your pain points are</p>",
        "id": 507795355,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1742829031
    },
    {
        "content": "<p>I assume to start working on our migration from Dataverse 4.20 on K8s to the latest and want to get some stuff done in a fork and upstream the changes later. Maybe some of these pain points align <span aria-label=\"smile cat\" class=\"emoji emoji-1f638\" role=\"img\" title=\"smile cat\">:smile_cat:</span></p>",
        "id": 507795564,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1742829082
    },
    {
        "content": "<p>Where should the code contribution go? In <a href=\"https://github.com/gdcc/dataverse-previewers\">https://github.com/gdcc/dataverse-previewers</a> ? We'll want the Dockerfile to live there, eventually?</p>",
        "id": 507795954,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1742829164
    },
    {
        "content": "<p>Yeah, that would be my guess (for both questions).</p>",
        "id": 507796042,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1742829187
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"882006\">@Gursahib</span> do you want to make a PR against that repo?</p>",
        "id": 507796380,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1742829252
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"598183\">Oliver Bertuch</span> <a href=\"#narrow/channel/375812-containers/topic/OpenShift/near/507795564\">said</a>:</p>\n<blockquote>\n<p>I assume to start working on our migration from Dataverse 4.20 on K8s to the latest and want to get some stuff done in a fork and upstream the changes later. Maybe some of these pain points align <span aria-label=\"smile cat\" class=\"emoji emoji-1f638\" role=\"img\" title=\"smile cat\">:smile_cat:</span></p>\n</blockquote>\n<p>Haha, sure. I had to do lot of changes in the components along with Dataverse, but here are few Major ones:</p>\n<ol>\n<li>In docker You can control the deployment order but here in OpenShift, even after adding delays to wait for PostgreSQL(in my case)/storage to be up, Dataverse fails trying to connect to the storage. Resolving this would be nice. I have added few JVM_Args but didn't do much. </li>\n<li>In OpneShift ports need to be above 100, as below that are not allowed due to security reasons (or was it below 1000, don't remember now but yeah you got the Idea)</li>\n</ol>\n<p>The classic example for point 2 is smtp on port 25, and due to its failure, as port 25 is not allowed, there was connection request timeout period on whenever an Admin mail is created. And during this time out Dataverse freezes in operations like, creating new dataverse, dataset; publishing the dataset/ dataverse. Basically anything which needed to send an email notification. </p>\n<p>I had used 2525 for port but default script uses 25, so I had to add a variable for that to. <br>\nThese are few pain points I can think of and the major one is previewer functionality</p>",
        "id": 507799871,
        "sender_full_name": "Gursahib",
        "timestamp": 1742829935
    },
    {
        "content": "<p>Ad 1) I've been using init containers for that reason and it's also why the base image contains wait4x</p>",
        "id": 507800616,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1742830074
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"598183\">Oliver Bertuch</span> <a href=\"#narrow/channel/375812-containers/topic/OpenShift/near/507800616\">said</a>:</p>\n<blockquote>\n<p>Ad 1) I've been using init containers for that reason and it's also why the base image contains wait4x</p>\n</blockquote>\n<p>Guess I have lot to learn</p>",
        "id": 507800821,
        "sender_full_name": "Gursahib",
        "timestamp": 1742830105
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"598112\">Philip Durbin â˜€ï¸</span> <a href=\"#narrow/channel/375812-containers/topic/OpenShift/near/507796380\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"882006\">Gursahib</span> do you want to make a PR against that repo?</p>\n</blockquote>\n<p>If i Succeed sure.</p>",
        "id": 507800993,
        "sender_full_name": "Gursahib",
        "timestamp": 1742830138
    },
    {
        "content": "<p>Here's an example how this worked in my old K8s stuff: <a href=\"https://github.com/gdcc/dataverse-kubernetes/blob/413cd89cc51ce4768dea831f0eb3280da60635f8/k8s/dataverse/deployment.yaml#L85\">https://github.com/gdcc/dataverse-kubernetes/blob/413cd89cc51ce4768dea831f0eb3280da60635f8/k8s/dataverse/deployment.yaml#L85</a></p>",
        "id": 507801176,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1742830172
    },
    {
        "content": "<p>(Needs to be adapted)</p>",
        "id": 507801201,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1742830176
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"882006\">Gursahib</span> <a href=\"#narrow/channel/375812-containers/topic/OpenShift/near/507799871\">said</a>:</p>\n<blockquote>\n<p>These are few pain points I can think of and the major one is previewer functionality</p>\n</blockquote>\n<p>It sounds like we're on the right track by focusing on previewers. <span aria-label=\"big smile\" class=\"emoji emoji-1f604\" role=\"img\" title=\"big smile\">:big_smile:</span> </p>\n<p>There's a dedicated topic for it, by the way: <a class=\"stream-topic\" data-stream-id=\"375812\" href=\"/#narrow/channel/375812-containers/topic/enable.20previewers/with/434165029\">#containers &gt; enable previewers</a></p>",
        "id": 507801943,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1742830317
    },
    {
        "content": "<p>Bah. No one likes dedicated topics. &lt;/sarcasm&gt;</p>",
        "id": 507802066,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1742830335
    },
    {
        "content": "<p>ha</p>",
        "id": 507802116,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1742830345
    },
    {
        "content": "<p>we all miss IRC <span aria-label=\"big smile\" class=\"emoji emoji-1f604\" role=\"img\" title=\"big smile\">:big_smile:</span></p>",
        "id": 507802242,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1742830367
    },
    {
        "content": "<p>I don't. But yes please let's rope in a discussion around IRC into this thread... The good ol' days <span aria-label=\"smiling devil\" class=\"emoji emoji-1f608\" role=\"img\" title=\"smiling devil\">:smiling_devil:</span> <span aria-label=\"see no evil\" class=\"emoji emoji-1f648\" role=\"img\" title=\"see no evil\">:see_no_evil:</span> <span aria-label=\"crazy\" class=\"emoji emoji-1f61c\" role=\"img\" title=\"crazy\">:crazy:</span></p>",
        "id": 507802422,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1742830406
    },
    {
        "content": "<p>Alright guys its getting late on my side of the world, I'll come back with news soon either good or bad idk. Enjoy your day.</p>",
        "id": 507802589,
        "sender_full_name": "Gursahib",
        "timestamp": 1742830440
    },
    {
        "content": "<p>Have fun!</p>",
        "id": 507802664,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1742830449
    },
    {
        "content": "<p>bye!</p>",
        "id": 507802711,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1742830459
    }
]