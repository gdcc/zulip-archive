[
    {
        "content": "<p>Here we are: I want to contribute the first real integration test. It is using Testcontainers (of course) and ensures that configurability of an OIDC provider via MPCONFIG as well as using that provider with a Keycloak instance in a container for a Bearer Token Access to the API <span class=\"user-mention\" data-user-id=\"617722\">@Johannes D</span></p>",
        "id": 360133977,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684713567
    },
    {
        "content": "<p>Anyone feeling adventurous enough to try <code>mvn clean verify</code> on the PR branch? <a href=\"https://github.com/IQSS/dataverse/pull/9273\">https://github.com/IQSS/dataverse/pull/9273</a> Only Docker, Java and Maven required!</p>",
        "id": 360134056,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684713612
    },
    {
        "content": "<p>Here's the test code BTW <a href=\"https://github.com/IQSS/dataverse/pull/9273/files#diff-104cf13998a3494cd46bf6cd92eba934c96744f84d4330ae378fcbf222bf58ea\">https://github.com/IQSS/dataverse/pull/9273/files#diff-104cf13998a3494cd46bf6cd92eba934c96744f84d4330ae378fcbf222bf58ea</a></p>",
        "id": 360134109,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684713663
    },
    {
        "content": "<p>BTW <span class=\"user-mention\" data-user-id=\"598442\">@Guillermo Portas</span> I have had a strange experience: when importing the realm you created to Keycloak 20 or 21, I could no longer access Keycloak userinfo endpoint with the retrieved access token. (Works perfectly fine with Keycloak 19) I'm a bit puzzled about that and wondering if we need to re-export or re-create our test realm from a more modern version. It says it was created with Keycloak 16, so maybe something is not right here?</p>",
        "id": 360134292,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684713819
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"598442\">@Guillermo Portas</span> as this PR does (try to) add PKCE support for the OIDC provider, maybe we need to alter the realm anyway? I would like to add an integration test for that as well!</p>",
        "id": 360134520,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684714007
    },
    {
        "content": "<p>Aaaand I have a working integration test with PKCE for the normal Auth Code Flow. Had to re-create the realm though. The exported realm from Keycloak 16 seems not be fully compatible with Keycloak 19. We'll see if that fixes the upgrade issue, too</p>",
        "id": 360178233,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684740377
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"598112\">@Philip Durbin</span> I would like to create some more users in the realm. I'd go for some users following our role model if that is OK. (admin, curator, user)</p>",
        "id": 360178438,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684740427
    },
    {
        "content": "<p><code>[INFO] Tests run: 2, Failures: 0, Errors: 0, Skipped: 0</code></p>",
        "id": 360228298,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1684752233
    },
    {
        "content": "<p><code>INFO: STDOUT: 2023-05-22 10:39:16,653 INFO  [org.keycloak.services] (main) KC-SERVICES0009: Added user 'kcuser' to realm 'master'</code></p>",
        "id": 360228441,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1684752260
    },
    {
        "content": "<p>Seems promising!</p>",
        "id": 360228654,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1684752324
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"598183\">@Oliver Bertuch</span> I would suggest making some noise in #dv-rearchitecture-auth as well.</p>",
        "id": 360229079,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1684752447
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"598183\">@Oliver Bertuch</span> sure, please go ahead and create users. You're using the default master realm instead of the realm we're adding with a JSON file?</p>",
        "id": 360229819,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1684752639
    },
    {
        "content": "<p>No, you shall (and cannot) use the master realm for that</p>",
        "id": 360232309,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684753268
    },
    {
        "content": "<p>I created a new realm \"test\"</p>",
        "id": 360232342,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684753278
    },
    {
        "content": "<p>And I'm loading it as JSON</p>",
        "id": 360232370,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684753285
    },
    {
        "content": "<p>Gotcha. I wonder why we have that out above then. <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span> <code>Added user 'kcuser' to realm 'master'</code></p>",
        "id": 360239192,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1684754998
    },
    {
        "content": "<p>That is completely normal and fine</p>",
        "id": 360242797,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684755889
    },
    {
        "content": "<p>Oh wait no it might not be</p>",
        "id": 360242835,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684755898
    },
    {
        "content": "<p>That is the \"normal\" user...</p>",
        "id": 360242928,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684755917
    },
    {
        "content": "<p>Anyway - I am setting up a nice and clean realm</p>",
        "id": 360242971,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684755928
    },
    {
        "content": "<p>admin, user, curator and affiliate as users</p>",
        "id": 360243069,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684755954
    },
    {
        "content": "<p>even created groups for them, although the OIDC provider doesn't support groups (yet!)</p>",
        "id": 360243212,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684755980
    },
    {
        "content": "<p>That must change...</p>",
        "id": 360243234,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684755986
    },
    {
        "content": "<p>We might need to edit the realm again later when we start testing things like attribute mapping for affiliatons etc</p>",
        "id": 360243364,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684756026
    },
    {
        "content": "<p>Awesome. Go, go, go! <img alt=\":dataverse_man:\" class=\"emoji\" src=\"https://zulip-avatars.s3.amazonaws.com/53090/emoji/images/44207.png\" title=\"dataverse man\"></p>",
        "id": 360255983,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1684759237
    },
    {
        "content": "<p>There you go :-) Replaced the realm, added the third test and pushed the changes</p>",
        "id": 360285666,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684764935
    },
    {
        "content": "<p>Even updated the docs :-D</p>",
        "id": 360285696,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684764945
    },
    {
        "content": "<p>No longer a draft! Great!</p>",
        "id": 360321147,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1684772878
    },
    {
        "content": "<p>Now let's see if you're trigger happy again <span aria-label=\"stuck out tongue wink\" class=\"emoji emoji-1f61c\" role=\"img\" title=\"stuck out tongue wink\">:stuck_out_tongue_wink:</span></p>",
        "id": 360321277,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684772904
    },
    {
        "content": "<p>Yes <span class=\"user-mention\" data-user-id=\"598183\">@Oliver Bertuch</span>, It may be a version incompatibility by having exported the original realm json file with an older version of Keycloak. I see in your PR that you have included a new realm, I guess exporting a new one from the new version has fixed the problem.</p>",
        "id": 360326149,
        "sender_full_name": "Guillermo Portas",
        "timestamp": 1684774135
    },
    {
        "content": "<p>If I remember correctly, the PKCE configuration is exported to the realm file with the rest of the config values of the realm, so I guess that you have included the new PKCE config in the realm file as well.</p>",
        "id": 360326686,
        "sender_full_name": "Guillermo Portas",
        "timestamp": 1684774268
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"598442\">Guillermo Portas</span> <a href=\"#narrow/stream/379673-dev/topic/real.20integration.20testing/near/360326686\">said</a>:</p>\n<blockquote>\n<p>If I remember correctly, the PKCE configuration is exported to the realm file with the rest of the config values of the realm, so I guess that you have included the new PKCE config in the realm file as well.</p>\n</blockquote>\n<p>No, I didn't add any PKCE in the realm. I looked for it but could not find any option to enforce it. Maybe because I only added a confidential client so far and no public client?</p>",
        "id": 360345257,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684779254
    },
    {
        "content": "<p>PKCE as an addendum works though - the integration test sends the challenge so that should be fine.</p>",
        "id": 360345323,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684779288
    },
    {
        "content": "<p>If you happen to know where to enforce PKCE plz let me know! Happy to include it</p>",
        "id": 360345537,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684779363
    },
    {
        "content": "<p>Ha I might just have found it... looks like you need to activate an enforcing policy.</p>",
        "id": 360348626,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684780339
    },
    {
        "content": "<p>Will look I to that when back at desk</p>",
        "id": 360348659,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684780349
    },
    {
        "content": "<p>What about real integration tests for S3 direct upload? Discuss here or in a new topic?</p>",
        "id": 360350593,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1684781015
    },
    {
        "content": "<p>Sounds like you got a taste for it now!</p>",
        "id": 360357112,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684783072
    },
    {
        "content": "<p>What can I say... IIRC there is a LocalStack Testcontainers module, so it should be easy to use.</p>",
        "id": 360357268,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684783121
    },
    {
        "content": "<p>Yeah, that's the one <span class=\"user-mention\" data-user-id=\"598186\">@Don Sizemore</span> keeps reminding me of. Or maybe we could use Minio.</p>",
        "id": 360368732,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1684787335
    },
    {
        "content": "<p>\"real\" integration testing? for when that fake integration testing just won't do?</p>",
        "id": 360369508,
        "sender_full_name": "Don Sizemore",
        "timestamp": 1684787588
    },
    {
        "content": "<p>More like \"cover more than just the API\" <span aria-label=\"wink\" class=\"emoji emoji-1f609\" role=\"img\" title=\"wink\">:wink:</span></p>",
        "id": 360459932,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684829752
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"598183\">@Oliver Bertuch</span> currently the title of your PR is this: 9268 mpconfig OIDC provider <a href=\"https://github.com/IQSS/dataverse/issues/9273\">#9273</a></p>\n<p>It does more than that, though, right?</p>",
        "id": 360498931,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1684840513
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"617722\">@Johannes D</span> have you had a chance to take a look?</p>",
        "id": 360499057,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1684840550
    },
    {
        "content": "<p>Yes, it contains more.</p>",
        "id": 360499112,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684840564
    },
    {
        "content": "<p>What should I write?</p>",
        "id": 360499179,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684840577
    },
    {
        "content": "<p>\"OIDC and OAuth refactor, MPCONFIG, more tests\"?</p>",
        "id": 360499322,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1684840613
    },
    {
        "content": "<p>Hope ya like \"9268 - OIDC auth: MPCONFIG provisioning, PKCE support and integration tests\"</p>",
        "id": 360517201,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684845141
    },
    {
        "content": "<p>Much better! Thanks!</p>",
        "id": 360526718,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1684847348
    },
    {
        "content": "<p>(We could probably drop 9268 since we have it under \"closes\".)</p>",
        "id": 360526823,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1684847372
    },
    {
        "content": "<p>But but but when I joined you lot in 2018 you wanted me to add the issue number! Is this yesterdays news?</p>",
        "id": 360532170,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684848487
    },
    {
        "content": "<p>Oh, I love, love, love, the issue number in the name of the branch. <span aria-label=\"heart\" class=\"emoji emoji-2764\" role=\"img\" title=\"heart\">:heart:</span> But in the title it's a bit noisy if you ask me. Sorry for the miscommunication!</p>",
        "id": 360534183,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1684848994
    },
    {
        "content": "<p>D'Oh!</p>",
        "id": 360543078,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684850805
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"598183\">@Oliver Bertuch</span> nice demo at tech hours! Thanks! <img alt=\":dataverse_man:\" class=\"emoji\" src=\"https://zulip-avatars.s3.amazonaws.com/53090/emoji/images/44207.png\" title=\"dataverse man\"></p>",
        "id": 360641667,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1684877158
    },
    {
        "content": "<p>Glad you liked it</p>",
        "id": 360641742,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684877172
    },
    {
        "content": "<p>May it be an icebreaker for more!</p>",
        "id": 360641770,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684877188
    },
    {
        "content": "<p>I'm hacking in this very moment on combined coverage reports...</p>",
        "id": 360641802,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684877211
    },
    {
        "content": "<p>Pre: <br>\n<a href=\"/user_uploads/53090/QnKVqL6bzmYlKNMJEpGAeeBe/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/53090/QnKVqL6bzmYlKNMJEpGAeeBe/image.png\" title=\"image.png\"><img src=\"/user_uploads/53090/QnKVqL6bzmYlKNMJEpGAeeBe/image.png\"></a></div>",
        "id": 360644791,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684878598
    },
    {
        "content": "<p>Post: <br>\n<a href=\"/user_uploads/53090/Hkd5LQGddDs8rzNFq-2pbigi/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/53090/Hkd5LQGddDs8rzNFq-2pbigi/image.png\" title=\"image.png\"><img src=\"/user_uploads/53090/Hkd5LQGddDs8rzNFq-2pbigi/image.png\"></a></div>",
        "id": 360644886,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684878616
    },
    {
        "content": "<p>Nice! As usual, go, go, go!</p>",
        "id": 360651371,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1684881767
    },
    {
        "content": "<p>Waiting on CI.... <br>\n<a href=\"/user_uploads/53090/g40gqb5fPueLy5gdBXEGWGtU/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/53090/g40gqb5fPueLy5gdBXEGWGtU/image.png\" title=\"image.png\"><img src=\"/user_uploads/53090/g40gqb5fPueLy5gdBXEGWGtU/image.png\"></a></div>",
        "id": 360652170,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684882164
    },
    {
        "content": "<p>Smooooooooth operator<br>\n<a href=\"/user_uploads/53090/88Ztx5RuH6roGnP5LzTieqrQ/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/53090/88Ztx5RuH6roGnP5LzTieqrQ/image.png\" title=\"image.png\"><img src=\"/user_uploads/53090/88Ztx5RuH6roGnP5LzTieqrQ/image.png\"></a></div>",
        "id": 360653042,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1684882602
    },
    {
        "content": "<p>Nice! If I'm reading Coveralls right, in develop OIDCAuthProvider.java has <a href=\"https://coveralls.io/builds/60189462/source?filename=src%2Fmain%2Fjava%2Fedu%2Fharvard%2Fiq%2Fdataverse%2Fauthorization%2Fproviders%2Foauth2%2Foidc%2FOIDCAuthProvider.java\">1.3% coverage</a> but in the PR you're working on (<a href=\"https://github.com/IQSS/dataverse/issues/9273\">#9273</a>), it now has <a href=\"https://coveralls.io/jobs/121991593/source_files/8929940614\">69.5% coverage</a>.</p>",
        "id": 360759879,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1684927283
    }
]