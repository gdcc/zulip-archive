[
    {
        "content": "<p>Over at <a href=\"https://guides.dataverse.org/en/6.6/api/native-api.html#editing-variable-level-metadata\">https://guides.dataverse.org/en/6.6/api/native-api.html#editing-variable-level-metadata</a> we have docs for an API that lets you edit variable level metadata. It was originally added in <a href=\"https://github.com/IQSS/dataverse/issues/5616\">#5616</a> by <span class=\"user-mention\" data-user-id=\"698148\">@Victoria Lubitch</span>. I'm having trouble getting it to work.</p>",
        "id": 527956461,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1752091112
    },
    {
        "content": "<p>There's a <a href=\"https://guides.dataverse.org/en/6.6/_downloads/d126c03c90aebaa09467b38513728564/dct.xml\">dct.xml</a> file provided but I assume it won't \"just work\".</p>\n<p>I assume I should first download variable-level DDI from my file from <code>$SERVER_URL/api/v1/access/datafile/$FILE_ID/metadata/ddi</code> (<a href=\"https://guides.dataverse.org/en/6.6/api/dataaccess.html#data-variable-metadata-access\">docs</a>), edit it, and use that. Does that sound right?</p>",
        "id": 527956736,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1752091231
    },
    {
        "content": "<p>I just started playing with this as well. I downloaded variable level ddi from the record, changed it and ran the api call to edit it.  That seemed to work well. </p>\n<p>The results are that I see the proper DDI with the changes when I fetch it via the API.  But should I also see it in the GUI when I download the DDI for a file?  I'm not seeing the changes there, even after I publish the file. I half suspect that I need to re-run some back end process to regenerate them for the UI?</p>",
        "id": 535019135,
        "sender_full_name": "Bethany Seeger",
        "timestamp": 1755549650
    },
    {
        "content": "<p>You might need to reexport that dataset: <a href=\"https://guides.dataverse.org/en/6.7.1/admin/metadataexport.html#batch-exports-through-the-api\">https://guides.dataverse.org/en/6.7.1/admin/metadataexport.html#batch-exports-through-the-api</a></p>",
        "id": 535019742,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1755549934
    },
    {
        "content": "<p>Does that run at a regular interval, or only when a record is re/published? (or when someone runs it explicitly like during an upgrade)</p>",
        "id": 535020000,
        "sender_full_name": "Bethany Seeger",
        "timestamp": 1755550056
    },
    {
        "content": "<p>Only when a dataset is republished.</p>",
        "id": 535020169,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1755550140
    },
    {
        "content": "<p>We ask people to reexport in release notes, sometimes, if we change something.</p>",
        "id": 535020227,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1755550167
    },
    {
        "content": "<p>For 6.7 we updated the Croissant export, for example. So we advise people to reexport all.</p>",
        "id": 535020289,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1755550199
    },
    {
        "content": "<p>Reexporting on a dataset should also work with the file metadata?  Or do I need to do something separate for that? I'm not seeing the file level<br>\n variable changes in the metadata yet. </p>\n<p>I did this for the dataset: <br>\ncurl <a href=\"http://localhost:8080/api/admin/metadata/:persistentId/reExportDataset?persistentId=doi:10.5072/FK2/F8WTAD\">http://localhost:8080/api/admin/metadata/:persistentId/reExportDataset?persistentId=doi:10.5072/FK2/F8WTAD</a></p>\n<p>and I get a message it's started and see a success in the log. </p>\n<p>(dataverse version 5.14, for reference)</p>",
        "id": 535020873,
        "sender_full_name": "Bethany Seeger",
        "timestamp": 1755550555
    },
    {
        "content": "<p>The file metadata should come along for the ride. <span aria-label=\"rocket\" class=\"emoji emoji-1f680\" role=\"img\" title=\"rocket\">:rocket:</span></p>",
        "id": 535021003,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1755550634
    },
    {
        "content": "<p>fwiw, I am seeing this after I re-publish a dataset after a change to the file's metadata:</p>\n<blockquote>\n<p>[#|2025-08-18T21:16:27.600+0000|SEVERE|Payara 5.2022.5|javax.enterprise.resource.webcontainer.jsf.context|_ThreadID=96;_ThreadName=http-thread-pool::jk-connector(4);_TimeMillis=1755551787600;_LevelValue=1000;|<br>\n  javax.faces.view.facelets.TagAttributeException: /dataset.xhtml @93,82 test=\"#{not empty DatasetPage.getSignpostingLinkHeader()}\" /dataset.xhtml @93,82 test=\"#{not empty DatasetPage.getSignpostingLinkHeader()}\": java.lang.NullPointerException<br>\n        at com.sun.faces.facelets.tag.TagAttributeImpl.getObject(TagAttributeImpl.java:318)<br>\n        at com.sun.faces.facelets.tag.TagAttributeImpl.getBoolean(TagAttributeImpl.java:109)<br>\n        at com.sun.faces.facelets.tag.jstl.core.IfHandler.apply(IfHandler.java:50)<br>\n        at javax.faces.view.facelets.CompositeFaceletHandler.apply(CompositeFaceletHandler.java:55)<br>\n        at com.sun.faces.facelets.tag.ui.DefineHandler.applyDefinition(DefineHandler.java:65)</p>\n</blockquote>",
        "id": 535023119,
        "sender_full_name": "Bethany Seeger",
        "timestamp": 1755551905
    },
    {
        "content": "<p>I'm guessing that the generation of the updated export files are failing in our setup due to (it seems like) the workingVersion in the DatasetPage.java is not set for some reason.  Weird. </p>\n<p>Actually, looks like I'm running into:  <a href=\"https://github.com/IQSS/dataverse/issues/9954\">https://github.com/IQSS/dataverse/issues/9954</a></p>\n<p>This may be preventing the generation of the new files... Interesting.</p>",
        "id": 535024529,
        "sender_full_name": "Bethany Seeger",
        "timestamp": 1755552751
    },
    {
        "content": "<p>Yikes, yes, interesting is one way to put it. <span aria-label=\"grimacing\" class=\"emoji emoji-1f62c\" role=\"img\" title=\"grimacing\">:grimacing:</span></p>",
        "id": 535111328,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1755604458
    }
]