[
    {
        "content": "<p>Any globus experts? I've been having issues setting up globus with the globus-dataverse external tool. <br>\nI'm testing with a POSIX gateway / collection. I have tested globus as a native app / non-native app, as enabling native app prevented me from referencing an identity for the registered app to give admin privs, and from generating a client secret. (Should it be registered as a native app to work with dataverse?)<br>\nWhen testing with a non-native app, my GCP endpoint isn't loaded in the UI and I get two 401 responses when attempting to upload with globus â€“ 'invalid_client' and 'Bad signed URL'. I tried connecting after disabling Anubis, and still got the same responses. <br>\nWhen testing it registered as a native app, my local filesystem via GCP is loaded, but I get the message 'There was an error in transfer submission. BIIG' when attempting to transfer a file. Any pointers here? And should it be registered as a native app? I do notice the redirect to <a href=\"https://auth.globus.org/v2/web/auth-code\">https://auth.globus.org/v2/web/auth-code</a> when native app is enabled, which seems to be needed here.</p>\n<p><span class=\"user-mention\" data-user-id=\"626369\">@Don Sizemore</span>  would like for me to tag <span class=\"user-mention\" data-user-id=\"598843\">@Deirdre Kirmis</span> <span class=\"user-mention\" data-user-id=\"698148\">@Victoria Lubitch</span></p>",
        "id": 560182097,
        "sender_full_name": "William Hahn",
        "timestamp": 1764083727
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"928397\">@William Hahn</span> if you don't mind, please also post at <a href=\"https://groups.google.com/g/dataverse-community\">https://groups.google.com/g/dataverse-community</a></p>",
        "id": 560187776,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1764085021
    },
    {
        "content": "<p>As a native app, the error in transfer submission throws a 401 for a requestGlobusUploadPaths api call. I suspect this issue would be solved if there were an identity provided for registered native apps (so that I could assign it admin privs).</p>",
        "id": 560187778,
        "sender_full_name": "William Hahn",
        "timestamp": 1764085021
    },
    {
        "content": "<p><a href=\"https://groups.google.com/g/dataverse-community/c/wxPlPHofIrs/m/jEgkPbpFCQAJ\">https://groups.google.com/g/dataverse-community/c/wxPlPHofIrs/m/jEgkPbpFCQAJ</a> looks great. Thanks!</p>",
        "id": 560192398,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1764086140
    },
    {
        "content": "<p>I'm not an expert, but I did get it set up and it is working. I believe I registered the main app as a native app, but I also have a PKXE app registered as a thick client. I remember the redirects and the order of them was very important, as well as the DB options and client config.</p>",
        "id": 560197189,
        "sender_full_name": "Deirdre Kirmis",
        "timestamp": 1764087346
    },
    {
        "content": "<p>It's worth noting that with a non-native registered app I get the following response ('invalid_client'):</p>\n<div class=\"codehilite\"><pre><span></span><code>ERROR TypeError: can&#39;t access property 0, this.transferData.userAccessTokenData.other_tokens is undefined\n</code></pre></div>\n<p>However, I've defined the globus token (clientID:clientSecret) in domain.xml and the :GlobusBasicToken setting.</p>\n<p><span class=\"user-mention\" data-user-id=\"598843\">@Deirdre Kirmis</span> thank you. Were you able to reference an identity when setting the client as an admin? Or did you need to do this?</p>",
        "id": 560198347,
        "sender_full_name": "William Hahn",
        "timestamp": 1764087651
    },
    {
        "content": "<p>Do you mean in Globus? Both of the apps show \"Required identity\" None .. but the credentials on the collection show my globus identity as having access to the collection and to the access keys of the IAM user who has access to the bucket. I vaguely remember setting this, but it's been a while. </p>\n<p>In the db settings, I have:<br>\n:GlobusPollingInterval 300<br>\n:GlobusAppUrl (the domain pointing to the globus collection)</p>\n<p>And for the Globus \"store\" jvm options, they look like this: </p>\n<div class=\"codehilite\"><pre><span></span><code>&lt;jvm-options&gt;-Ddataverse.files.glbs.type=s3&lt;/jvm-options&gt;\n        &lt;jvm-options&gt;-Ddataverse.files.glbs.url-expiration-minutes=60&lt;/jvm-options&gt;\n        &lt;jvm-options&gt;-Ddataverse.files.glbs.download-redirect=true&lt;/jvm-options&gt;\n        &lt;jvm-options&gt;-Ddataverse.files.glbs.upload-redirect=true&lt;/jvm-options&gt;\n        &lt;jvm-options&gt;-Ddataverse.files.glbs.path-style-access=true&lt;/jvm-options&gt;\n        &lt;jvm-options&gt;-Ddataverse.files.glbs.label=globus&lt;/jvm-options&gt;\n        &lt;jvm-options&gt;-Ddataverse.files.glbs.base-store=&lt;main store label&gt;&lt;/jvm-options&gt;\n        &lt;jvm-options&gt;-Ddataverse.files.glbs.bucket-name=&lt;bucket name&gt;&lt;/jvm-options&gt;\n        &lt;jvm-options&gt;-Ddataverse.files.glbs.managed=true&lt;/jvm-options&gt;\n        &lt;jvm-options&gt;-Ddataverse.files.glbs.transfer-endpoint-with-basepath=&lt;UUID of guest collection&gt;&lt;/jvm-options&gt;\n        &lt;jvm-options&gt;-Ddataverse.files.glbs.globus-transfer-endpoint-with-basepath=&lt;UUID of guest collection&gt;&lt;/jvm-options&gt;\n        &lt;jvm-options&gt;-Ddataverse.files.glbs.globus-token=&lt;generated token&gt;&lt;/jvm-options&gt;\n        &lt;jvm-options&gt;-Ddataverse.files.glbs.files-not-accessible-by-dataverse=false&lt;/jvm-options&gt;\n</code></pre></div>\n<p>Looking through my notes to find any other relevant info ..</p>",
        "id": 560204271,
        "sender_full_name": "Deirdre Kirmis",
        "timestamp": 1764089145
    },
    {
        "content": "<p>I built the integration app as an angular app and running it with nginx</p>",
        "id": 560204615,
        "sender_full_name": "Deirdre Kirmis",
        "timestamp": 1764089233
    },
    {
        "content": "<p>config.json looks like this:<br>\n{<br>\n  \"baseUrl\": \"\",<br>\n  \"id\": \"\",<br>\n  \"redirectUploadURL\": \"https://&lt;globus-app URL&gt;/upload\",<br>\n  \"redirectDownloadURL\": \"https://&lt;globus-app URL&gt;/download\",<br>\n  \"globusClientId\": \"&lt;secret key&gt;\"<br>\n}</p>",
        "id": 560205091,
        "sender_full_name": "Deirdre Kirmis",
        "timestamp": 1764089372
    },
    {
        "content": "<p>this is for a managed store btw</p>",
        "id": 560205354,
        "sender_full_name": "Deirdre Kirmis",
        "timestamp": 1764089440
    },
    {
        "content": "<p>the redirects for the apps include all of these:</p>\n<div class=\"codehilite\"><pre><span></span><code>http://localhost/download/\nhttp://localhost/upload/\nhttp://localhost/*/\nhttps://app.globus.org/file-manager\nhttp://localhost\nhttp://localhost/download-file/\nhttp://localhost/upload\nhttps://&lt;URL of globus app&gt;\nhttps://&lt;URL of globus app&gt;/download-file/\nhttps://&lt;URL of globus app&gt;/upload/\nhttps://&lt;URL of globus app&gt;/\nhttps://&lt;URL of globus app&gt;/upload\nhttps://&lt;URL of globus app&gt;/download\nhttps://&lt;URL of globus app&gt;/download/\nhttps://&lt;URL of globus app&gt;/download-file\nhttps://&lt;AWS ALB URL&gt;/upload\nhttps://&lt;AWS ALB URL&gt;/upload/\n</code></pre></div>",
        "id": 560206306,
        "sender_full_name": "Deirdre Kirmis",
        "timestamp": 1764089716
    },
    {
        "content": "<p>i guess all that is on their docs =/</p>",
        "id": 560206854,
        "sender_full_name": "Deirdre Kirmis",
        "timestamp": 1764089866
    },
    {
        "content": "<p>I remember getting the BIIG error several times and it seems that is related to bucket access .. (ie: the access keys changed or something else was configured incorrectly).</p>",
        "id": 560208464,
        "sender_full_name": "Deirdre Kirmis",
        "timestamp": 1764090305
    },
    {
        "content": "<p>also, as you can tell, we are running dataverse and the integration app on AWS and we have DNS &gt; ALB &gt; globus app .. both store in S3</p>",
        "id": 560210696,
        "sender_full_name": "Deirdre Kirmis",
        "timestamp": 1764090964
    },
    {
        "content": "<p>hope some of that helps <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span></p>",
        "id": 560210741,
        "sender_full_name": "Deirdre Kirmis",
        "timestamp": 1764090978
    },
    {
        "content": "<p>Thanks a lot <span class=\"user-mention\" data-user-id=\"598843\">@Deirdre Kirmis</span>. I'll try out some of your suggestions and see if they help. <br>\nOne thing I'm noticingâ€“ I've been using the UUID of the configured endpoint itself rather than for the specific guest collection (for transfer-endpoint jvm options). This probably accounts for at least some of my setup issues... Also, I've been using the registered UUID for the client rather than the secret key for globusClientId in the config. I'll try building while mirroring some of your setup and see if I have any luck.<br>\nAnd I was referencing the client identity that one can see for non-native apps (e.g. &lt;Client UUID&gt;@clients.auth.globus.org). The dataverse community document instructs this field should be set as admin for the guest collection, but I was confused since this field doesn't show up when native app / thick client is selected (which is also instructed) <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 560429375,
        "sender_full_name": "William Hahn",
        "timestamp": 1764173631
    },
    {
        "content": "<p>fyi: I was able to upload a file to the guest collection (POSIX) with Deirdre's and Kirill's suggestions! Several of the redirects (mainly localhost) that Deirdre has I did not. Thank you both :)<br>\nThe main thing I was missing was Kirill's suggestion. My confusion stemmed from where to source the client secret, Basic Globus Token, etc. <br>\nOne needs to register a portal in conjunction with a thick client for the project, and reference the client ID and secret for the portal for the basic token. I also gave the portal identity (&lt;Client UUID&gt;@clients.auth.globus.org) admin privs for the guest collection.</p>",
        "id": 560468247,
        "sender_full_name": "William Hahn",
        "timestamp": 1764187710
    },
    {
        "content": "<p>That's great! Glad you were able to get it to work! I remember switching out the UUIDs to find the right one, and going back and forth between the DV docs and the github instructions to find the right combination of things. Somehow I got it working. <span aria-label=\"smile\" class=\"emoji emoji-1f604\" role=\"img\" title=\"smile\">:smile:</span> I would be interested in your experience with it and if you find you use it a lot. We still have not had a real use case that we couldn't solve with DVUploader or DVWebloader recently, although we have had some in the past that we could really have used it for.  And for our researcher community who use Globus already, it could be a huge help.</p>",
        "id": 560471261,
        "sender_full_name": "Deirdre Kirmis",
        "timestamp": 1764188968
    },
    {
        "content": "<p>And just curious, do you plan to just have Globus available as a \"managed\" upload option for anyone that has large/many files, or are you going to configure remote stores with it? I've tested adding some remote endpoints but we have not actively used any.</p>",
        "id": 560471638,
        "sender_full_name": "Deirdre Kirmis",
        "timestamp": 1764189134
    },
    {
        "content": "<p>At UNC we're not quite there yet, but we're definitely are interested in using globus for big data transfers, especially with S3 Glacier now having globus support. We aren't charged egress for S3, so it's a great option for us. So... I'm thinking we'll be using a remote store for big data uploads but things are a bit in flux at the moment. Any pointers are welcome if you have any!<br>\nAlso would be interested to hear about how you all might use it in the future <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span></p>",
        "id": 560474500,
        "sender_full_name": "William Hahn",
        "timestamp": 1764190427
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"928397\">@William Hahn</span> I'm glad you figured it out! Do you think a tweak to the docs would help? Any interest in making a pull request? <span aria-label=\"smile\" class=\"emoji emoji-1f604\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 561179823,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1764600170
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"598112\">@Philip Durbin ðŸš€</span> I submitted a PR to update the guides link to the current repo; we're going to update the community Google doc hopefully today or tomorrow. I told William I can think of four people who may know more about the Dataverse/Globus integration than him.</p>",
        "id": 561189038,
        "sender_full_name": "Don Sizemore",
        "timestamp": 1764601993
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"598112\">@Philip Durbin ðŸš€</span> Definitely! I think the bit about setting up a portal will be important for future dataverse globus tinkerers to know about. <span class=\"user-mention\" data-user-id=\"626369\">@Don Sizemore</span> and I plan to look at it later today/this week <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span></p>",
        "id": 561190094,
        "sender_full_name": "William Hahn",
        "timestamp": 1764602230
    },
    {
        "content": "<p>Awesome, thanks!</p>",
        "id": 561190193,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1764602253
    },
    {
        "content": "<p>Eventually, I think that community doc should go away. The content should be incorporated into the guides, I mean.</p>",
        "id": 561190414,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1764602302
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"598112\">@Philip Durbin ðŸš€</span> today <span class=\"user-mention\" data-user-id=\"928397\">@William Hahn</span> would like to test Globus in Jim's recommended configuration (those are the two comments we didn't accept/approve yesterday) then, with Jim/Victoria/Leonid's approval we may well submit a docs PR.</p>",
        "id": 561400626,
        "sender_full_name": "Don Sizemore",
        "timestamp": 1764679059
    }
]