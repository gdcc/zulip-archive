[
    {
        "content": "<p>Hi all,</p>\n<p>we encounter a inconsistent behaviour when using the /api/metadatablocks endpoint. When for example querying the citation metadatablock the first parent is \"otherId\" with child \"otherIdAgency\" etc. The entry for \"otherIdAgency\" is then shown again after the otherId block, which we think it shouldn't as it is a child entry. The same holds for all other child entries, too, i.e. they are all shown twice. The entries are not filtered during casting from list to set via treeSet in JsonPrinter.java, ln. 642.<br>\nAdditionally we noticed that for the codeMeta20 block the children displayOrder are numbered always starting from 0 (which we think is the proper way to do it) whereas in all other blocks the entries are numbered consecutively. The counting form 0 can mitigate the filtering issue but only if a certain order within the DB of parents and children are followed.<br>\nIt seems like using a non-unique identifier, i.e. displayOrder, for sorting the json export leads to undesired side-effects.<br>\nIs anybody else seeing this behaviour?</p>\n<p>We are on dataverse version 6.3.<br>\nThank you and regards<br>\nBjÃ¶rn (FoKUS, University of Stuttgart)</p>",
        "id": 457293229,
        "sender_full_name": "BjÃ¶rn Selent",
        "timestamp": 1723103558
    },
    {
        "content": "<p>Hmm, looking at <a href=\"https://demo.dataverse.org/api/metadatablocks/citation\">https://demo.dataverse.org/api/metadatablocks/citation</a> I see what you mean:</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n  &quot;status&quot;: &quot;OK&quot;,\n  &quot;data&quot;: {\n...\n    &quot;fields&quot;: {\n...\n      &quot;otherId&quot;: {\n        &quot;name&quot;: &quot;otherId&quot;,\n...\n        &quot;childFields&quot;: {\n          &quot;otherIdAgency&quot;: {\n            &quot;name&quot;: &quot;otherIdAgency&quot;,\n...\n      &quot;otherIdAgency&quot;: {\n        &quot;name&quot;: &quot;otherIdAgency&quot;,\n</code></pre></div>",
        "id": 457366592,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1723122584
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"598112\">Philip Durbin</span> <a href=\"#narrow/stream/378866-troubleshooting/topic/metadatablocks.20api/near/457366592\">schrieb</a>:</p>\n<blockquote>\n<p>Hmm, looking at <a href=\"https://demo.dataverse.org/api/metadatablocks/citation\">https://demo.dataverse.org/api/metadatablocks/citation</a> I see what you mean:</p>\n<p><div class=\"codehilite\"><pre><span></span><code>{\n  &quot;status&quot;: &quot;OK&quot;,\n  &quot;data&quot;: {\n...\n    &quot;fields&quot;: {\n...\n      &quot;otherId&quot;: {\n        &quot;name&quot;: &quot;otherId&quot;,\n...\n        &quot;childFields&quot;: {\n          &quot;otherIdAgency&quot;: {\n            &quot;name&quot;: &quot;otherIdAgency&quot;,\n...\n      &quot;otherIdAgency&quot;: {\n        &quot;name&quot;: &quot;otherIdAgency&quot;,\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>Hello Philip, <br>\nI have just created a Pull Request that should fix the issue: <a href=\"https://github.com/IQSS/dataverse/pull/10764\">https://github.com/IQSS/dataverse/pull/10764</a><br>\nKind regards<br>\nFlorian (FoKUS, University of Stuttgart)<br>\nP.S. I hope I fulfilled all the requirements for a proper Pull Request.</p>",
        "id": 459412432,
        "sender_full_name": "Florian Fritze",
        "timestamp": 1723193383
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"671970\">@Florian Fritze</span> Thanks.</p>\n<p>edu.harvard.iq.dataverse.api.DataversesIT.testListMetadataBlocks is failing with this:</p>\n<div class=\"codehilite\"><pre><span></span><code>1 expectation failed.\nJSON path data[1].fields.size() doesn&#39;t match.\nExpected: &lt;10&gt;\n  Actual: &lt;2&gt;\n</code></pre></div>\n<p>Here: edu.harvard.iq.dataverse.api.DataversesIT.testListMetadataBlocks(DataversesIT.java:779)</p>",
        "id": 460096243,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1723473620
    },
    {
        "content": "<p>It looks like the code was last edited by <span class=\"user-mention\" data-user-id=\"598442\">@Guillermo Portas</span> in PR <a href=\"https://github.com/IQSS/dataverse/issues/10642\">#10642</a> to fix <a href=\"https://github.com/IQSS/dataverse/issues/10637\">#10637</a>.</p>",
        "id": 460096748,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1723473802
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"598112\">@Philip Durbin</span>  The issue that Florian describes is something that was present in the original code before I modified it. It's a behavior that I remember discussing in the past, and we decided to keep it this way for backwards compatibility. That is, showing the child fields also repeated as root fields in the response. We need to decide whether we want to finally change this behavior or keep it as is.</p>",
        "id": 461940832,
        "sender_full_name": "Guillermo Portas",
        "timestamp": 1723491381
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"598112\">@Philip Durbin</span> I'm in favor of changing it, although it might be good to double-check first.</p>",
        "id": 461941048,
        "sender_full_name": "Guillermo Portas",
        "timestamp": 1723491465
    },
    {
        "content": "<p>Ah, thanks <span class=\"user-mention\" data-user-id=\"598442\">@Guillermo Portas</span>. I didn't remember discussing it!</p>",
        "id": 461942648,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1723491970
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"671970\">@Florian Fritze</span> at minimum, if we do decide to make a backward-incompatible change, we should document it at a future version of <a href=\"https://guides.dataverse.org/en/6.3/api/changelog.html\">https://guides.dataverse.org/en/6.3/api/changelog.html</a></p>",
        "id": 461942884,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1723492053
    },
    {
        "content": "<p>Can you please edit <code>doc/sphinx-guides/source/api/changelog.rst</code> in your PR?</p>",
        "id": 461944053,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1723492558
    },
    {
        "content": "<p>Oh and please create a release note snippet too: <a href=\"https://guides.dataverse.org/en/6.3/developers/version-control.html#writing-a-release-note-snippet\">https://guides.dataverse.org/en/6.3/developers/version-control.html#writing-a-release-note-snippet</a></p>",
        "id": 461944249,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1723492634
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"598112\">Philip Durbin</span> <a href=\"#narrow/stream/378866-troubleshooting/topic/metadatablocks.20api/near/461944053\">schrieb</a>:</p>\n<blockquote>\n<p>Can you please edit <code>doc/sphinx-guides/source/api/changelog.rst</code> in your PR?</p>\n</blockquote>\n<p>I am not quite familiar with this. What should I enter in the changelog.rst file? What would you expect from me. Currently on the top there is:</p>\n<blockquote>\n<p>API Changelog (Breaking Changes)<br>\n================================</p>\n<p>This API changelog is experimental and we would love feedback on its usefulness. Its primary purpose is to inform API developers of any breaking changes. (We try not ship any backward incompatible changes, but it happens.) To see a list of new APIs and backward-compatible changes to existing API, please see each version's release notes at <a href=\"https://github.com/IQSS/dataverse/releases\">https://github.com/IQSS/dataverse/releases</a></p>\n<p>.. contents:: |toctitle|<br>\n    :local:<br>\n    :depth: 1</p>\n<p>v6.3</p>\n<hr>\n<ul>\n<li><strong>/api/admin/superuser/{identifier}</strong>: The POST endpoint that toggles superuser status has been deprecated in favor of a new PUT endpoint that allows you to specify true or false. See :ref:<code>set-superuser-status</code>.</li>\n</ul>\n</blockquote>",
        "id": 462084434,
        "sender_full_name": "Florian Fritze",
        "timestamp": 1723547566
    },
    {
        "content": "<p>And an additional question: Should I make the changes in my branch which I used for the Pull Request? Thanks in advance.</p>",
        "id": 462084787,
        "sender_full_name": "Florian Fritze",
        "timestamp": 1723547700
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"671970\">@Florian Fritze</span> Hi! v6.3 is the latest released version. You'd start a new section called v6.4 and add a bullet describing the change.</p>",
        "id": 462124848,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1723558112
    },
    {
        "content": "<p>And yes, all in the same branch, please. Thanks!</p>",
        "id": 462132553,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1723559888
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"598112\">Philip Durbin</span> <a href=\"#narrow/stream/378866-troubleshooting/topic/metadatablocks.20api/near/462132553\">schrieb</a>:</p>\n<blockquote>\n<p>And yes, all in the same branch, please. Thanks!</p>\n</blockquote>\n<p>Good morning, it's done.</p>",
        "id": 462271058,
        "sender_full_name": "Florian Fritze",
        "timestamp": 1723616113
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"671970\">@Florian Fritze</span> thanks! I just left another review: <a href=\"https://github.com/IQSS/dataverse/pull/10764#pullrequestreview-2248119241\">https://github.com/IQSS/dataverse/pull/10764#pullrequestreview-2248119241</a></p>",
        "id": 463713876,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1724162955
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"598112\">Philip Durbin ðŸš€</span> <a href=\"#narrow/channel/378866-troubleshooting/topic/metadatablocks.20api/near/463713876\">schrieb</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"671970\">Florian Fritze</span> thanks! I just left another review: <a href=\"https://github.com/IQSS/dataverse/pull/10764#pullrequestreview-2248119241\">https://github.com/IQSS/dataverse/pull/10764#pullrequestreview-2248119241</a></p>\n</blockquote>\n<p>Hello Philip, I am still waiting for an approval of my Pull Request. Could it be that it is fallen under the table?</p>",
        "id": 489217923,
        "sender_full_name": "Florian Fritze",
        "timestamp": 1734350635
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"671970\">Florian Fritze</span> <a href=\"#narrow/channel/378866-troubleshooting/topic/metadatablocks.20api/near/489217923\">schrieb</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"598112\">Philip Durbin ðŸš€</span> <a href=\"#narrow/channel/378866-troubleshooting/topic/metadatablocks.20api/near/463713876\">schrieb</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"671970\">Florian Fritze</span> thanks! I just left another review: <a href=\"https://github.com/IQSS/dataverse/pull/10764#pullrequestreview-2248119241\">https://github.com/IQSS/dataverse/pull/10764#pullrequestreview-2248119241</a></p>\n</blockquote>\n<p>Hello Philip, I am still waiting for an approval of my Pull Request. Could it be that it is fallen under the table?</p>\n</blockquote>\n<p>Thanks in advance Florian</p>",
        "id": 489218253,
        "sender_full_name": "Florian Fritze",
        "timestamp": 1734350732
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"760572\">@Steven Winship</span> can you please take a look at this?</p>",
        "id": 489233798,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1734354998
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"681715\">@Florian FÃ¶rster</span> I can't push to your fork so I made a PR for you. Please take a look: <a href=\"https://github.com/IQSS/dataverse/pull/10764#issuecomment-2545755220\">https://github.com/IQSS/dataverse/pull/10764#issuecomment-2545755220</a></p>",
        "id": 489249484,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1734358864
    }
]