[
    {
        "content": "<p>A new thread by <span class=\"user-mention\" data-user-id=\"671269\">@AsbjÃ¸rn SkÃ¸dt</span> - <a href=\"https://groups.google.com/g/dataverse-community/c/HgZRJ3WoKUs/m/YP9JFm1sAgAJ\">https://groups.google.com/g/dataverse-community/c/HgZRJ3WoKUs/m/YP9JFm1sAgAJ</a></p>",
        "id": 452099171,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1721227890
    },
    {
        "content": "<p>I just replied, pointing him here to continue the discussion <span aria-label=\"smiley\" class=\"emoji emoji-1f603\" role=\"img\" title=\"smiley\">:smiley:</span> <a href=\"https://groups.google.com/g/dataverse-community/c/HgZRJ3WoKUs/m/1cKsKudvAgAJ\">https://groups.google.com/g/dataverse-community/c/HgZRJ3WoKUs/m/1cKsKudvAgAJ</a></p>",
        "id": 452105017,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1721229233
    },
    {
        "content": "<p>Yeah, I thought here might be better. Thanks.</p>",
        "id": 452114696,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1721231573
    },
    {
        "content": "<p>Maybe <span class=\"user-mention\" data-user-id=\"671269\">@AsbjÃ¸rn SkÃ¸dt</span> is interested in trying out the experimental TOML support <span aria-label=\"money face\" class=\"emoji emoji-1f911\" role=\"img\" title=\"money face\">:money_face:</span></p>",
        "id": 452123340,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1721233531
    },
    {
        "content": "<p>Exactly! I think he'd love it.</p>",
        "id": 452139601,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1721237079
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"671269\">@AsbjÃ¸rn SkÃ¸dt</span> see Feature Request: Enabling configuration of Dataverse using simple file(s) <a href=\"https://github.com/IQSS/dataverse/issues/10684\">#10684</a></p>",
        "id": 452139845,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1721237129
    },
    {
        "content": "<p>Hey! Yes, let's continue here. What terrible lies the ChatGPT gives you! What is this TOML, tell me more :)</p>",
        "id": 452276082,
        "sender_full_name": "AsbjÃ¸rn SkÃ¸dt",
        "timestamp": 1721289685
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"671269\">@AsbjÃ¸rn SkÃ¸dt</span> !</p>\n<p>I've been announcing this in <a class=\"stream-topic\" data-stream-id=\"375812\" href=\"/#narrow/stream/375812-containers/topic/toml.20configuration\">#containers &gt; toml configuration</a>... I created a <a href=\"https://github.com/gdcc/jdbc-conffile-driver\">fake JDBC driver</a> that we can use to deploy  JVM options that are MPCONFIG enabled (note that not all are, especially the storage subsystem isn't yet) as <a href=\"https://toml.io/en/\">TOML files</a>.</p>\n<p>There's also an upstream issue that describes it with some examples: <a href=\"https://github.com/IQSS/dataverse/issues/10684\">#10684</a></p>",
        "id": 452277567,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1721290010
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"671269\">@AsbjÃ¸rn SkÃ¸dt</span> feel free to join the container meeting in 5 or watch the recording later. Will give a demo of the TOML config thing. (Also with a demo app, not Dataverse...)</p>",
        "id": 452343695,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1721309049
    },
    {
        "content": "<p>See <a class=\"stream-topic\" data-stream-id=\"375812\" href=\"/#narrow/stream/375812-containers/topic/weekly.20meeting\">#containers &gt; weekly meeting</a> or <a href=\"https://ct.gdcc.io\">https://ct.gdcc.io</a></p>",
        "id": 452344083,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1721309144
    },
    {
        "content": "<p>So I think the conclusion for us was to wait for Oliver's TOML update.</p>",
        "id": 453105055,
        "sender_full_name": "AsbjÃ¸rn SkÃ¸dt",
        "timestamp": 1721634258
    },
    {
        "content": "<p>Don't forget to vote <span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span>  on <a href=\"https://github.com/payara/Payara/issues/6822\">https://github.com/payara/Payara/issues/6822</a> y'all!!!</p>",
        "id": 453105641,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1721634399
    },
    {
        "content": "<p>So, yes, please vote, and yes, I'm looking forward to the TOML file, but...</p>\n<p>... should we also write better documentation about how to use MicroProfile Config today?</p>",
        "id": 453180815,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1721656238
    },
    {
        "content": "<p>No idea. It's complicated. And the configuration guide is a mess. I already added a section on safe password handling. Not sure if we put more gasoline into the fire.</p>",
        "id": 453213492,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1721663326
    },
    {
        "content": "<p>Should we send a notice to the community mailing list to add more votes for the issue? I'm already alerting some other channels to get more votes in.</p>",
        "id": 453213603,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1721663361
    },
    {
        "content": "<p>Heh, if you want to email the google group, for it.</p>\n<p>That said, at 15 votes, the TOML issue is already number one! Number two has 9 votes: <a href=\"https://github.com/payara/Payara/issues?q=is%3Aissue+is%3Aopen+sort%3Areactions-%2B1-desc\">https://github.com/payara/Payara/issues?q=is%3Aissue+is%3Aopen+sort%3Areactions-%2B1-desc</a></p>",
        "id": 453214555,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1721663622
    },
    {
        "content": "<p>Hi there. <br>\nDid TOML support get implemented in Dataverse? We have also been looking into using a <em>microprofile-config.properties</em>Â file but need some more guidance on where to put the file and how to get Payara to recognize it. What are folks doing to avoid editing the domain.xml file and handle configuration like PID settings? <br>\nThanks, Jay</p>",
        "id": 538696719,
        "sender_full_name": "Jay Sundu",
        "timestamp": 1757522358
    },
    {
        "content": "<p>Never ever edit the properties file directly. It is absolutely not meant to be edited and you may Ende up getting in trouble doing so.</p>",
        "id": 538708698,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1757526586
    },
    {
        "content": "<p>Yes, Payara enabled TOML support.</p>",
        "id": 538708760,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1757526607
    },
    {
        "content": "<p>Here's how you activate it: <a href=\"https://docs.payara.fish/community/docs/6.2025.9/Technical%20Documentation/MicroProfile/Config/TOML.html\">https://docs.payara.fish/community/docs/6.2025.9/Technical%20Documentation/MicroProfile/Config/TOML.html</a></p>",
        "id": 538708859,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1757526645
    },
    {
        "content": "<p>So far I've mostly used env vars in containers, but looking forward to using TOML now, mounted from a K8s ConfigMap.</p>",
        "id": 538709043,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1757526723
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"598183\">@Oliver Bertuch</span> I'll try to get TOML working</p>",
        "id": 538726183,
        "sender_full_name": "Jay Sundu",
        "timestamp": 1757533031
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"598183\">@Oliver Bertuch</span> Following up on Jay's Q, right now we're deploying Dataverse to VMs per the documentation (which among things, involves using asadmin to deploy the app, which results in a mutable &lt;application&gt; section of that file). The root motivation behind Jay's Q is that we want to full extract our config customization (a la what you'd do with a containerized deployment). (We run containers for everything but Dataverse, but opted not to for it because it didn't seem well-supported at the time.) Do you have any pointers for us? Maybe a GitHub link? From your comment it sounds like you're mostly using the environment, but we'd be curious about details (e.g. what remains, if anything, in domain.xml).</p>",
        "id": 538901184,
        "sender_full_name": "Daniel C Schmidt",
        "timestamp": 1757607743
    },
    {
        "content": "<p>Here's an example using MPConfig with environment variables in Dataverse:</p>\n<div class=\"codehilite\"><pre><span></span><code>[dataverse@dev1 ~]$ /usr/local/payara6/glassfish/bin/asadmin stop-domain\nPicked up JAVA_TOOL_OPTIONS: -Djdk.util.zip.disableZip64ExtraFieldValidation=true --add-opens=java.base/java.io=ALL-UNNAMED\nWaiting for the domain to stop ....\nCommand stop-domain executed successfully.\n[dataverse@dev1 ~]$\n[dataverse@dev1 ~]$ export DATAVERSE_VERSION=foo\n[dataverse@dev1 ~]$\n[dataverse@dev1 ~]$ /usr/local/payara6/glassfish/bin/asadmin start-domain\nPicked up JAVA_TOOL_OPTIONS: -Djdk.util.zip.disableZip64ExtraFieldValidation=true --add-opens=java.base/java.io=ALL-UNNAMED\nWaiting for domain1 to start ...................\nSuccessfully started the domain : domain1\ndomain  Location: /usr/local/payara6/glassfish/domains/domain1\nLog File: /usr/local/payara6/glassfish/domains/domain1/logs/server.log\nAdmin Port: 4848\nCommand start-domain executed successfully.\n[dataverse@dev1 ~]$\n[dataverse@dev1 ~]$ curl http://localhost:8080/api/info/version\n{&quot;status&quot;:&quot;OK&quot;,&quot;data&quot;:{&quot;version&quot;:&quot;foo&quot;,&quot;build&quot;:&quot;11747-review-dataset-type-48ccfc8f54&quot;}}\n</code></pre></div>\n<p>DATAVERSE_VERSION comes from here in the code: <a href=\"https://github.com/IQSS/dataverse/blob/v6.7.1/src/main/java/edu/harvard/iq/dataverse/settings/JvmSettings.java#L42\">https://github.com/IQSS/dataverse/blob/v6.7.1/src/main/java/edu/harvard/iq/dataverse/settings/JvmSettings.java#L42</a></p>\n<p>(Don't worry about my custom build number. I set that with <a href=\"https://github.com/IQSS/dataverse/blob/develop/scripts/installer/custom-build-number\">a script</a> before I built the war file.)</p>",
        "id": 538905289,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1757609032
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"598112\">@Philip Durbin ðŸš€</span> , that looks promising. I'm thinking we could package everything into a .env file and (in our current setup) pass that to the service via the systemd service configuration (i.e. EnvironmentFile). Do you know if everything can be provided that way, or would we still have to resort to templating domain.xml or running asadmin scripts pre-startup for some settings? I'm coming into this from another project so am a bit less familiar with Dataverse than <span class=\"user-mention\" data-user-id=\"674237\">@Jay Sundu</span> , but my understanding from his testing is that not all configurations can be set that way.</p>",
        "id": 538906691,
        "sender_full_name": "Daniel C Schmidt",
        "timestamp": 1757609468
    },
    {
        "content": "<p>There are a few stragglers but most of the old JVM settings we used to set in domain.xml can now be set via MPConfig, such as with environment variables, as shown above.</p>",
        "id": 538918444,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1757614177
    },
    {
        "content": "<p>Storage can't be configured via MPConfig yet. See <a href=\"https://github.com/IQSS/dataverse/issues/9998\">#9998</a>.</p>",
        "id": 538918552,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1757614221
    },
    {
        "content": "<p>I think that's the big one. Please let us know what else you need.</p>",
        "id": 538918767,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1757614329
    },
    {
        "content": "<p>But yeah, you should be able to source an .env file before you start Payara.</p>",
        "id": 538918805,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1757614351
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"598112\">@Philip Durbin ðŸš€</span> . Can I use environment variables for the Per Provider Settings? For instance, I have the variable dataverse.pid.ez1.type and I tried setting DATAVERSE_PID_EZ1_TYPE but that doesn't seem to work.</p>",
        "id": 538944016,
        "sender_full_name": "Jay Sundu",
        "timestamp": 1757625453
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"674237\">@Jay Sundu</span> Did you try using DATAVERSE_PID_EZID_ as the prefix? That would seem to be it based on the code <a href=\"https://github.com/IQSS/dataverse/blob/v6.7.1/src/main/java/edu/harvard/iq/dataverse/settings/JvmSettings.java#L42\">linked above</a>. Granted I'm just grokking the constants there, not looking into how things are actually fetched from ENV, so might be off here</p>",
        "id": 538945859,
        "sender_full_name": "Daniel C Schmidt",
        "timestamp": 1757626371
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"960313\">@Daniel C Schmidt</span>** I ended up rebuilding the dev environment and now DATAVERSE_PID_EZ1_TYPE works there.</p>",
        "id": 538955563,
        "sender_full_name": "Jay Sundu",
        "timestamp": 1757632953
    },
    {
        "content": "<p>Working? Great! <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span></p>",
        "id": 538956041,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1757633235
    },
    {
        "content": "<p>Also, if you have suggestions of how we should improve the docs, let's talk! I can definitely help with a PR if you want to start one.</p>",
        "id": 538963111,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1757637324
    },
    {
        "content": "<p>Personally, I'd always favor using a TOML file over any .env file. But if systemd + env file works for you, go go go! <span aria-label=\"smile\" class=\"emoji emoji-1f604\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 538984428,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1757654462
    },
    {
        "content": "<p>Makes sense, but you gotta walk before you can run. <span aria-label=\"smile\" class=\"emoji emoji-1f604\" role=\"img\" title=\"smile\">:smile:</span> </p>\n<p><span class=\"user-mention\" data-user-id=\"598183\">@Oliver Bertuch</span> what do you think? Should document the <code>DATAVERSE_VERSION</code> example above? I think of it as the \"hello world\" of using MPConfig in a classic installation.</p>",
        "id": 539034222,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1757674105
    },
    {
        "content": "<p>Maybe instead of _VERSION use the build number thingy?</p>",
        "id": 539048097,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1757678881
    },
    {
        "content": "<p>But sure, we can make some example for MPCONFIG and include it in the docs</p>",
        "id": 539048187,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1757678914
    },
    {
        "content": "<p>It probably would help to have the full picture in there how to go about the env file and systemd, to be extended with TOML etc</p>",
        "id": 539049205,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1757679184
    },
    {
        "content": "<p>DATAVERSE_BUILD has no effect if you build the war with src/main/java/BuildNumber.properties in place: <a href=\"https://github.com/IQSS/dataverse/blob/v6.7.1/src/main/java/edu/harvard/iq/dataverse/util/SystemConfig.java#L106-L120\">https://github.com/IQSS/dataverse/blob/v6.7.1/src/main/java/edu/harvard/iq/dataverse/util/SystemConfig.java#L106-L120</a></p>\n<p>(I tried it yesterday. Didn't work. Looked at the code above.)</p>",
        "id": 539060649,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1757682380
    },
    {
        "content": "<p>The problem I'm trying to solve with an example is this: people may be unclear how to even use MPConfig and just give up and hack on domain.xml.</p>",
        "id": 539060852,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1757682434
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"598112\">Philip Durbin ðŸš€</span> <a href=\"#narrow/channel/378866-troubleshooting/topic/How.20to.20Use.20Microprofile.20Config/near/539060852\">said</a>:</p>\n<blockquote>\n<p>The problem I'm trying to solve with an example is this: people may be unclear how to even use MPConfig and just give up and hack on domain.xml.</p>\n</blockquote>\n<p>That was our experience coming into the deployment process as a team with a lot of container/orchestration experience but only a very, very distant Java background. (I suspect the clean path is more obvious to an experienced Java developer.) The use of asadmin, for example, which is referenced quite a bit in release notesâ€”we didn't realize that not only does it modify domain.xml, but that some of the modifications are (without hacky workarounds) impossible to back into configuration management. Application deployments come to mind due to changes to the &lt;applications&gt; config section.</p>",
        "id": 539079474,
        "sender_full_name": "Daniel C Schmidt",
        "timestamp": 1757687390
    },
    {
        "content": "<p>Makes total sense. Many years of hacking on domain.xml (for this project) has made me lose perspective on how unnatural it is. Hopefully you like the MPConfig way better. And TOML (which builds on MPConfig) should be better still. More like configuring any service on Linux. <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 539080529,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1757687684
    }
]