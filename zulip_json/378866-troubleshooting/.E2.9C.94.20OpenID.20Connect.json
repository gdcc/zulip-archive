[
    {
        "content": "<p>I have developed an OpenID Connect Provider and now want to configure Dataverse's login approach so that users can authenticate themselves through my OpenID Connect Provider.</p>\n<p>I have set the following options in Dataverse (i.e., /usr/local/payara6/glassfish/domains/domain1/config/domain.xml):</p>\n<p>&lt;jvm-options&gt;-Ddataverse.auth.oidc.enabled=true&lt;/jvm-options&gt;<br>\n&lt;jvm-options&gt;-Ddataverse.auth.oidc.client-id=some_id&lt;/jvm-options&gt;<br>\n&lt;jvm-options&gt;-Ddataverse.auth.oidc.client-secret=some_secret&lt;/jvm-options&gt;<br>\n&lt;jvm-options&gt;-Ddataverse.auth.oidc.auth-server-url=https://my.oidc.com/api/auth/.well-known/openid-configuration&lt;/jvm-options&gt;<br>\n&lt;jvm-options&gt;-Ddataverse.auth.oidc.title=OpenID Title&lt;/jvm-options&gt;<br>\n&lt;jvm-options&gt;-Ddataverse.auth.oidc.subtitle=OpenID SubTitle&lt;/jvm-options&gt;</p>\n<p>I have developed an OpenID Connect Provider and now want to configure Dataverse's login approach so that users can authenticate themselves through my OpenID Connect Provider.</p>\n<p>I have set the following options in Dataverse (i.e., /usr/local/payara6/glassfish/domains/domain1/config/domain.xml):</p>\n<p>&lt;jvm-options&gt;-Ddataverse.auth.oidc.enabled=true&lt;/jvm-options&gt;<br>\n&lt;jvm-options&gt;-Ddataverse.auth.oidc.client-id=some_id&lt;/jvm-options&gt;<br>\n&lt;jvm-options&gt;-Ddataverse.auth.oidc.client-secret=some_secret&lt;/jvm-options&gt;<br>\n&lt;jvm-options&gt;-Ddataverse.auth.oidc.auth-server-url=https://my.oidc.com/api/auth/.well-known/openid-configuration&lt;/jvm-options&gt;<br>\n&lt;jvm-options&gt;-Ddataverse.auth.oidc.title=OpenID Title&lt;/jvm-options&gt;<br>\n&lt;jvm-options&gt;-Ddataverse.auth.oidc.subtitle=OpenID SubTitle&lt;/jvm-options&gt;<br>\nI restarted the service using command /usr/local/payara6/bin/asadmin restart-domain domain1.</p>\n<p>Now I expect to see a new button (for OpenID Connect) in the Dataverse's login view but I do not see such a thing and only the normal login button is - as always - shown. Also I see the logs using the command cat /usr/local/payara6/glassfish/domains/domain1/logs/server.log and the logs show the following:</p>\n<p>[2024-03-07T10:59:39.449+0000] [Payara 6.2023.8] [SEVERE] [] [edu.harvard.iq.dataverse.authorization.AuthenticationProvidersRegistrationServiceBean] [tid: _ThreadID=70 _ThreadName=http-thread-pool::http-listener-1(2)] [timeMillis: 1709809179449] [levelValue: 1000] [[ Exception setting up an OIDC auth provider via MicroProfile Config edu.harvard.iq.dataverse.authorization.exceptions.AuthorizationSetupException: OIDC provider metadata at <a href=\"https://my.oidc.com/api/auth/.well-known/openid-configuration/\">https://my.oidc.com/api/auth/.well-known/openid-configuration/</a> not parsable. at edu.harvard.iq.dataverse.authorization.providers.oauth2.oidc.OIDCAuthProvider.getMetadata(OIDCAuthProvider.java:129) at edu.harvard.iq.dataverse.authorization.providers.oauth2.oidc.OIDCAuthProvider.(OIDCAuthProvider.java:91) at edu.harvard.iq.dataverse.authorization.providers.oauth2.oidc.OIDCAuthenticationProviderFactory.buildFromSettings(OIDCAuthenticationProviderFactory.java:67) at edu.harvard.iq.dataverse.authorization.AuthenticationProvidersRegistrationServiceBean.startup(AuthenticationProvidersRegistrationServiceBean.java:129) at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.base/java.lang.reflect.Method.invoke(Method.java:568) at com.sun.ejb.containers.interceptors.BeanCallbackInterceptor.intercept(InterceptorManager.java:1022) at com.sun.ejb.containers.interceptors.CallbackChainImpl.invokeNext(CallbackChainImpl.java:72) at com.sun.ejb.containers.interceptors.CallbackInvocationContext.proceed(CallbackInvocationContext.java:204) at com.sun.ejb.containers.interceptors.SystemInterceptorProxy.doCall(SystemInterceptorProxy.java:163) at com.sun.ejb.containers.interceptors.SystemInterceptorProxy.init(SystemInterceptorProxy.java:125) at jdk.internal.reflect.GeneratedMethodAccessor226.invoke(Unknown Source) at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.base/java.lang.reflect.Method.invoke(Method.java:568) at com.sun.ejb.containers.interceptors.CallbackInterceptor.intercept(InterceptorManager.java:978) at com.sun.ejb.containers.interceptors.CallbackChainImpl.invokeNext(CallbackChainImpl.java:72) at com.sun.ejb.containers.interceptors.CallbackInvocationContext.proceed(CallbackInvocationContext.java:204) at org.jboss.weld.module.ejb.AbstractEJBRequestScopeActivationInterceptor.aroundInvoke(AbstractEJBRequestScopeActivationInterceptor.java:72) at org.jboss.weld.module.ejb.SessionBeanInterceptor.aroundInvoke(SessionBeanInterceptor.java:52) at jdk.internal.reflect.GeneratedMethodAccessor224.invoke(Unknown Source) at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.base/java.lang.reflect.Method.invoke(Method.java:568) at com.sun.ejb.containers.interceptors.CallbackInterceptor.intercept(InterceptorManager.java:978) at com.sun.ejb.containers.interceptors.CallbackChainImpl.invokeNext(CallbackChainImpl.java:72) at com.sun.ejb.containers.interceptors.InterceptorManager.intercept(InterceptorManager.java:418) at com.sun.ejb.containers.interceptors.InterceptorManager.intercept(InterceptorManager.java:381) at com.sun.ejb.containers.BaseContainer.intercept(BaseContainer.java:2071) at com.sun.ejb.containers.AbstractSingletonContainer.createSingletonEJB(AbstractSingletonContainer.java:585) at com.sun.ejb.containers.AbstractSingletonContainer$SingletonContextFactory.create(AbstractSingletonContainer.java:743) at com.sun.ejb.containers.AbstractSingletonContainer.instantiateSingletonInstance(AbstractSingletonContainer.java:477) at org.glassfish.ejb.startup.SingletonLifeCycleManager.initializeSingleton(SingletonLifeCycleManager.java:219) at org.glassfish.ejb.startup.SingletonLifeCycleManager.initializeSingleton(SingletonLifeCycleManager.java:180) at com.sun.ejb.containers.AbstractSingletonContainer.checkInit(AbstractSingletonContainer.java:451) at com.sun.ejb.containers.AbstractSingletonContainer._getContext(AbstractSingletonContainer.java:189) at com.sun.ejb.containers.CMCSingletonContainer._getContext(CMCSingletonContainer.java:85) at com.sun.ejb.containers.BaseContainer.getContext(BaseContainer.java:2607) at com.sun.ejb.containers.BaseContainer.preInvoke(BaseContainer.java:2024) at com.sun.ejb.containers.EJBLocalObjectInvocationHandler.invoke(EJBLocalObjectInvocationHandler.java:210) at com.sun.ejb.containers.EJBLocalObjectInvocationHandlerDelegate.invoke(EJBLocalObjectInvocationHandlerDelegate.java:90) at jdk.proxy76/jdk.proxy76.$Proxy344.getAuthenticationProvidersMap(Unknown Source) at edu.harvard.iq.dataverse.authorization.EJB31_Generated__AuthenticationProvidersRegistrationServiceBean__Intf____Bean.getAuthenticationProvidersMap(Unknown Source) at edu.harvard.iq.dataverse.authorization.AuthenticationServiceBean.getAuthenticationProviderIdsOfType(AuthenticationServiceBean.java:150) at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.base/java.lang.reflect.Method.invoke(Method.java:568) at org.glassfish.ejb.security.application.EJBSecurityManager.runMethod(EJBSecurityManager.java:588) at org.glassfish.ejb.security.application.EJBSecurityManager.invoke(EJBSecurityManager.java:408) at com.sun.ejb.containers.BaseContainer.invokeBeanMethod(BaseContainer.java:4835) at com.sun.ejb.EjbInvocation.invokeBeanMethod(EjbInvocation.java:653) at com.sun.ejb.containers.interceptors.AroundInvokeChainImpl.invokeNext(InterceptorManager.java:834) at com.sun.ejb.EjbInvocation.proceed(EjbInvocation.java:603) at com.sun.ejb.containers.interceptors.SystemInterceptorProxy.doCall(SystemInterceptorProxy.java:163) at com.sun.ejb.containers.interceptors.SystemInterceptorProxy.aroundInvoke(SystemInterceptorProxy.java:140) at jdk.internal.reflect.GeneratedMethodAccessor289.invoke(Unknown Source) at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.base/java.lang.reflect.Method.invoke(Method.java:568) at com.sun.ejb.containers.interceptors.AroundInvokeInterceptor.intercept(InterceptorManager.java:888) at com.sun.ejb.containers.interceptors.AroundInvokeChainImpl.invokeNext(InterceptorManager.java:833) at com.sun.ejb.EjbInvocation.proceed(EjbInvocation.java:603) at org.jboss.weld.module.ejb.AbstractEJBRequestScopeActivationInterceptor.aroundInvoke(AbstractEJBRequestScopeActivationInterceptor.java:72) at org.jboss.weld.module.ejb.SessionBeanInterceptor.aroundInvoke(SessionBeanInterceptor.java:52) at jdk.internal.reflect.GeneratedMethodAccessor224.invoke(Unknown Source) at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.base/java.lang.reflect.Method.invoke(Method.java:568) at com.sun.ejb.containers.interceptors.AroundInvokeInterceptor.intercept(InterceptorManager.java:888) at com.sun.ejb.containers.interceptors.AroundInvokeChainImpl.invokeNext(InterceptorManager.java:833) at com.sun.ejb.containers.interceptors.InterceptorManager.intercept(InterceptorManager.java:375)...</p>\n<p>Also, the following is the output of the <a href=\"https://my.oidc.com/api/auth/.well-known/openid-configuration\">https://my.oidc.com/api/auth/.well-known/openid-configuration</a>:</p>\n<p>{<br>\n  \"issuer\": \"<a href=\"https://my.oidc.com/api/auth\">https://my.oidc.com/api/auth</a>\",<br>\n  \"authorization_endpoint\": \"<a href=\"https://my.oidc.com/api/auth/authorize\">https://my.oidc.com/api/auth/authorize</a>\",<br>\n  \"token_endpoint\": \"<a href=\"https://my.oidc.com/api/auth/oauth-access-token\">https://my.oidc.com/api/auth/oauth-access-token</a>\",<br>\n  \"userinfo_endpoint\": \"<a href=\"https://my.oidc.com/api/auth/oauth-user-profile\">https://my.oidc.com/api/auth/oauth-user-profile</a>\",<br>\n  \"jwks_uri\": \"<a href=\"https://my.oidc.com/api/auth/.well-known/jwks.json\">https://my.oidc.com/api/auth/.well-known/jwks.json</a>\",<br>\n  \"response_types_supported\": [\"code\", \"token\", \"id_token\", \"code id_token\"],<br>\n  \"subject_types_supported\": [\"public\", \"pairwise\"],<br>\n  \"id_token_signing_alg_values_supported\": [\"RS256\", \"ES256\", \"HS256\"]<br>\n}</p>",
        "id": 425282509,
        "sender_full_name": "Mohsen Jafari",
        "timestamp": 1709810798
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"698782\">@Mohsen Jafari</span> hi! This just a guess but maybe instead of</p>\n<p><code>&lt;jvm-options&gt;-Ddataverse.auth.oidc.auth-server-url=https://my.oidc.com/api/auth/.well-known/openid-configuration&lt;/jvm-options&gt;</code></p>\n<p>... you should try...</p>\n<p><code>&lt;jvm-options&gt;-Ddataverse.auth.oidc.auth-server-url=https://my.oidc.com/api/auth/&lt;/jvm-options&gt;</code></p>\n<p>I'm looking at <code>&lt;issuer url&gt;</code> under <a href=\"https://guides.dataverse.org/en/6.1/installation/oidc.html#how-to-use\">https://guides.dataverse.org/en/6.1/installation/oidc.html#how-to-use</a></p>",
        "id": 425296738,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1709816051
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"598112\">Philip Durbin</span> <a href=\"#narrow/stream/378866-troubleshooting/topic/OpenID.20Connect/near/425296738\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"698782\">Mohsen Jafari</span> hi! This just a guess but maybe instead of</p>\n<p><code>&lt;jvm-options&gt;-Ddataverse.auth.oidc.auth-server-url=https://my.oidc.com/api/auth/.well-known/openid-configuration&lt;/jvm-options&gt;</code></p>\n<p>... you should try...</p>\n<p><code>&lt;jvm-options&gt;-Ddataverse.auth.oidc.auth-server-url=https://my.oidc.com/api/auth/&lt;/jvm-options&gt;</code></p>\n<p>I'm looking at <code>&lt;issuer url&gt;</code> under <a href=\"https://guides.dataverse.org/en/6.1/installation/oidc.html#how-to-use\">https://guides.dataverse.org/en/6.1/installation/oidc.html#how-to-use</a></p>\n</blockquote>\n<p>You are right. Thanks.</p>",
        "id": 425297302,
        "sender_full_name": "Mohsen Jafari",
        "timestamp": 1709816271
    },
    {
        "content": "<p>It works! Great! <span aria-label=\"grinning\" class=\"emoji emoji-1f600\" role=\"img\" title=\"grinning\">:grinning:</span></p>",
        "id": 425297392,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1709816291
    },
    {
        "content": "<p>How is it possible to set redirect_uri for dataverse (in case of using OpenID approach)?</p>",
        "id": 425328121,
        "sender_full_name": "Mohsen Jafari",
        "timestamp": 1709824101
    },
    {
        "content": "<p>Huh, I see a related commit by <span class=\"user-mention\" data-user-id=\"598183\">@Oliver Bertuch</span> at <a href=\"https://github.com/IQSS/dataverse/commit/9a4b49fae048e727abb198c71bbd55127ef9934c\">https://github.com/IQSS/dataverse/commit/9a4b49fae048e727abb198c71bbd55127ef9934c</a> but I'm really not sure.</p>",
        "id": 425333984,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1709825500
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"598112\">Philip Durbin</span> <a href=\"#narrow/stream/378866-troubleshooting/topic/OpenID.20Connect/near/425333984\">said</a>:</p>\n<blockquote>\n<p>Huh, I see a related commit by <span class=\"user-mention silent\" data-user-id=\"598183\">Oliver Bertuch</span> at <a href=\"https://github.com/IQSS/dataverse/commit/9a4b49fae048e727abb198c71bbd55127ef9934c\">https://github.com/IQSS/dataverse/commit/9a4b49fae048e727abb198c71bbd55127ef9934c</a> but I'm really not sure.</p>\n</blockquote>\n<p>You are right. By seeing the commit I found out that I should set the following jvm option in domain.xml:</p>\n<p>&lt;jvm-options&gt;-Ddataverse.fqdn=MY_DATAVERSE_IP&lt;/jvm-options&gt;</p>",
        "id": 425336501,
        "sender_full_name": "Mohsen Jafari",
        "timestamp": 1709826171
    },
    {
        "content": "<p>Fantastic.</p>",
        "id": 425337355,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1709826403
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"698782\">Mohsen Jafari</span> has marked this topic as resolved.</p>",
        "id": 425854497,
        "sender_full_name": "Notification Bot",
        "timestamp": 1710144686
    }
]