[
    {
        "content": "<p>We have a custom PID provider called perma1  set as the default. (we dont have datacite integration yet nor will we have it soon we want to use permalink (for now).. Our Payara JVM options include:</p>\n<div class=\"codehilite\"><pre><span></span><code>-Ddataverse.pid.providers=perma1\n-Ddataverse.pid.default-provider=perma1\n-Ddataverse.pid.perma1.type=perma\n-Ddataverse.pid.perma1.label=PermaLink\n-Ddataverse.pid.perma1.authority=TEST\n-Ddataverse.pid.perma1.shoulder=x/\n-Ddataverse.pid.perma1.permalink.base-url=https://dataverse-test.bsc.es/dataset.xhtml?persistentId=perma:\n-Ddataverse.pid.perma1.permalink.separator=/\nIn the Dataverse database (dvobject), our dataset row shows:\n</code></pre></div>\n<p>If we create a new dataset <br>\nIn the Dataverse database (dvobject), our dataset row shows:</p>\n<div class=\"codehilite\"><pre><span></span><code>id=501\nprotocol=perma\nauthority=TEST\nidentifier=x/GEGNYK\n</code></pre></div>\n<p>We can access the dataset page directly at <a href=\"https://dataverse-test.bsc.es/dataset.xhtml?persistentId=perma:TEST/x/GEGNYK\">https://dataverse-test.bsc.es/dataset.xhtml?persistentId=perma:TEST/x/GEGNYK</a><br>\nHowever, it never appears in Solr (numFound=0), and thus not in search results or dataset listings. Forced reindexing completes without errors, but the dataset is still missing from Solr. Logs show the custom PermaLinkPidProvider gets invoked (“Parsing in Perma...”), yet no dataset doc is created in Solr.</p>\n<p>We suspect the custom perma protocol isn’t being recognized by the indexing pipeline, possibly due to incomplete integration between PermaLinkPidProvider and Dataverse’s GlobalIdServiceBean or indexing logic. We removed :DoiProvider=\"Builtin\" and confirmed the PID config is set to perma1 only. Still, the dataset never appears in Solr.</p>\n<p>We are looking for guidance on how to properly integrate a custom PID provider (“perma1”) so new “perma:…” datasets are fully indexed in Dataverse.</p>",
        "id": 489429388,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1734424024
    },
    {
        "content": "<p>Strange. Can you please show us your server.log?</p>",
        "id": 489476955,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1734439638
    },
    {
        "content": "<p><a href=\"/user_uploads/53090/MJw4nvELrS8YSR-Mx1J3kDSU/server.log\">server.log</a></p>",
        "id": 489479952,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1734440411
    },
    {
        "content": "<p>Thanks!</p>",
        "id": 489479994,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1734440427
    },
    {
        "content": "<p>Interesting. Here's the error:</p>\n<div class=\"codehilite\"><pre><span></span><code>Exception Description: Syntax error parsing [SELECT fm.id FROM FileMetadata fm, DvObject dvo WHERE fm.datasetVersion.id=(SELECT dv.id FROM DatasetVersion dv WHERE dv.dataset.id=dvo.owner.id and dv.versionState=edu.harvard.iq.dataverse.DatasetVersion.VersionState.RELEASED ORDER BY dv.versionNumber DESC, dv.minorVersionNumber DESC LIMIT 1) AND dvo.id=fm.dataFile.id AND fm.dataFile.id=:fid].\n[232, 232] The right parenthesis is missing from the sub-expression.\n[291, 292] The ORDER BY clause has &#39;dv.minorVersionNumber DESC &#39; and &#39;LIMIT 1&#39; that are not separated by a comma.\n[292, 299] The order by item is not a valid expression.\n[299, 350] The query contains a malformed ending.\n</code></pre></div>",
        "id": 489483482,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1734441479
    },
    {
        "content": "<p>Which <span class=\"user-mention\" data-user-id=\"760290\">@Omer M Fahim</span> saw in this issue: <a href=\"https://github.com/IQSS/dataverse/issues/11069\">https://github.com/IQSS/dataverse/issues/11069</a></p>",
        "id": 489483560,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1734441494
    },
    {
        "content": "<p><a href=\"https://github.com/IQSS/dataverse/pull/11072\">https://github.com/IQSS/dataverse/pull/11072</a> is the fix</p>",
        "id": 489483608,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1734441511
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"671195\">@Simon Carroll</span> which version of Dataverse are you running?</p>",
        "id": 489483633,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1734441523
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"598112\">Philip Durbin 🚀</span> <a href=\"#narrow/channel/378866-troubleshooting/topic/Custom.20.E2.80.9CPerma.E2.80.9D.20PID.20Setup.20.26.20Indexing.20Problem/near/489483633\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"671195\">Simon Carroll</span> which version of Dataverse are you running?</p>\n</blockquote>\n<p>6.4</p>",
        "id": 489484164,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1734441720
    },
    {
        "content": "<p>Ok, the fix above is in 6.5 (<a class=\"stream-topic\" data-stream-id=\"375707\" href=\"/#narrow/channel/375707-community/topic/Dataverse.206.2E5.20is.20here.21\">#community &gt; Dataverse 6.5 is here!</a> )</p>",
        "id": 489484479,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1734441826
    },
    {
        "content": "<p>Hi Philip </p>\n<p>I can now create datasets and the permalink seems to work but nothing is indexed.  I dont really see any relevant errors. Any ideas what could be  happening</p>\n<p>Current config below :</p>",
        "id": 489713866,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1734514024
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>-Ddataverse.files.archive.type=trs\n-Ddataverse.files.archive.base-url=https://transfer1.bsc.es/gpfs/archive/\n-Ddataverse.files.archive.ingestsizelimit=0\n-Ddataverse.files.archive.label=archive\n-Ddataverse.pid.datacite.username=testaccount\n-Ddataverse.pid.datacite.password=${ALIAS=doi_password_alias}\n-Ddataverse.pid.perma1.type=perma\n-Ddataverse.pid.perma1.label=PermaLink\n-Ddataverse.pid.perma1.authority=TEST\n-Ddataverse.pid.perma1.permalink.separator=/\n-Ddataverse.pid.default-provider=perma1\n-Ddataverse.pid.providers=perma1\n-Ddataverse.spi.pidproviders.directory=/usr/local/payara6/glassfish/domains/domain1/config/pidproviders\n-Ddataverse.pid.perma1.permalink.base-url=https://dataverse-test.bsc.es/dataset.xhtml?persistentId=perma:\n</code></pre></div>",
        "id": 489730313,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1734519471
    },
    {
        "content": "<p><a href=\"/user_uploads/53090/Hq3Y5RvyIp2_phrzHqNgX_sg/server.log\">server.log</a><br>\nI attach the relevant part of the log</p>",
        "id": 489738978,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1734522403
    },
    {
        "content": "<p>even doing this </p>\n<div class=\"codehilite\"><pre><span></span><code>rocky@dataverse-test ~]$ curl http://localhost:8080/api/admin/index/dataset?persistentId=perma:TEST/JEZUF6\n{&quot;status&quot;:&quot;OK&quot;,&quot;data&quot;:{&quot;message&quot;:&quot;Reindexed dataset perma:TEST/JEZUF6&quot;,&quot;id&quot;:517,&quot;persistentId&quot;:&quot;perma:TEST/JEZUF6&quot;,&quot;versions&quot;:[{&quot;semanticVersion&quot;:&quot;DRAFT&quot;,&quot;id&quot;:104}]}}\n</code></pre></div>\n<p>I still dont see it <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 489743266,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1734523787
    },
    {
        "content": "<p>Hmm, what do you have in <code>/usr/local/payara6/glassfish/domains/domain1/config/pidproviders</code>?</p>",
        "id": 489751238,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1734526395
    },
    {
        "content": "<p>Hi philip. It is empty.</p>",
        "id": 489776177,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1734534071
    },
    {
        "content": "<p>Ok, could that line be causing you trouble? What if you remove it? This one: <code>-Ddataverse.spi.pidproviders.directory=/usr/local/payara6/glassfish/domains/domain1/config/pidproviders</code></p>",
        "id": 489776390,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1734534121
    },
    {
        "content": "<p>should I duplicate some of the config form the domain.xml to there</p>",
        "id": 489776492,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1734534138
    },
    {
        "content": "<p>Oh, wait, you started by saying you have a custom PID provider.</p>",
        "id": 489776634,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1734534175
    },
    {
        "content": "<p>In what way is it custom?</p>",
        "id": 489776670,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1734534183
    },
    {
        "content": "<p>it depends on the definition. We just want to like the PID to the url of the dataset in dataverse</p>",
        "id": 489776817,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1734534217
    },
    {
        "content": "<p>Ok, the regular perma provider should work fine for that.</p>",
        "id": 489776973,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1734534251
    },
    {
        "content": "<p>It's funny, right now for development and demos we use a weird FAKE DOI provider but we've talked about switching to the perma provider. Maybe we should go ahead and switch. Then you'd have a working config!</p>",
        "id": 489777237,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1734534320
    },
    {
        "content": "<p>just deleted that option and I still dont have new datasets<br>\n indexed</p>",
        "id": 489778016,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1734534525
    },
    {
        "content": "<p>Here's what I'm thinking. Maybe I could convert the compose.yml in our tutorial at <a href=\"https://guides.dataverse.org/en/6.5/container/running/demo.html\">https://guides.dataverse.org/en/6.5/container/running/demo.html</a> to use perma instead of FAKE. If it works, if datasets are indexed properly, maybe you can try it and compare to your config. How does that sound?</p>",
        "id": 489778844,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1734534735
    },
    {
        "content": "<p>It sounds great for us!</p>",
        "id": 489789763,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1734537537
    },
    {
        "content": "<p>Please, if we can help let us know.</p>",
        "id": 489789800,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1734537547
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"671195\">@Simon Carroll</span> please take a look at this: <a href=\"https://github.com/IQSS/dataverse/pull/11108\">https://github.com/IQSS/dataverse/pull/11108</a></p>",
        "id": 489834981,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1734553199
    },
    {
        "content": "<p>Good morning!  Thanks a lot for the support. </p>\n<p>The config works nicely for us however, when I create a data set like this, <a href=\"https://dataverse-test.bsc.es/dataset.xhtml?persistentId=perma:BSCTEST/VPJRN7\">https://dataverse-test.bsc.es/dataset.xhtml?persistentId=perma:BSCTEST/VPJRN7</a> I dont see the new data set indexed. <br>\n<a href=\"/user_uploads/53090/9oRcyP_xNP9q0jlpMMJE-fzb/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/53090/9oRcyP_xNP9q0jlpMMJE-fzb/image.png\" title=\"image.png\"><img data-original-dimensions=\"1544x893\" src=\"/user_uploads/thumbnail/53090/9oRcyP_xNP9q0jlpMMJE-fzb/image.png/840x560.webp\"></a></div><p>Even if I do this : </p>\n<div class=\"codehilite\"><pre><span></span><code>curl http://localhost:8080/api/admin/index/dataset?persistentId=perma:BSCTEST/VPJRN7\n{\"status\":\"OK\",\"data\":{\"message\":\"Reindexed dataset perma:BSCTEST/VPJRN7\",\"id\":534,\"persistentId\":\"perma:BSCTEST/VPJRN7\",\"versions\":[{\"semanticVersion\":\"DRAFT\",\"id\":110}]}}[rocky@dataverse-test ~]$\n</code></pre></div>",
        "id": 489898237,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1734591996
    },
    {
        "content": "<p>Hmm, could you please show us a fresh copy of server.log?</p>",
        "id": 489952331,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1734610785
    },
    {
        "content": "<p><a href=\"/user_uploads/53090/ECA-v46Qi8WSTJTpSxeJ_ZAD/server.adddata.log\">server.adddata.log</a><br>\nGood morning! I attach a log of creating a dataset  <a href=\"https://dataverse-test.bsc.es/citation?persistentId=perma:BSCTEST/0DBSEH\">https://dataverse-test.bsc.es/citation?persistentId=perma:BSCTEST/0DBSEH</a>,</p>",
        "id": 490113778,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1734682769
    },
    {
        "content": "<p><a href=\"/user_uploads/53090/l_VBsgM1IsZ6EI4NCBjwrFuf/server.index.log\">server.index.log</a> heres a couple of lines after manually indexing it</p>",
        "id": 490114214,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1734682930
    },
    {
        "content": "<p>and the full log in case its usefull <br>\n<a href=\"/user_uploads/53090/PxJaneTP27kiQs0vCwz-C1Dl/full.log\">full.log</a></p>",
        "id": 490114405,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1734683016
    },
    {
        "content": "<p>Unfortunately, I can't find anything relevant in the logs. Should we do a \"diff\" between our two configs? I'm using the compose.yml from <a href=\"https://github.com/IQSS/dataverse/pull/11108\">https://github.com/IQSS/dataverse/pull/11108</a> . What other settings are you using?</p>",
        "id": 490174110,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1734705720
    },
    {
        "content": "<p><a href=\"/user_uploads/53090/QhJkgKYhszTkTQI_wCwCav_C/jvmoptions.out\">jvmoptions.out</a><br>\nI am not using docker in test atm but here is the jvm options out.</p>",
        "id": 490177029,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1734706619
    },
    {
        "content": "<p>very strange one . I do see in the logs something with the sholder \"x\" but we removed it the subsequent indexing should fix it anyway though ?</p>",
        "id": 490177556,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1734706774
    },
    {
        "content": "<p>Well, if a dataset was saved with a certain PID due to previous configurations it will still have that PID. Reconfiguring Dataverse won't change the dataset's PID.</p>",
        "id": 490178207,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1734706943
    },
    {
        "content": "<p>I wonder if we can have you start with a \"known good\" config that indexes datasets properly. Then add more config that you need. Does that make sense?</p>",
        "id": 490178314,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1734706977
    },
    {
        "content": "<p>Because it seems like you are starting with a config that isn't working well, at least for indexing datasets.</p>",
        "id": 490178379,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1734706995
    },
    {
        "content": "<p>yeah, well it worked beore switching to perma1</p>",
        "id": 490178480,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1734707035
    },
    {
        "content": "<p>what can i do, change the default provider ?</p>",
        "id": 490178661,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1734707086
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>-Ddataverse.pid.providers=fake\n-Ddataverse.pid.fake.type=FAKE\n-Ddataverse.pid.fake.label=Fake DOI Provider\n-Ddataverse.pid.fake.authority=10.5072\n-Ddataverse.pid.fake.shoulder=FK2/\n</code></pre></div>",
        "id": 490179052,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1734707218
    },
    {
        "content": "<p>Interesting. So perma1 caused all the problems. <span aria-label=\"grimacing\" class=\"emoji emoji-1f62c\" role=\"img\" title=\"grimacing\">:grimacing:</span></p>",
        "id": 490179083,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1734707229
    },
    {
        "content": "<p>this worked before</p>",
        "id": 490179101,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1734707236
    },
    {
        "content": "<p>This is how I'm setting the default provider in the PR above:</p>\n<div class=\"codehilite\"><pre><span></span><code>-Ddataverse.pid.default-provider=perma1\n</code></pre></div>",
        "id": 490179214,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1734707279
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>-Ddataverse.pid.default-provider=perma1\n</code></pre></div>",
        "id": 490179352,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1734707313
    },
    {
        "content": "<p>we only differ on authority in the pid settings</p>",
        "id": 490179546,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1734707387
    },
    {
        "content": "<p>and of course the fact we switch form one to the other</p>\n<div class=\"codehilite\"><pre><span></span><code>[root@dataverse-test rocky]# $PAYARA/bin/asadmin list-jvm-options | grep pid\nPicked up JAVA_TOOL_OPTIONS: -Djdk.util.zip.disableZip64ExtraFieldValidation=true --add-opens=java.base/java.io=ALL-UNNAMED\n-Ddataverse.pid.datacite.mds-api-url=https://mds.test.datacite.org/\n-Ddataverse.pid.datacite.rest-api-url=https://api.test.datacite.org\n-Ddataverse.pid.perma1.type=perma\n-Ddataverse.pid.perma1.label=Perma1\n-Ddataverse.pid.perma1.authority=BSCTEST\n-Ddataverse.pid.perma1.permalink.separator=/\n-Ddataverse.pid.default-provider=perma1\n-Ddataverse.pid.providers=perma1\n</code></pre></div>",
        "id": 490179759,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1734707445
    },
    {
        "content": "<p>Right.</p>",
        "id": 490180437,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1734707651
    },
    {
        "content": "<p>Could you please run this for me?</p>\n<p><code>curl http://localhost:8080/api/admin/index/status</code></p>",
        "id": 490180456,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1734707658
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>[root@dataverse-test rocky]# curl http://localhost:8080/api/admin/index/status\n{&quot;status&quot;:&quot;OK&quot;,&quot;data&quot;:{&quot;message&quot;:&quot;Index Status Batch Job initiated, check log for job status.&quot;}}\n</code></pre></div>",
        "id": 490180514,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1734707678
    },
    {
        "content": "<p>Great. Now can you please look at server.log? You should see output that looks something like this:</p>\n<div class=\"codehilite\"><pre><span></span><code>dev_dataverse&gt;   Beginning indexStatus()|#]\ndev_dataverse&gt;\ndev_dataverse&gt; [#|2024-12-20T15:15:22.856+0000|INFO|Payara 6.2024.6|edu.harvard.iq.dataverse.search.IndexBatchServiceBean|_ThreadID=493;_ThreadName=__ejb-thread-pool6;_TimeMillis=1734707722856;_LevelValue=800;|\ndev_dataverse&gt;   checking for stale or missing dataverses|#]\ndev_dataverse&gt;\ndev_dataverse&gt; [#|2024-12-20T15:15:22.868+0000|INFO|Payara 6.2024.6|edu.harvard.iq.dataverse.search.IndexBatchServiceBean|_ThreadID=493;_ThreadName=__ejb-thread-pool6;_TimeMillis=1734707722868;_LevelValue=800;|\ndev_dataverse&gt;   checking for stale or missing datasets|#]\ndev_dataverse&gt;\ndev_dataverse&gt; [#|2024-12-20T15:15:22.870+0000|INFO|Payara 6.2024.6|edu.harvard.iq.dataverse.search.IndexBatchServiceBean|_ThreadID=493;_ThreadName=__ejb-thread-pool6;_TimeMillis=1734707722870;_LevelValue=800;|\ndev_dataverse&gt;   completed check for stale or missing content.|#]\ndev_dataverse&gt;\ndev_dataverse&gt; [#|2024-12-20T15:15:22.870+0000|INFO|Payara 6.2024.6|edu.harvard.iq.dataverse.search.IndexBatchServiceBean|_ThreadID=493;_ThreadName=__ejb-thread-pool6;_TimeMillis=1734707722870;_LevelValue=800;|\ndev_dataverse&gt;   checking for dataverses in Solr only|#]\ndev_dataverse&gt;\ndev_solr&gt; 2024-12-20 15:15:22.875 INFO  (qtp1331270134-57) [c: s: r: x:collection1 t:null-5] o.a.s.c.S.Request webapp=/solr path=/select params={q=*&amp;cursorMark=*&amp;sort=id+asc&amp;fq=dvObjectType:dataverses&amp;rows=100&amp;wt=javabin&amp;version=2} hits=0 status=0 QTime=2\ndev_dataverse&gt; [#|2024-12-20T15:15:22.878+0000|INFO|Payara 6.2024.6|edu.harvard.iq.dataverse.search.IndexBatchServiceBean|_ThreadID=493;_ThreadName=__ejb-thread-pool6;_TimeMillis=1734707722878;_LevelValue=800;|\ndev_dataverse&gt;   checking for datasets in Solr only|#]\ndev_dataverse&gt;\ndev_solr&gt; 2024-12-20 15:15:22.882 INFO  (qtp1331270134-28) [c: s: r: x:collection1 t:null-6] o.a.s.c.S.Request webapp=/solr path=/select params={q=*&amp;cursorMark=*&amp;sort=id+asc&amp;fq=dvObjectType:datasets&amp;rows=100&amp;wt=javabin&amp;version=2} hits=0 status=0 QTime=1\ndev_dataverse&gt; [#|2024-12-20T15:15:22.883+0000|INFO|Payara 6.2024.6|edu.harvard.iq.dataverse.search.IndexBatchServiceBean|_ThreadID=493;_ThreadName=__ejb-thread-pool6;_TimeMillis=1734707722883;_LevelValue=800;|\ndev_dataverse&gt;   checking for files in Solr only|#]\ndev_dataverse&gt;\ndev_solr&gt; 2024-12-20 15:15:22.884 INFO  (qtp1331270134-56) [c: s: r: x:collection1 t:null-7] o.a.s.c.S.Request webapp=/solr path=/select params={q=*&amp;cursorMark=*&amp;sort=id+asc&amp;fq=dvObjectType:files&amp;rows=100&amp;wt=javabin&amp;version=2} hits=0 status=0 QTime=0\ndev_dataverse&gt; [#|2024-12-20T15:15:22.885+0000|INFO|Payara 6.2024.6|edu.harvard.iq.dataverse.search.IndexBatchServiceBean|_ThreadID=493;_ThreadName=__ejb-thread-pool6;_TimeMillis=1734707722885;_LevelValue=800;|\ndev_dataverse&gt;   completed check for content in Solr but not database|#]\ndev_dataverse&gt;\ndev_dataverse&gt; [#|2024-12-20T15:15:22.886+0000|INFO|Payara 6.2024.6|edu.harvard.iq.dataverse.search.IndexServiceBean|_ThreadID=493;_ThreadName=__ejb-thread-pool6;_TimeMillis=1734707722886;_LevelValue=800;|\ndev_dataverse&gt;   Checking for solr-only permissions|#]\ndev_dataverse&gt;\ndev_solr&gt; 2024-12-20 15:15:22.887 INFO  (qtp1331270134-57) [c: s: r: x:collection1 t:null-8] o.a.s.c.S.Request webapp=/solr path=/select params={q=definitionPointDvObjectId:*&amp;cursorMark=*&amp;sort=id+asc&amp;rows=1000&amp;wt=javabin&amp;version=2} hits=0 status=0 QTime=0\ndev_dataverse&gt; [#|2024-12-20T15:15:22.888+0000|INFO|Payara 6.2024.6|edu.harvard.iq.dataverse.search.IndexBatchServiceBean|_ThreadID=493;_ThreadName=__ejb-thread-pool6;_TimeMillis=1734707722888;_LevelValue=800;|\ndev_dataverse&gt;   checking for permissions in database but stale or missing from Solr|#]\ndev_dataverse&gt;\ndev_dataverse&gt; [#|2024-12-20T15:15:22.890+0000|INFO|Payara 6.2024.6|edu.harvard.iq.dataverse.search.IndexBatchServiceBean|_ThreadID=493;_ThreadName=__ejb-thread-pool6;_TimeMillis=1734707722890;_LevelValue=800;|\ndev_dataverse&gt;   completed checking for permissions in database but stale or missing from Solr|#]\ndev_dataverse&gt;\ndev_dataverse&gt; [#|2024-12-20T15:15:22.890+0000|INFO|Payara 6.2024.6|edu.harvard.iq.dataverse.search.IndexBatchServiceBean|_ThreadID=493;_ThreadName=__ejb-thread-pool6;_TimeMillis=1734707722890;_LevelValue=800;|\ndev_dataverse&gt;   contentInDatabaseButStaleInOrMissingFromIndex: {&quot;dataverses&quot;:[],&quot;datasets&quot;:[]}|#]\ndev_dataverse&gt;\ndev_dataverse&gt; [#|2024-12-20T15:15:22.890+0000|INFO|Payara 6.2024.6|edu.harvard.iq.dataverse.search.IndexBatchServiceBean|_ThreadID=493;_ThreadName=__ejb-thread-pool6;_TimeMillis=1734707722890;_LevelValue=800;|\ndev_dataverse&gt;   contentInIndexButNotDatabase: {&quot;dataverses&quot;:[],&quot;datasets&quot;:[],&quot;files&quot;:[]}|#]\ndev_dataverse&gt;\ndev_dataverse&gt; [#|2024-12-20T15:15:22.891+0000|INFO|Payara 6.2024.6|edu.harvard.iq.dataverse.search.IndexBatchServiceBean|_ThreadID=493;_ThreadName=__ejb-thread-pool6;_TimeMillis=1734707722891;_LevelValue=800;|\ndev_dataverse&gt;   permissionsInDatabaseButStaleInOrMissingFromIndex: {&quot;dvobjects&quot;:[]}|#]\ndev_dataverse&gt;\ndev_dataverse&gt; [#|2024-12-20T15:15:22.891+0000|INFO|Payara 6.2024.6|edu.harvard.iq.dataverse.search.IndexBatchServiceBean|_ThreadID=493;_ThreadName=__ejb-thread-pool6;_TimeMillis=1734707722891;_LevelValue=800;|\ndev_dataverse&gt;   permissionsInIndexButNotDatabase: {&quot;permissions&quot;:[]}|#]\ndev_dataverse&gt;\n</code></pre></div>",
        "id": 490180858,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1734707779
    },
    {
        "content": "<p><a href=\"/user_uploads/53090/9BQuZEjcjfuA9l1CrbhPvZOz/partial.log\">partial.log</a></p>",
        "id": 490181058,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1734707855
    },
    {
        "content": "<p><a href=\"/user_uploads/53090/MXLZIMhKaqbzEvquN-ZEpyS2/server.log\">server.log</a></p>",
        "id": 490181561,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1734708011
    },
    {
        "content": "<p>Thanks. It's interesting. It's claiming that all the datasets in your database are in your Solr index:</p>\n<p><code>contentInDatabaseButStaleInOrMissingFromIndex: {\"dataverses\":[],\"datasets\":[]}</code></p>",
        "id": 490181598,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1734708026
    },
    {
        "content": "<p>full log the second I need to head out sorry I will get back to you later. <br>\nThanks a lot!</p>",
        "id": 490181621,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1734708031
    },
    {
        "content": "<p>No worries. Next I would see what you can see from the API: <a href=\"http://localhost:8080/api/search?q=*\">http://localhost:8080/api/search?q=*</a></p>",
        "id": 490181726,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1734708071
    },
    {
        "content": "<p>Or even <a href=\"http://localhost:8080/api/search?q=*&amp;per_page=1000\">http://localhost:8080/api/search?q=*&amp;per_page=1000</a> (1000 is the max)</p>",
        "id": 490181812,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1734708101
    },
    {
        "content": "<p>That is, can you see more datasets etc from the Search API than you can see from the web interface? <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 490181924,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1734708128
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>curl  http://localhost:8080/api/search?q=*\n{&quot;status&quot;:&quot;OK&quot;,&quot;data&quot;:{&quot;q&quot;:&quot;*&quot;,&quot;total_count&quot;:83,&quot;start&quot;:0,&quot;spelling_alternatives&quot;:{},&quot;items&quot;:[{&quot;name&quot;:&quot;flgomezc Sandbox Dataverse&quot;,&quot;type&quot;:&quot;dataverse&quot;,&quot;url&quot;:&quot;https://dataverse-test.bsc.es/dataverse/flgomezcsandbox&quot;,&quot;identifier&quot;:&quot;flgomezcsandbox&quot;,&quot;description&quot;:&quot;This dataverse is created with testing purposes&quot;,&quot;published_at&quot;:&quot;2024-09-10T13:59:55Z&quot;,&quot;publicationStatuses&quot;:[&quot;Published&quot;],&quot;affiliation&quot;:&quot;BSC&quot;,&quot;parentDataverseName&quot;:&quot;BSC&quot;,&quot;parentDataverseIdentifier&quot;:&quot;BSC&quot;},{&quot;name&quot;:&quot;Simon Carroll Dataverse&quot;,&quot;type&quot;:&quot;dataverse&quot;,&quot;url&quot;:&quot;https://dataverse-test.bsc.es/dataverse/test1&quot;,&quot;identifier&quot;:&quot;test1&quot;,&quot;published_at&quot;:&quot;2024-09-10T08:04:42Z&quot;,&quot;publicationStatuses&quot;:[&quot;Published&quot;],&quot;parentDataverseName&quot;:&quot;BSC&quot;,&quot;parentDataverseIdentifier&quot;:&quot;BSC&quot;},{&quot;name&quot;:&quot;Dataverse Admin Dataverse&quot;,&quot;type&quot;:&quot;dataverse&quot;,&quot;url&quot;:&quot;https://dataverse-test.bsc.es/dataverse/subverse&quot;,&quot;identifier&quot;:&quot;subverse&quot;,&quot;published_at&quot;:&quot;2024-09-10T08:05:38Z&quot;,&quot;publicationStatuses&quot;:[&quot;Published&quot;],&quot;affiliation&quot;:&quot;Dataverse.org&quot;,&quot;parentDataverseName&quot;:&quot;BSC&quot;,&quot;parentDataverseIdentifier&quot;:&quot;BSC&quot;},{&quot;name&quot;:&quot;Life Sciences&quot;,&quot;type&quot;:&quot;dataverse&quot;,&quot;url&quot;:&quot;https://dataverse-test.bsc.es/dataverse/lifesciences&quot;,&quot;identifier&quot;:&quot;lifesciences&quot;,&quot;description&quot;:&quot;Computational Biology Life Sciences Group Dataverse&quot;,&quot;published_at&quot;:&quot;2024-11-05T12:04:33Z&quot;,&quot;publicationStatuses&quot;:[&quot;Published&quot;],&quot;affiliation&quot;:&quot;BSC&quot;,&quot;parentDataverseName&quot;:&quot;BSC&quot;,&quot;parentDataverseIdentifier&quot;:&quot;BSC&quot;},{&quot;name&quot;:&quot;cyCLONE&quot;,&quot;type&quot;:&quot;dataverse&quot;,&quot;url&quot;:&quot;https://dataverse-test.bsc.es/dataverse/cyclone&quot;,&quot;identifier&quot;:&quot;cyclone&quot;,&quot;description&quot;:&quot;cyCLONE: CLimate change impacts on the Onset of diseases and Eco-anxiety in Catalonia Climate change is long known to have an impact on different aspects of human health. CLIMATICAT addresses the impacts of climate on the health of the Catalan population, focusing on mental health. We address this topic by integrating different kinds of data: temperature, air pollution, geographic movement, and health (diagnoses, exacerbations, deaths). Our analyses will lead to the identification of which groups of individuals are most vulnerable to climate change impacts, including anxiety caused by climate change existential threats (an estimation of the prevalence of eco-anxiety will be made), what diseases are the most expected to co-occur with mental health diseases, and how likely these co-occurring diseases are to be exacerbated by climate change events. All the results and data used in the analyses will be available through an interactive dashboard.&quot;,&quot;published_at&quot;:&quot;2024-11-05T12:05:01Z&quot;,&quot;publicationStatuses&quot;:[&quot;Published&quot;],&quot;affiliation&quot;:&quot;BSC&quot;,&quot;parentDataverseName&quot;:&quot;Life Sciences&quot;,&quot;parentDataverseIdentifier&quot;:&quot;lifesciences&quot;},{&quot;name&quot;:&quot;Computational Social Sciences &amp; Humanities&quot;,&quot;type&quot;:&quot;dataverse&quot;,&quot;url&quot;:&quot;https://dataverse-test.bsc.es/dataverse/CSSH&quot;,&quot;image_url&quot;:&quot;https://dataverse-test.bsc.es/api/access/dvCardImage/344&quot;,&quot;identifier&quot;:&quot;CSSH&quot;,&quot;description&quot;:&quot;The BSC&#39;s newly created Computational Social Sciences programme a pioneering initiative in an European supercomputing centre, works to find new applications of data and supercomputing in social science research, including the fields of economics, political science, sociology, anthropology, geography, psychology and cognitive science, and in the digital humanities (an area of research where computing and the humanities converge, applied to fields such as history, literature, linguistics, archaeology and cultural heritage).&quot;,&quot;published_at&quot;:&quot;2024-11-05T12:21:31Z&quot;,&quot;publicationStatuses&quot;:[&quot;Published&quot;],&quot;affiliation&quot;:&quot;BSC&quot;,&quot;parentDataverseName&quot;:&quot;BSC&quot;,&quot;parentDataverseIdentifier&quot;:&quot;BSC&quot;},{&quot;name&quot;:&quot;Earth Sciences&quot;,&quot;type&quot;:&quot;dataverse&quot;,&quot;url&quot;:&quot;https://dataverse-test.bsc.es/dataverse/earth_sciences&quot;,&quot;identifier&quot;:&quot;earth_sciences&quot;,&quot;description&quot;:&quot;Collection for the Earth Sciences department&quot;,&quot;published_at&quot;:&quot;2024-11-19T10:54:15Z&quot;,&quot;publicationStatuses&quot;:[&quot;Published&quot;],&quot;affiliation&quot;:&quot;BSC&quot;,&quot;parentDataverseName&quot;:&quot;BSC&quot;,&quot;parentDataverseIdentifier&quot;:&quot;BSC&quot;},{&quot;name&quot;:&quot;UncertAIR &quot;,&quot;type&quot;:&quot;dataverse&quot;,&quot;url&quot;:&quot;https://dataverse-test.bsc.es/dataverse/uncertair&quot;,&quot;identifier&quot;:&quot;uncertair&quot;,&quot;published_at&quot;:&quot;2024-11-21T14:59:16Z&quot;,&quot;publicationStatuses&quot;:[&quot;Published&quot;],&quot;affiliation&quot;:&quot;BSC &quot;,&quot;parentDataverseName&quot;:&quot;Earth Sciences&quot;,&quot;parentDataverseIdentifier&quot;:&quot;earth_sciences&quot;},{&quot;name&quot;:&quot;AJC-Dataverse&quot;,&quot;type&quot;:&quot;dataverse&quot;,&quot;url&quot;:&quot;https://dataverse-test.bsc.es/dataverse/ajc-dv&quot;,&quot;image_url&quot;:&quot;https://dataverse-test.bsc.es/api/access/dvCardImage/396&quot;,&quot;identifier&quot;:&quot;ajc-dv&quot;,&quot;description&quot;:&quot;Lorem ipsum odor amet, consectetuer adipiscing elit. Porttitor quam curae mauris fames leo phasellus curae. Semper potenti ad feugiat primis montes dictumst augue magna. Pulvinar dolor eleifend ullamcorper adipiscing fringilla eu orci. Pellentesque praesent auctor netus sodales ultrices elit enim eget. Maximus nisi maecenas; duis amet ligula vel mattis. Est potenti cursus ac a sociosqu. Natoque hendrerit suspendisse ex cursus etiam dictumst. Conubia placerat ultrices fames lobortis nibh. Lorem nibh aptent tincidunt maecenas sed. Proin morbi viverra ullamcorper purus dui vitae risus. Urna consequat sagittis risus litora lacinia proin. Malesuada dui dictum vitae viverra est bibendum. Primis posuere curabitur duis auctor sociosqu platea porttitor leo suscipit. Pharetra iaculis senectus himenaeos aenean luctus ultrices. Risus malesuada non nisl praesent egestas nisl. Nibh per phasellus rutrum, suscipit duis mi? Velit congue nam montes elit cras venenatis sapien.&quot;,&quot;published_at&quot;:&quot;2024-11-21T10:34:38Z&quot;,&quot;publicationStatuses&quot;:[&quot;Published&quot;],&quot;affiliation&quot;:&quot;Barcelona Supercomputing Center&quot;,&quot;parentDataverseName&quot;:&quot;BSC&quot;,&quot;parentDataverseIdentifier&quot;:&quot;BSC&quot;},{&quot;name&quot;:&quot;Paula Checchia Adell Dataverse TEST &quot;,&quot;type&quot;:&quot;dataverse&quot;,&quot;url&quot;:&quot;https://dataverse-test.bsc.es/dataverse/test_paula&quot;,&quot;identifier&quot;:&quot;test_paula&quot;,&quot;published_at&quot;:&quot;2024-11-21T10:59:11Z&quot;,&quot;publicationStatuses&quot;:[&quot;Published&quot;],&quot;affiliation&quot;:&quot;Barcelona Supercomputing Center &quot;,&quot;parentDataverseName&quot;:&quot;BSC&quot;,&quot;parentDataverseIdentifier&quot;:&quot;BSC&quot;}],&quot;count_in_response&quot;:10}}\n</code></pre></div>",
        "id": 490479292,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1734944386
    },
    {
        "content": "<p><a href=\"/user_uploads/53090/VK3bneC95kKE1c5g2VX0ny00/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/53090/VK3bneC95kKE1c5g2VX0ny00/image.png\" title=\"image.png\"><img data-original-dimensions=\"513x270\" src=\"/user_uploads/thumbnail/53090/VK3bneC95kKE1c5g2VX0ny00/image.png/840x560.webp\"></a></div>",
        "id": 490479378,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1734944406
    },
    {
        "content": "<p>Im quite sure we are seeing less with the API if I am understanding well.</p>",
        "id": 490479455,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1734944440
    },
    {
        "content": "<p>Good morning! Merry Christmas and happy new year ! </p>\n<p>I am checking in what will be our production instance, and I am seeing the same, <br>\n<a href=\"/user_uploads/53090/W5vZu0k7LHJEQ56uKOZGRu1m/image.png\">image.png</a><br>\n0 datasets but here in the admin panel :</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/53090/W5vZu0k7LHJEQ56uKOZGRu1m/image.png\" title=\"image.png\"><img data-original-dimensions=\"1366x922\" src=\"/user_uploads/thumbnail/53090/W5vZu0k7LHJEQ56uKOZGRu1m/image.png/840x560.webp\"></a></div>",
        "id": 492295218,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1736250784
    },
    {
        "content": "<p><a href=\"/user_uploads/53090/yLN8yB3TP5M5x35UC2P4rE9u/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/53090/yLN8yB3TP5M5x35UC2P4rE9u/image.png\" title=\"image.png\"><img data-original-dimensions=\"552x290\" src=\"/user_uploads/thumbnail/53090/yLN8yB3TP5M5x35UC2P4rE9u/image.png/840x560.webp\"></a></div>",
        "id": 492295241,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1736250796
    },
    {
        "content": "<p>Could we be missing somethin fundemental <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 492295341,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1736250820
    },
    {
        "content": "<p>Strange, If we restart solr everything indexes correctly</p>",
        "id": 492300939,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1736253180
    },
    {
        "content": "<p>Happy New Year! Restarting Solr fixed it?!? <span aria-label=\"mind blown\" class=\"emoji emoji-1f92f\" role=\"img\" title=\"mind blown\">:mind_blown:</span></p>",
        "id": 492522945,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1736348507
    },
    {
        "content": "<p>It clears the backlog but new entries are not indexed until it is restarted.</p>",
        "id": 492526560,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1736349662
    },
    {
        "content": "<p>We're seeing something similar in both our instances. I wonder if it relates the upgrade process seeing as the pod configuration is completely different</p>",
        "id": 492526873,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1736349749
    },
    {
        "content": "<p>Oh, I was hoping it's fixed. Drat. Sounds like progress toward understanding the problem, at least. <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 492527432,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1736349919
    },
    {
        "content": "<p>Any ideas how we can debug it a bit ? <br>\n<a href=\"/user_uploads/53090/H1u0BCiNwAEryqeghbDXJjBZ/solr.log\">solr.log</a><br>\nHere is the solr log during and imediatly after uploading a dataset.</p>",
        "id": 492674477,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1736415253
    },
    {
        "content": "<p><a href=\"/user_uploads/53090/I2SsHM7N2JrFfTNblgweHP41/solr-restart.log\">solr-restart.log</a><br>\nand here is the restart which indeed means the dataset is now visible in the service</p>",
        "id": 492675062,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1736415420
    },
    {
        "content": "<p>I'm really not sure. How would I reproduce the problem on my laptop?</p>",
        "id": 492714187,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1736427077
    },
    {
        "content": "<p>I guess it is difficult. I suppose the issue is coming from the upgrade as it was working well before. Could it help to provide the jvm options ? I suppose we have the same solr version </p>\n<div class=\"codehilite\"><pre><span></span><code>[rocky@dataverse-test ~]$ curl http://localhost:8983/solr/admin/info/system?wt=json\n{\n  &quot;responseHeader&quot;:{\n    &quot;status&quot;:0,\n    &quot;QTime&quot;:47\n  },\n  &quot;mode&quot;:&quot;std&quot;,\n  &quot;solr_home&quot;:&quot;/usr/local/solr/server/solr&quot;,\n  &quot;core_root&quot;:&quot;/usr/local/solr/server/solr&quot;,\n  &quot;lucene&quot;:{\n    &quot;solr-spec-version&quot;:&quot;9.3.0&quot;,\n    &quot;solr-impl-version&quot;:&quot;9.3.0 de33f50ce79ec1d156faf204553012037e2bc1cb - houston - 2023-07-17 17:13:17&quot;,\n    &quot;lucene-spec-version&quot;:&quot;9.7.0&quot;,\n    &quot;lucene-impl-version&quot;:&quot;9.7.0 ccf4b198ec328095d45d2746189dc8ca633e8bcf - 2023-06-21 11:48:16&quot;\n  },\n</code></pre></div>",
        "id": 492730154,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1736431435
    },
    {
        "content": "<p>initially we deployed 6.2 via the ansible <a href=\"https://github.com/gdcc/dataverse-ansible\">https://github.com/gdcc/dataverse-ansible</a> and worked our way up</p>",
        "id": 492730299,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1736431468
    },
    {
        "content": "<p>Ansible. So this is a \"classic\" installation? Not Docker?</p>",
        "id": 492771131,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1736442137
    },
    {
        "content": "<p>Yes! Exactly. We have a test and prod enviroment installed with ansible. </p>\n<div class=\"codehilite\"><pre><span></span><code>&quot;[rocky@dataverse-test ~]$ /usr/local/solr/bin/solr -v\n9.3.0\n[rocky@dataverse-test ~]$ /usr/local/payara6/bin/asadmin version\nPicked up JAVA_TOOL_OPTIONS: -Djdk.util.zip.disableZip64ExtraFieldValidation=true --add-opens=java.base/java.io=ALL-UNNAMED\nVersion = Payara Server 6.2023.8 #badassfish (build 920)\nCommand version executed successfully.\n[rocky@dataverse-test ~]$ psql --version\npsql (PostgreSQL) 13.16\n[rocky@dataverse-test ~]$ httpd -v\nServer version: Apache/2.4.37 (Rocky Linux)\nServer built:   Aug 12 2024 08:13:30\n[rocky@dataverse-test ~]$\n&quot;\n</code></pre></div>",
        "id": 492782056,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1736445117
    },
    {
        "content": "<p>You started on Dataverse 6.2, you said. What version are you on now?</p>",
        "id": 492782425,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1736445218
    },
    {
        "content": "<p>6.5</p>",
        "id": 492810884,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1736454049
    },
    {
        "content": "<p>Thanks. You started this thread on Dec 17 and 6.5 was <a href=\"https://github.com/IQSS/dataverse/releases/tag/v6.5\">released</a> on Dec 12. Did you start seeing this problem on 6.5? 6.4? 6.3?</p>",
        "id": 492812162,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1736454525
    },
    {
        "content": "<p>Dec 17 we were running 6.4 Im quite sure the dataset indexing was working.</p>",
        "id": 492813937,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1736455191
    },
    {
        "content": "<p>We thought maybe <a href=\"https://github.com/IQSS/dataverse/issues/11069\">https://github.com/IQSS/dataverse/issues/11069</a> was stopping our permalink from working so we moved to 6.5</p>",
        "id": 492814129,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1736455257
    },
    {
        "content": "<p>Gotcha. Well, there's no harm in upgrading to 6.5.</p>",
        "id": 492814705,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1736455451
    },
    {
        "content": "<p>Do you want to go ahead and open an issue at <a href=\"https://github.com/IQSS/dataverse/issues\">https://github.com/IQSS/dataverse/issues</a> ?</p>",
        "id": 492814899,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1736455530
    },
    {
        "content": "<p>Sure tomorrow ill try to to write it up. Thanks!</p>",
        "id": 492815235,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1736455642
    },
    {
        "content": "<p>Thanks. At least it will help us track it.</p>",
        "id": 492815966,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1736455901
    },
    {
        "content": "<p>Did you try completely reinstalling Solr?</p>",
        "id": 492815996,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1736455913
    },
    {
        "content": "<p>I just tried it  </p>\n<div class=\"codehilite\"><pre><span></span><code>rocky@dataverse-test ~]$ curl http://localhost:8080/api/admin/index/status\n{&quot;status&quot;:&quot;OK&quot;,&quot;data&quot;:{&quot;message&quot;:&quot;Index Status Batch Job initiated, check log for job status.&quot;}}[rocky@dataverse-test ~]$\n[rocky@dataverse-test ~]$ curl http://localhost:8080/api/admin/index/clear-orphans\n{&quot;status&quot;:&quot;OK&quot;,&quot;data&quot;:{&quot;message&quot;:&quot;Clear Orphans Batch Job initiated, check log for job status.&quot;}}[rocky@dataverse-test ~]$\n[rocky@dataverse-test ~]$ curl http://localhost:8080/api/admin/index/clear\n{&quot;status&quot;:&quot;OK&quot;,&quot;data&quot;:{&quot;numRowsClearedByClearAllIndexTimes&quot;:238,&quot;message&quot;:&quot;Solr index and database index timestamps cleared.&quot;}}[rocky@dataverse-test ~]$\n[rocky@dataverse-test ~]$ curl http://localhost:8080/api/admin/index\n{&quot;status&quot;:&quot;OK&quot;,&quot;data&quot;:{&quot;availablePartitionIds&quot;:[0],&quot;args&quot;:{&quot;numPartitions&quot;:1,&quot;partitionIdToProcess&quot;:0},&quot;message&quot;:&quot;indexAllOrSubset has begun of 43 dataverses and 67 datasets.&quot;}}\n</code></pre></div>\n<p>after running that it is still required to restart solr to see the new records <span aria-label=\"mind blown\" class=\"emoji emoji-1f92f\" role=\"img\" title=\"mind blown\">:mind_blown:</span></p>",
        "id": 492903302,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1736499219
    },
    {
        "content": "<p><a href=\"https://github.com/IQSS/dataverse/issues/11146\">https://github.com/IQSS/dataverse/issues/11146</a> done!</p>",
        "id": 492906999,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1736500494
    },
    {
        "content": "<p>Thanks for opening that issue.</p>",
        "id": 492929323,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1736508236
    },
    {
        "content": "<p>And sorry, when I mean completely reinstalling Solr I mean stopping it, doing a <code>rm -rf</code> of the Solr directory (or move it aside), and then install fresh according to <a href=\"https://guides.dataverse.org/en/6.5/installation/prerequisites.html#installing-solr\">https://guides.dataverse.org/en/6.5/installation/prerequisites.html#installing-solr</a></p>",
        "id": 492929568,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1736508321
    },
    {
        "content": "<p>Hey yes. I'll update the issue. I moved it aside and did a comprehensive reinstall.</p>",
        "id": 492935300,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1736510365
    },
    {
        "content": "<p>And the problem is still there. D'oh! <img alt=\":doh:\" class=\"emoji\" src=\"https://avatars.zulip.com/53090/emoji/images/343009b9.png\" title=\"doh\"></p>",
        "id": 492963858,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1736519960
    },
    {
        "content": "<p>Yes. I am trying to think what the restart of solr can trigger that is not triggered in the data set creation flow.</p>",
        "id": 492964959,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1736520315
    },
    {
        "content": "<p>You wrote \"deploy 6.2 viable ansible and upgrade ? I think this will be hard to reproduce easily.\"</p>",
        "id": 492965306,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1736520441
    },
    {
        "content": "<p>I imagine a number of installations deployed initially with Ansible. It's very popular.</p>",
        "id": 492965394,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1736520468
    },
    {
        "content": "<p>Maybe not so many with 6.2 specifically.</p>",
        "id": 492965431,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1736520481
    },
    {
        "content": "<p>Sure, do you know of many installations already using 6.4/5 ?</p>",
        "id": 492965600,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1736520523
    },
    {
        "content": "<p>We're running 6.5 at <a href=\"https://dataverse.harvard.edu\">https://dataverse.harvard.edu</a></p>",
        "id": 492965669,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1736520548
    },
    {
        "content": "<p>and I guess you have upgraded in, more or less, the same way</p>",
        "id": 492965734,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1736520571
    },
    {
        "content": "<p><a href=\"https://dataverse.org/metrics\">https://dataverse.org/metrics</a> shows three on 6.5</p>",
        "id": 492965764,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1736520580
    },
    {
        "content": "<p>Yes, I imagine the upgrade was similar.</p>",
        "id": 492965917,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1736520623
    },
    {
        "content": "<p>We still have \"perma\" in this Zulip topic. Do we suspect it might be related to the perma PID provider? We don't use the perma provider for Harvard Dataverse.</p>",
        "id": 492966011,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1736520658
    },
    {
        "content": "<p>I'm just trying to think of what could be different in your setup.</p>",
        "id": 492966419,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1736520786
    },
    {
        "content": "<p>yes maybe indexing problem is better</p>\n<p><span class=\"user-mention silent\" data-user-id=\"598112\">Philip Durbin ☃️</span> <a href=\"#narrow/channel/378866-troubleshooting/topic/Custom.20.E2.80.9CPerma.E2.80.9D.20PID.20Setup.20.26.20Indexing.20Problem/near/492966011\">said</a>:</p>\n<blockquote>\n<p>We still have \"perma\" in this Zulip topic. Do we suspect it might be related to the perma PID provider? We don't use the perma provider for Harvard Dataverse.</p>\n</blockquote>",
        "id": 492966659,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1736520858
    },
    {
        "content": "<p>although, the it indexes fine if your restart solr</p>",
        "id": 492966686,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1736520869
    },
    {
        "content": "<p>Good idea. I renamed it to \"indexing problem\". Thanks.</p>",
        "id": 492966750,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1736520892
    },
    {
        "content": "<p>After you restart Solr, do you have to manually reindex the dataset for it to be visible in the GUI?</p>",
        "id": 492966929,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1736520956
    },
    {
        "content": "<p>nope not required</p>",
        "id": 492967213,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1736521056
    },
    {
        "content": "<p>Hmm, well, these days there is a delay when you create a dataset before it's indexed. But it should only be a delay of maybe 5 seconds? 10? Have you tried simply waiting a bit and then refreshing the page?</p>\n<p>This change was introduced in 6.3: IQSS/10559-2 Drop COMMIT_WITHIN which breaks autoSoftCommit by maxTime in solrconfig <a href=\"https://github.com/IQSS/dataverse/issues/10654\">#10654</a></p>",
        "id": 492967755,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1736521218
    },
    {
        "content": "<p>And this PR: Solr: Try Soft Commit on Indexing <a href=\"https://github.com/IQSS/dataverse/issues/10547\">#10547</a></p>",
        "id": 492967885,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1736521265
    },
    {
        "content": "<p>yes indeed we were testing for some days without seeing anything in the gui until we restarted solr <span aria-label=\"hurt\" class=\"emoji emoji-1f915\" role=\"img\" title=\"hurt\">:hurt:</span></p>",
        "id": 492968187,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1736521348
    },
    {
        "content": "<p>Maybe we should ask on the Solr mailing list. Do you think it could be a problem with Solr?</p>",
        "id": 492968540,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1736521462
    },
    {
        "content": "<p>What if we have you push some data into Solr outside of Dataverse. With curl or whatever?</p>",
        "id": 492968613,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1736521490
    },
    {
        "content": "<p>To see if it shows up right away or not.</p>",
        "id": 492968685,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1736521515
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"598112\">Philip Durbin ☃️</span> <a href=\"#narrow/channel/378866-troubleshooting/topic/indexing.20problem/near/492968613\">said</a>:</p>\n<blockquote>\n<p>What if we have you push some data into Solr outside of Dataverse. With curl or whatever?</p>\n</blockquote>\n<p>good idea</p>",
        "id": 492970160,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1736522003
    },
    {
        "content": "<p>Do you need help with this?</p>",
        "id": 492970188,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1736522016
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>2025-01-10 15:09:49.733 INFO  (searcherExecutor-12-thread-1-processing-collection1) [ x:collection1] o.a.s.c.SolrCore Registered new searcher autowarm time: 0 ms\n2025-01-10 15:10:15.291 INFO  (qtp240630125-27) [ x:collection1] o.a.s.c.S.Request webapp=/solr path=/select params={facet.field=dvObjectType&amp;facet.field=metadata_type_ss&amp;facet.field=datasetType&amp;facet.field=dvCategory&amp;facet.field=metadataSource&amp;facet.field=publicationDate&amp;facet.field=publicationStatus&amp;facet.field=license&amp;facet.field=authorName_ss&amp;facet.field=subject_ss&amp;facet.field=keywordValue_ss&amp;facet.field=dateOfDeposit_s&amp;facet.field=fileTypeGroupFacet&amp;facet.field=fileTag&amp;facet.field=fileAccess&amp;qt=/select&amp;hl=true&amp;fl=*,score&amp;start=0&amp;sort=dateSort+desc&amp;fq=dvObjectType:(dataverses+OR+datasets)&amp;rows=10&amp;version=2&amp;hl.simple.pre=&lt;span+class%3D&quot;search-term-match&quot;&gt;&amp;facet.query=*&amp;hl.snippets=1&amp;q=*&amp;hl.simple.post=&lt;/span&gt;&amp;hl.fl=dateOfCollectionStart&amp;hl.fl=software&amp;hl.fl=resolution.Temporal&amp;hl.fl=responseRate&amp;hl.fl=distributionDate&amp;hl.fl=geographicBoundingBox&amp;hl.fl=coverage.Redshift.MaximumValue&amp;hl.fl=contributorName&amp;hl.fl=affiliation_ss&amp;hl.fl=datasetContactName&amp;hl.fl=studyAssayOtherPlatform&amp;hl.fl=dsDescriptionDate&amp;hl.fl=coverage.Temporal&amp;hl.fl=socialScienceNotesText&amp;hl.fl=datasetContactAffiliation&amp;hl.fl=journalArticleType&amp;hl.fl=producerLogoURL&amp;hl.fl=datasetLevelErrorNotes&amp;hl.fl=state&amp;hl.fl=timePeriodCoveredStart&amp;hl.fl=otherIdValue&amp;hl.fl=dateOfCollectionEnd&amp;hl.fl=studyAssayOrganism&amp;hl.fl=socialScienceNotesType&amp;hl.fl=publicationIDType&amp;hl.fl=seriesName&amp;hl.fl=alternativeURL&amp;hl.fl=coverage.Spectral.Bandpass&amp;hl.fl=fileTypeDisplay&amp;hl.fl=producerURL&amp;hl.fl=authorAffiliation&amp;hl.fl=astroType&amp;hl.fl=redshiftType&amp;hl.fl=astroFacility&amp;hl.fl=producerAffiliation&amp;hl.fl=coverage.Depth&amp;hl.fl=authorName&amp;hl.fl=subtitle&amp;hl.fl=timeMethod&amp;hl.fl=depositor&amp;hl.fl=otherDataAppraisal&amp;hl.fl=authorIdentifierScheme&amp;hl.fl=coverage.Spectral.Wavelength&amp;hl.fl=softwareVersion&amp;hl.fl=coverage.SkyFraction&amp;hl.fl=actionsToMinimizeLoss&amp;hl.fl=city&amp;hl.fl=dsDescriptionValue&amp;hl.fl=characteristicOfSources&amp;hl.fl=coverage.Temporal.StopTime&amp;hl.fl=studyAssayOtherOrganism&amp;hl.fl=alternativeTitle&amp;hl.fl=topicClassVocabURI&amp;hl.fl=journalVolumeIssue&amp;hl.fl=distributorURL&amp;hl.fl=literalQuestion&amp;hl.fl=distributorName&amp;hl.fl=coverage.Spatial&amp;hl.fl=journalPubDate&amp;hl.fl=distributorAffiliation&amp;hl.fl=fileNameWithoutExtension&amp;hl.fl=topicClassVocab&amp;hl.fl=journalVolume&amp;hl.fl=topicClassValue&amp;hl.fl=distributorAbbreviation&amp;hl.fl=publicationRelationType&amp;hl.fl=originOfSources&amp;hl.fl=resolution.Spectral&amp;hl.fl=variableNotes&amp;hl.fl=westLongitude&amp;hl.fl=coverage.Polarization&amp;hl.fl=studyFactorType&amp;hl.fl=coverage.Spectral.CentralWavelength&amp;hl.fl=keywordTermURI&amp;hl.fl=dsPersistentId&amp;hl.fl=distributor&amp;hl.fl=dsPublicationDate&amp;hl.fl=topicClassification&amp;hl.fl=studyOtherDesignType&amp;hl.fl=series&amp;hl.fl=dsDescription&amp;hl.fl=dateOfDeposit&amp;hl.fl=coverage.Temporal.StartTime&amp;hl.fl=frequencyOfDataCollection&amp;hl.fl=socialScienceNotes&amp;hl.fl=astroObject&amp;hl.fl=coverage.Spectral.MinimumWavelength&amp;hl.fl=variableLabel&amp;hl.fl=timePeriodCovered&amp;hl.fl=studyAssayOtherTechnologyType&amp;hl.fl=country&amp;hl.fl=studyAssayPlatform&amp;hl.fl=subject&amp;hl.fl=studyAssayOtherMeasurmentType&amp;hl.fl=interviewInstructions&amp;hl.fl=accessToSources&amp;hl.fl=language&amp;hl.fl=controlOperations&amp;hl.fl=samplingProcedure&amp;hl.fl=keywordVocabulary&amp;hl.fl=coverage.ObjectCount&amp;hl.fl=otherReferences&amp;hl.fl=coverage.Redshift.MinimumValue&amp;hl.fl=eastLongitude&amp;hl.fl=producerAbbreviation&amp;hl.fl=publication&amp;hl.fl=unitOfAnalysis&amp;hl.fl=postQuestion&amp;hl.fl=keyword&amp;hl.fl=fileTags&amp;hl.fl=dataSources&amp;hl.fl=distributorLogoURL&amp;hl.fl=relatedMaterial&amp;hl.fl=filePersistentId&amp;hl.fl=variableUniverse&amp;hl.fl=otherIdAgency&amp;hl.fl=author&amp;hl.fl=targetSampleActualSize&amp;hl.fl=journalIssue&amp;hl.fl=publicationIDNumber&amp;hl.fl=coverage.ObjectDensity&amp;hl.fl=publicationCitation&amp;hl.fl=dataCollector&amp;hl.fl=productionPlace&amp;hl.fl=weighting&amp;hl.fl=softwareName&amp;hl.fl=grantNumberAgency&amp;hl.fl=name&amp;hl.fl=producer&amp;hl.fl=contributorType&amp;hl.fl=notesText&amp;hl.fl=publicationURL&amp;hl.fl=studyDesignType&amp;hl.fl=keywordValue&amp;hl.fl=geographicCoverage&amp;hl.fl=description&amp;hl.fl=resolution.Spatial&amp;hl.fl=title&amp;hl.fl=keywordVocabularyURI&amp;hl.fl=studyOtherFactorType&amp;hl.fl=productionDate&amp;hl.fl=contributor&amp;hl.fl=otherGeographicCoverage&amp;hl.fl=northLatitude&amp;hl.fl=collectorTraining&amp;hl.fl=kindOfData&amp;hl.fl=studyAssayCellType&amp;hl.fl=coverage.RedshiftValue&amp;hl.fl=timePeriodCoveredEnd&amp;hl.fl=southLatitude&amp;hl.fl=socialScienceNotesSubject&amp;hl.fl=variableName&amp;hl.fl=dataCollectionSituation&amp;hl.fl=otherId&amp;hl.fl=dateOfCollection&amp;hl.fl=collectionMode&amp;hl.fl=studyAssayTechnologyType&amp;hl.fl=deviationsFromSampleDesign&amp;hl.fl=producerName&amp;hl.fl=targetSampleSizeFormula&amp;hl.fl=coverage.Spectral.MaximumWavelength&amp;hl.fl=authorIdentifier&amp;hl.fl=relatedDatasets&amp;hl.fl=datasetContact&amp;hl.fl=researchInstrument&amp;hl.fl=samplingErrorEstimates&amp;hl.fl=astroInstrument&amp;hl.fl=seriesInformation&amp;hl.fl=datasetContactEmail&amp;hl.fl=studyAssayMeasurementType&amp;hl.fl=targetSampleSize&amp;hl.fl=geographicUnit&amp;hl.fl=universe&amp;hl.fl=resolution.Redshift&amp;hl.fl=grantNumberValue&amp;hl.fl=grantNumber&amp;hl.fl=cleaningOperations&amp;hl.fl=fileType&amp;facet=true&amp;wt=javabin} hits=6 status=0 QTime=181\n2025-01-10 15:10:15.344 INFO  (qtp240630125-19) [ x:collection1] o.a.s.c.S.Request webapp=/solr path=/select params={facet.query=*&amp;q=*&amp;facet.field=dvObjectType&amp;qt=/select&amp;fl=*,score&amp;start=0&amp;fq=dvObjectType:(files)&amp;rows=1&amp;facet=true&amp;wt=javabin&amp;version=2} hits=1 status=0 QTime=9\n</code></pre></div>\n<p>this appears after restart solr. I need to look a bit how solr works.</p>",
        "id": 492970224,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1736522030
    },
    {
        "content": "<p>It's a lot of output but it might be normal. I'm not sure.</p>",
        "id": 492970788,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1736522182
    },
    {
        "content": "<p>Here, please try this:</p>\n<p><code>bin/solr post -commit techproducts example/exampledocs/* -url \"http://localhost:8983/solr/collection1/update?commit=true\"</code></p>",
        "id": 492972475,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1736522720
    },
    {
        "content": "<p>It's adding Solr docs like this:</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n      &quot;id&quot;:&quot;viewsonic&quot;,\n      &quot;compName_s&quot;:&quot;ViewSonic Corp&quot;,\n      &quot;address_s&quot;:&quot;381 Brea Canyon Road Walnut, CA 91789-0708&quot;,\n      &quot;_version_&quot;:1820876012009816073\n}\n</code></pre></div>",
        "id": 492972616,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1736522763
    },
    {
        "content": "<p>I'm sort of following <a href=\"https://solr.apache.org/guide/solr/9_6/getting-started/tutorial-techproducts.html\">https://solr.apache.org/guide/solr/9_6/getting-started/tutorial-techproducts.html</a></p>",
        "id": 492972660,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1736522777
    },
    {
        "content": "<p>-c isn't working but -commit does <span aria-label=\"shrug\" class=\"emoji emoji-1f937\" role=\"img\" title=\"shrug\">:shrug:</span> </p>\n<p>Maybe try it without -c as well.</p>",
        "id": 492972712,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1736522801
    },
    {
        "content": "<p><a href=\"/user_uploads/53090/oY50WTl8B-ZOXAE0NtFBXrKu/solrCreate.log\">solrCreate.log</a><br>\nGood morning! It seems to work in both a new collection I created and in collection1 of dataverse</p>",
        "id": 493329070,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1736768615
    },
    {
        "content": "<p><a href=\"/user_uploads/53090/5k0vaSKayylbbafh2f5tzlbC/solrCreateBinSolr.log\">solrCreateBinSolr.log</a><br>\n(in line with your suggested way).</p>",
        "id": 493329835,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1736768852
    },
    {
        "content": "<p>Great! But what is \"it\"? Are you talking about <code>bin/solr post -commit techproducts example/exampledocs/* -url \"http://localhost:8983/solr/collection1/update?commit=true\"</code>?</p>",
        "id": 493342924,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1736772598
    },
    {
        "content": "<p>Well, just to post something and see it in a collection (without having to restart solr). I didn't use the example docks as they dont see to match the scheme for collection1. Does it make sense or have I missed something ?</p>",
        "id": 493544944,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1736847193
    },
    {
        "content": "<p>I am going to add a solr debug level log just after adding a dataset. I am not able to make sense of it yet but perhaps it helps. <br>\n<a href=\"/user_uploads/53090/qSnmhz6BA--cC4jKgftFziew/solr_capture_20250114_101226.log\">solr_capture_20250114_101226.log</a></p>",
        "id": 493555731,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1736851096
    },
    {
        "content": "<p>I have changed these settings in /var/solr/data/collection1/conf/solrconfig.xml and now it works! </p>\n<div class=\"codehilite\"><pre><span></span><code>&lt;!--   &lt;autoCommit&gt;\n      &lt;maxTime&gt;${solr.autoCommit.maxTime:15000}&lt;/maxTime&gt;\n      &lt;openSearcher&gt;false&lt;/openSearcher&gt;\n    &lt;/autoCommit&gt; --&gt;\n\n\n\n  &lt;autoCommit&gt;\n    &lt;maxTime&gt;15000&lt;/maxTime&gt; &lt;!-- 15 seconds --&gt;\n    &lt;openSearcher&gt;true&lt;/openSearcher&gt; &lt;!-- Ensure the searcher is refreshed --&gt;\n  &lt;/autoCommit&gt;\n\n\n    &lt;!-- softAutoCommit is like autoCommit except it causes a\n         &#39;soft&#39; commit which only ensures that changes are visible\n         but does not ensure that data is synced to disk.  This is\n         faster and more near-realtime friendly than a hard commit.\n      --&gt;\n&lt;!--\n    &lt;autoSoftCommit&gt;\n      &lt;maxTime&gt;${solr.autoSoftCommit.maxTime:-1}&lt;/maxTime&gt;\n    &lt;/autoSoftCommit&gt;\n--&gt;\n\n  &lt;autoSoftCommit&gt;\n    &lt;maxTime&gt;2000&lt;/maxTime&gt; &lt;!-- 2 seconds for soft commits --&gt;\n  &lt;/autoSoftCommit&gt;\n</code></pre></div>",
        "id": 493592853,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1736863471
    },
    {
        "content": "<p>Great! So you changed it to 2 seconds?</p>",
        "id": 493597994,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1736865030
    },
    {
        "content": "<p>yes and openSearcher true</p>",
        "id": 493598786,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1736865256
    },
    {
        "content": "<p>Is this a bug in Dataverse? Again, we changed these values in this pull request: Solr: Try Soft Commit on Indexing <a href=\"https://github.com/IQSS/dataverse/issues/10547\">#10547</a></p>",
        "id": 493599282,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1736865392
    },
    {
        "content": "<p>well it seems it doesn't work with the old configuration of solr so maybe just advisory in the upgrades ? Then again, if nobdy else has seen the issue with 6.4 <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 493621602,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1736871641
    },
    {
        "content": "<p>You've been good about updating <a href=\"https://github.com/IQSS/dataverse/issues/11146\">https://github.com/IQSS/dataverse/issues/11146</a></p>\n<p>Can you please leave another comment about your latest discoveries?</p>",
        "id": 493622381,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1736871867
    },
    {
        "content": "<p>Sure just added it! I guess we can resolve this one ? If somenoes needed address it there. Many Thanks for all the help!</p>",
        "id": 493905774,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1736941194
    },
    {
        "content": "<p>Thanks. Let me try to understand the situation. Your initial installation was with Ansible of Dataverse 6.2. Then you went through some upgrades. As part of those upgrades you should have been told to update your Solr config but this information wasn't in the release notes? Is it something like that?</p>",
        "id": 493916751,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1736944787
    },
    {
        "content": "<p>Hi! Yes, unless I have missed something. I think if someone has a installation deployed via ansible  from anything pre 6.4 they would have machine solr configuration to us that required changing ?</p>",
        "id": 493927468,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1736947943
    },
    {
        "content": "<p>Let's see. The autocommit change was introduced in <a href=\"https://github.com/IQSS/dataverse/issues/10547\">#10547</a> which landed in Dataverse 6.3. The release notes at <a href=\"https://github.com/IQSS/dataverse/releases/tag/v6.3\">https://github.com/IQSS/dataverse/releases/tag/v6.3</a> say to stop the Solr 9.3.0 installation and install Solr 9.4.1 fresh. And it says to use certain config files with Solr 9.4.1 that include the autocommit changes.</p>\n<p>Also, under the first bullet of the release notes it says, \"Dataverse now relies on the autoCommit and autoSoftCommit settings in the Solr configuration instead of explicitly committing documents to the Solr index. This improves indexing speed.\"</p>\n<p>So I think the release notes are in decent shape. Do you happen to recall switching from Solr 9.3.0 to 9.4.1?</p>",
        "id": 493958217,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1736956159
    },
    {
        "content": "<p>Ah ha! I didn't handle the upgrade myself (only 6.4 - 6.5)  so completely missed that. We are running 9.3.0 still infact but it runs fine with the new conf. I also tested 9.7.0 out of frustration and it works !</p>",
        "id": 493964184,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1736957792
    },
    {
        "content": "<p>Easy to miss.</p>",
        "id": 493965290,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1736958100
    },
    {
        "content": "<p>so, again many thanks! Atleast it is here in case someone else makes the same mistake :).</p>",
        "id": 493975827,
        "sender_full_name": "Simon Carroll",
        "timestamp": 1736960681
    },
    {
        "content": "<p>Yes, exactly. Do you want to go ahead and close <a href=\"https://github.com/IQSS/dataverse/issues/11146\">https://github.com/IQSS/dataverse/issues/11146</a> and point to this Zulip thread?</p>",
        "id": 493978018,
        "sender_full_name": "Philip Durbin 🚀",
        "timestamp": 1736961420
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"671195\">Simon Carroll</span> has marked this topic as resolved.</p>",
        "id": 495004310,
        "sender_full_name": "Notification Bot",
        "timestamp": 1737452038
    }
]