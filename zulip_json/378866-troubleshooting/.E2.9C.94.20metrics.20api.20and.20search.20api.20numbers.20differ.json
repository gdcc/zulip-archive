[
    {
        "content": "<p>I am expanding the monitoring of our dataverse instance, and have come across a curious thing: If I get the number of datasets with the metrics api, I get 72, but if I use the search api, I get 73. Has anyone seen a similar error? Maybe some types of datasets are not being shown?</p>",
        "id": 437241961,
        "sender_full_name": "PÃ©ter Pallinger",
        "timestamp": 1714994430
    },
    {
        "content": "<p>Interesting. Are you able to identify which one is missing from the metrics API?</p>",
        "id": 437242507,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1714994673
    },
    {
        "content": "<p>For the search API, are authenticating and showing drafts as well?</p>",
        "id": 437242564,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1714994697
    },
    {
        "content": "<p>No, I use both endpoints without authentication. <br>\nAs for identifying: I am working on it, but the metrics api only displays aggregates.</p>",
        "id": 437243000,
        "sender_full_name": "PÃ©ter Pallinger",
        "timestamp": 1714994885
    },
    {
        "content": "<p>Oh, right.</p>",
        "id": 437243149,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1714994957
    },
    {
        "content": "<p>Ok, this is weird: the /monthly metrics says 73 for may, and 72 for april...</p>",
        "id": 437243183,
        "sender_full_name": "PÃ©ter Pallinger",
        "timestamp": 1714994974
    },
    {
        "content": "<p><a href=\"https://repo.researchdata.hu/api/info/metrics/datasets\">https://repo.researchdata.hu/api/info/metrics/datasets</a><br>\n<a href=\"https://repo.researchdata.hu/api/info/metrics/datasets/monthly\">https://repo.researchdata.hu/api/info/metrics/datasets/monthly</a></p>",
        "id": 437243305,
        "sender_full_name": "PÃ©ter Pallinger",
        "timestamp": 1714995012
    },
    {
        "content": "<p>so maybe the first endpoint displays the data for the last whole month?</p>",
        "id": 437243405,
        "sender_full_name": "PÃ©ter Pallinger",
        "timestamp": 1714995060
    },
    {
        "content": "<p><a href=\"https://repo.researchdata.hu/api/info/metrics/datasets?dataLocation=all\">https://repo.researchdata.hu/api/info/metrics/datasets?dataLocation=all</a>  -&gt; 73<br>\n<a href=\"https://repo.researchdata.hu/api/info/metrics/datasets?dataLocation=local\">https://repo.researchdata.hu/api/info/metrics/datasets?dataLocation=local</a>  -&gt; 72<br>\n<a href=\"https://repo.researchdata.hu/api/info/metrics/datasets?dataLocation=remote\">https://repo.researchdata.hu/api/info/metrics/datasets?dataLocation=remote</a>  -&gt; 0</p>",
        "id": 437244013,
        "sender_full_name": "PÃ©ter Pallinger",
        "timestamp": 1714995306
    },
    {
        "content": "<p>Is there a dataLocation that is not local or remote? Because the numbers seem to support that. :)</p>",
        "id": 437244531,
        "sender_full_name": "PÃ©ter Pallinger",
        "timestamp": 1714995527
    },
    {
        "content": "<p>It looks like you found the three possibilities:</p>\n<div class=\"codehilite\"><pre><span></span><code>public static final String DATA_LOCATION_LOCAL = &quot;local&quot;;\npublic static final String DATA_LOCATION_REMOTE = &quot;remote&quot;;\npublic static final String DATA_LOCATION_ALL = &quot;all&quot;;\n</code></pre></div>",
        "id": 437268644,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1715004057
    },
    {
        "content": "<p>From here (you seem to be on 6.1): <a href=\"https://github.com/IQSS/dataverse/blob/v6.1/src/main/java/edu/harvard/iq/dataverse/metrics/MetricsUtil.java#L38-L40\">https://github.com/IQSS/dataverse/blob/v6.1/src/main/java/edu/harvard/iq/dataverse/metrics/MetricsUtil.java#L38-L40</a></p>",
        "id": 437268840,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1715004116
    },
    {
        "content": "<p>Yes, /monthly seems to be cumulative.</p>",
        "id": 437271392,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1715004757
    },
    {
        "content": "<p>I was wondering if one of your 73 datasets returned by the Search API are deaccessioned (not included in metrics) but no, they are all released:</p>\n<p><code>curl 'https://repo.researchdata.hu/api/search?q=*&amp;type=dataset&amp;per_page=100' | jq . | grep versionState</code></p>",
        "id": 437272340,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1715005055
    },
    {
        "content": "<p>Well, I will stop investigating this now (I may look into the SQL queries run later), and use the dataLocation=all option.<br>\nThe difference between local and all will remain a mystery for now.</p>",
        "id": 437273023,
        "sender_full_name": "PÃ©ter Pallinger",
        "timestamp": 1715005258
    },
    {
        "content": "<p>I asked in the IQSS Slack. If I hear anything, I'll let you know.</p>",
        "id": 437275051,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1715005913
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"602779\">@PÃ©ter Pallinger</span> what if you clear the cache for the Metrics API? Any difference?</p>",
        "id": 437279232,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1715007173
    },
    {
        "content": "<p>I did not find how to clear the cache, but setting MetricsCacheTimeoutMinutes=1 fixed it. There was no MetricsCacheTimeoutMinutes set, the default is probably quite long.</p>",
        "id": 437333346,
        "sender_full_name": "PÃ©ter Pallinger",
        "timestamp": 1715027499
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"602779\">PÃ©ter Pallinger</span> has marked this topic as resolved.</p>",
        "id": 437333778,
        "sender_full_name": "Notification Bot",
        "timestamp": 1715027716
    }
]