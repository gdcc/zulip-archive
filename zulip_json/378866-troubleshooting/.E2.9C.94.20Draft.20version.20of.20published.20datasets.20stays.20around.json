[
    {
        "content": "<p>I stumbled across another problem <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span> We have a dataset that has been published, but the interface is still showing an unpublished draft version (only). Clicking on the dataset forwards me to the published version v1.0 of the dataset, since the draft version is no longer around. Things I tried:</p>\n<ul>\n<li>Re-index the dataset in SOLR via Database id as well as PID</li>\n<li>Clear SOLR orphans</li>\n<li>Manually publish a new version of the dataset</li>\n<li>A manual SOLR query via CURL is inconclusive (at least to my eyes)</li>\n</ul>\n<p>Things I have not tried:</p>\n<ul>\n<li>Since the instance is running v6.0, deleting that specific SOLR record is not an option (yet)</li>\n<li>I have not yet run a full re-index, since I would like to avoid the downtime for now.</li>\n</ul>\n<p>I have seen some JVM crashes during SOLR runs that occurred yesterday. I am not sure if they are related. This might be related to our problems with full text indexing that we had earlier.</p>\n<p>Has anyone encountered something like this before?</p>",
        "id": 435183265,
        "sender_full_name": "Henning Timm",
        "timestamp": 1713963446
    },
    {
        "content": "<p>Huh. I would expect that reindexing the specific dataset should remove the draft version. It's strange that it did not.</p>\n<p>You could delete the document from Solr by calling Solr directly.</p>\n<p>It sounds like you tried <a href=\"https://guides.dataverse.org/en/6.2/admin/solr-search-index.html#manually-querying-solr\">https://guides.dataverse.org/en/6.2/admin/solr-search-index.html#manually-querying-solr</a> already. Inconclusive? Did it return two Solr documents? One published one draft?</p>",
        "id": 435188726,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1713965029
    },
    {
        "content": "<p>Thanks for the help! The first problem is solved, the manual query returned no results because I messed up the query URL. Now it shows all datasets.</p>\n<p>For the dataset in question, SOLR only return the draft version, but it seems like all SOLR reindexing runs crash with an OutOfMemory Exception. I think I need to dig into my settings here.</p>",
        "id": 435193320,
        "sender_full_name": "Henning Timm",
        "timestamp": 1713966260
    },
    {
        "content": "<p>Are you saying you get out of memory problems even if you try to reindex a single dataset? <span aria-label=\"grimacing\" class=\"emoji emoji-1f62c\" role=\"img\" title=\"grimacing\">:grimacing:</span></p>",
        "id": 435194295,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1713966514
    },
    {
        "content": "<p>Correct <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span> I re-index the single dataset and get a nice jvm crash report </p>\n<div class=\"codehilite\"><pre><span></span><code># A fatal error has been detected by the Java Runtime Environment:\n#\n#  Internal Error (debug.cpp:362), pid=3178922, tid=3178961\n#  fatal error: OutOfMemory encountered: Java heap space\n[...]\nCommand Line: -Xms512m -Xmx512m -XX:+UseG1GC -XX:+PerfDisableSharedMem -XX:+ParallelRefProcEnabled [...]\n</code></pre></div>\n<p>I am not this experienced with SOLR. Are the 512m a reasonable value?</p>",
        "id": 435196685,
        "sender_full_name": "Henning Timm",
        "timestamp": 1713967208
    },
    {
        "content": "<p>It seems to work with the same settings on other servers, so I am not sure what is going on here. I will try a complete re-index later today.</p>",
        "id": 435199978,
        "sender_full_name": "Henning Timm",
        "timestamp": 1713968124
    },
    {
        "content": "<p>Hmm, I'm not sure.</p>\n<p>I do see 1 GB here: <code>ExecStart = /usr/local/solr/solr-9.3.0/bin/solr start -m 1g</code></p>\n<p>Which is twice what you have. That's from the solr.service script at <a href=\"https://guides.dataverse.org/en/6.2/installation/prerequisites.html#solr-init-script\">https://guides.dataverse.org/en/6.2/installation/prerequisites.html#solr-init-script</a></p>",
        "id": 435208099,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1713970311
    },
    {
        "content": "<p>Perhaps <span class=\"user-mention\" data-user-id=\"626369\">@Don Sizemore</span> or <span class=\"user-mention\" data-user-id=\"637063\">@Leo Andreev</span> can suggest a sufficient amount of memory for Solr.</p>",
        "id": 435208304,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1713970360
    },
    {
        "content": "<p>But obviously, you shouldn't get a crash like that when reindexing a single dataset. <span aria-label=\"scream\" class=\"emoji emoji-1f631\" role=\"img\" title=\"scream\">:scream:</span></p>",
        "id": 435208436,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1713970397
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"601943\">Henning Timm</span> <a href=\"#narrow/stream/378866-troubleshooting/topic/Draft.20version.20of.20published.20datasets.20stays.20around/near/435196685\">said</a>:</p>\n<blockquote>\n<p>Correct <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span> I re-index the single dataset and get a nice jvm crash report </p>\n<div class=\"codehilite\"><pre><span></span><code># A fatal error has been detected by the Java Runtime Environment:\n#\n#  Internal Error (debug.cpp:362), pid=3178922, tid=3178961\n#  fatal error: OutOfMemory encountered: Java heap space\n[...]\nCommand Line: -Xms512m -Xmx512m -XX:+UseG1GC -XX:+PerfDisableSharedMem -XX:+ParallelRefProcEnabled [...]\n</code></pre></div>\n<p>I am not this experienced with SOLR. Are the 512m a reasonable value?</p>\n</blockquote>\n<p>Phil is correct; Harvard had trouble with Solr stability and bumped their SOLR JVM heap size to 1GB in response.</p>",
        "id": 435213033,
        "sender_full_name": "Don Sizemore",
        "timestamp": 1713971330
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"626369\">Don Sizemore</span> <a href=\"#narrow/stream/378866-troubleshooting/topic/Draft.20version.20of.20published.20datasets.20stays.20around/near/435213033\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"601943\">Henning Timm</span> <a href=\"#narrow/stream/378866-troubleshooting/topic/Draft.20version.20of.20published.20datasets.20stays.20around/near/435196685\">said</a>:</p>\n<blockquote>\n<p>Correct <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span> I re-index the single dataset and get a nice jvm crash report </p>\n<div class=\"codehilite\"><pre><span></span><code># A fatal error has been detected by the Java Runtime Environment:\n#\n#  Internal Error (debug.cpp:362), pid=3178922, tid=3178961\n#  fatal error: OutOfMemory encountered: Java heap space\n[...]\nCommand Line: -Xms512m -Xmx512m -XX:+UseG1GC -XX:+PerfDisableSharedMem -XX:+ParallelRefProcEnabled [...]\n</code></pre></div>\n<p>I am not this experienced with SOLR. Are the 512m a reasonable value?</p>\n</blockquote>\n<p>Phil is correct; Harvard had trouble with Solr stability and bumped their SOLR JVM heap size to 1GB in response.</p>\n</blockquote>\n<p>Thanks! I'll give this a try.</p>",
        "id": 435214766,
        "sender_full_name": "Henning Timm",
        "timestamp": 1713971655
    },
    {
        "content": "<p>That did the trick! Thank you for the help!</p>",
        "id": 435235052,
        "sender_full_name": "Henning Timm",
        "timestamp": 1713977720
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"601943\">Henning Timm</span> has marked this topic as resolved.</p>",
        "id": 435235057,
        "sender_full_name": "Notification Bot",
        "timestamp": 1713977723
    }
]