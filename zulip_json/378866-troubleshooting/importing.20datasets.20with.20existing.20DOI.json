[
    {
        "content": "<p>Hi everyone,</p>\n<p>I am trying to add datasets that have been deposited in other repositories to our collections running 6.2, but not sure how to configure the JSON file to attach the data files. I am following the instructions here: <br>\n<a href=\"https://guides.dataverse.org/en/latest/api/native-api.html#id59\">https://guides.dataverse.org/en/latest/api/native-api.html#id59</a></p>\n<p>Do I just put the data files to be uploaded in the same folder as the JSON file? How do I name the data files and how to configure the following part of the JSON file. I tried different things and kept getting a message says \"Validation Failed: Please specify a file name. (Invalid value:).java.util.stream.ReferencePipeline$3@71302796\".</p>\n<div class=\"codehilite\"><pre><span></span><code>&quot;files&quot;: [\n  {\n    &quot;description&quot;: &quot;&quot;,\n    &quot;label&quot;: &quot;pub&quot;,\n    &quot;restricted&quot;: false,\n    &quot;version&quot;: 1,\n    &quot;datasetVersionId&quot;: 1,\n    &quot;dataFile&quot;: {\n      &quot;id&quot;: 4,\n      &quot;filename&quot;: &quot;pub&quot;,\n      &quot;contentType&quot;: &quot;application/vnd.dataverse.file-package&quot;,\n      &quot;filesize&quot;: 1698795873,\n      &quot;description&quot;: &quot;&quot;,\n      &quot;storageIdentifier&quot;: &quot;162017e5ad5-ee2a2b17fee9&quot;,\n      &quot;originalFormatLabel&quot;: &quot;UNKNOWN&quot;,\n      &quot;rootDataFileId&quot;: -1,\n      &quot;checksum&quot;: {\n        &quot;type&quot;: &quot;SHA-1&quot;,\n        &quot;value&quot;: &quot;54bc7ddb096a490474bd8cc90cbed1c96730f350&quot;\n      }\n    }\n  }\n]\n</code></pre></div>",
        "id": 452380606,
        "sender_full_name": "Hansen Zhang",
        "timestamp": 1721318150
    },
    {
        "content": "<p>Hi! First, I'm turning your guides link into something more permanent (since \"latest\" is always changing): <a href=\"https://guides.dataverse.org/en/6.2/api/native-api.html#import-a-dataset-into-a-dataverse-collection\">https://guides.dataverse.org/en/6.2/api/native-api.html#import-a-dataset-into-a-dataverse-collection</a></p>",
        "id": 452410818,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1721326596
    },
    {
        "content": "<p>I was just playing with the import API yesterday. One sec.</p>",
        "id": 452410971,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1721326640
    },
    {
        "content": "<p>This is what I did: <a href=\"https://github.com/IQSS/dataverse/pull/10694/commits/4f055b6d89e790ff4df6af490f7152e88e1c431d\">https://github.com/IQSS/dataverse/pull/10694/commits/4f055b6d89e790ff4df6af490f7152e88e1c431d</a></p>",
        "id": 452411235,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1721326689
    },
    {
        "content": "<p>Oh, but I wasn't testing files. Let me try with the example from the guides.</p>",
        "id": 452411662,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1721326793
    },
    {
        "content": "<p>It seems to import ok on my machine. Please check this out:</p>\n<p><a href=\"/user_uploads/53090/OR40d0BBPB7t83XlGdxGu3nk/Screenshot-2024-07-18-at-2.21.56PM.png\">Screenshot-2024-07-18-at-2.21.56PM.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/53090/OR40d0BBPB7t83XlGdxGu3nk/Screenshot-2024-07-18-at-2.21.56PM.png\" title=\"Screenshot-2024-07-18-at-2.21.56PM.png\"><img src=\"/user_uploads/53090/OR40d0BBPB7t83XlGdxGu3nk/Screenshot-2024-07-18-at-2.21.56PM.png\"></a></div>",
        "id": 452412472,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1721326963
    },
    {
        "content": "<p>Thanks, Philip for testing the functions on your machine. I am thinking I probably did not get the JSON file correctly configured. Where do I get the value to add to \"storageIdentifier\":?</p>",
        "id": 452413756,
        "sender_full_name": "Hansen Zhang",
        "timestamp": 1721327259
    },
    {
        "content": "<p>Well, first you might want to see if scripts/api/data/dataset-package-files.json works for you.</p>",
        "id": 452414041,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1721327312
    },
    {
        "content": "<p>That's the file I tried that's used in the guides.</p>",
        "id": 452414066,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1721327321
    },
    {
        "content": "<p>Here's what the guides say about storage identifiers:</p>\n<p>Before calling the API, make sure the data files referenced by the <code>POST</code>ed JSON are placed in the dataset directory with filenames matching their specified storage identifiers. In installations using POSIX storage, these files must be made readable by the app server user.</p>",
        "id": 452414223,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1721327386
    },
    {
        "content": "<p>Which sounds right to me.</p>",
        "id": 452414236,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1721327391
    },
    {
        "content": "<p>But your current problem, I think, is that your JSON isn't working.</p>",
        "id": 452414332,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1721327410
    },
    {
        "content": "<p>So I would try scripts/api/data/dataset-package-files.json</p>",
        "id": 452414716,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1721327540
    },
    {
        "content": "<p>Thanks. Let me try dataset-package-files.json first.</p>",
        "id": 452414826,
        "sender_full_name": "Hansen Zhang",
        "timestamp": 1721327584
    },
    {
        "content": "<p>Is there a place to download the file named \"pub\" for testing, or I can just use any file?</p>",
        "id": 452420996,
        "sender_full_name": "Hansen Zhang",
        "timestamp": 1721329653
    },
    {
        "content": "<p>I checked my JSON file. It was based on the dataset-package-files.json file. The part I don't know how to set up is the \"dataFile\" section. In \"storageIdentifier\": \"162017e5ad5-ee2a2b17fee9\", do I give a random value to storageIdentifier or is it machine generated? The instruction says \"make sure the data files referenced by the <code>POST</code>ed JSON are placed in the dataset directory with filenames matching their specified storage identifiers\". Do I rename my data file to a name like 162017e5ad5-ee2a2b17fee9?</p>",
        "id": 452422338,
        "sender_full_name": "Hansen Zhang",
        "timestamp": 1721330129
    },
    {
        "content": "<p>This is the error message after running the curl: {\"status\":\"ERROR\",\"message\":\"Validation Failed: Please specify a file name. (Invalid value:).java.util.stream.ReferencePipeline$3@55ac8b8e\"}</p>",
        "id": 452422622,
        "sender_full_name": "Hansen Zhang",
        "timestamp": 1721330191
    },
    {
        "content": "<p>In the JSON file you are telling Dataverse the name of the file on disk.</p>\n<p>So you should use the storage identifier as the name (on disk).</p>",
        "id": 452432984,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1721333995
    },
    {
        "content": "<p>I don't know where you keep your data but the filename could be something like this:</p>\n<p>/usr/local/dataverse/data/10.5072/FK2/ZTIQ5D/18b23995b07-aee7a8fd551d</p>",
        "id": 452433180,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1721334055
    },
    {
        "content": "<p>Thanks for the detailed explanation! I named the xlsx data file as \"19d611809e9-rumbolda6e05\" and put it in this folder: <code>/home/hansen/Documents/2Dataset_Migration/10.7266/N7XP72WT/</code>. Below is the setting for the <code>files</code> section. I am still getting the same error message.</p>\n<div class=\"codehilite\"><pre><span></span><code>    &quot;files&quot;: [\n        {\n          &quot;description&quot;: &quot;&quot;,\n          &quot;label&quot;: &quot;&quot;,\n          &quot;restricted&quot;: false,\n          &quot;version&quot;: 1,\n          &quot;datasetVersionId&quot;: 1,\n          &quot;dataFile&quot;: {\n            &quot;id&quot;: 1001,\n            &quot;filename&quot;: &quot;19d611809e9-rumbolda6e05&quot;,\n            &quot;contentType&quot;: &quot;application/vnd.dataverse.file-package&quot;,\n            &quot;filesize&quot;: 239590,\n            &quot;description&quot;: &quot;&quot;,\n            &quot;storageIdentifier&quot;: &quot;/home/hansen/Documents/2Dataset_Migration/10.7266/N7XP72WT/19d611809e9-rumbolda6e05&quot;,\n            &quot;originalFormatLabel&quot;: &quot;UNKNOWN&quot;,\n            &quot;rootDataFileId&quot;: -1,\n            &quot;checksum&quot;: {\n              &quot;type&quot;: &quot;SHA-1&quot;,\n              &quot;value&quot;: &quot;7e543d4cd13715aec38ba485267568442a7818fa&quot;\n            }\n          }\n        }\n    ]\n</code></pre></div>",
        "id": 452627385,
        "sender_full_name": "Hansen Zhang",
        "timestamp": 1721410659
    },
    {
        "content": "<p>Why would it work for me and not for you? You did try scripts/api/data/dataset-package-files.json, right? And it didn't work?</p>",
        "id": 452629044,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1721411366
    },
    {
        "content": "<p>I would like to try, but I don't have the pub file.</p>",
        "id": 452631389,
        "sender_full_name": "Hansen Zhang",
        "timestamp": 1721412150
    },
    {
        "content": "<p>I tried using the JSON file to add metadata of datasets with existing DOI. They all work fine and can be successfully published without the data file. But after adding the data files in the app, the datasets can not be published. An error message says there were problems registering the datasets. Does it mean that we need to upload metadata and data files altogether using a JSON to be able to publish?</p>",
        "id": 452633716,
        "sender_full_name": "Hansen Zhang",
        "timestamp": 1721412753
    },
    {
        "content": "<p>You don't need the pub file.</p>",
        "id": 452634039,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1721412863
    },
    {
        "content": "<p>You can just test with that JSON.</p>",
        "id": 452634060,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1721412873
    },
    {
        "content": "<p>Just to see if the JSON works.</p>",
        "id": 452634088,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1721412884
    },
    {
        "content": "<p>It works.</p>",
        "id": 452636830,
        "sender_full_name": "Hansen Zhang",
        "timestamp": 1721413545
    },
    {
        "content": "<p>Oh! Great! So now we need to figure out what's different between the two JSON files?</p>",
        "id": 452638415,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1721413952
    },
    {
        "content": "<p>Using the same JSON, I can successfully add metadata. The error message showed up after adding the \"files\" section. Does the curl automatically upload the data file on local disk to the server or do we need to upload the files first?</p>",
        "id": 452638423,
        "sender_full_name": "Hansen Zhang",
        "timestamp": 1721413958
    },
    {
        "content": "<p>You need to upload the files first.</p>\n<p>But I'm confused. scripts/api/data/dataset-package-files.json does have a \"files\" section. You're saying it worked, right? You can see a file in Dataverse? Like in the screenshot I put above?</p>",
        "id": 452638604,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1721414048
    },
    {
        "content": "<p>scripts/api/data/dataset-package-files.json worked for me. I can see a file in Dataverse. <br>\nBefore doing this, I tried to add metadata to Dataverse first, and then upload the data files in the app before publishing. But ketp getting the \"unable to register\" error in server.log.</p>",
        "id": 452639238,
        "sender_full_name": "Hansen Zhang",
        "timestamp": 1721414360
    },
    {
        "content": "<p>Ok, that's a different error, related to publishing.</p>",
        "id": 452639771,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1721414550
    },
    {
        "content": "<p>Have we moved on to that error, the publishing error? The first problem is resolved?</p>",
        "id": 452640040,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1721414645
    },
    {
        "content": "<p>Based on what you explained, I think I misunderstood how dataset-package-files.json works. I thought it can upload files to the server. <br>\nAre we supposed to be able to upload data files in the app after adding the metadata using the JSON? I only see some cache files in the corresponding folder on the server after doing that.</p>",
        "id": 452640345,
        "sender_full_name": "Hansen Zhang",
        "timestamp": 1721414774
    },
    {
        "content": "<p>I'm not sure but I think people use the import API this way:</p>\n<ul>\n<li>put files in place</li>\n<li>use import API (send JSON), setting published=true (or whatever it's called)</li>\n</ul>\n<p>That is, I'm not sure if it works to keep the imported dataset in draft to add files or make metadata edits. It might work, but I'm not sure.</p>",
        "id": 452640742,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1721414975
    },
    {
        "content": "<p>I will try and see if the registration error still shows up after uploading the data files to the server first and then using import API to publish.</p>",
        "id": 452641169,
        "sender_full_name": "Hansen Zhang",
        "timestamp": 1721415167
    },
    {
        "content": "<p>I greatly appreciate your time and kind help!</p>",
        "id": 452641205,
        "sender_full_name": "Hansen Zhang",
        "timestamp": 1721415188
    },
    {
        "content": "<p>Awesome. Good luck!</p>",
        "id": 452642122,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1721415486
    },
    {
        "content": "<p>And feel free to open issues about the API not working the way you expect it to!</p>",
        "id": 452642146,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1721415499
    },
    {
        "content": "<p>Got it. Thanks!</p>",
        "id": 452645360,
        "sender_full_name": "Hansen Zhang",
        "timestamp": 1721416383
    },
    {
        "content": "<p>Hi Philip, I copied the file to the server and successfully published the dataset. But file seems not downloadable. Is there anything else that I am missing. Here is the link to the dataset: <a href=\"https://dataverse.fgcu.edu/dataset.xhtml?persistentId=doi:10.7266/N7XP72WT\">https://dataverse.fgcu.edu/dataset.xhtml?persistentId=doi:10.7266/N7XP72WT</a></p>",
        "id": 452658144,
        "sender_full_name": "Hansen Zhang",
        "timestamp": 1721419626
    },
    {
        "content": "<p>{\"status\":\"ERROR\",\"code\":404,\"message\":\"Datafile 182: Failed to locate and/or open physical file.\"}</p>",
        "id": 452658499,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1721419704
    },
    {
        "content": "<p>Hmm, it seems like the file is not in the right place on disk.</p>",
        "id": 452658530,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1721419718
    },
    {
        "content": "<p>What does server.log say?</p>",
        "id": 452658546,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1721419724
    },
    {
        "content": "<p>Let me check if it's a permission issue</p>",
        "id": 452658720,
        "sender_full_name": "Hansen Zhang",
        "timestamp": 1721419764
    },
    {
        "content": "<p>Also you're using this:</p>\n<p>\"contentType\": \"application/vnd.dataverse.file-package\",</p>",
        "id": 452658741,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1721419772
    },
    {
        "content": "<p>Instead you should use the right contentType for Excel.</p>",
        "id": 452658776,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1721419783
    },
    {
        "content": "<p>Yes. That's something that I was to ask. Where do I find <code>contentType</code> for different file types?</p>",
        "id": 452660112,
        "sender_full_name": "Hansen Zhang",
        "timestamp": 1721420123
    },
    {
        "content": "<p>Here you go: <a href=\"https://github.com/IQSS/dataverse/blob/v6.3/src/main/java/propertyFiles/MimeTypeDisplay.properties\">https://github.com/IQSS/dataverse/blob/v6.3/src/main/java/propertyFiles/MimeTypeDisplay.properties</a></p>",
        "id": 452660686,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1721420321
    },
    {
        "content": "<p>Thank you so much!</p>",
        "id": 452661029,
        "sender_full_name": "Hansen Zhang",
        "timestamp": 1721420429
    },
    {
        "content": "<p>You saved my life again <span aria-label=\"grinning face with smiling eyes\" class=\"emoji emoji-1f601\" role=\"img\" title=\"grinning face with smiling eyes\">:grinning_face_with_smiling_eyes:</span></p>",
        "id": 452661107,
        "sender_full_name": "Hansen Zhang",
        "timestamp": 1721420464
    },
    {
        "content": "<p>Ha. Sure! <span aria-label=\"blush\" class=\"emoji emoji-1f60a\" role=\"img\" title=\"blush\">:blush:</span></p>",
        "id": 452661174,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1721420494
    },
    {
        "content": "<p>Hi Philip, I tried to add a folder containing 200 tif images to a dataset. I have tried zip it or double zip it, but the folder does not show up in dataverse. The other xlsx file being added together showed up without any problems. Is there anything I am missing about how to handle folders in the json file?</p>",
        "id": 454948814,
        "sender_full_name": "Hansen Zhang",
        "timestamp": 1722286924
    },
    {
        "content": "<p>Hmm, you could try tar.gz format instead of zip.</p>",
        "id": 454950626,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1722287386
    },
    {
        "content": "<p>Okay. Thanks!</p>",
        "id": 454951602,
        "sender_full_name": "Hansen Zhang",
        "timestamp": 1722287735
    }
]