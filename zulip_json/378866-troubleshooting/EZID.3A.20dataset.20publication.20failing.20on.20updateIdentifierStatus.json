[
    {
        "content": "<p>we're trying to debug an issue in our production dataverse related to publication of metadata-only datasets. when we try to publish, we're seeing in the logs something like the following (when the log levels are set to FINE for the EZIdDOIProvider):</p>\n<div class=\"codehilite\"><pre><span></span><code>[2024-09-18T10:04:51.504-0700] [Payara 6.2024.7] [INFO] [] [edu.harvard.iq.dataverse.engine.command.impl.FinalizeDatasetPublicationCommand] [tid: _ThreadID=243 _ThreadName=__ejb-thread-pool12] [timeMillis: 1726679091504] [levelValue: 800] [[\n  Finalizing publication of the dataset doi:10.60503/D3/EEKRZR]]\n\n[2024-09-18T10:04:51.532-0700] [Payara 6.2024.7] [FINE] [] [edu.harvard.iq.dataverse.pidproviders.doi.ezid.EZIdDOIProvider] [tid: _ThreadID=243 _ThreadName=__ejb-thread-pool12] [timeMillis: 1726679091532] [levelValue: 500] [CLASSNAME: edu.harvard.iq.dataverse.pidproviders.doi.ezid.EZIdDOIProvider] [METHODNAME: publicizeIdentifier] [[\n  publicizeIdentifier - dvObject]]\n\n[2024-09-18T10:04:51.533-0700] [Payara 6.2024.7] [FINE] [] [edu.harvard.iq.dataverse.pidproviders.doi.ezid.EZIdDOIProvider] [tid: _ThreadID=243 _ThreadName=__ejb-thread-pool12] [timeMillis: 1726679091533] [levelValue: 500] [CLASSNAME: edu.harvard.iq.dataverse.pidproviders.doi.ezid.EZIdDOIProvider] [METHODNAME: updateIdentifierStatus] [[\n  updateIdentifierStatus]]\n\n[2024-09-18T10:04:51.533-0700] [Payara 6.2024.7] [WARNING] [] [edu.harvard.iq.dataverse.engine.command.impl.FinalizeDatasetPublicationCommand] [tid: _ThreadID=243 _ThreadName=__ejb-thread-pool12] [timeMillis: 1726679091533] [levelValue: 900] [[\n  Failed to register the identifier doi:10.60503/D3/EEKRZR, or to register a file in the dataset; notifying the user(s), unlocking the dataset]]\n</code></pre></div>\n<p>are there further suggestions about how to dig into this? it seems isolated to a couple of records right now.</p>",
        "id": 471307693,
        "sender_full_name": "mar√≠a a. matienzo",
        "timestamp": 1726678864
    },
    {
        "content": "<p>Hmm, it would help to print out this Throwable to see what the problem was: <a href=\"https://github.com/IQSS/dataverse/blob/v6.3/src/main/java/edu/harvard/iq/dataverse/engine/command/impl/FinalizeDatasetPublicationCommand.java#L424\">https://github.com/IQSS/dataverse/blob/v6.3/src/main/java/edu/harvard/iq/dataverse/engine/command/impl/FinalizeDatasetPublicationCommand.java#L424</a></p>",
        "id": 471313836,
        "sender_full_name": "Philip Durbin üöÄ",
        "timestamp": 1726681001
    },
    {
        "content": "<p>okay, this is is strange - saving is now failing on new datasets too:</p>\n<div class=\"codehilite\"><pre><span></span><code>2024-09-18T11:59:39.788-0700] [Payara 6.2024.7] [WARNING] [] [jakarta.enterprise.resource.webcontainer.faces.lifecycle] [tid: _ThreadID=110 _ThreadName=http-thread-pool::jk-connector(5)] [timeMillis: 1726685979788] [levelValue: 900] [[\n  #{DatasetPage.save}: /dataset.xhtml @992,44 action=&quot;#{DatasetPage.save}&quot;: java.lang.NullPointerException: Cannot invoke &quot;edu.harvard.iq.dataverse.GlobalId.asString()&quot; because the return value of &quot;edu.harvard.iq.dataverse.Dataset.getGlobalId()&quot; is null\njakarta.faces.FacesException: #{DatasetPage.save}: /dataset.xhtml @992,44 action=&quot;#{DatasetPage.save}&quot;: java.lang.NullPointerException: Cannot invoke &quot;edu.harvard.iq.dataverse.GlobalId.asString()&quot; because the return value of &quot;edu.harvard.iq.dataverse.Dataset.getGlobalId()&quot; is null\n</code></pre></div>",
        "id": 471327867,
        "sender_full_name": "mar√≠a a. matienzo",
        "timestamp": 1726686012
    },
    {
        "content": "<p>(this is an upgraded install from 6.1 to the patched 6.3)</p>",
        "id": 471328526,
        "sender_full_name": "mar√≠a a. matienzo",
        "timestamp": 1726686217
    },
    {
        "content": "<p>null global id (PID), yuck</p>",
        "id": 471328711,
        "sender_full_name": "Philip Durbin üöÄ",
        "timestamp": 1726686278
    },
    {
        "content": "<p>as far as i know, our EZID credentials are set up in the jvm config, and that shouldn't have changed</p>",
        "id": 471328803,
        "sender_full_name": "mar√≠a a. matienzo",
        "timestamp": 1726686314
    },
    {
        "content": "<p>In <a href=\"https://github.com/IQSS/dataverse/pull/10234\">https://github.com/IQSS/dataverse/pull/10234</a> for 6.2 we did a fairly major refactoring of the PID provider code. I hope we didn't break EZID.</p>",
        "id": 471329106,
        "sender_full_name": "Philip Durbin üöÄ",
        "timestamp": 1726686425
    },
    {
        "content": "<p>We used to use EZID ourselves, before it became California only.</p>",
        "id": 471329133,
        "sender_full_name": "Philip Durbin üöÄ",
        "timestamp": 1726686443
    },
    {
        "content": "<p>i gather from the discussion on that pr and  <a href=\"https://github.com/IQSS/dataverse/issues/10557\">#10557</a> that the configuration format may have changed? is that the case?</p>",
        "id": 471329696,
        "sender_full_name": "mar√≠a a. matienzo",
        "timestamp": 1726686624
    },
    {
        "content": "<p>Yes, it's certainly possible!</p>",
        "id": 471329792,
        "sender_full_name": "Philip Durbin üöÄ",
        "timestamp": 1726686661
    },
    {
        "content": "<p>I'm not sure how helpful this is, but in dev I use these FAKE settings: <a href=\"https://github.com/IQSS/dataverse/blob/v6.3/docker-compose-dev.yml#L54-L59\">https://github.com/IQSS/dataverse/blob/v6.3/docker-compose-dev.yml#L54-L59</a></p>",
        "id": 471329914,
        "sender_full_name": "Philip Durbin üöÄ",
        "timestamp": 1726686704
    },
    {
        "content": "<p>This might help: <a class=\"stream-topic\" data-stream-id=\"446770\" href=\"/#narrow/stream/446770-docs/topic/domain.2Exml.20example.20for.20configuring.20DataCite.20PID.20provider\">#docs &gt; domain.xml example for configuring DataCite PID provider</a></p>",
        "id": 471330119,
        "sender_full_name": "Philip Durbin üöÄ",
        "timestamp": 1726686777
    },
    {
        "content": "<p>(I know you're on EZID, but it might help.)</p>",
        "id": 471330172,
        "sender_full_name": "Philip Durbin üöÄ",
        "timestamp": 1726686794
    },
    {
        "content": "<p>okay. yes, our configuration probably needs to look different. we'll probably need to do some testing on our side and coordinate with our devops folks.</p>",
        "id": 471330387,
        "sender_full_name": "mar√≠a a. matienzo",
        "timestamp": 1726686863
    },
    {
        "content": "<p>we currently only have <code>dataverse.pid.ezid.username</code>, <code>dataverse.pid.ezid.password</code>, and <code>dataverse.pid.ezid.api-url</code> set</p>",
        "id": 471330505,
        "sender_full_name": "mar√≠a a. matienzo",
        "timestamp": 1726686913
    },
    {
        "content": "<p>Ok. If you have any suggestions for the guides or release notes, please let us know!</p>",
        "id": 471331345,
        "sender_full_name": "Philip Durbin üöÄ",
        "timestamp": 1726687183
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"598112\">@Philip Durbin üêâ</span> will do. i think the big thing is that if configuration structure for Dataverse changes in a breaking way, that should be called out very clearly in the upgrade procedures.</p>",
        "id": 471339993,
        "sender_full_name": "mar√≠a a. matienzo",
        "timestamp": 1726690213
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"735407\">@Mar√≠a A. Matienzo</span> I absolutely agree. <a href=\"https://github.com/IQSS/dataverse/releases/tag/v6.2\">https://github.com/IQSS/dataverse/releases/tag/v6.2</a> says \"While backward compatibility for installations using a single PID Provider account is provided, updating to use the new microprofile settings is highly recommended and will be required in a future version.\"</p>\n<p>But it sounds like you aren't seeing the promised backward compatibility. <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 471340331,
        "sender_full_name": "Philip Durbin üöÄ",
        "timestamp": 1726690334
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"598112\">@Philip Durbin üêâ</span> yeah, that seems to be the case <span aria-label=\"face with diagonal mouth\" class=\"emoji emoji-1fae4\" role=\"img\" title=\"face with diagonal mouth\">:face_with_diagonal_mouth:</span></p>",
        "id": 471340438,
        "sender_full_name": "mar√≠a a. matienzo",
        "timestamp": 1726690380
    },
    {
        "content": "<p>I guess I would try following the DataCite pattern I showed in <a class=\"stream-topic\" data-stream-id=\"446770\" href=\"/#narrow/stream/446770-docs/topic/domain.2Exml.20example.20for.20configuring.20DataCite.20PID.20provider\">#docs &gt; domain.xml example for configuring DataCite PID provider</a></p>",
        "id": 471341325,
        "sender_full_name": "Philip Durbin üöÄ",
        "timestamp": 1726690713
    },
    {
        "content": "<p>yup, we'll try that next</p>",
        "id": 471341346,
        "sender_full_name": "mar√≠a a. matienzo",
        "timestamp": 1726690724
    },
    {
        "content": "<p>great</p>",
        "id": 471341353,
        "sender_full_name": "Philip Durbin üöÄ",
        "timestamp": 1726690729
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"598112\">@Philip Durbin üêâ</span> is * <a href=\"https://guides.dataverse.org/en/6.2/installation/config.html#dataverse-spi-pidproviders-directory\">dataverse.spi.pidproviders.directory</a> not needed? I don't see it in your examples.</p>",
        "id": 471343212,
        "sender_full_name": "Jay Sundu",
        "timestamp": 1726691470
    },
    {
        "content": "<p>Not needed. Someday it will be useful, if people create their own PID providers. They'll drop their own jar file in, like we have for exporters, if you're familiar with that. It's for extensibility. Modularity.</p>",
        "id": 471344267,
        "sender_full_name": "Philip Durbin üöÄ",
        "timestamp": 1726691897
    },
    {
        "content": "<p>Thanks again <span class=\"user-mention\" data-user-id=\"598112\">@Philip Durbin üêâ</span> we got it working now.</p>",
        "id": 471349486,
        "sender_full_name": "Jay Sundu",
        "timestamp": 1726694018
    },
    {
        "content": "<p>Phew! Should we add something to the release notes and the docs? Suggestions and pull requests welcome!</p>",
        "id": 471460453,
        "sender_full_name": "Philip Durbin üöÄ",
        "timestamp": 1726743690
    }
]