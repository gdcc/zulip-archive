[
    {
        "content": "<p>Metadata blocks can be updated, the technical process is similar to the initial integration. However, it is not yet documented how changes affect already captured metadata or the existing structure. The current implementation [1] simply overwrites the existing definitions, matching is based on the value of the \"name\" property of metadata blocks and dataset fields (or \"value\" for elements of the controlled vocabulary). As a result, names are globally unique and not per metadata block. Therefore, the behavior when updating metadata blocks must be considered undefined and risky!</p>\n<p>To improve the situation it would be great if we could document and answer the following questions:</p>\n<ul>\n<li>What processes must be followed to update a metadata block? <ul>\n<li>In which cases can I just follow the existing process without any side effects? <ul>\n<li>Example: changing the \"description\" or \"displayOrder\" property? Adding new properties?  </li>\n</ul>\n</li>\n</ul>\n</li>\n<li>In what cases are additional steps required? <ul>\n<li>Example: How to delete a property?</li>\n</ul>\n</li>\n<li>In which cases is it necessary to migrate the metadata? <ul>\n<li>How can I perform the data migration?<br>\n[1] <a href=\"https://github.com/IQSS/dataverse/blob/develop/src/main/java/edu/harvard/iq/dataverse/api/DatasetFieldServiceApi.java\">https://github.com/IQSS/dataverse/blob/develop/src/main/java/edu/harvard/iq/dataverse/api/DatasetFieldServiceApi.java</a></li>\n</ul>\n</li>\n</ul>",
        "id": 391186382,
        "sender_full_name": "Johannes D",
        "timestamp": 1694788489
    },
    {
        "content": "<p>I absolutely agree. It should definitely be documented. <span class=\"user-mention\" data-user-id=\"617722\">@Johannes D</span> would you be able to create an issue about this?</p>",
        "id": 391686742,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1695039595
    },
    {
        "content": "<p>I faced this problem recently. I would be interested in this as well. I can at least add a user story or two ;)</p>",
        "id": 391687203,
        "sender_full_name": "Henning Timm",
        "timestamp": 1695039740
    },
    {
        "content": "<p>That would be much appreciated!</p>",
        "id": 391688079,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1695040034
    },
    {
        "content": "<p>Sure, can I'm also happy to write the documentation but I need some help grasping the functionality.</p>",
        "id": 391837510,
        "sender_full_name": "Johannes D",
        "timestamp": 1695104190
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"598112\">@Philip Durbin</span> : I'm trying to understand the source code related to metadatablocks. I struggle to understand the purpose of <code>DatasetFieldDefaultValue</code>.  My editor says there is no usage of the class/object. Is that correct?</p>",
        "id": 391871793,
        "sender_full_name": "Johannes D",
        "timestamp": 1695116488
    },
    {
        "content": "<p>I'm seeing 14 usages:</p>\n<p><a href=\"/user_uploads/53090/C6-d5tRUZRIydPp52IKK4uyB/Screenshot-2023-09-19-at-6.37.01-AM.png\">Screenshot-2023-09-19-at-6.37.01-AM.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/53090/C6-d5tRUZRIydPp52IKK4uyB/Screenshot-2023-09-19-at-6.37.01-AM.png\" title=\"Screenshot-2023-09-19-at-6.37.01-AM.png\"><img src=\"/user_uploads/53090/C6-d5tRUZRIydPp52IKK4uyB/Screenshot-2023-09-19-at-6.37.01-AM.png\"></a></div>",
        "id": 391882752,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1695119848
    },
    {
        "content": "<p>I do find it interesting that the project still compiles if I delete <code>DatasetFieldDefaultValue</code> and <code>DefaultValueSet</code> and only these lines:</p>\n<div class=\"codehilite\"><pre><span></span><code>diff --git a/src/main/java/edu/harvard/iq/dataverse/DatasetFieldType.java b/src/main/java/edu/harvard/iq/dataverse/DatasetFieldType.java\nindex 824b486a42..b328d46f3a 100644\n--- a/src/main/java/edu/harvard/iq/dataverse/DatasetFieldType.java\n+++ b/src/main/java/edu/harvard/iq/dataverse/DatasetFieldType.java\n@@ -504,17 +504,6 @@ public class DatasetFieldType implements Serializable, Comparable&lt;DatasetFieldTy\n         this.datasetFields = datasetFieldValues;\n     }\n\n-    @OneToMany(mappedBy = &quot;datasetField&quot;, cascade = {CascadeType.REMOVE, CascadeType.MERGE, CascadeType.PERSIST})\n-    private List&lt;DatasetFieldDefaultValue&gt; datasetFieldDefaultValues;\n-\n-    public List&lt;DatasetFieldDefaultValue&gt; getDatasetFieldDefaultValues() {\n-        return datasetFieldDefaultValues;\n-    }\n-\n-    public void setDatasetFieldDefaultValues(List&lt;DatasetFieldDefaultValue&gt; datasetFieldDefaultValues) {\n-        this.datasetFieldDefaultValues = datasetFieldDefaultValues;\n-    }\n-\n     @Override\n     public int compareTo(DatasetFieldType o) {\n         return Integer.compare(this.getDisplayOrder(), (o.getDisplayOrder()));\n</code></pre></div>",
        "id": 391884295,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1695120399
    },
    {
        "content": "<p>Maybe it was an experiment? And isn't actually used? I'm not sure.</p>",
        "id": 391884364,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1695120424
    },
    {
        "content": "<p>I ignored the self usage. I tried the same and stated a new instance, toyed around  and found no issues. Do you think it is save to remove the class?</p>",
        "id": 391886452,
        "sender_full_name": "Johannes D",
        "timestamp": 1695121129
    },
    {
        "content": "<p>I'd want to ask around internally first.</p>",
        "id": 391887555,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1695121533
    },
    {
        "content": "<p>On a related note, here is my list of shortcomings I found in the metadata block spec:</p>\n<ol>\n<li>Headers all required or not?</li>\n<li>Headers may not contain other whitespace</li>\n<li>Tabs of non-required, empty values required or not?</li>\n<li>CV header line must be present even if no CVs</li>\n<li>Do not allow fields from other block in list. (Spec says it's not good practice only)</li>\n<li>blockUri required or not?</li>\n<li>parent field must be of type \"none\" (only mentioned in type defs)</li>\n<li>displayOrder for subfields not clearly defined</li>\n<li>allowed nesting levels of fields not clearly defined</li>\n<li>how to make comments</li>\n<li>what about empty / blank lines</li>\n<li>what about order of headings</li>\n<li>Can a compound field parent be facetable? (Probably not because format unclear)</li>\n</ol>",
        "id": 391892425,
        "sender_full_name": "Oliver Bertuch",
        "timestamp": 1695123285
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"598112\">@Philip Durbin</span>  I believe the same applies to <code>DatasetDistributor</code> as there is no object created in the codebase.. and <code>DatasetKeyword</code> without any usage.</p>",
        "id": 391892535,
        "sender_full_name": "Johannes D",
        "timestamp": 1695123325
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"617722\">@Johannes D</span> maybe you could make a PR to delete all of it. I assume tests will pass. We can point other devs at it and ask if we need it.</p>",
        "id": 391894892,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1695124144
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"598112\">Philip Durbin</span> <a href=\"#narrow/stream/375707-community/topic/CustomMetadata.20Migration/near/391894892\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"617722\">Johannes D</span> maybe you could make a PR to delete all of it. I assume tests will pass. We can point other devs at it and ask if we need it.</p>\n</blockquote>\n<p>here it is: <a href=\"https://github.com/IQSS/dataverse/pull/9932\">https://github.com/IQSS/dataverse/pull/9932</a></p>",
        "id": 391909566,
        "sender_full_name": "Johannes D",
        "timestamp": 1695129157
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"637063\">@Leo Andreev</span> what do you think?</p>",
        "id": 391909999,
        "sender_full_name": "Philip Durbin ðŸš€",
        "timestamp": 1695129277
    }
]