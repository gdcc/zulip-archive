<html>
<head><meta charset="utf-8"><title>âœ” metrics api and search api numbers differ Â· troubleshooting Â· Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/index.html">troubleshooting</a></h2>
<h3>Topic: <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/.E2.9C.94.20metrics.20api.20and.20search.20api.20numbers.20differ.html">âœ” metrics api and search api numbers differ</a></h3>

<hr>

<base href="https://dataverse.zulipchat.com">

<head><link href="https://gdcc.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="437241961"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/%E2%9C%94%20metrics%20api%20and%20search%20api%20numbers%20differ/near/437241961" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> PÃ©ter Pallinger <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/.E2.9C.94.20metrics.20api.20and.20search.20api.20numbers.20differ.html#437241961">(May 06 2024 at 11:20)</a>:</h4>
<p>I am expanding the monitoring of our dataverse instance, and have come across a curious thing: If I get the number of datasets with the metrics api, I get 72, but if I use the search api, I get 73. Has anyone seen a similar error? Maybe some types of datasets are not being shown?</p>



<a name="437242507"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/%E2%9C%94%20metrics%20api%20and%20search%20api%20numbers%20differ/near/437242507" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/.E2.9C.94.20metrics.20api.20and.20search.20api.20numbers.20differ.html#437242507">(May 06 2024 at 11:24)</a>:</h4>
<p>Interesting. Are you able to identify which one is missing from the metrics API?</p>



<a name="437242564"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/%E2%9C%94%20metrics%20api%20and%20search%20api%20numbers%20differ/near/437242564" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/.E2.9C.94.20metrics.20api.20and.20search.20api.20numbers.20differ.html#437242564">(May 06 2024 at 11:24)</a>:</h4>
<p>For the search API, are authenticating and showing drafts as well?</p>



<a name="437243000"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/%E2%9C%94%20metrics%20api%20and%20search%20api%20numbers%20differ/near/437243000" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> PÃ©ter Pallinger <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/.E2.9C.94.20metrics.20api.20and.20search.20api.20numbers.20differ.html#437243000">(May 06 2024 at 11:28)</a>:</h4>
<p>No, I use both endpoints without authentication. <br>
As for identifying: I am working on it, but the metrics api only displays aggregates.</p>



<a name="437243149"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/%E2%9C%94%20metrics%20api%20and%20search%20api%20numbers%20differ/near/437243149" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/.E2.9C.94.20metrics.20api.20and.20search.20api.20numbers.20differ.html#437243149">(May 06 2024 at 11:29)</a>:</h4>
<p>Oh, right.</p>



<a name="437243183"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/%E2%9C%94%20metrics%20api%20and%20search%20api%20numbers%20differ/near/437243183" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> PÃ©ter Pallinger <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/.E2.9C.94.20metrics.20api.20and.20search.20api.20numbers.20differ.html#437243183">(May 06 2024 at 11:29)</a>:</h4>
<p>Ok, this is weird: the /monthly metrics says 73 for may, and 72 for april...</p>



<a name="437243305"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/%E2%9C%94%20metrics%20api%20and%20search%20api%20numbers%20differ/near/437243305" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> PÃ©ter Pallinger <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/.E2.9C.94.20metrics.20api.20and.20search.20api.20numbers.20differ.html#437243305">(May 06 2024 at 11:30)</a>:</h4>
<p><a href="https://repo.researchdata.hu/api/info/metrics/datasets">https://repo.researchdata.hu/api/info/metrics/datasets</a><br>
<a href="https://repo.researchdata.hu/api/info/metrics/datasets/monthly">https://repo.researchdata.hu/api/info/metrics/datasets/monthly</a></p>



<a name="437243405"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/%E2%9C%94%20metrics%20api%20and%20search%20api%20numbers%20differ/near/437243405" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> PÃ©ter Pallinger <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/.E2.9C.94.20metrics.20api.20and.20search.20api.20numbers.20differ.html#437243405">(May 06 2024 at 11:31)</a>:</h4>
<p>so maybe the first endpoint displays the data for the last whole month?</p>



<a name="437244013"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/%E2%9C%94%20metrics%20api%20and%20search%20api%20numbers%20differ/near/437244013" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> PÃ©ter Pallinger <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/.E2.9C.94.20metrics.20api.20and.20search.20api.20numbers.20differ.html#437244013">(May 06 2024 at 11:35)</a>:</h4>
<p><a href="https://repo.researchdata.hu/api/info/metrics/datasets?dataLocation=all">https://repo.researchdata.hu/api/info/metrics/datasets?dataLocation=all</a>  -&gt; 73<br>
<a href="https://repo.researchdata.hu/api/info/metrics/datasets?dataLocation=local">https://repo.researchdata.hu/api/info/metrics/datasets?dataLocation=local</a>  -&gt; 72<br>
<a href="https://repo.researchdata.hu/api/info/metrics/datasets?dataLocation=remote">https://repo.researchdata.hu/api/info/metrics/datasets?dataLocation=remote</a>  -&gt; 0</p>



<a name="437244531"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/%E2%9C%94%20metrics%20api%20and%20search%20api%20numbers%20differ/near/437244531" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> PÃ©ter Pallinger <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/.E2.9C.94.20metrics.20api.20and.20search.20api.20numbers.20differ.html#437244531">(May 06 2024 at 11:38)</a>:</h4>
<p>Is there a dataLocation that is not local or remote? Because the numbers seem to support that. :)</p>



<a name="437268644"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/%E2%9C%94%20metrics%20api%20and%20search%20api%20numbers%20differ/near/437268644" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/.E2.9C.94.20metrics.20api.20and.20search.20api.20numbers.20differ.html#437268644">(May 06 2024 at 14:00)</a>:</h4>
<p>It looks like you found the three possibilities:</p>
<div class="codehilite"><pre><span></span><code>public static final String DATA_LOCATION_LOCAL = &quot;local&quot;;
public static final String DATA_LOCATION_REMOTE = &quot;remote&quot;;
public static final String DATA_LOCATION_ALL = &quot;all&quot;;
</code></pre></div>



<a name="437268840"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/%E2%9C%94%20metrics%20api%20and%20search%20api%20numbers%20differ/near/437268840" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/.E2.9C.94.20metrics.20api.20and.20search.20api.20numbers.20differ.html#437268840">(May 06 2024 at 14:01)</a>:</h4>
<p>From here (you seem to be on 6.1): <a href="https://github.com/IQSS/dataverse/blob/v6.1/src/main/java/edu/harvard/iq/dataverse/metrics/MetricsUtil.java#L38-L40">https://github.com/IQSS/dataverse/blob/v6.1/src/main/java/edu/harvard/iq/dataverse/metrics/MetricsUtil.java#L38-L40</a></p>



<a name="437271392"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/%E2%9C%94%20metrics%20api%20and%20search%20api%20numbers%20differ/near/437271392" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/.E2.9C.94.20metrics.20api.20and.20search.20api.20numbers.20differ.html#437271392">(May 06 2024 at 14:12)</a>:</h4>
<p>Yes, /monthly seems to be cumulative.</p>



<a name="437272340"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/%E2%9C%94%20metrics%20api%20and%20search%20api%20numbers%20differ/near/437272340" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/.E2.9C.94.20metrics.20api.20and.20search.20api.20numbers.20differ.html#437272340">(May 06 2024 at 14:17)</a>:</h4>
<p>I was wondering if one of your 73 datasets returned by the Search API are deaccessioned (not included in metrics) but no, they are all released:</p>
<p><code>curl 'https://repo.researchdata.hu/api/search?q=*&amp;type=dataset&amp;per_page=100' | jq . | grep versionState</code></p>



<a name="437273023"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/%E2%9C%94%20metrics%20api%20and%20search%20api%20numbers%20differ/near/437273023" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> PÃ©ter Pallinger <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/.E2.9C.94.20metrics.20api.20and.20search.20api.20numbers.20differ.html#437273023">(May 06 2024 at 14:20)</a>:</h4>
<p>Well, I will stop investigating this now (I may look into the SQL queries run later), and use the dataLocation=all option.<br>
The difference between local and all will remain a mystery for now.</p>



<a name="437275051"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/%E2%9C%94%20metrics%20api%20and%20search%20api%20numbers%20differ/near/437275051" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/.E2.9C.94.20metrics.20api.20and.20search.20api.20numbers.20differ.html#437275051">(May 06 2024 at 14:31)</a>:</h4>
<p>I asked in the IQSS Slack. If I hear anything, I'll let you know.</p>



<a name="437279232"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/%E2%9C%94%20metrics%20api%20and%20search%20api%20numbers%20differ/near/437279232" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/.E2.9C.94.20metrics.20api.20and.20search.20api.20numbers.20differ.html#437279232">(May 06 2024 at 14:52)</a>:</h4>
<p><span class="user-mention" data-user-id="602779">@PÃ©ter Pallinger</span> what if you clear the cache for the Metrics API? Any difference?</p>



<a name="437333346"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/%E2%9C%94%20metrics%20api%20and%20search%20api%20numbers%20differ/near/437333346" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> PÃ©ter Pallinger <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/.E2.9C.94.20metrics.20api.20and.20search.20api.20numbers.20differ.html#437333346">(May 06 2024 at 20:31)</a>:</h4>
<p>I did not find how to clear the cache, but setting MetricsCacheTimeoutMinutes=1 fixed it. There was no MetricsCacheTimeoutMinutes set, the default is probably quite long.</p>



<a name="437333778"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/%E2%9C%94%20metrics%20api%20and%20search%20api%20numbers%20differ/near/437333778" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/.E2.9C.94.20metrics.20api.20and.20search.20api.20numbers.20differ.html#437333778">(May 06 2024 at 20:35)</a>:</h4>
<p><span class="user-mention silent" data-user-id="602779">PÃ©ter Pallinger</span> has marked this topic as resolved.</p>



<hr><p>Last updated: Nov 01 2025 at 23:12 UTC</p>
</html>