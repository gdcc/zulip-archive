<html>
<head><meta charset="utf-8"><title>Total File Size Postgres Query · troubleshooting · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/index.html">troubleshooting</a></h2>
<h3>Topic: <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/Total.20File.20Size.20Postgres.20Query.html">Total File Size Postgres Query</a></h3>

<hr>

<base href="https://dataverse.zulipchat.com">

<head><link href="https://gdcc.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="477040613"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/Total%20File%20Size%20Postgres%20Query/near/477040613" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sherry Lake <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/Total.20File.20Size.20Postgres.20Query.html#477040613">(Oct 15 2024 at 17:40)</a>:</h4>
<p>I have been using Julian's list of postgres queries:<br>
<a href="https://docs.google.com/document/d/1-Y_iUduSxdDNeK1yiGUxe7t-Md7Fy965jp4o4m1XEoE/edit?tab=t.0">https://docs.google.com/document/d/1-Y_iUduSxdDNeK1yiGUxe7t-Md7Fy965jp4o4m1XEoE/edit?tab=t.0</a></p>
<p><span class="user-mention" data-user-id="621770">@Julian Gautier</span> do you have a new updated set?</p>
<p>I ask because this dataset in our repo: <a href="https://doi.org/10.18130/V3/G1NW7F">https://doi.org/10.18130/V3/G1NW7F</a><br>
w/ 76 files (74 of them &gt; 5GB) gets a "result" from the query: "Sum of file sizes in a specific dataset"...... of only 16GB... which is not correct.</p>
<p><em>Here I am only showing the affected dataset...</em></p>
<blockquote>
<p>dataset_id |   byte_size   | file_count <br>
------------+---------------+------------<br>
     58650 |   16440586164 |         76</p>
</blockquote>
<p>So I don't know how accurate this query is. Spot checking some of my other datasets, looks pretty accurate, not sure why this one is wonky.</p>
<p>There is an API command for total storage, which shows 431GB</p>
<div class="codehilite"><pre><span></span><code>curl -H &quot;X-Dataverse-key:$API_TOKEN&quot; &quot;https://dataverse.lib.virginia.edu/api/datasets/58650/storagesize&quot;
{&quot;status&quot;:&quot;OK&quot;,&quot;data&quot;:{&quot;message&quot;:&quot;Total size of the files stored in this dataset: 431,676,682,164 bytes&quot;}}
</code></pre></div>
<p>but I like the query of combo of total filesize with total number of files. (if it is reliable).</p>



<a name="477050009"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/Total%20File%20Size%20Postgres%20Query/near/477050009" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Julian Gautier <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/Total.20File.20Size.20Postgres.20Query.html#477050009">(Oct 15 2024 at 18:41)</a>:</h4>
<p>Hey <span class="user-mention" data-user-id="599826">@Sherry Lake</span>. I don't have a different query and I'm not sure why that one returns the wrong size for your dataset while returning the right number of files. It's a relatively simple dataset, too. Only one major version, no ingested tabular files, the usual things that I think make these queries more complex.</p>
<p>Would you be able to adjust the database query, like the select statement and the "group by" part, so you can see what it's saying each file's size is? Then you could compare those sizes to what's in the Dataverse JSON metadata export to see if there are particular files whose right sizes aren't being returned for some reason?</p>



<a name="477062854"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/Total%20File%20Size%20Postgres%20Query/near/477062854" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sherry Lake <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/Total.20File.20Size.20Postgres.20Query.html#477062854">(Oct 15 2024 at 20:08)</a>:</h4>
<p><span class="user-mention" data-user-id="621770">@Julian Gautier</span>  Here you go..... I'm taking off for the day, so no need to hurry to get back to me today.</p>
<p><em>Would you be able to adjust the database query, like the select statement and the "group by" part, so you can see what it's saying each file's size is?</em></p>
<p>[Note from Sherry, I added "DISTINCT" because there are two versions 1.0, 1.1 -both have the same files, so those were just being repeated]</p>
<div class="codehilite"><pre><span></span><code>select
         DISTINCT  dataset.id as dataset_id,
        datafile.filesize,
        filemetadata.datafile_id
from filemetadata
join datafile on datafile.id = filemetadata.datafile_id
full outer join datatable on datatable.datafile_id = filemetadata.datafile_id
full outer join datasetversion on datasetversion.id = filemetadata.datasetversion_id
join dataset on dataset.id = datasetversion.dataset_id
where
        dataset.harvestingclient_id is null and dataset.id = 58650;
</code></pre></div>
<blockquote>
<p>dataset_id |  filesize  | datafile_id <br>
------------+------------+-------------<br>
      58650 | 5767168000 |       58710<br>
      58650 | 5767168000 |       58654<br>
      58650 | 5767168000 |       58715<br>
      58650 | 5767168000 |       58684<br>
      58650 | 5767168000 |       58656<br>
      58650 | 5767168000 |       58720<br>
      58650 | 5767168000 |       58692<br>
      58650 | 5767168000 |       58723<br>
      58650 | 5767168000 |       58655<br>
      58650 | 5767168000 |       58680<br>
      58650 | 5767168000 |       58665<br>
      58650 | 5767168000 |       58724<br>
      58650 | 5767168000 |       58683<br>
      58650 | 5767168000 |       58676<br>
      58650 | 5767168000 |       58722<br>
      58650 | 5767168000 |       58717<br>
      58650 | 5767168000 |       58660<br>
      58650 | 5767168000 |       58659<br>
      58650 | 5767168000 |       58704<br>
      58650 | 5767168000 |       58706<br>
      58650 | 5767168000 |       58661<br>
      58650 | 5767168000 |       58718<br>
      58650 | 5767168000 |       58653<br>
      58650 | 5767168000 |       58694<br>
      58650 | 5767168000 |       58669<br>
      58650 | 5767168000 |       58664<br>
      58650 | 5767168000 |       58716<br>
      58650 | 5767168000 |       58695<br>
      58650 | 5767168000 |       58675<br>
      58650 | 5767168000 |       58693<br>
      58650 | 5767168000 |       58700<br>
      58650 | 5767168000 |       58658<br>
      58650 | 5767168000 |       58701<br>
      58650 | 5767168000 |       58699<br>
      58650 | 2923070292 |       58719<br>
      58650 | 5767168000 |       58703<br>
      58650 | 5767168000 |       58671<br>
      58650 | 5767168000 |       58697<br>
      58650 | 5767168000 |       58707<br>
      58650 | 5767168000 |       58698<br>
      58650 | 5767168000 |       58681<br>
      58650 | 5767168000 |       58663<br>
      58650 | 5767168000 |       58651<br>
      58650 | 5767168000 |       58673<br>
      58650 | 5767168000 |       58721<br>
      58650 | 5767168000 |       58662<br>
      58650 | 5767168000 |       58685<br>
      58650 | 5767168000 |       58689<br>
      58650 | 5767168000 |       58674<br>
      58650 | 5767168000 |       58667<br>
      58650 | 5767168000 |       58702<br>
      58650 | 5767168000 |       58682<br>
      58650 | 5767168000 |       58668<br>
      58650 | 5767168000 |       58714<br>
      58650 | 5767168000 |       58726<br>
      58650 | 5767168000 |       58690<br>
      58650 | 5767168000 |       58711<br>
      58650 | 5767168000 |       58712<br>
      58650 | 5767168000 |       58691<br>
      58650 | 5699988502 |       58679<br>
      58650 | 5767168000 |       58696<br>
      58650 | 5767168000 |       58709<br>
      58650 | 5767168000 |       58713<br>
      58650 | 5767168000 |       58666<br>
      58650 | 5767168000 |       58686<br>
      58650 | 5767168000 |       58725<br>
      58650 | 5767168000 |       58705<br>
      58650 | 5767168000 |       58677<br>
      58650 | 5767168000 |       58687<br>
      58650 | 5767168000 |       58678<br>
      58650 | 2050359370 |       58672<br>
      58650 | 5767168000 |       58652<br>
      58650 | 5767168000 |       58708<br>
      58650 | 5767168000 |       58688<br>
      58650 | 5767168000 |       58670<br>
      58650 | 5767168000 |       58657<br>
(76 rows)</p>
</blockquote>
<p><em>Then you could compare those sizes to what's in the Dataverse JSON metadata export</em> <br>
------  Filesizes in export looks OK - what is showing in UI.<br>
Here's a snipped from the file metadata export - they match.</p>
<p><code>curl https://dataverse.lib.virginia.edu/api/datasets/58650 | jq .</code></p>
<blockquote>
<p>"files": [<br>
        {<br>
          "label": "CAESAR-Dataset-L.z01",<br>
          "restricted": false,<br>
          "version": 1,<br>
          "datasetVersionId": 1109,<br>
          "dataFile": {<br>
            "id": 58713,<br>
            "persistentId": "",<br>
            "filename": "CAESAR-Dataset-L.z01",<br>
            "contentType": "application/octet-stream",<br>
            "friendlyType": "Unknown",<br>
            "filesize": 5767168000,<br>
            "storageIdentifier": "s3://dataverse-storage-production:183b84ee6a2-4bec26798f2a",<br>
            "rootDataFileId": -1,<br>
            "md5": "ae8f61ab138ff61a54a2ff6708f738ed",<br>
            "checksum": {<br>
              "type": "MD5",<br>
              "value": "ae8f61ab138ff61a54a2ff6708f738ed"<br>
            },<br>
            "tabularData": false,<br>
            "creationDate": "2022-10-08",<br>
            "publicationDate": "2022-10-09",<br>
            "fileAccessRequest": true<br>
          }<br>
        },<br>
        {<br>
          "label": "CAESAR-Dataset-L.z02",<br>
          "restricted": false,<br>
          "version": 1,<br>
          "datasetVersionId": 1109,<br>
          "dataFile": {<br>
            "id": 58714,<br>
            "persistentId": "",<br>
            "filename": "CAESAR-Dataset-L.z02",<br>
            "contentType": "application/octet-stream",<br>
            "friendlyType": "Unknown",<br>
            "filesize": 5767168000,<br>
            "storageIdentifier": "s3://dataverse-storage-production:183b8514ef2-f3ded382cbbb",<br>
            "rootDataFileId": -1,<br>
            "md5": "5b8e6403ffe0788fa43143462addccc4",<br>
            "checksum": {<br>
              "type": "MD5",<br>
              "value": "5b8e6403ffe0788fa43143462addccc4"<br>
            },<br>
            "tabularData": false,<br>
            "creationDate": "2022-10-08",<br>
            "publicationDate": "2022-10-09",<br>
            "fileAccessRequest": true<br>
          }<br>
        },<br>
        {<br>
          "label": "CAESAR-Dataset-L.z03",<br>
          "restricted": false,<br>
          "version": 1,<br>
          "datasetVersionId": 1109,<br>
          "dataFile": {<br>
            "id": 58681,<br>
            "persistentId": "",<br>
            "filename": "CAESAR-Dataset-L.z03",<br>
            "contentType": "application/octet-stream",<br>
            "friendlyType": "Unknown",<br>
            "filesize": 5767168000,<br>
            "storageIdentifier": "s3://dataverse-storage-production:183b853bc91-2b8b3c5374e0",<br>
            "rootDataFileId": -1,<br>
            "md5": "4781b0004eba02b871f68e6b9b30cf39",<br>
            "checksum": {<br>
              "type": "MD5",<br>
              "value": "4781b0004eba02b871f68e6b9b30cf39"<br>
            },<br>
            "tabularData": false,<br>
            "creationDate": "2022-10-08",<br>
            "publicationDate": "2022-10-09",<br>
            "fileAccessRequest": true<br>
          }<br>
        },</p>
</blockquote>



<a name="477269107"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/Total%20File%20Size%20Postgres%20Query/near/477269107" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Julian Gautier <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/Total.20File.20Size.20Postgres.20Query.html#477269107">(Oct 16 2024 at 17:52)</a>:</h4>
<p>Thanks. Yeah I see that the file sizes for each file match.</p>
<p>When I take the sum of all the byte sizes from the results of your database query, I get 431,676,682,164 bytes. Exactly what your API call reports.</p>
<p>I think that the problem is with the part of the database query that's getting the sum of non-tabular files. It's "sum(distinct coalesce(datafile.filesize, 0)". This is getting the sum of all files that have a distinct size, and because most of the files in this dataset have the same size, it's getting the sum of just the four distinct file sizes in this dataset, which is exactly the number you reported yesterday, 16440586164.</p>
<p>And maybe the database query works with other datasets you've spot checked because those datasets have files that all have different sizes?</p>
<p>So we need another way to get the sum of distinct files <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="477270244"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/Total%20File%20Size%20Postgres%20Query/near/477270244" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sherry Lake <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/Total.20File.20Size.20Postgres.20Query.html#477270244">(Oct 16 2024 at 17:58)</a>:</h4>
<p>Wait.... <span class="user-mention" data-user-id="621770">@Julian Gautier</span>  didn't you have a new SQL line for me to try?<br>
I was just reading it, went to open a window.... and you removed it?</p>
<p>Didn't want to miss anything.</p>



<a name="477270520"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/Total%20File%20Size%20Postgres%20Query/near/477270520" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sherry Lake <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/Total.20File.20Size.20Postgres.20Query.html#477270520">(Oct 16 2024 at 17:59)</a>:</h4>
<p>And <span class="user-mention" data-user-id="621770">@Julian Gautier</span> great detective work!!!! <img alt=":dataverse_man:" class="emoji" src="https://avatars.zulip.com/53090/emoji/images/c7b94a03.png" title="dataverse man"></p>



<a name="477271125"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/Total%20File%20Size%20Postgres%20Query/near/477271125" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Julian Gautier <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/Total.20File.20Size.20Postgres.20Query.html#477271125">(Oct 16 2024 at 18:02)</a>:</h4>
<p>Lol as I was writing I realized that how I thought to edit the query wouldn't work, so I removed it</p>



<a name="477271374"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/Total%20File%20Size%20Postgres%20Query/near/477271374" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Julian Gautier <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/Total.20File.20Size.20Postgres.20Query.html#477271374">(Oct 16 2024 at 18:03)</a>:</h4>
<p>Was hoping you wouldn't see that. Thought you had today off. Or was that yesterday?</p>



<a name="477271496"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/Total%20File%20Size%20Postgres%20Query/near/477271496" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sherry Lake <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/Total.20File.20Size.20Postgres.20Query.html#477271496">(Oct 16 2024 at 18:04)</a>:</h4>
<p>Took off early yesterday. All <span aria-label="eyes" class="emoji emoji-1f440" role="img" title="eyes">:eyes:</span> today. <span aria-label="wink" class="emoji emoji-1f609" role="img" title="wink">:wink:</span></p>



<a name="477272696"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/Total%20File%20Size%20Postgres%20Query/near/477272696" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Julian Gautier <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/Total.20File.20Size.20Postgres.20Query.html#477272696">(Oct 16 2024 at 18:11)</a>:</h4>
<p>We/I should probably remove that query until we can figure out how to improve it. Or leave a note saying it doesn't really work <span aria-label="grimacing" class="emoji emoji-1f62c" role="img" title="grimacing">:grimacing:</span></p>



<a name="477272890"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/Total%20File%20Size%20Postgres%20Query/near/477272890" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sherry Lake <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/Total.20File.20Size.20Postgres.20Query.html#477272890">(Oct 16 2024 at 18:12)</a>:</h4>
<p>Wonder if there is a way to mimic what the API is doing? I'm looking at that code.... but I'm no Java programmer.</p>



<a name="477273192"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/Total%20File%20Size%20Postgres%20Query/near/477273192" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Julian Gautier <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/Total.20File.20Size.20Postgres.20Query.html#477273192">(Oct 16 2024 at 18:14)</a>:</h4>
<p>Is the reason why you prefer the queries to the API endpoint because you need to also see the number of files?</p>



<a name="477273289"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/Total%20File%20Size%20Postgres%20Query/near/477273289" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sherry Lake <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/Total.20File.20Size.20Postgres.20Query.html#477273289">(Oct 16 2024 at 18:15)</a>:</h4>
<p>I think a comment around the query would be helpful. It does work most of the time. I checked and out of 432 datasets - only 59 had differing file sizes (from the SQL query vs the API).</p>



<a name="477274114"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/Total%20File%20Size%20Postgres%20Query/near/477274114" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sherry Lake <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/Total.20File.20Size.20Postgres.20Query.html#477274114">(Oct 16 2024 at 18:20)</a>:</h4>
<p>And, yes, I need to see number of files with file sizes.</p>
<p>We are manually bagging our datasets to send to our preservation system (APTrust). There is a great command linescript to bag all "un-bagged" datasets, but I don't want to include the "large" ones in the auto script (large file sizes, large number of files), so I do those separately - from the list that the SQL Query provides.</p>
<p>This one dataset is the only one that was WAY off with size.</p>
<p>I created a spreadsheet comparing the SQL query and API:<br>
<a href="https://docs.google.com/spreadsheets/d/1Mw5l_pU7NZXJ54fV2R321r80JTx2DGQX/edit?usp=sharing&amp;ouid=100246654920053034549&amp;rtpof=true&amp;sd=true">https://docs.google.com/spreadsheets/d/1Mw5l_pU7NZXJ54fV2R321r80JTx2DGQX/edit?usp=sharing&amp;ouid=100246654920053034549&amp;rtpof=true&amp;sd=true</a></p>
<p>I was trying to see if there was a pattern why they were different (draft, multi versions, zip, tab...... etc.), that's what the colors and comments are about.</p>



<a name="477279853"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/Total%20File%20Size%20Postgres%20Query/near/477279853" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Julian Gautier <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/Total.20File.20Size.20Postgres.20Query.html#477279853">(Oct 16 2024 at 18:52)</a>:</h4>
<p>I added a comment to the query for now. Will probably figure out later how to get it working for datasets with files that are the same sizes.</p>
<p>Sometimes I use database queries instead of the API because it's faster than the API, which are usually pretty granular. And I've heard the same from folks running other installations.</p>
<p>Is that true for you here, too? I imagine running one more endpoints on hundreds or thousands of files would take too long</p>



<a name="477453752"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/Total%20File%20Size%20Postgres%20Query/near/477453752" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Julian Gautier <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/Total.20File.20Size.20Postgres.20Query.html#477453752">(Oct 17 2024 at 14:11)</a>:</h4>
<p>I changed <a href="https://docs.google.com/document/d/1-Y_iUduSxdDNeK1yiGUxe7t-Md7Fy965jp4o4m1XEoE/edit#bookmark=id.vdush2gpwcg3">the query that's in that Google Doc</a> so that it gets the sum of file sizes from the database's storageuse table, which I think was added in v6.1. UVA Dataverse is on 6.2 right? So I think it should work for you <span class="user-mention" data-user-id="599826">@Sherry Lake</span>. I tested the query a little and it seemed to work well. Definitely simpler!</p>



<a name="477464459"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/Total%20File%20Size%20Postgres%20Query/near/477464459" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sherry Lake <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/Total.20File.20Size.20Postgres.20Query.html#477464459">(Oct 17 2024 at 15:00)</a>:</h4>
<p>I made a correction to your new query  on the google doc: "=" in place of "in".</p>
<p>It didn't work for me with "in". </p>
<p>Changing to "=" and it worked for me;  got the correct correct size for the single dataset.</p>
<p>Now can we have it do all datasets? Something to work on later. Not needed now.</p>



<a name="477468511"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/Total%20File%20Size%20Postgres%20Query/near/477468511" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Julian Gautier <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/Total.20File.20Size.20Postgres.20Query.html#477468511">(Oct 17 2024 at 15:17)</a>:</h4>
<p>Oh thanks! Yeah I briefly considered making the query work with a list of dataset IDs and backed out of that idea, but left that "in" in.</p>



<a name="477469484"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/Total%20File%20Size%20Postgres%20Query/near/477469484" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Julian Gautier <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/Total.20File.20Size.20Postgres.20Query.html#477469484">(Oct 17 2024 at 15:22)</a>:</h4>
<p>About making it work with all datasets, I think we'd just remove the where clause in that temporary "datasetfilecount" table or cte. I left a comment to indicate this.</p>
<p>I wrote "should" 'cause I haven't tested this to make sure. Do you plan to test it?</p>



<a name="477496991"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/Total%20File%20Size%20Postgres%20Query/near/477496991" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Julian Gautier <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/Total.20File.20Size.20Postgres.20Query.html#477496991">(Oct 17 2024 at 17:59)</a>:</h4>
<p>I tested it a bit since I was already querying for another reason.</p>
<p>Removing that where clause seems to work well. I didn't even have to add a clause to exclude harvested datasets, which was a nice surprise.</p>



<a name="477497541"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/Total%20File%20Size%20Postgres%20Query/near/477497541" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sherry Lake <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/Total.20File.20Size.20Postgres.20Query.html#477497541">(Oct 17 2024 at 18:02)</a>:</h4>
<p>Thanks, Julian.  I was trying to figure a pyDataverse problem - see my zulip question in python channel (not for you.... just an FYI... I have been catching up on Dataverse things, that have been on my todo list.</p>



<hr><p>Last updated: Nov 01 2025 at 23:12 UTC</p>
</html>