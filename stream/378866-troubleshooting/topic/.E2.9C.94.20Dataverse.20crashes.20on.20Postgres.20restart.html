<html>
<head><meta charset="utf-8"><title>âœ” Dataverse crashes on Postgres restart Â· troubleshooting Â· Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/index.html">troubleshooting</a></h2>
<h3>Topic: <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/.E2.9C.94.20Dataverse.20crashes.20on.20Postgres.20restart.html">âœ” Dataverse crashes on Postgres restart</a></h3>

<hr>

<base href="https://dataverse.zulipchat.com">

<head><link href="https://gdcc.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="448958956"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/%E2%9C%94%20Dataverse%20crashes%20on%20Postgres%20restart/near/448958956" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Florez <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/.E2.9C.94.20Dataverse.20crashes.20on.20Postgres.20restart.html#448958956">(Jul 03 2024 at 22:10)</a>:</h4>
<p>Hello everyone, today I was informed that my Dataverse was down. This image shows the error message when I tried to access Dataverse</p>
<p><a href="/user_uploads/53090/3mVGprsFxCOIecbC8-I6W5fu/imagen_2024-07-03_165236903.png">imagen_2024-07-03_165236903.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/53090/3mVGprsFxCOIecbC8-I6W5fu/imagen_2024-07-03_165236903.png" title="imagen_2024-07-03_165236903.png"><img src="/user_uploads/53090/3mVGprsFxCOIecbC8-I6W5fu/imagen_2024-07-03_165236903.png"></a></div><p>After a while, Dataverse was up. I took a look at the logs while Postgres was restarting. This is the <a href="/user_uploads/53090/SnAYXzT14Bn2dqax3Wu5XNBJ/server.log">server.log</a></p>
<p>I think it is about connection pool. Someone know What can I do? Or What I need to check?</p>



<a name="449846079"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/%E2%9C%94%20Dataverse%20crashes%20on%20Postgres%20restart/near/449846079" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Henning Timm <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/.E2.9C.94.20Dataverse.20crashes.20on.20Postgres.20restart.html#449846079">(Jul 08 2024 at 11:53)</a>:</h4>
<p>I have the same issue after updating postgres packages in my (Debian) system. So far I have restarted the server to get it running again. So I would be interested in this as well ;)</p>



<a name="449855151"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/%E2%9C%94%20Dataverse%20crashes%20on%20Postgres%20restart/near/449855151" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/.E2.9C.94.20Dataverse.20crashes.20on.20Postgres.20restart.html#449855151">(Jul 08 2024 at 12:32)</a>:</h4>
<p>Have you tried some of these? <a href="https://guides.dataverse.org/en/latest/installation/config.html#advanced-database-settings">https://guides.dataverse.org/en/latest/installation/config.html#advanced-database-settings</a> There are also links to more docs by Payara.</p>



<a name="449871222"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/%E2%9C%94%20Dataverse%20crashes%20on%20Postgres%20restart/near/449871222" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/.E2.9C.94.20Dataverse.20crashes.20on.20Postgres.20restart.html#449871222">(Jul 08 2024 at 13:34)</a>:</h4>
<p>In general, yes, I've found that if PostgreSQL goes down I need to restart Payara to re-establish the connection.</p>
<p>I do like the sound of "allow server to reconnect in case of failure" in the link from Oliver above.</p>



<a name="449871583"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/%E2%9C%94%20Dataverse%20crashes%20on%20Postgres%20restart/near/449871583" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/.E2.9C.94.20Dataverse.20crashes.20on.20Postgres.20restart.html#449871583">(Jul 08 2024 at 13:36)</a>:</h4>
<p>Yes, that's the one I'd try first</p>



<a name="449967338"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/%E2%9C%94%20Dataverse%20crashes%20on%20Postgres%20restart/near/449967338" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Florez <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/.E2.9C.94.20Dataverse.20crashes.20on.20Postgres.20restart.html#449967338">(Jul 08 2024 at 19:46)</a>:</h4>
<p><span class="user-mention" data-user-id="598183">@Oliver Bertuch</span> and <span class="user-mention" data-user-id="598112">@Philip Durbin</span>, thanks for the response. I will check the documentation that Oliver has shared. If I get it, I will let you know.</p>



<a name="449967741"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/%E2%9C%94%20Dataverse%20crashes%20on%20Postgres%20restart/near/449967741" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/.E2.9C.94.20Dataverse.20crashes.20on.20Postgres.20restart.html#449967741">(Jul 08 2024 at 19:49)</a>:</h4>
<p>Good luck!</p>



<a name="449982436"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/%E2%9C%94%20Dataverse%20crashes%20on%20Postgres%20restart/near/449982436" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Florez <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/.E2.9C.94.20Dataverse.20crashes.20on.20Postgres.20restart.html#449982436">(Jul 08 2024 at 21:08)</a>:</h4>
<p>I have configured the next property <strong>&lt;system-property name="dataverse.db.is-connection-validation-required" value="true"&gt;&lt;/system-property&gt;</strong>, in my domain.xml file, I was restarting Payara and got the next error:</p>
<div class="codehilite"><pre><span></span><code>RAR5114 : Error allocating connection : [Error in allocating a connection. Cause: Cannot invoke &quot;String.toLowerCase(java.util.Locale)&quot; because the return value of &quot;com.sun.gjc.common.DataSourceSpec.getDetail(int)&quot; is null]]]

[2024-07-08T15:53:18.454-0500] [Payara 6.2023.8] [GRAVE] [] [javax.enterprise.system.tools.deployment.common] [tid: _ThreadID=32 _ThreadName=RunLevelControllerThread-1720471969883] [timeMillis: 1720471998454] [levelValue: 1000] [[
  Exception while invoking class org.glassfish.ejb.startup.EjbApplication start method
jakarta.ejb.EJBException: jakarta.ejb.CreateException: Initialization failed for Singleton StartupFlywayMigrator
    at com.sun.ejb.containers.AbstractSingletonContainer$SingletonContextFactory.create(AbstractSingletonContainer.java:745)
    at com.sun.ejb.containers.AbstractSingletonContainer.instantiateSingletonInstance(AbstractSingletonContainer.java:477)
    at org.glassfish.ejb.startup.SingletonLifeCycleManager.initializeSingleton(SingletonLifeCycleManager.java:219)
    at org.glassfish.ejb.startup.SingletonLifeCycleManager.initializeSingleton(SingletonLifeCycleManager.java:180)
    at org.glassfish.ejb.startup.SingletonLifeCycleManager.doStartup(SingletonLifeCycleManager.java:159)
    at org.glassfish.ejb.startup.EjbApplication.start(EjbApplication.java:171)
    at org.glassfish.internal.data.EngineRef.start(EngineRef.java:123)
    at org.glassfish.internal.data.ModuleInfo.start(ModuleInfo.java:292)
    at org.glassfish.internal.data.ApplicationInfo.start(ApplicationInfo.java:361)
    at com.sun.enterprise.v3.server.ApplicationLifecycle.initialize(ApplicationLifecycle.java:633)
    at com.sun.enterprise.v3.server.ApplicationLoaderService.postConstruct(ApplicationLoaderService.java:346)
    at org.jvnet.hk2.internal.ClazzCreator.postConstructMe(ClazzCreator.java:303)
    at org.jvnet.hk2.internal.ClazzCreator.create(ClazzCreator.java:351)
    at org.jvnet.hk2.internal.SystemDescriptor.create(SystemDescriptor.java:466)
    at org.glassfish.hk2.runlevel.internal.AsyncRunLevelContext.findOrCreate(AsyncRunLevelContext.java:281)
    at org.glassfish.hk2.runlevel.RunLevelContext.findOrCreate(RunLevelContext.java:65)
    at org.jvnet.hk2.internal.Utilities.createService(Utilities.java:2103)
    at org.jvnet.hk2.internal.ServiceHandleImpl.getService(ServiceHandleImpl.java:93)
    at org.jvnet.hk2.internal.ServiceHandleImpl.getService(ServiceHandleImpl.java:67)
    at org.glassfish.hk2.runlevel.internal.CurrentTaskFuture$QueueRunner.oneJob(CurrentTaskFuture.java:1213)
    at org.glassfish.hk2.runlevel.internal.CurrentTaskFuture$QueueRunner.run(CurrentTaskFuture.java:1144)
    at org.glassfish.hk2.runlevel.internal.CurrentTaskFuture$UpOneLevel.run(CurrentTaskFuture.java:762)
    at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
    at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
    at java.base/java.lang.Thread.run(Thread.java:840)
Caused by: jakarta.ejb.CreateException: Initialization failed for Singleton StartupFlywayMigrator
    at com.sun.ejb.containers.AbstractSingletonContainer.createSingletonEJB(AbstractSingletonContainer.java:598)
    at com.sun.ejb.containers.AbstractSingletonContainer$SingletonContextFactory.create(AbstractSingletonContainer.java:743)
    ... 24 more
Caused by: org.flywaydb.core.internal.exception.FlywaySqlException: Unable to obtain connection from database: Error in allocating a connection. Cause: Cannot invoke &quot;String.toLowerCase(java.util.Locale)&quot; because the return value of &quot;com.sun.gjc.common.DataSourceSpec.getDetail(int)&quot; is null
</code></pre></div>
<p>This is my domain.xml file configuration.<br>
<a href="/user_uploads/53090/_Wo1-KK945-mS4RWwgyUpo-B/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/53090/_Wo1-KK945-mS4RWwgyUpo-B/image.png" title="image.png"><img src="/user_uploads/53090/_Wo1-KK945-mS4RWwgyUpo-B/image.png"></a></div>



<a name="449982632"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/%E2%9C%94%20Dataverse%20crashes%20on%20Postgres%20restart/near/449982632" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Florez <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/.E2.9C.94.20Dataverse.20crashes.20on.20Postgres.20restart.html#449982632">(Jul 08 2024 at 21:09)</a>:</h4>
<p>Is that the way to set the property, or should I set it as a JVM option?</p>



<a name="449983264"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/%E2%9C%94%20Dataverse%20crashes%20on%20Postgres%20restart/near/449983264" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/.E2.9C.94.20Dataverse.20crashes.20on.20Postgres.20restart.html#449983264">(Jul 08 2024 at 21:11)</a>:</h4>
<p>You will need to define the method how to validate, too, I think. There is no default selection.</p>



<a name="449983778"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/%E2%9C%94%20Dataverse%20crashes%20on%20Postgres%20restart/near/449983778" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Florez <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/.E2.9C.94.20Dataverse.20crashes.20on.20Postgres.20restart.html#449983778">(Jul 08 2024 at 21:13)</a>:</h4>
<p><span class="user-mention" data-user-id="598183">@Oliver Bertuch</span> do you mean this <strong>dataverse.db.connection-validation-method</strong> property?</p>



<a name="449985736"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/%E2%9C%94%20Dataverse%20crashes%20on%20Postgres%20restart/near/449985736" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/.E2.9C.94.20Dataverse.20crashes.20on.20Postgres.20restart.html#449985736">(Jul 08 2024 at 21:27)</a>:</h4>
<p>Can you try with custom validation and set the class to  org.glassfish.api.jdbc.validation.PostgresConnectionValidation?</p>



<a name="449985743"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/%E2%9C%94%20Dataverse%20crashes%20on%20Postgres%20restart/near/449985743" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/.E2.9C.94.20Dataverse.20crashes.20on.20Postgres.20restart.html#449985743">(Jul 08 2024 at 21:27)</a>:</h4>
<p>I'm curious if that works...</p>



<a name="449991421"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/%E2%9C%94%20Dataverse%20crashes%20on%20Postgres%20restart/near/449991421" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santiago Florez <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/.E2.9C.94.20Dataverse.20crashes.20on.20Postgres.20restart.html#449991421">(Jul 08 2024 at 22:00)</a>:</h4>
<p><span class="user-mention" data-user-id="598183">@Oliver Bertuch</span> I have configured my domain.xml file as follows:<br>
<a href="/user_uploads/53090/B-Ff_dh6hIl4pVJHjesxFmyr/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/53090/B-Ff_dh6hIl4pVJHjesxFmyr/image.png" title="image.png"><img src="/user_uploads/53090/B-Ff_dh6hIl4pVJHjesxFmyr/image.png"></a></div><p>First, I restarted Payara, and it loaded correctly, and then I restarted Postgresql, to validate that everything is ok, and it works. So, thank you very much for helping me.</p>



<a name="449991584"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/%E2%9C%94%20Dataverse%20crashes%20on%20Postgres%20restart/near/449991584" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/.E2.9C.94.20Dataverse.20crashes.20on.20Postgres.20restart.html#449991584">(Jul 08 2024 at 22:01)</a>:</h4>
<p>Well it's not what I asked, but glad it seems to work for you!</p>



<a name="449991608"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/%E2%9C%94%20Dataverse%20crashes%20on%20Postgres%20restart/near/449991608" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/.E2.9C.94.20Dataverse.20crashes.20on.20Postgres.20restart.html#449991608">(Jul 08 2024 at 22:01)</a>:</h4>
<p>Please let us know if your problems reappear</p>



<a name="449991682"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/%E2%9C%94%20Dataverse%20crashes%20on%20Postgres%20restart/near/449991682" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/.E2.9C.94.20Dataverse.20crashes.20on.20Postgres.20restart.html#449991682">(Jul 08 2024 at 22:02)</a>:</h4>
<p>In case it's smooth sailin' from now on, we might include these things in the docs as useful tips</p>



<a name="450161711"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/%E2%9C%94%20Dataverse%20crashes%20on%20Postgres%20restart/near/450161711" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/.E2.9C.94.20Dataverse.20crashes.20on.20Postgres.20restart.html#450161711">(Jul 09 2024 at 12:42)</a>:</h4>
<p>Docs, docs, docs.</p>



<a name="450631831"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/378866-troubleshooting/topic/%E2%9C%94%20Dataverse%20crashes%20on%20Postgres%20restart/near/450631831" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://gdcc.github.io/zulip-archive/stream/378866-troubleshooting/topic/.E2.9C.94.20Dataverse.20crashes.20on.20Postgres.20restart.html#450631831">(Jul 11 2024 at 06:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="598183">Oliver Bertuch</span> has marked this topic as resolved.</p>



<hr><p>Last updated: Mar 02 2026 at 13:56 UTC</p>
</html>