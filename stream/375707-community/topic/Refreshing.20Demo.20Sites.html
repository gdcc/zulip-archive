<html>
<head><meta charset="utf-8"><title>Refreshing Demo Sites Â· community Â· Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://gdcc.github.io/zulip-archive/stream/375707-community/index.html">community</a></h2>
<h3>Topic: <a href="https://gdcc.github.io/zulip-archive/stream/375707-community/topic/Refreshing.20Demo.20Sites.html">Refreshing Demo Sites</a></h3>

<hr>

<base href="https://dataverse.zulipchat.com">

<head><link href="https://gdcc.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="464045197"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375707-community/topic/Refreshing%20Demo%20Sites/near/464045197" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sherry Lake <a href="https://gdcc.github.io/zulip-archive/stream/375707-community/topic/Refreshing.20Demo.20Sites.html#464045197">(Aug 21 2024 at 12:51)</a>:</h4>
<p>I asked this in the google forum (Borealis is also interested):  <a href="https://groups.google.com/g/dataverse-community/c/Zf9ME-8Uc0Y">https://groups.google.com/g/dataverse-community/c/Zf9ME-8Uc0Y</a></p>
<p>How does Harvard (IQSS) refreshÂ <a href="http://demo.dataverse.org/">demo.dataverse.org</a>? The note at the top of the page says datasets deleted after 30 days.</p>
<p>We would like to incorporate that on our test server.<br>
Thanks.</p>



<a name="464059237"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375707-community/topic/Refreshing%20Demo%20Sites/near/464059237" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375707-community/topic/Refreshing.20Demo.20Sites.html#464059237">(Aug 21 2024 at 13:35)</a>:</h4>
<p>So, I look a quick look and it's a bit complicated. Let me at least throw some of the code over the wall to you (and Borealis).</p>



<a name="464059356"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375707-community/topic/Refreshing%20Demo%20Sites/near/464059356" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375707-community/topic/Refreshing.20Demo.20Sites.html#464059356">(Aug 21 2024 at 13:35)</a>:</h4>
<p>From root's crontab:</p>
<p><code>0 5 1 * * (cd /usr/local/dvn-admin/clean; /usr/local/dvn-admin/clean/delete_older_datasets.sh) &gt; /dev/null 2&gt;&amp;1</code></p>



<a name="464059454"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375707-community/topic/Refreshing%20Demo%20Sites/near/464059454" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375707-community/topic/Refreshing.20Demo.20Sites.html#464059454">(Aug 21 2024 at 13:35)</a>:</h4>
<div class="codehilite"><pre><span></span><code># cat delete_older_datasets.sh
#!/bin/sh

datestamp=`date +%Y%m%d`; export datesteamp
psql -U postgres -d dvndb -t -f finddatasetstoclean.sql &gt; cleandatasets_${datestamp}.sh
if /bin/sh cleandatasets_${datestamp}.sh
then
    /bin/rm cleandatasets_${datestamp}.sh
fi
</code></pre></div>



<a name="464059936"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375707-community/topic/Refreshing%20Demo%20Sites/near/464059936" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375707-community/topic/Refreshing.20Demo.20Sites.html#464059936">(Aug 21 2024 at 13:37)</a>:</h4>
<p><code># cat finddatasetstoclean.sql</code></p>
<p><code>select 'curl --header "X-Dataverse-key: REDACTED" -X DELETE http://localhost:8080/api/datasets/:persistentId/destroy?persistentId=doi:'||authority||'/'||identifier||';echo;sleep 1;' from dvobject where dtype='Dataset' and modificationtime &lt; current_date-60 and identifier not in ('FK2/Q1RSNG','FK2/XSAZXH','FK2/U6AEZM','FK2/PPPORT','FK2/AJM2AT','FK2/HJVOXL','FK2/PPIAXE','FK2/HXJVJU','FK2/QZDNI4') and owner_id not in (select id from dataverse where alias in ('trade_statistics','csvconfv723','CAP_demo','CAP_USA', 'rdprincipal')) order by indextime asc;</code></p>



<a name="464060283"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375707-community/topic/Refreshing%20Demo%20Sites/near/464060283" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375707-community/topic/Refreshing.20Demo.20Sites.html#464060283">(Aug 21 2024 at 13:38)</a>:</h4>
<p>You end up with a shell script with lines like this in it:</p>
<p><code>curl --header "X-Dataverse-key: REDACTED" -X DELETE http://localhost:8080/api/datasets/:persistentId/destroy?persistentId=doi:10.70122/FK2/MSSBNE;echo;sleep 1;</code></p>



<a name="464060312"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375707-community/topic/Refreshing%20Demo%20Sites/near/464060312" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375707-community/topic/Refreshing.20Demo.20Sites.html#464060312">(Aug 21 2024 at 13:38)</a>:</h4>
<p>I hope that helps! <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="464086335"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375707-community/topic/Refreshing%20Demo%20Sites/near/464086335" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Deirdre Kirmis <a href="https://gdcc.github.io/zulip-archive/stream/375707-community/topic/Refreshing.20Demo.20Sites.html#464086335">(Aug 21 2024 at 15:15)</a>:</h4>
<p>This is awesome! We are interested as well. I have been running a terraform script to completely destroy and rebuild our QA environment from snapshots and this is waaaayy better!</p>



<a name="464090328"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375707-community/topic/Refreshing%20Demo%20Sites/near/464090328" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Deirdre Kirmis <a href="https://gdcc.github.io/zulip-archive/stream/375707-community/topic/Refreshing.20Demo.20Sites.html#464090328">(Aug 21 2024 at 15:30)</a>:</h4>
<p>so, you keep the last 60 days and then a few demo datasets that are preserved?</p>



<a name="464090986"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375707-community/topic/Refreshing%20Demo%20Sites/near/464090986" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375707-community/topic/Refreshing.20Demo.20Sites.html#464090986">(Aug 21 2024 at 15:32)</a>:</h4>
<p>Yes, we skip over a few datasets to avoid deleting them.</p>



<a name="464091075"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375707-community/topic/Refreshing%20Demo%20Sites/near/464091075" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375707-community/topic/Refreshing.20Demo.20Sites.html#464091075">(Aug 21 2024 at 15:33)</a>:</h4>
<p>60 days? Well, whatever that crontab says. <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>



<a name="464091304"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375707-community/topic/Refreshing%20Demo%20Sites/near/464091304" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Deirdre Kirmis <a href="https://gdcc.github.io/zulip-archive/stream/375707-community/topic/Refreshing.20Demo.20Sites.html#464091304">(Aug 21 2024 at 15:34)</a>:</h4>
<p>Oh i was looking at the "<code>and modificationtime &lt; current_date-60</code>" in the sql query .. i may be reading it wrong. This is awesome! Thanks for posting.</p>



<a name="464105491"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375707-community/topic/Refreshing%20Demo%20Sites/near/464105491" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Deirdre Kirmis <a href="https://gdcc.github.io/zulip-archive/stream/375707-community/topic/Refreshing.20Demo.20Sites.html#464105491">(Aug 21 2024 at 16:29)</a>:</h4>
<p>It worked! Just need another script/query to delete empty dataverses using <a href="https://guides.dataverse.org/en/latest/api/native-api.html#delete-a-dataverse-collection">that API</a> .. working on that</p>



<a name="464120911"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375707-community/topic/Refreshing%20Demo%20Sites/near/464120911" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375707-community/topic/Refreshing.20Demo.20Sites.html#464120911">(Aug 21 2024 at 17:33)</a>:</h4>
<p>Nice. I'm glad it's useful. I'm pretty sure we have <span class="user-mention" data-user-id="637063">@Leo Andreev</span> to thank for writing those scripts. <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>



<a name="464124689"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375707-community/topic/Refreshing%20Demo%20Sites/near/464124689" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Deirdre Kirmis <a href="https://gdcc.github.io/zulip-archive/stream/375707-community/topic/Refreshing.20Demo.20Sites.html#464124689">(Aug 21 2024 at 17:56)</a>:</h4>
<p>oops that is deleting everything within the last 60 days .. lol </p>
<p>i created a script that just deletes all of the dataverses except the root dataverse (ID = 1) using that API .. but we currently  just want to wipe everything clean .. so we could set the filter to filter on specific IDs if we wanted to keep some</p>



<a name="464124991"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375707-community/topic/Refreshing%20Demo%20Sites/near/464124991" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375707-community/topic/Refreshing.20Demo.20Sites.html#464124991">(Aug 21 2024 at 17:57)</a>:</h4>
<p>Oh, if you want to delete everything, you might like destroy_all_dvobjects.py from <a href="https://github.com/IQSS/dataverse-sample-data">https://github.com/IQSS/dataverse-sample-data</a></p>



<a name="464127596"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375707-community/topic/Refreshing%20Demo%20Sites/near/464127596" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Deirdre Kirmis <a href="https://gdcc.github.io/zulip-archive/stream/375707-community/topic/Refreshing.20Demo.20Sites.html#464127596">(Aug 21 2024 at 18:04)</a>:</h4>
<p>Oh that's awesome, too! This would work well for our Dev env so will try it. For QA we will likely want to keep some, so will still use Leonid's script/query and adjust the filters, as we can be much more selective.</p>



<a name="464127734"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375707-community/topic/Refreshing%20Demo%20Sites/near/464127734" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Deirdre Kirmis <a href="https://gdcc.github.io/zulip-archive/stream/375707-community/topic/Refreshing.20Demo.20Sites.html#464127734">(Aug 21 2024 at 18:05)</a>:</h4>
<p>so for the demo dataverse, you just keep all of the dataverses ever created?</p>



<a name="464128182"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375707-community/topic/Refreshing%20Demo%20Sites/near/464128182" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Deirdre Kirmis <a href="https://gdcc.github.io/zulip-archive/stream/375707-community/topic/Refreshing.20Demo.20Sites.html#464128182">(Aug 21 2024 at 18:06)</a>:</h4>
<p>sorry to hijack this stream, <span class="user-mention" data-user-id="599826">@Sherry Lake</span> .. I've been working on the same thing! <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="464128273"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375707-community/topic/Refreshing%20Demo%20Sites/near/464128273" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375707-community/topic/Refreshing.20Demo.20Sites.html#464128273">(Aug 21 2024 at 18:06)</a>:</h4>
<p>Yes, I'm pretty sure we do keep collections. They're "free" in the sense that they only take up a tiny bit of space in the database. No files.</p>



<a name="464128921"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375707-community/topic/Refreshing%20Demo%20Sites/near/464128921" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sherry Lake <a href="https://gdcc.github.io/zulip-archive/stream/375707-community/topic/Refreshing.20Demo.20Sites.html#464128921">(Aug 21 2024 at 18:09)</a>:</h4>
<p>No problem <span class="user-mention" data-user-id="660583">@Dieuwertje Bloemen</span> I'm learning lots tool!</p>



<hr><p>Last updated: Mar 02 2026 at 13:56 UTC</p>
</html>