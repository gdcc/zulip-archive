<html>
<head><meta charset="utf-8"><title>CustomMetadata Migration Â· community Â· Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://gdcc.github.io/zulip-archive/stream/375707-community/index.html">community</a></h2>
<h3>Topic: <a href="https://gdcc.github.io/zulip-archive/stream/375707-community/topic/CustomMetadata.20Migration.html">CustomMetadata Migration</a></h3>

<hr>

<base href="https://dataverse.zulipchat.com">

<head><link href="https://gdcc.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="391186382"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375707-community/topic/CustomMetadata%20Migration/near/391186382" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Johannes D <a href="https://gdcc.github.io/zulip-archive/stream/375707-community/topic/CustomMetadata.20Migration.html#391186382">(Sep 15 2023 at 14:34)</a>:</h4>
<p>Metadata blocks can be updated, the technical process is similar to the initial integration. However, it is not yet documented how changes affect already captured metadata or the existing structure. The current implementation [1] simply overwrites the existing definitions, matching is based on the value of the "name" property of metadata blocks and dataset fields (or "value" for elements of the controlled vocabulary). As a result, names are globally unique and not per metadata block. Therefore, the behavior when updating metadata blocks must be considered undefined and risky!</p>
<p>To improve the situation it would be great if we could document and answer the following questions:</p>
<ul>
<li>What processes must be followed to update a metadata block? <ul>
<li>In which cases can I just follow the existing process without any side effects? <ul>
<li>Example: changing the "description" or "displayOrder" property? Adding new properties?  </li>
</ul>
</li>
</ul>
</li>
<li>In what cases are additional steps required? <ul>
<li>Example: How to delete a property?</li>
</ul>
</li>
<li>In which cases is it necessary to migrate the metadata? <ul>
<li>How can I perform the data migration?<br>
[1] <a href="https://github.com/IQSS/dataverse/blob/develop/src/main/java/edu/harvard/iq/dataverse/api/DatasetFieldServiceApi.java">https://github.com/IQSS/dataverse/blob/develop/src/main/java/edu/harvard/iq/dataverse/api/DatasetFieldServiceApi.java</a></li>
</ul>
</li>
</ul>



<a name="391686742"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375707-community/topic/CustomMetadata%20Migration/near/391686742" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375707-community/topic/CustomMetadata.20Migration.html#391686742">(Sep 18 2023 at 12:19)</a>:</h4>
<p>I absolutely agree. It should definitely be documented. <span class="user-mention" data-user-id="617722">@Johannes D</span> would you be able to create an issue about this?</p>



<a name="391687203"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375707-community/topic/CustomMetadata%20Migration/near/391687203" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Henning Timm <a href="https://gdcc.github.io/zulip-archive/stream/375707-community/topic/CustomMetadata.20Migration.html#391687203">(Sep 18 2023 at 12:22)</a>:</h4>
<p>I faced this problem recently. I would be interested in this as well. I can at least add a user story or two ;)</p>



<a name="391688079"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375707-community/topic/CustomMetadata%20Migration/near/391688079" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375707-community/topic/CustomMetadata.20Migration.html#391688079">(Sep 18 2023 at 12:27)</a>:</h4>
<p>That would be much appreciated!</p>



<a name="391837510"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375707-community/topic/CustomMetadata%20Migration/near/391837510" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Johannes D <a href="https://gdcc.github.io/zulip-archive/stream/375707-community/topic/CustomMetadata.20Migration.html#391837510">(Sep 19 2023 at 06:16)</a>:</h4>
<p>Sure, can I'm also happy to write the documentation but I need some help grasping the functionality.</p>



<a name="391871793"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375707-community/topic/CustomMetadata%20Migration/near/391871793" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Johannes D <a href="https://gdcc.github.io/zulip-archive/stream/375707-community/topic/CustomMetadata.20Migration.html#391871793">(Sep 19 2023 at 09:41)</a>:</h4>
<p><span class="user-mention" data-user-id="598112">@Philip Durbin</span> : I'm trying to understand the source code related to metadatablocks. I struggle to understand the purpose of <code>DatasetFieldDefaultValue</code>.  My editor says there is no usage of the class/object. Is that correct?</p>



<a name="391882752"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375707-community/topic/CustomMetadata%20Migration/near/391882752" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375707-community/topic/CustomMetadata.20Migration.html#391882752">(Sep 19 2023 at 10:37)</a>:</h4>
<p>I'm seeing 14 usages:</p>
<p><a href="/user_uploads/53090/C6-d5tRUZRIydPp52IKK4uyB/Screenshot-2023-09-19-at-6.37.01-AM.png">Screenshot-2023-09-19-at-6.37.01-AM.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/53090/C6-d5tRUZRIydPp52IKK4uyB/Screenshot-2023-09-19-at-6.37.01-AM.png" title="Screenshot-2023-09-19-at-6.37.01-AM.png"><img src="/user_uploads/53090/C6-d5tRUZRIydPp52IKK4uyB/Screenshot-2023-09-19-at-6.37.01-AM.png"></a></div>



<a name="391884295"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375707-community/topic/CustomMetadata%20Migration/near/391884295" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375707-community/topic/CustomMetadata.20Migration.html#391884295">(Sep 19 2023 at 10:46)</a>:</h4>
<p>I do find it interesting that the project still compiles if I delete <code>DatasetFieldDefaultValue</code> and <code>DefaultValueSet</code> and only these lines:</p>
<div class="codehilite"><pre><span></span><code>diff --git a/src/main/java/edu/harvard/iq/dataverse/DatasetFieldType.java b/src/main/java/edu/harvard/iq/dataverse/DatasetFieldType.java
index 824b486a42..b328d46f3a 100644
--- a/src/main/java/edu/harvard/iq/dataverse/DatasetFieldType.java
+++ b/src/main/java/edu/harvard/iq/dataverse/DatasetFieldType.java
@@ -504,17 +504,6 @@ public class DatasetFieldType implements Serializable, Comparable&lt;DatasetFieldTy
         this.datasetFields = datasetFieldValues;
     }

-    @OneToMany(mappedBy = &quot;datasetField&quot;, cascade = {CascadeType.REMOVE, CascadeType.MERGE, CascadeType.PERSIST})
-    private List&lt;DatasetFieldDefaultValue&gt; datasetFieldDefaultValues;
-
-    public List&lt;DatasetFieldDefaultValue&gt; getDatasetFieldDefaultValues() {
-        return datasetFieldDefaultValues;
-    }
-
-    public void setDatasetFieldDefaultValues(List&lt;DatasetFieldDefaultValue&gt; datasetFieldDefaultValues) {
-        this.datasetFieldDefaultValues = datasetFieldDefaultValues;
-    }
-
     @Override
     public int compareTo(DatasetFieldType o) {
         return Integer.compare(this.getDisplayOrder(), (o.getDisplayOrder()));
</code></pre></div>



<a name="391884364"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375707-community/topic/CustomMetadata%20Migration/near/391884364" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375707-community/topic/CustomMetadata.20Migration.html#391884364">(Sep 19 2023 at 10:47)</a>:</h4>
<p>Maybe it was an experiment? And isn't actually used? I'm not sure.</p>



<a name="391886452"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375707-community/topic/CustomMetadata%20Migration/near/391886452" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Johannes D <a href="https://gdcc.github.io/zulip-archive/stream/375707-community/topic/CustomMetadata.20Migration.html#391886452">(Sep 19 2023 at 10:58)</a>:</h4>
<p>I ignored the self usage. I tried the same and stated a new instance, toyed around  and found no issues. Do you think it is save to remove the class?</p>



<a name="391887555"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375707-community/topic/CustomMetadata%20Migration/near/391887555" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375707-community/topic/CustomMetadata.20Migration.html#391887555">(Sep 19 2023 at 11:05)</a>:</h4>
<p>I'd want to ask around internally first.</p>



<a name="391892425"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375707-community/topic/CustomMetadata%20Migration/near/391892425" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375707-community/topic/CustomMetadata.20Migration.html#391892425">(Sep 19 2023 at 11:34)</a>:</h4>
<p>On a related note, here is my list of shortcomings I found in the metadata block spec:</p>
<ol>
<li>Headers all required or not?</li>
<li>Headers may not contain other whitespace</li>
<li>Tabs of non-required, empty values required or not?</li>
<li>CV header line must be present even if no CVs</li>
<li>Do not allow fields from other block in list. (Spec says it's not good practice only)</li>
<li>blockUri required or not?</li>
<li>parent field must be of type "none" (only mentioned in type defs)</li>
<li>displayOrder for subfields not clearly defined</li>
<li>allowed nesting levels of fields not clearly defined</li>
<li>how to make comments</li>
<li>what about empty / blank lines</li>
<li>what about order of headings</li>
<li>Can a compound field parent be facetable? (Probably not because format unclear)</li>
</ol>



<a name="391892535"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375707-community/topic/CustomMetadata%20Migration/near/391892535" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Johannes D <a href="https://gdcc.github.io/zulip-archive/stream/375707-community/topic/CustomMetadata.20Migration.html#391892535">(Sep 19 2023 at 11:35)</a>:</h4>
<p><span class="user-mention" data-user-id="598112">@Philip Durbin</span>  I believe the same applies to <code>DatasetDistributor</code> as there is no object created in the codebase.. and <code>DatasetKeyword</code> without any usage.</p>



<a name="391894892"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375707-community/topic/CustomMetadata%20Migration/near/391894892" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375707-community/topic/CustomMetadata.20Migration.html#391894892">(Sep 19 2023 at 11:49)</a>:</h4>
<p><span class="user-mention" data-user-id="617722">@Johannes D</span> maybe you could make a PR to delete all of it. I assume tests will pass. We can point other devs at it and ask if we need it.</p>



<a name="391909566"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375707-community/topic/CustomMetadata%20Migration/near/391909566" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Johannes D <a href="https://gdcc.github.io/zulip-archive/stream/375707-community/topic/CustomMetadata.20Migration.html#391909566">(Sep 19 2023 at 13:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="598112">Philip Durbin</span> <a href="#narrow/stream/375707-community/topic/CustomMetadata.20Migration/near/391894892">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="617722">Johannes D</span> maybe you could make a PR to delete all of it. I assume tests will pass. We can point other devs at it and ask if we need it.</p>
</blockquote>
<p>here it is: <a href="https://github.com/IQSS/dataverse/pull/9932">https://github.com/IQSS/dataverse/pull/9932</a></p>



<a name="391909999"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375707-community/topic/CustomMetadata%20Migration/near/391909999" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375707-community/topic/CustomMetadata.20Migration.html#391909999">(Sep 19 2023 at 13:14)</a>:</h4>
<p><span class="user-mention" data-user-id="637063">@Leo Andreev</span> what do you think?</p>



<hr><p>Last updated: Mar 02 2026 at 13:56 UTC</p>
</html>