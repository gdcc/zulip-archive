<html>
<head><meta charset="utf-8"><title>testing S3 Â· containers Â· Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/index.html">containers</a></h2>
<h3>Topic: <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html">testing S3</a></h3>

<hr>

<base href="https://dataverse.zulipchat.com">

<head><link href="https://gdcc.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="352814859"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/352814859" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#352814859">(Apr 26 2023 at 14:16)</a>:</h4>
<p>As part of <a href="https://github.com/IQSS/dataverse/pull/9541">https://github.com/IQSS/dataverse/pull/9541</a> I need to test S3.</p>
<p>I've always tested S3 with Payara running directly on my Mac. <span aria-label="grimacing" class="emoji emoji-1f62c" role="img" title="grimacing">:grimacing:</span> </p>
<p>It should be possible to supply all the necessary S3 config via MPCONFIG, right? That way I can continue my streak of doing all development with containers. <span aria-label="happy" class="emoji emoji-1f600" role="img" title="happy">:happy:</span> It's been over a month! <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span> </p>
<p>I'd rather not switch back to Payara running directly on my Mac if I can avoid it!</p>



<a name="352818600"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/352818600" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#352818600">(Apr 26 2023 at 14:28)</a>:</h4>
<p>Yes it is possible but only dirty, because the files part is not yet supporting MPCONFIG. So you need to use the "dataverse_files_xxx_option=..." env var hack. Mind the casing.</p>



<a name="352819215"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/352819215" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#352819215">(Apr 26 2023 at 14:30)</a>:</h4>
<p>Interesting. Do you have a list of env vars handy I can start with? If not, I'll look at the guides.</p>



<a name="352819789"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/352819789" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#352819789">(Apr 26 2023 at 14:32)</a>:</h4>
<p>Just take the example from the startup script asa template <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="352820245"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/352820245" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#352820245">(Apr 26 2023 at 14:33)</a>:</h4>
<p>Sorry, which startup script?</p>



<a name="352820499"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/352820499" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#352820499">(Apr 26 2023 at 14:34)</a>:</h4>
<p><a href="https://github.com/IQSS/dataverse/blob/4903e9f0277105ea6a8c59a2f962dac8bcf715f2/src/main/docker/scripts/init_2_configure.sh#L18-L22">https://github.com/IQSS/dataverse/blob/4903e9f0277105ea6a8c59a2f962dac8bcf715f2/src/main/docker/scripts/init_2_configure.sh#L18-L22</a></p>



<a name="352820776"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/352820776" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#352820776">(Apr 26 2023 at 14:35)</a>:</h4>
<p>Nice. Thanks. I'll probably add some docs for this!</p>



<a name="352821013"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/352821013" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#352821013">(Apr 26 2023 at 14:36)</a>:</h4>
<p>Sure. Don't put too much effort into it - should go away anyway with making the config of storage via MPCONFIG available. Someone needs to code that...</p>



<a name="352821125"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/352821125" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#352821125">(Apr 26 2023 at 14:36)</a>:</h4>
<p>Right. There's a comment about <a href="https://github.com/IQSS/dataverse/issues/7000">https://github.com/IQSS/dataverse/issues/7000</a> but no PR yet, right?</p>



<a name="352821453"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/352821453" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#352821453">(Apr 26 2023 at 14:37)</a>:</h4>
<p>Am I right that we don't plan to create a PR until milestone G? "MPCONFIG for remaining dozen JVM settings (Size: 80)"</p>



<a name="352821616"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/352821616" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#352821616">(Apr 26 2023 at 14:38)</a>:</h4>
<p>No, that's not correct.</p>



<a name="352821651"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/352821651" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#352821651">(Apr 26 2023 at 14:38)</a>:</h4>
<p>Oh, wait. Milestone D. "Configurability: Make storage configuration use MPCONFIG (Size: 33)"</p>



<a name="352821671"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/352821671" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#352821671">(Apr 26 2023 at 14:38)</a>:</h4>
<p>There are some config things in milestones along the way</p>



<a name="352821808"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/352821808" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#352821808">(Apr 26 2023 at 14:38)</a>:</h4>
<p>So all I have for now is a local branch and a stash of changes on my laptop for the work on the file storage thing</p>



<a name="352821922"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/352821922" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#352821922">(Apr 26 2023 at 14:39)</a>:</h4>
<p>Awesome. Want me to create an issue?</p>



<a name="352822075"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/352822075" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#352822075">(Apr 26 2023 at 14:39)</a>:</h4>
<p>There was some discussion a while ago during some tech hour about  if it would be OK to require a list of storage names which IIRC was eventually put on hold with "hmm yeah dunno maybe fine lets see"</p>



<a name="352822239"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/352822239" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#352822239">(Apr 26 2023 at 14:40)</a>:</h4>
<p>Well there is 7000, but maybe we can close that and create issues for the remaining parts</p>



<a name="352822308"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/352822308" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#352822308">(Apr 26 2023 at 14:40)</a>:</h4>
<p>Yeah, smaller chunks, I'm thinking.</p>



<a name="352822353"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/352822353" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#352822353">(Apr 26 2023 at 14:40)</a>:</h4>
<p>(That would be mail, which has an issue, storage and "the leftovers")</p>



<a name="352822385"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/352822385" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#352822385">(Apr 26 2023 at 14:40)</a>:</h4>
<p>yum</p>



<a name="352822707"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/352822707" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#352822707">(Apr 26 2023 at 14:41)</a>:</h4>
<p>I've been going on with this for a while... <span aria-label="innocent" class="emoji emoji-1f607" role="img" title="innocent">:innocent:</span></p>



<a name="352823095"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/352823095" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#352823095">(Apr 26 2023 at 14:42)</a>:</h4>
<p>Glad that it seems to be appreciated now among the devs... That lookup thing seems to be intriguing... <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>



<a name="352823462"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/352823462" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#352823462">(Apr 26 2023 at 14:43)</a>:</h4>
<p>Well, now I need it. The ability to configure S3 in containers. <span aria-label="happy" class="emoji emoji-1f600" role="img" title="happy">:happy:</span></p>



<a name="352823898"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/352823898" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#352823898">(Apr 26 2023 at 14:44)</a>:</h4>
<p>Hrhr... I remember we talked about this stuff long time ago and one of my arguments was "you want this for containers" <span aria-label="yum" class="emoji emoji-1f60b" role="img" title="yum">:yum:</span></p>



<a name="352824422"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/352824422" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#352824422">(Apr 26 2023 at 14:45)</a>:</h4>
<p>Ah BTW do you want to test localstack for S3?</p>



<a name="352824505"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/352824505" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#352824505">(Apr 26 2023 at 14:45)</a>:</h4>
<p>Or are you going to use Minio?</p>



<a name="352824580"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/352824580" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#352824580">(Apr 26 2023 at 14:45)</a>:</h4>
<p>(Or Seaweedfs)</p>



<a name="352824851"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/352824851" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#352824851">(Apr 26 2023 at 14:46)</a>:</h4>
<p>IIRC this is part of another milestone, would it make sense to take a look into how spin up the storage container, too?</p>



<a name="352824876"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/352824876" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#352824876">(Apr 26 2023 at 14:46)</a>:</h4>
<p>I'm going to use real S3. It's possible to configure it with the hacks above, right?</p>



<a name="352825015"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/352825015" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#352825015">(Apr 26 2023 at 14:46)</a>:</h4>
<p>Yes, that's completely possible</p>



<a name="352825277"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/352825277" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#352825277">(Apr 26 2023 at 14:47)</a>:</h4>
<p>Oh wait: one thing... What I already had a chance to bring in for MPCONFIG and S3 is the keys thing</p>



<a name="352825388"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/352825388" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#352825388">(Apr 26 2023 at 14:47)</a>:</h4>
<p>So you don't need to think about how to deal with the AWS profile and config files in ~/.aws</p>



<a name="352825559"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/352825559" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#352825559">(Apr 26 2023 at 14:47)</a>:</h4>
<p>That is documented in the main section, it's been sitting there for a while and made <span class="user-mention" data-user-id="598186">@Don Sizemore</span> happy before</p>



<a name="354956708"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/354956708" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#354956708">(May 01 2023 at 19:07)</a>:</h4>
<p>I started editing my <code>.env</code> file today but got so confused I gave up and just ran Payara locally on my Mac. These are the (surely incorrect) values I was editing when I gave up:</p>
<div class="codehilite"><pre><span></span><code>DATAVERSE_FILES_STORAGE__DRIVER__ID=s3
DATAVERSE_FILES_LOCAL_TYPE=s3
DATAVERSE_FILES_LOCAL_LABEL=S3
DATAVERSE.FILES.&lt;ID&gt;.ACCESS-KEY=
DATAVERSE.FILES.&lt;ID&gt;.SECRET-KEY=
</code></pre></div>
<p>I'm happy to try again but I'd need some hand holding. Or more time (than I want to spend today) studying the code. Or I can just wait for MPCONFIG. <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="355052201"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/355052201" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#355052201">(May 02 2023 at 07:16)</a>:</h4>
<p><span aria-label="leftwards hand" class="emoji emoji-1faf2" role="img" title="leftwards hand">:leftwards_hand:</span> Here you go</p>



<a name="355052499"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/355052499" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#355052499">(May 02 2023 at 07:18)</a>:</h4>
<p>May I point you towards <a href="http://preview.guides.gdcc.io/en/develop/container/app-image.html#tunables">http://preview.guides.gdcc.io/en/develop/container/app-image.html#tunables</a> and the description of the "dataverse_*" vars? Maybe we should add a note that this is case sensitive.</p>



<a name="355112272"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/355112272" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#355112272">(May 02 2023 at 11:03)</a>:</h4>
<p>Ah, I didn't know about these magic trick rules.</p>



<a name="355112310"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/355112310" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#355112310">(May 02 2023 at 11:03)</a>:</h4>
<p>Replace - with __ for example.</p>



<a name="355112439"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/355112439" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#355112439">(May 02 2023 at 11:03)</a>:</h4>
<p>I wasn't sure what do with with SECRET-KEY and gave up.</p>



<a name="355119237"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/355119237" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#355119237">(May 02 2023 at 11:29)</a>:</h4>
<p>Both Secret and Access Key are already using MPCONFIG, so you may use either way</p>



<a name="358967203"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/358967203" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#358967203">(May 17 2023 at 12:14)</a>:</h4>
<p>Configuring S3 via MPCONFIG is possible, right? At least in containers?</p>



<a name="358967387"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/358967387" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#358967387">(May 17 2023 at 12:15)</a>:</h4>
<p>No. Needs a hack.</p>



<a name="358968275"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/358968275" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#358968275">(May 17 2023 at 12:19)</a>:</h4>
<p>Ok, the but the hack should work. Great. I'll try again some day.</p>



<a name="359695401"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/359695401" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#359695401">(May 19 2023 at 15:23)</a>:</h4>
<p>I was able to configure containerized Dataverse to use S3!</p>



<a name="359695555"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/359695555" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#359695555">(May 19 2023 at 15:24)</a>:</h4>
<div class="codehilite"><pre><span></span><code>diff --git a/docker-compose-dev.yml b/docker-compose-dev.yml
index 30c55661a2..298a20b6ff 100644
--- a/docker-compose-dev.yml
+++ b/docker-compose-dev.yml
@@ -13,6 +13,14 @@ services:
       - DATAVERSE_DB_PASSWORD=secret
       - DATAVERSE_DB_USER=${DATAVERSE_DB_USER}
       - DATAVERSE_FEATURE_API_BEARER_AUTH=1
+      - dataverse_files_storage__driver__id=s3
+      - dataverse_files_s3_type=s3
+      - dataverse_files_s3_label=S3
+      - dataverse_files_s3_custom__endpoint__url=s3.us-east-2.amazonaws.com
+      - dataverse_files_s3_custom__endpoint__region=us-east-2
+      - dataverse_files_s3_bucket__name=pdurbin
+      - dataverse_files_s3_access__key=REDACTED
+      - dataverse_files_s3_secret__key=REDACTED
     ports:
       - &quot;8080:8080&quot; # HTTP (Dataverse Application)
       - &quot;4848:4848&quot; # HTTP (Payara Admin Console)
</code></pre></div>



<a name="359695805"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/359695805" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#359695805">(May 19 2023 at 15:25)</a>:</h4>
<p>As you can see earlier in this thread, I was using UPPER CASE before, like any good sysadmin. But it seems like one must use lower case.</p>



<a name="359747781"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/359747781" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#359747781">(May 19 2023 at 19:09)</a>:</h4>
<p>Yeah like I said (did I?) before in this thread, this is a limitation because we have a hack in place for now until the storage subsystem is MPCONFIGified</p>



<a name="359747797"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/359747797" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#359747797">(May 19 2023 at 19:09)</a>:</h4>
<p>Sorry 'bout that!</p>



<a name="359752257"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/359752257" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#359752257">(May 19 2023 at 19:34)</a>:</h4>
<p>Now I see you said "case sensitive" above.</p>



<a name="359752305"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/359752305" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#359752305">(May 19 2023 at 19:34)</a>:</h4>
<p>And now I get it. <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="359752367"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/359752367" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#359752367">(May 19 2023 at 19:35)</a>:</h4>
<p>Sorry, I should have <strong>EMPHASIZED_IT_MORE</strong>. <span aria-label="yum" class="emoji emoji-1f60b" role="img" title="yum">:yum:</span></p>



<a name="359753201"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/359753201" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#359753201">(May 19 2023 at 19:39)</a>:</h4>
<p>Well, now I can document it: <a class="stream-topic" data-stream-id="375812" href="/#narrow/stream/375812-containers/topic/docs.20for.20milestone.20A.20.239540">#containers &gt; docs for milestone A #9540</a></p>



<a name="384005327"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/384005327" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#384005327">(Aug 11 2023 at 15:18)</a>:</h4>
<p>I just thought I'd point out that this issue made it to the board. Currently it's in "sprint ready": Add S3 tests to the regular integration test suite <a href="https://github.com/IQSS/dataverse/issues/6783">#6783</a></p>



<a name="389629726"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/389629726" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#389629726">(Sep 07 2023 at 11:02)</a>:</h4>
<p>Any discussion or prep for this S3 testing work? We could discuss it today or a future ct meeting if people want to.</p>



<a name="391984598"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/391984598" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#391984598">(Sep 19 2023 at 19:48)</a>:</h4>
<p>Before working on <a href="https://github.com/IQSS/dataverse/issues/6783">#6783</a> should we merge <a href="https://github.com/IQSS/dataverse/issues/9273">#9273</a> or does it not matter?</p>



<a name="391985054"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/391985054" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#391985054">(Sep 19 2023 at 19:52)</a>:</h4>
<p>Yes yes yes please merge first</p>



<a name="391985100"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/391985100" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#391985100">(Sep 19 2023 at 19:53)</a>:</h4>
<p>Oh I see it was added to the 6.1 milestone!</p>



<a name="391985587"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/391985587" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#391985587">(Sep 19 2023 at 19:56)</a>:</h4>
<p>Yes, both are flagged for 6.1.</p>



<a name="391986010"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/391986010" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#391986010">(Sep 19 2023 at 19:59)</a>:</h4>
<p>Great, thanks, I left a comment: <a href="https://github.com/IQSS/dataverse/issues/6783#issuecomment-1726389019">https://github.com/IQSS/dataverse/issues/6783#issuecomment-1726389019</a></p>



<a name="394895047"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/394895047" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#394895047">(Oct 04 2023 at 18:26)</a>:</h4>
<p>Should I pick up this issue? Add S3 tests to the regular integration test suite <a href="https://github.com/IQSS/dataverse/issues/6783">#6783</a></p>



<a name="394895142"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/394895142" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#394895142">(Oct 04 2023 at 18:27)</a>:</h4>
<p><span class="user-mention" data-user-id="598183">@Oliver Bertuch</span> are we in a better spot now that <a href="https://github.com/IQSS/dataverse/issues/9273">#9273</a> has been merged? Do you have ideas on how to proceed with S3 testing?</p>



<a name="394895188"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/394895188" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#394895188">(Oct 04 2023 at 18:27)</a>:</h4>
<p>You bet we are!</p>



<a name="394895285"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/394895285" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#394895285">(Oct 04 2023 at 18:28)</a>:</h4>
<p>Do you want to work on this now?</p>



<a name="394895552"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/394895552" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#394895552">(Oct 04 2023 at 18:30)</a>:</h4>
<p>That's what I'm saying. It's in "this sprint". I could pick it up next.</p>



<a name="394895628"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/394895628" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#394895628">(Oct 04 2023 at 18:30)</a>:</h4>
<p>Oh! Wasn't aware!</p>



<a name="394895676"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/394895676" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#394895676">(Oct 04 2023 at 18:31)</a>:</h4>
<p>Want me to give you some thoughts and spill ideas?</p>



<a name="394895690"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/394895690" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#394895690">(Oct 04 2023 at 18:31)</a>:</h4>
<p>That's my job. To stare at the project board. <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>



<a name="394895717"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/394895717" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#394895717">(Oct 04 2023 at 18:31)</a>:</h4>
<p>Yes, please hit me with ideas.</p>



<a name="394895848"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/394895848" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#394895848">(Oct 04 2023 at 18:32)</a>:</h4>
<p>The way I see it, we should definitely take a look at adding integration test using Testcontainers</p>



<a name="394895929"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/394895929" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#394895929">(Oct 04 2023 at 18:32)</a>:</h4>
<p>There are basically 2 ways to do this: go for LocalStack or use some other S3 compatible thing</p>



<a name="394895992"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/394895992" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#394895992">(Oct 04 2023 at 18:33)</a>:</h4>
<p><a href="https://java.testcontainers.org/modules/minio/">https://java.testcontainers.org/modules/minio/</a></p>



<a name="394896009"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/394896009" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#394896009">(Oct 04 2023 at 18:33)</a>:</h4>
<p><a href="https://java.testcontainers.org/modules/localstack/">https://java.testcontainers.org/modules/localstack/</a></p>



<a name="394896176"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/394896176" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#394896176">(Oct 04 2023 at 18:34)</a>:</h4>
<p>As we are using the official AWS Java SDK, it might be worth going for LocalStack</p>



<a name="394896231"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/394896231" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#394896231">(Oct 04 2023 at 18:34)</a>:</h4>
<p>No objection to LocalStack, though I've only heard of it.</p>



<a name="394896249"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/394896249" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#394896249">(Oct 04 2023 at 18:34)</a>:</h4>
<p>I think <span class="user-mention" data-user-id="626369">@Don Sizemore</span> is a fan.</p>



<a name="394896681"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/394896681" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#394896681">(Oct 04 2023 at 18:37)</a>:</h4>
<p>You will have to do some ugly hacks with configuration... Sorry, but most <code>dataverse.files</code> S3 options ain't MPCONFIG enabled yet, so no nice simple wrapper with <code>@JvmSetting</code></p>



<a name="394896717"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/394896717" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#394896717">(Oct 04 2023 at 18:37)</a>:</h4>
<p>Oh, I know, I worked around them. I know the hacks.</p>



<a name="394896778"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/394896778" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#394896778">(Oct 04 2023 at 18:37)</a>:</h4>
<p>BeforeAll and AfterAll are your friends <span aria-label="smile cat" class="emoji emoji-1f638" role="img" title="smile cat">:smile_cat:</span></p>



<a name="394896880"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/394896880" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#394896880">(Oct 04 2023 at 18:38)</a>:</h4>
<p>So I need to add LocalStack to the docker compose file?</p>



<a name="394896928"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/394896928" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#394896928">(Oct 04 2023 at 18:38)</a>:</h4>
<p>No - Testcontainers makes containers start from within the test class</p>



<a name="394896987"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/394896987" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#394896987">(Oct 04 2023 at 18:39)</a>:</h4>
<p>No edit of the compose file necessary - it's much more self-contained this way</p>



<a name="394897067"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/394897067" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#394897067">(Oct 04 2023 at 18:39)</a>:</h4>
<p>Remember <a href="https://github.com/IQSS/dataverse/blob/develop/src/test/java/edu/harvard/iq/dataverse/authorization/providers/oauth2/oidc/OIDCAuthenticationProviderFactoryIT.java">https://github.com/IQSS/dataverse/blob/develop/src/test/java/edu/harvard/iq/dataverse/authorization/providers/oauth2/oidc/OIDCAuthenticationProviderFactoryIT.java</a> ?</p>



<a name="394897175"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/394897175" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#394897175">(Oct 04 2023 at 18:40)</a>:</h4>
<p>It's basically the same thing</p>



<a name="394897223"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/394897223" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#394897223">(Oct 04 2023 at 18:40)</a>:</h4>
<p>There is a code example on the LocalStack TC docs page</p>



<a name="394897250"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/394897250" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#394897250">(Oct 04 2023 at 18:40)</a>:</h4>
<p>If you want, we can hack on this later</p>



<a name="394897280"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/394897280" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#394897280">(Oct 04 2023 at 18:40)</a>:</h4>
<p>(Meeting of DV Sustainability Group in 20)</p>



<a name="394897581"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/394897581" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#394897581">(Oct 04 2023 at 18:42)</a>:</h4>
<p>Ok, so something like this:</p>
<div class="codehilite"><pre><span></span><code>@Container
static KeycloakContainer keycloakContainer = new KeycloakContainer(&quot;quay.io/keycloak/keycloak:22.0&quot;)
</code></pre></div>



<a name="394902661"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/394902661" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#394902661">(Oct 04 2023 at 19:17)</a>:</h4>
<p>Ok, I picked it up.</p>



<a name="395861401"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/395861401" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#395861401">(Oct 10 2023 at 11:25)</a>:</h4>
<p><span class="user-mention" data-user-id="598112">@Philip Durbin</span> you might be interested in <a href="https://github.com/IQSS/dataverse/pull/9939/files#diff-7f214d6bbc0cb42b01ab03fb4b3d26fc18ca74c93e12ce998fbb7371f90f80ba">https://github.com/IQSS/dataverse/pull/9939/files#diff-7f214d6bbc0cb42b01ab03fb4b3d26fc18ca74c93e12ce998fbb7371f90f80ba</a> and/or <a href="https://github.com/IQSS/dataverse/pull/9939/files#diff-cec3a75a2f2de0e5eed7be824f8305ec3101ec2a86d4ebc4e4939ce51e315997">https://github.com/IQSS/dataverse/pull/9939/files#diff-cec3a75a2f2de0e5eed7be824f8305ec3101ec2a86d4ebc4e4939ce51e315997</a> for some more examples <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="395861525"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/395861525" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#395861525">(Oct 10 2023 at 11:26)</a>:</h4>
<p>Would it be in scope to refactor the <code>dataverse.files.&lt;id&gt;</code> thing for this? It would make writing these tests much easier...</p>



<a name="395864853"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/395864853" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#395864853">(Oct 10 2023 at 11:47)</a>:</h4>
<p>Thanks for the examples!</p>



<a name="395865051"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/395865051" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#395865051">(Oct 10 2023 at 11:48)</a>:</h4>
<p>I don't know what to say about the refactoring. I'm buried in HR paperwork again and we have a visitor all week (which I'm looking forward to). I haven't been able to work on S3 testing at all. <span aria-label="disappointed" class="emoji emoji-1f61e" role="img" title="disappointed">:disappointed:</span></p>



<a name="395866142"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/395866142" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#395866142">(Oct 10 2023 at 11:54)</a>:</h4>
<p>It's your first day of the week, so no worries. And you did cleanse out loads of stuff over the weekend! So much dust came off!</p>



<a name="395871564"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/395871564" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#395871564">(Oct 10 2023 at 12:24)</a>:</h4>
<p>In case it helps: there's also <a href="https://github.com/gaul/s3proxy">https://github.com/gaul/s3proxy</a> which might be interesting for testing (transient memory storage), but might also add support to drop more storage backends and rely on a different component to create a bridge between Dataverse -&gt; S3 -&gt; sth else</p>



<a name="395872134"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/395872134" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#395872134">(Oct 10 2023 at 12:27)</a>:</h4>
<p>If you are looking for sth. more lightweight not involving testcontainers, maybe <a href="https://github.com/findify/s3mock">https://github.com/findify/s3mock</a> would be worth a look</p>



<a name="396903562"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/396903562" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#396903562">(Oct 16 2023 at 13:30)</a>:</h4>
<p><a href="https://github.com/IQSS/dataverse/issues/6783">#6783</a> starts by talking about S3AccessIT, how we should add it to our Jenkins runs. But if we switch to S3 storage we won't be testing the filesystem anymore.</p>



<a name="396903577"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/396903577" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#396903577">(Oct 16 2023 at 13:30)</a>:</h4>
<p>Can we test both?</p>



<a name="396922999"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/396922999" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#396922999">(Oct 16 2023 at 15:02)</a>:</h4>
<p>Maybe. Should be doable.</p>



<a name="396923057"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/396923057" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#396923057">(Oct 16 2023 at 15:02)</a>:</h4>
<p>Might need API extension though</p>



<a name="396923116"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/396923116" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#396923116">(Oct 16 2023 at 15:03)</a>:</h4>
<p>But why only an e2e test?</p>



<a name="396923162"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/396923162" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#396923162">(Oct 16 2023 at 15:03)</a>:</h4>
<p>No UT/IT?</p>



<a name="396926238"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/396926238" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#396926238">(Oct 16 2023 at 15:18)</a>:</h4>
<p>Ha. Well, I thought I'd start with what we requested in the issue. I don't want to lose sight of that.</p>



<a name="396926306"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/396926306" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#396926306">(Oct 16 2023 at 15:19)</a>:</h4>
<p>But yes, integration tests too, if I can figure it out.</p>



<a name="396927717"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/396927717" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#396927717">(Oct 16 2023 at 15:25)</a>:</h4>
<p>But couldn't we just move that one test to a non e2e test?</p>



<a name="396927819"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/396927819" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#396927819">(Oct 16 2023 at 15:26)</a>:</h4>
<p>(Haven't looked yet)</p>



<a name="396928012"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/396928012" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#396928012">(Oct 16 2023 at 15:26)</a>:</h4>
<p>Wouldn't that safe the trouble of jumping through the E2E hoops with config and all?</p>



<a name="396928060"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/396928060" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#396928060">(Oct 16 2023 at 15:27)</a>:</h4>
<p>Here's a handy link: <a href="https://github.com/IQSS/dataverse/blob/v6.0/src/test/java/edu/harvard/iq/dataverse/api/S3AccessIT.java">https://github.com/IQSS/dataverse/blob/v6.0/src/test/java/edu/harvard/iq/dataverse/api/S3AccessIT.java</a></p>



<a name="396928533"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/396928533" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#396928533">(Oct 16 2023 at 15:29)</a>:</h4>
<p>I'm not sure how to move it. Happy to talk about it.</p>



<a name="396958226"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/396958226" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#396958226">(Oct 16 2023 at 18:46)</a>:</h4>
<p>To me this test looks like it's simply testing an upload and a deletion, making sure along the way the prefix is correct</p>



<a name="396958278"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/396958278" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#396958278">(Oct 16 2023 at 18:46)</a>:</h4>
<p>IMHO there is no need to have a full fledged deployment around for that...</p>



<a name="396965760"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/396965760" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#396965760">(Oct 16 2023 at 19:30)</a>:</h4>
<p>You saying that using Testcontainers we could create a dataset? Let me go look at the test you added.</p>



<a name="396967068"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/396967068" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#396967068">(Oct 16 2023 at 19:41)</a>:</h4>
<p>OIDCAuthenticationProviderFactoryIT, that is</p>



<a name="396967389"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/396967389" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#396967389">(Oct 16 2023 at 19:44)</a>:</h4>
<p>I could do a quiet, quick Zoom if it helps</p>



<a name="396967597"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/396967597" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#396967597">(Oct 16 2023 at 19:46)</a>:</h4>
<p>Sure! <a href="https://harvard.zoom.us/j/98729082963?pwd=OUVmWnFwSTlibS9wOWI0aTRZOW45dz09">https://harvard.zoom.us/j/98729082963?pwd=OUVmWnFwSTlibS9wOWI0aTRZOW45dz09</a></p>



<a name="396973613"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/396973613" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#396973613">(Oct 16 2023 at 20:35)</a>:</h4>
<p>That was fun hacking! Thanks for doing all the typing <span class="user-mention" data-user-id="598112">@Philip Durbin</span> <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="396973864"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/396973864" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#396973864">(Oct 16 2023 at 20:37)</a>:</h4>
<p>Ha! I'm the hands. You're the brain. It was fun!</p>



<a name="397164998"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397164998" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397164998">(Oct 17 2023 at 18:48)</a>:</h4>
<p>I'm sending "hello" into S3AccessIO and pulling it out again,  making sure it's still "hello". Code coverage of that class has jumped from 0% to 7.88%!</p>



<a name="397178646"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397178646" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397178646">(Oct 17 2023 at 20:34)</a>:</h4>
<p>Oh, wait. I'm not sure code coverage is being reported properly in Netbeans. <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="397178883"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397178883" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397178883">(Oct 17 2023 at 20:37)</a>:</h4>
<p>For OIDCAuthProvider it's only showing 1.01%. I don't think that's right.</p>



<a name="397179085"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397179085" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397179085">(Oct 17 2023 at 20:38)</a>:</h4>
<p>Ok, 67% when I look at <code>target/site/jacoco-integration-test-coverage-report/edu.harvard.iq.dataverse.authorization.providers.oauth2.oidc/OIDCAuthProvider.html</code>. Phew. <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="397183231"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397183231" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397183231">(Oct 17 2023 at 21:16)</a>:</h4>
<p>I wonder if there's a way to skip MOST tests except the one I'm working on. Something like this: <code>mvn verify -DskipTests=true -Dtest=S3AccessIOIT</code>.</p>



<a name="397183610"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397183610" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397183610">(Oct 17 2023 at 21:19)</a>:</h4>
<p>Ok, actually, this seems to work: <code>mvn verify -Dtest=S3AccessIOIT</code></p>



<a name="397185912"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397185912" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397185912">(Oct 17 2023 at 21:42)</a>:</h4>
<p>Hmm, I'm still seeing Keycloak output though, from the other test, I guess.</p>



<a name="397188711"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397188711" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397188711">(Oct 17 2023 at 22:08)</a>:</h4>
<p><a href="https://maven.apache.org/surefire/maven-failsafe-plugin/integration-test-mojo.html#test">https://maven.apache.org/surefire/maven-failsafe-plugin/integration-test-mojo.html#test</a></p>



<a name="397375499"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397375499" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397375499">(Oct 18 2023 at 19:57)</a>:</h4>
<p>Thanks, I'll circle back to excluding Keycloak when testing S3 but right now I'm trying to configure multiple stores. I must be doing it wrong.</p>



<a name="397375688"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397375688" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397375688">(Oct 18 2023 at 19:58)</a>:</h4>
<p>This what I have:</p>
<div class="codehilite"><pre><span></span><code>- dataverse_files_storage__driver__id=file-1
- dataverse_files_file-1_type=file
- dataverse_files_file-1_label=Filesystem
- dataverse_files_file-1_directory=${STORAGE_DIR}/store
- dataverse_files_s3-3reals3_type=s3
- dataverse_files_s3-3reals3_label=Real S3
- dataverse_files_s3-3reals3_custom__endpoint__url=s3.us-east-2.amazonaws.com
- dataverse_files_s3-3reals3_custom__endpoint__region=us-east-2
- dataverse_files_s3-3reals3_bucket__name=pdurbin
- dataverse_files_s3-3reals3_upload__redirect=true
- dataverse_files_s3-3reals3_access__key=REDACTED
- dataverse_files_s3-3reals3_secret__key=REDACTED
</code></pre></div>



<a name="397375728"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397375728" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397375728">(Oct 18 2023 at 19:59)</a>:</h4>
<p>I'm trying to have a default "file" store called "file-1".</p>



<a name="397375767"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397375767" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397375767">(Oct 18 2023 at 19:59)</a>:</h4>
<p>And an "s3" store called "s3-3reals3".</p>



<a name="397376059"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397376059" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397376059">(Oct 18 2023 at 20:01)</a>:</h4>
<p>(I plan to add two more s3 stores: "s3-1localstackdirect" and "s3-2localstackvanilla" or something. Similar to what I wrote about at <a href="https://github.com/GlobalDataverseCommunityConsortium/dataverse-ansible/issues/327">https://github.com/GlobalDataverseCommunityConsortium/dataverse-ansible/issues/327</a> )</p>



<a name="397376148"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397376148" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397376148">(Oct 18 2023 at 20:02)</a>:</h4>
<p>When I list the stores I only get the file-1 one:</p>
<div class="codehilite"><pre><span></span><code>{
    &quot;status&quot;: &quot;OK&quot;,
    &quot;data&quot;: {
        &quot;Filesystem&quot;: &quot;file-1&quot;
    }
}
</code></pre></div>



<a name="397376234"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397376234" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397376234">(Oct 18 2023 at 20:03)</a>:</h4>
<p><span class="user-mention" data-user-id="598183">@Oliver Bertuch</span> do you see anything obvious I'm missing?</p>



<a name="397376686"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397376686" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397376686">(Oct 18 2023 at 20:06)</a>:</h4>
<p>I've only ever configured a single store in containerized Dataverse. I'm not sure if it's supported.</p>



<a name="397454162"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397454162" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eryk Kulikowski <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397454162">(Oct 19 2023 at 08:17)</a>:</h4>
<p>I am testing with two stores: one s3 and one file store. I use JVM_ARGS in my docker-compose like this:</p>
<div class="codehilite"><pre><span></span><code>    environment:
      JVM_ARGS:
        -Ddataverse.timerServer=true
        -Xmx24g
        -Xms4g
        -XX:+HeapDumpOnOutOfMemoryError
        -XX:MaxMetaspaceSize=2g
        -XX:MetaspaceSize=256m
        -XX:+UseG1GC
        -XX:+UseStringDeduplication
        -XX:+DisableExplicitGC
        -Ddataverse.files.s3.upload-out-of-band=true
        -Ddataverse.api.allow-incomplete-metadata=true
        -Ddataverse.ui.allow-review-for-incomplete=false
        -Ddataverse.ui.show-validity-filter=true
        -Ddataverse.files.directory=/data
        -Ddataverse.files.uploads=/uploads
        -Ddataverse.files.s3.type=s3
        -Ddataverse.files.s3.label=s3
        -Ddataverse.files.s3.bucket-name=dataverse-local
        -Ddataverse.files.s3.download-redirect=true
        -Ddataverse.files.s3.upload-redirect=true
        -Ddataverse.files.s3.path-style-access=true
        -Ddataverse.files.s3.custom-endpoint-url=https://rdmo.icts.kuleuven.be
        -Ddataverse.files.s3.custom-endpoint-region=us-east-1
        -Ddataverse.files.s3.disable-tagging=true
        -Ddataverse.files.file.type=file
        -Ddataverse.files.file.label=file
        -Ddataverse.files.file.directory=/data
</code></pre></div>
<p>Notice the space on the end of each line (otherwise it will not work).<br>
This is the output from listing the storage:</p>
<div class="codehilite"><pre><span></span><code>{
   &quot;status&quot;: &quot;OK&quot;,
   &quot;data&quot;:    {
      &quot;s3&quot;: &quot;s3&quot;,
      &quot;file&quot;: &quot;file&quot;
   }
}
</code></pre></div>



<a name="397455011"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397455011" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eryk Kulikowski <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397455011">(Oct 19 2023 at 08:22)</a>:</h4>
<p>It looks like Zulip strips the spaces, but there is space at the end of each line, before the end-of-line character, it functions as a separator for the jvm args.</p>



<a name="397455710"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397455710" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eryk Kulikowski <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397455710">(Oct 19 2023 at 08:27)</a>:</h4>
<p>I also mount the aws secrets and config like this:</p>
<div class="codehilite"><pre><span></span><code>    volumes:
      - /path/to/aws/config/.aws:/opt/payara/.aws
      -...
</code></pre></div>



<a name="397459865"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397459865" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eryk Kulikowski <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397459865">(Oct 19 2023 at 08:51)</a>:</h4>
<p>If you are interested, this is my entire image description:</p>
<div class="codehilite" data-code-language="YAML"><pre><span></span><code><span class="w">  </span><span class="nt">dataverse</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${DATAVERSE_IMAGE_TAG}</span>
<span class="w">    </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dataverse</span>
<span class="w">    </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">payara</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app_net</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db_net</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"7005:4848"</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"7008:8080"</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">TZ</span><span class="p">:</span><span class="w"> </span><span class="s">"Europe/Brussels"</span>
<span class="w">      </span><span class="nt">DATAVERSE_DB_HOST</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db</span>
<span class="w">      </span><span class="nt">DATAVERSE_DB_PORT</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5432</span>
<span class="w">      </span><span class="nt">DATAVERSE_DB_USER</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${DB_USER}</span>
<span class="w">      </span><span class="nt">DATAVERSE_DB_NAME</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${DB_NAME}</span>
<span class="w">      </span><span class="nt">ENABLE_JDWP</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">      </span><span class="nt">DATAVERSE_MAIL_HOST</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${MAIL_SERVICE_HOST}</span>
<span class="w">      </span><span class="nt">DATAVERSE_MAIL_FROM</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${MAIL_SENDER}</span>
<span class="w">      </span><span class="nt">dataverse_fqdn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${FQDN}</span>
<span class="w">      </span><span class="nt">dataverse_siteUrl</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${DATAVERSE_URL}</span>
<span class="w">      </span><span class="nt">dataverse_files_storage__driver__id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${DRIVER_ID}</span>
<span class="w">      </span><span class="nt">db_SystemEmail</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${MAIL_SENDER_NAME}</span>
<span class="w">      </span><span class="nt">CUSTOM_INSTALL</span><span class="p">:</span><span class="w"> </span><span class="s">"/opt/payara/custominstall"</span>
<span class="w">      </span><span class="nt">API_DEBUG</span><span class="p">:</span><span class="w"> </span><span class="s">"false"</span>
<span class="w">      </span><span class="nt">LANG_DIR</span><span class="p">:</span><span class="w"> </span><span class="s">"/languages"</span>
<span class="w">      </span><span class="nt">STORAGE_DIR</span><span class="p">:</span><span class="w"> </span><span class="s">"/data"</span>
<span class="w">      </span><span class="nt">SECRETS_DIR</span><span class="p">:</span><span class="w"> </span><span class="s">"/run/secrets"</span>
<span class="w">      </span><span class="nt">DUMPS_DIR</span><span class="p">:</span><span class="w"> </span><span class="s">"/dumps"</span>
<span class="w">      </span><span class="nt">UPLOAD_DIR</span><span class="p">:</span><span class="w"> </span><span class="s">"/uploads"</span>
<span class="w">      </span><span class="nt">MP_CONFIG_PROFILE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${RDM_STAGE}</span>
<span class="w">      </span><span class="nt">JVM_ARGS</span><span class="p">:</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">-Ddataverse.timerServer=true</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">-Xmx24g</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">-Xms4g</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">-XX:+HeapDumpOnOutOfMemoryError</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">-XX:MaxMetaspaceSize=2g</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">-XX:MetaspaceSize=256m</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">-XX:+UseG1GC</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">-XX:+UseStringDeduplication</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">-XX:+DisableExplicitGC</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">-Ddataverse.files.s3.upload-out-of-band=true</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">-Ddataverse.api.allow-incomplete-metadata=true</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">-Ddataverse.ui.allow-review-for-incomplete=false</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">-Ddataverse.ui.show-validity-filter=true</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">-Ddataverse.files.directory=/data</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">-Ddataverse.files.uploads=/uploads</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">-Ddataverse.files.s3.type=s3</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">-Ddataverse.files.s3.label=s3</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">-Ddataverse.files.s3.bucket-name=dataverse-local</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">-Ddataverse.files.s3.download-redirect=true</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">-Ddataverse.files.s3.upload-redirect=true</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">-Ddataverse.files.s3.path-style-access=true</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">-Ddataverse.files.s3.custom-endpoint-url=https://rdmo.icts.kuleuven.be</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">-Ddataverse.files.s3.custom-endpoint-region=us-east-1</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">-Ddataverse.files.s3.disable-tagging=true</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">-Ddataverse.files.file.type=file</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">-Ddataverse.files.file.label=file</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">-Ddataverse.files.file.directory=/data</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">-Ddataverse.solr.host=solr</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">-Ddataverse.mail.cc-support-on-contact-email=rdr@kuleuven.be</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/localtime:/etc/localtime:ro</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./config/dataverse:/opt/payara/custominstall</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./config/dataverse/set_language.sh:/opt/payara/scripts/init.d/set_language.sh</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./config/dataverse/change-admin-password.sh:/opt/payara/scripts/init.d/change-admin-password.sh</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${DV_FILES}:/data</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${DV_DUMPS}:/dumps</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${DV_UPLOADS}:/uploads</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${DV_LANG_DIR}:/languages</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${DOCROOT}:/opt/payara/appserver/glassfish/domains/domain1/docroot</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${SECRETS}:/run/secrets</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${SECRETS}/microprofile:/secrets</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${DV_PATH}/aws:/opt/payara/.aws</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">proxy</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">index</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
<span class="w">    </span><span class="nt">privileged</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</code></pre></div>
<p>I use a standard image built with maven. I think that the interesting script is the one that changes the admin password (you see it mounted in volumes):</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="ch">#!/usr/bin/env bash</span>

<span class="c1"># Check and load secrets</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-s<span class="w"> </span><span class="s2">"</span><span class="si">${</span><span class="nv">SECRETS_DIR</span><span class="si">}</span><span class="s2">/admin/password"</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">"No admin password present. Failing."</span>
<span class="w">  </span><span class="nb">exit</span><span class="w"> </span><span class="m">126</span>
<span class="k">fi</span>
<span class="nv">ADMIN_PASSWORD</span><span class="o">=</span><span class="k">$(</span>cat<span class="w"> </span><span class="s2">"</span><span class="si">${</span><span class="nv">SECRETS_DIR</span><span class="si">}</span><span class="s2">/admin/password"</span><span class="k">)</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">"AS_ADMIN_PASSWORD=admin"</span><span class="w"> </span>&gt;<span class="w"> </span>/tmp/password-change-file.txt
<span class="nb">echo</span><span class="w"> </span><span class="s2">"AS_ADMIN_NEWPASSWORD=</span><span class="si">${</span><span class="nv">ADMIN_PASSWORD</span><span class="si">}</span><span class="s2">"</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/tmp/password-change-file.txt
<span class="nb">echo</span><span class="w"> </span><span class="s2">"AS_ADMIN_PASSWORD=</span><span class="si">${</span><span class="nv">ADMIN_PASSWORD</span><span class="si">}</span><span class="s2">"</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="si">${</span><span class="nv">PASSWORD_FILE</span><span class="si">}</span>
asadmin<span class="w"> </span>--user<span class="o">=</span><span class="si">${</span><span class="nv">ADMIN_USER</span><span class="si">}</span><span class="w"> </span>--passwordfile<span class="o">=</span>/tmp/password-change-file.txt<span class="w"> </span>change-admin-password<span class="w"> </span>--domain_name<span class="o">=</span><span class="si">${</span><span class="nv">DOMAIN_NAME</span><span class="si">}</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">true</span>
rm<span class="w"> </span>/tmp/password-change-file.txt
</code></pre></div>



<a name="397481973"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397481973" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397481973">(Oct 19 2023 at 11:08)</a>:</h4>
<p><span class="user-mention" data-user-id="614964">@Eryk Kulikowski</span> that actually works?!? JVM_ARGS?!? <span class="user-mention" data-user-id="598183">@Oliver Bertuch</span> have you seen this?</p>



<a name="397482050"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397482050" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397482050">(Oct 19 2023 at 11:08)</a>:</h4>
<p><span class="user-mention" data-user-id="614964">@Eryk Kulikowski</span> what is the value of ${DATAVERSE_IMAGE_TAG} please?</p>



<a name="397492051"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397492051" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eryk Kulikowski <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397492051">(Oct 19 2023 at 12:10)</a>:</h4>
<p>It works, you can pass any JVM/microprofile settings like this, just remember to add a space ( " ") after each argument. Otherwise, it will be sticking together. You can check if it worked in your server log when using it:</p>
<div class="codehilite"><pre><span></span><code>[Entrypoint] running /opt/payara/scripts/startInForeground.sh in foreground
Executing Payara Server with the following command line:
/opt/java/openjdk/bin/java
-cp
/opt/payara/appserver/glassfish/domains/domain1/lib/ext/*:/opt/payara/appserver/glassfish/modules/glassfish.jar
-Ddataverse.timerServer=true
-Xmx24g
-Xms4g
-XX:+HeapDumpOnOutOfMemoryError
-XX:MaxMetaspaceSize=2g
-XX:MetaspaceSize=256m
-XX:+UseG1GC
-XX:+UseStringDeduplication
-XX:+DisableExplicitGC
-Ddataverse.files.s3.upload-out-of-band=true
-Ddataverse.api.allow-incomplete-metadata=true
-Ddataverse.ui.allow-review-for-incomplete=false
-Ddataverse.ui.show-validity-filter=true
-Ddataverse.files.directory=/data
-Ddataverse.files.uploads=/uploads
-Ddataverse.files.s3.type=s3
-Ddataverse.files.s3.label=s3
-Ddataverse.files.s3.bucket-name=dataverse-local
-Ddataverse.files.s3.download-redirect=true
-Ddataverse.files.s3.upload-redirect=true
-Ddataverse.files.s3.path-style-access=true
-Ddataverse.files.s3.custom-endpoint-url=https://rdmo.icts.kuleuven.be
-Ddataverse.files.s3.custom-endpoint-region=us-east-1
-Ddataverse.files.s3.disable-tagging=true
-Ddataverse.files.file.type=file
-Ddataverse.files.file.label=file
-Ddataverse.files.file.directory=/data
-Ddataverse.solr.host=solr
-Ddataverse.mail.cc-support-on-contact-email=rdr@kuleuven.be
-Ddataverse.lang.directory=/languages

-XX:+UnlockDiagnosticVMOptions
...
-Dfelix.fileinstall.bundles.startTransient=true

-Dcom.sun.enterprise.config.config_environment_factory_class=com.sun.enterprise.config.serverbeans.AppserverConfigEnvironmentFactory
...
-Djava.library.path=/opt/payara/appserver/glassfish/lib:/usr/java/packages/lib:/usr/lib64:/lib64:/lib:/usr/lib
com.sun.enterprise.glassfish.bootstrap.ASMain
/opt/payara/config/pre-boot-commands.asadmin
-upgrade
false
-read-stdin
true
-postbootcommandfile
/opt/payara/config/post-boot-commands.asadmin
-domainname
domain1
-domaindir
/opt/payara/appserver/glassfish/domains/domain1
-asadmin-args
--host,,,localhost,,,--port,,,4848,,,--user,,,admin,,,--passwordfile,,,/opt/payara/passwordFile,,,--secure=false,,,--terse=false,,,--extraterse=false,,,--echo=false,,,--interactive=false,,,--autoname=false,,,start-domain,,,--verbose=false,,,--watchdog=false,,,--debug=false,,,--domaindir,,,/opt/payara/appserver/glassfish/domains,,,domain1
-instancename
server
-type
DAS
-verbose
false
-asadmin-classpath
/opt/payara/appserver/glassfish/lib/client/appserver-cli.jar
-debug
false
-asadmin-classname
com.sun.enterprise.admin.cli.AdminMain
-watchdog
false

Launching Payara Server on Felix platform
Oct 18, 2023 2:02:14 PM com.sun.enterprise.glassfish.bootstrap.osgi.BundleProvisioner createBundleProvisioner
INFO: Create bundle provisioner class = class com.sun.enterprise.glassfish.bootstrap.osgi.BundleProvisioner.
Registered com.sun.enterprise.glassfish.bootstrap.osgi.EmbeddedOSGiGlassFishRuntime@7c581736 in service registry.
Reading in commandments from /opt/payara/config/pre-boot-commands.asadmin
</code></pre></div>



<a name="397493097"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397493097" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eryk Kulikowski <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397493097">(Oct 19 2023 at 12:17)</a>:</h4>
<p><span class="user-mention" data-user-id="598112">@Philip Durbin</span> <br>
We use our own LIBIS registry for docker images. We build them with rdm-build <a href="https://github.com/libis/rdm-build">https://github.com/libis/rdm-build</a><br>
Check this script <a href="https://github.com/libis/rdm-build/blob/main/images/dataverse/build_dv.sh">https://github.com/libis/rdm-build/blob/main/images/dataverse/build_dv.sh</a><br>
It uses env variables from here: <a href="https://github.com/libis/rdm-build/blob/main/env.dev">https://github.com/libis/rdm-build/blob/main/env.dev</a><br>
Resulting image tag is: <a href="http://docker.io/rdm/dataverse-stock:1.5">docker.io/rdm/dataverse-stock:1.5</a><br>
I add ruby to that in <a href="https://github.com/libis/rdm-build/blob/main/images/dataverse/Dockerfile">https://github.com/libis/rdm-build/blob/main/images/dataverse/Dockerfile</a><br>
The final image tag is <a href="http://docker.io/rdm/dataverse:1.5">docker.io/rdm/dataverse:1.5</a><br>
Where <a href="http://docker.io">docker.io</a> becomes our own LIBIS registry when building for production (STAGE=prod).<br>
This particular image is still in test, not yet in pilot or production.</p>



<a name="397493725"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397493725" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eryk Kulikowski <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397493725">(Oct 19 2023 at 12:21)</a>:</h4>
<p>My specific branch build script: <a href="https://github.com/libis/rdm-build/blob/main/images/dataverse/build_dev_dv.sh">https://github.com/libis/rdm-build/blob/main/images/dataverse/build_dev_dv.sh</a><br>
The other one uses the tagged version it checks out (notice that you download specific maven and java in the script, but it uses your default maven registry): <a href="https://github.com/libis/rdm-build/blob/main/images/dataverse/build_dv.sh">https://github.com/libis/rdm-build/blob/main/images/dataverse/build_dv.sh</a></p>



<a name="397495116"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397495116" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397495116">(Oct 19 2023 at 12:29)</a>:</h4>
<p><span class="user-mention" data-user-id="614964">@Eryk Kulikowski</span> what are you doing in an hour? Would you like to join the Containerization Working Group meeting? <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span> <a href="https://ct.gdcc.io">https://ct.gdcc.io</a></p>



<a name="397495763"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397495763" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397495763">(Oct 19 2023 at 12:32)</a>:</h4>
<p>As a compose file is YAML, you might try using <code>JVM_ARG: &gt;</code>. See also <a href="https://yaml.org/spec/1.2.2/#line-folding">https://yaml.org/spec/1.2.2/#line-folding</a></p>



<a name="397495814"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397495814" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397495814">(Oct 19 2023 at 12:33)</a>:</h4>
<p>(So you should not need to pay attention about the spaces at the end)</p>



<a name="397496710"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397496710" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397496710">(Oct 19 2023 at 12:38)</a>:</h4>
<p><span class="user-mention" data-user-id="614964">@Eryk Kulikowski</span> I'm glad to see you are basing your work on the WG outputs! Glad it's being reused. Looks like we made it customizable enough.</p>



<a name="397497051"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397497051" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397497051">(Oct 19 2023 at 12:41)</a>:</h4>
<p>FWIW <span class="user-mention" data-user-id="614964">@Eryk Kulikowski</span>, using <code>Xmx</code>, <code>Xms</code> etc in a container context is not considered good practice. Did you see the env vars for memory management in the tunables table? <a href="http://preview.guides.gdcc.io/en/develop/container/base-image.html#tunables">http://preview.guides.gdcc.io/en/develop/container/base-image.html#tunables</a> You can easily asign the 24g of RAM defining the container limits in the compose definition, by default 70% of that will be allocated as heap.</p>



<a name="397498836"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397498836" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eryk Kulikowski <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397498836">(Oct 19 2023 at 12:50)</a>:</h4>
<p><span class="user-mention" data-user-id="598183">@Oliver Bertuch</span>  Thanks! I will check it out!</p>



<a name="397523399"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397523399" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Don Sizemore <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397523399">(Oct 19 2023 at 14:56)</a>:</h4>
<p><span class="user-mention" data-user-id="598112">@Philip Durbin</span> where I'm at: I have the basics in place, but next to read in both buckets' settings and tell Ansible to provision them within the container: <a href="https://github.com/GlobalDataverseCommunityConsortium/dataverse-ansible/blob/327_multiple_s3_stores/tests/group_vars/jenkins.yml#L336">https://github.com/GlobalDataverseCommunityConsortium/dataverse-ansible/blob/327_multiple_s3_stores/tests/group_vars/jenkins.yml#L336</a><br>
One of my questions was whether you want want the S3 testing to provision said LocalStack buckets, but that would break testing on S3 proper. Any further direction/thoughts from you and/or <span class="user-mention" data-user-id="598183">@Oliver Bertuch</span> at this point most welcome.</p>



<a name="397537544"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397537544" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397537544">(Oct 19 2023 at 16:12)</a>:</h4>
<p><span class="user-mention" data-user-id="626369">@Don Sizemore</span> hmm, would it be a permanent break on testing S3 proper? Or more that if we someday want to test both S3 and LocalStack that we'd need to do further refactoring on the Ansible side?</p>



<a name="397537690"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397537690" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397537690">(Oct 19 2023 at 16:12)</a>:</h4>
<p><span class="user-mention" data-user-id="598843">@Deirdre Kirmis</span> if your ears were burning a couple hours ago, we were trying to remember what flavor of S3 you use. Something on Dell, I think.</p>



<a name="397539785"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397539785" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Deirdre Kirmis <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397539785">(Oct 19 2023 at 16:26)</a>:</h4>
<p>we use aws s3 .. we tried for about a year to use Dell Isilon S3 for one of our stores but never got it working =)</p>



<a name="397539859"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397539859" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397539859">(Oct 19 2023 at 16:27)</a>:</h4>
<p>Oh. Bummer!</p>



<a name="397539911"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397539911" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397539911">(Oct 19 2023 at 16:28)</a>:</h4>
<p><span class="user-mention silent" data-user-id="598843">Deirdre Kirmis</span> <a href="#narrow/stream/375812-containers/topic/testing.20S3/near/397539785">said</a>:</p>
<blockquote>
<p>we use aws s3 .. we tried for about a year to use Dell Isilon S3 for one of our stores but never got it working =)</p>
</blockquote>
<p>Have you ever tried to front the Isilon with Minio? I will probably do sth like that with our internal S3 to enable direct up/download. <a href="https://min.io/docs/minio/linux/administration/object-management/transition-objects-to-s3.html">https://min.io/docs/minio/linux/administration/object-management/transition-objects-to-s3.html</a></p>



<a name="397539964"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397539964" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Deirdre Kirmis <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397539964">(Oct 19 2023 at 16:28)</a>:</h4>
<p>i think there is actually a fix to dataverse now (it was a bug in apache on the isilon server) .. but we decided to go all in on aws</p>



<a name="397540026"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397540026" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Deirdre Kirmis <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397540026">(Oct 19 2023 at 16:28)</a>:</h4>
<p>i did try fronting it with  minio .. i need to look back at my notes to see how that went .. i think i ran into some problems there too</p>



<a name="397540047"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397540047" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Deirdre Kirmis <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397540047">(Oct 19 2023 at 16:29)</a>:</h4>
<p>but i also don't exactly always know what i'm doing <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>



<a name="397540200"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397540200" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Bertuch <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397540200">(Oct 19 2023 at 16:30)</a>:</h4>
<p>Welcome to the club, here's your  member id <span aria-label="identification card" class="emoji emoji-1faaa" role="img" title="identification card">:identification_card:</span> <span aria-label="see no evil" class="emoji emoji-1f648" role="img" title="see no evil">:see_no_evil:</span></p>



<a name="397540252"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397540252" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Deirdre Kirmis <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397540252">(Oct 19 2023 at 16:30)</a>:</h4>
<p><span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> always fun to test things out!</p>



<a name="397545238"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397545238" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Don Sizemore <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397545238">(Oct 19 2023 at 17:06)</a>:</h4>
<p><span class="user-mention" data-user-id="598112">@Philip Durbin</span> Ansible can create and configure the buckets in LocalStack, but if for some/any reason Dataverse wanted to, it could? I don't think you want this to be the case, but just checking.</p>



<a name="397552233"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397552233" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397552233">(Oct 19 2023 at 17:57)</a>:</h4>
<p><span class="user-mention" data-user-id="626369">@Don Sizemore</span> I think I'm a little slow today but I think we're on the same page. All good. <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>



<a name="397562559"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397562559" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397562559">(Oct 19 2023 at 19:09)</a>:</h4>
<p>After today's meeting I was all excited to try the magic trick with store names that don't have dashes in them.</p>



<a name="397562573"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397562573" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397562573">(Oct 19 2023 at 19:09)</a>:</h4>
<p>I tried this:</p>
<div class="codehilite"><pre><span></span><code>- dataverse_files_storage__driver__id=file1
- dataverse_files_file1_type=file
- dataverse_files_file1_label=Filesystem
- dataverse_files_file1_directory=${STORAGE_DIR}/store
- dataverse_files_s3c_type=s3
- dataverse_files_s3c_label=Real S3
- dataverse_files_s3c_custom__endpoint__url=s3.us-east-2.amazonaws.com
- dataverse_files_s3c_custom__endpoint__region=us-east-2
- dataverse_files_s3c_bucket__name=pdurbin
- dataverse_files_s3c_upload__redirect=true
- dataverse_files_s3c_access__key=REDACTED
- dataverse_files_s3c_secret__key=REDACTED
</code></pre></div>



<a name="397562645"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397562645" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397562645">(Oct 19 2023 at 19:10)</a>:</h4>
<p>However, when I list the stores, I still only see the one:</p>
<div class="codehilite"><pre><span></span><code>{
    &quot;status&quot;: &quot;OK&quot;,
    &quot;data&quot;: {
        &quot;Filesystem&quot;: &quot;file1&quot;
    }
}
</code></pre></div>



<a name="397562684"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397562684" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397562684">(Oct 19 2023 at 19:10)</a>:</h4>
<p><span class="user-mention" data-user-id="598183">@Oliver Bertuch</span> ^^</p>



<a name="397562723"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397562723" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397562723">(Oct 19 2023 at 19:10)</a>:</h4>
<p>I guess I'll try JVM_ARGS next.</p>



<a name="397566321"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397566321" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397566321">(Oct 19 2023 at 19:38)</a>:</h4>
<div class="codehilite"><pre><span></span><code>[ERROR] Failed to execute goal io.fabric8:docker-maven-plugin:0.43.4:run (default-cli) on project dataverse: Execution default-cli of goal io.fabric8:docker-maven-plugin:0.43.4:run failed: while scanning a simple key
[ERROR]  in &#39;reader&#39;, line 23, column 9:
[ERROR]             -Ddataverse.files.storage-driver ...
[ERROR]             ^
[ERROR] could not find expected &#39;:&#39;
[ERROR]  in &#39;reader&#39;, line 24, column 9:
[ERROR]             -Ddataverse.files.file1.type=file
[ERROR]             ^
</code></pre></div>



<a name="397566426"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397566426" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397566426">(Oct 19 2023 at 19:39)</a>:</h4>
<p>... when using this file:</p>
<p><a href="/user_uploads/53090/4VMU3UaDhBQBKTJyWwZUCGfh/docker-compose-dev.yml">docker-compose-dev.yml</a></p>



<a name="397572543"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397572543" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397572543">(Oct 19 2023 at 20:26)</a>:</h4>
<p>From <a href="https://www.yamllint.com">https://www.yamllint.com</a></p>
<p><a href="/user_uploads/53090/LV9J05dED8upjX05z2crma6h/Screenshot-2023-10-19-at-4.25.49-PM.png">Screenshot-2023-10-19-at-4.25.49-PM.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/53090/LV9J05dED8upjX05z2crma6h/Screenshot-2023-10-19-at-4.25.49-PM.png" title="Screenshot-2023-10-19-at-4.25.49-PM.png"><img src="/user_uploads/53090/LV9J05dED8upjX05z2crma6h/Screenshot-2023-10-19-at-4.25.49-PM.png"></a></div>



<a name="397573417"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397573417" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397573417">(Oct 19 2023 at 20:33)</a>:</h4>
<p>Ah ha! I think (I hope) I got it.</p>



<a name="397573660"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397573660" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397573660">(Oct 19 2023 at 20:35)</a>:</h4>
<p>Nope. <span aria-label="very angry" class="emoji emoji-1f621" role="img" title="very angry">:very_angry:</span></p>



<a name="397576752"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397576752" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397576752">(Oct 19 2023 at 21:00)</a>:</h4>
<p>Weird! I sort of got it working?!? But I have three stores when I expected two:</p>
<div class="codehilite"><pre><span></span><code>{
    &quot;status&quot;: &quot;OK&quot;,
    &quot;data&quot;: {
        &quot;RealS3&quot;: &quot;s3c&quot;,
        &quot;Local&quot;: &quot;local&quot;,
        &quot;Filesystem&quot;: &quot;file1&quot;
    }
}
</code></pre></div>



<a name="397576845"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397576845" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397576845">(Oct 19 2023 at 21:00)</a>:</h4>
<p>Here's my file:</p>
<p><a href="/user_uploads/53090/VbH856MoKh8j12oW4tuTcQdZ/docker-compose-dev.yml">docker-compose-dev.yml</a></p>



<a name="397577432"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/397577432" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#397577432">(Oct 19 2023 at 21:06)</a>:</h4>
<p>file1 and s3c I expect. I'm not sure where local is coming from. <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="398148321"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/398148321" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#398148321">(Oct 23 2023 at 20:04)</a>:</h4>
<p>Just capturing some commands and output that <span class="user-mention" data-user-id="626369">@Don Sizemore</span> helped me figure out to prove to myself that we can upload a test file from the Dataverse/Payara container to the Localstack container:</p>
<div class="codehilite"><pre><span></span><code>payara@dataverse:~$ echo -e &#39;[default]\nregion = us-east-2&#39; &gt; ~/.aws/config
payara@dataverse:~$ cat ~/.aws/config
[default]
region = us-east-2
payara@dataverse:~$ echo -e &#39;[default]\naws_access_key_id = default\naws_secret_access_key = default&#39; &gt; ~/.aws/credentials
payara@dataverse:~$ cat ~/.aws/credentials
[default]
aws_access_key_id = default
aws_secret_access_key = default
payara@dataverse:~$
payara@dataverse:~$ aws --endpoint-url=http://localstack:4566 s3 ls
2023-10-23 18:02:38 mybucket
payara@dataverse:~$
payara@dataverse:~$ echo foo &gt; test.txt
payara@dataverse:~$ cat test.txt
foo
payara@dataverse:~$ aws --endpoint-url=http://localstack:4566 s3 cp test.txt s3://mybucket/
upload: ./test.txt to s3://mybucket/test.txt
payara@dataverse:~$ aws --endpoint-url=http://localstack:4566 s3 ls s3://mybucket/
2023-10-23 18:13:23          4 test.txt
payara@dataverse:~$
</code></pre></div>



<a name="398148467"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/398148467" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#398148467">(Oct 23 2023 at 20:06)</a>:</h4>
<p>But we still can't upload files from Dataverse itself to LocalStack. Here's the config I'm using:</p>
<div class="codehilite"><pre><span></span><code>-Ddataverse.files.localstack1.type=s3
-Ddataverse.files.localstack1.label=LocalStack
-Ddataverse.files.localstack1.custom-endpoint-url=http://localstack:4566
-Ddataverse.files.localstack1.custom-endpoint-region=us-east-2
-Ddataverse.files.localstack1.bucket-name=mybucket
-Ddataverse.files.localstack1.upload-redirect=false
-Ddataverse.files.localstack1.access-key=default
-Ddataverse.files.localstack1.secret-key=default
</code></pre></div>



<a name="398148493"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/398148493" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#398148493">(Oct 23 2023 at 20:06)</a>:</h4>
<p><span class="user-mention" data-user-id="598183">@Oliver Bertuch</span> any ideas for me? I think I might try MinIO instead.</p>



<a name="398157872"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/398157872" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#398157872">(Oct 23 2023 at 21:20)</a>:</h4>
<p>Ah ha! For Minio, at least, I needed this:</p>
<div class="codehilite"><pre><span></span><code>-Ddataverse.files.minio1.path-style-access=true
</code></pre></div>



<a name="398157893"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/398157893" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#398157893">(Oct 23 2023 at 21:20)</a>:</h4>
<p>As mentioned in our docs: <a href="https://guides.dataverse.org/en/6.0/installation/config.html#reported-working-s3-compatible-storage">https://guides.dataverse.org/en/6.0/installation/config.html#reported-working-s3-compatible-storage</a></p>



<a name="398340496"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/398340496" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#398340496">(Oct 24 2023 at 18:28)</a>:</h4>
<p><span class="user-mention" data-user-id="626369">@Don Sizemore</span> please remind me, do you have a preference for LocalStack or MinIO? I'm certainly happy to see if the trick above works with LocalStack.</p>



<a name="398344636"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/398344636" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Don Sizemore <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#398344636">(Oct 24 2023 at 18:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="598112">Philip Durbin</span> <a href="#narrow/stream/375812-containers/topic/testing.20S3/near/398340496">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="626369">Don Sizemore</span> please remind me, do you have a preference for LocalStack or MinIO? I'm certainly happy to see if the trick above works with LocalStack.</p>
</blockquote>
<p>I really don't. LocalStack sounds better for testing overall; MinIO sounds better for sites like ASU who use Dell MinIO. Also because I have to keep correcting myself when I type Minion.</p>



<a name="398345250"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/398345250" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#398345250">(Oct 24 2023 at 19:03)</a>:</h4>
<p>Well, the <code>path-style-access=true</code> trick does seem to work for LocalStack.</p>



<a name="398361854"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/398361854" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#398361854">(Oct 24 2023 at 21:16)</a>:</h4>
<p>I'm testing both.</p>



<a name="398493181"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/398493181" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#398493181">(Oct 25 2023 at 14:06)</a>:</h4>
<p>LocalStack is finickier about bucket creation. I've only had luck creating the bucket with <code>awslocal s3 mb s3://mybucket</code> (rather than Java).</p>



<a name="398509024"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/398509024" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#398509024">(Oct 25 2023 at 15:18)</a>:</h4>
<p>I made a draft pull request! add S3 tests, LocalStack, MinIO <a href="https://github.com/IQSS/dataverse/issues/6783">#6783</a> <a href="https://github.com/IQSS/dataverse/issues/10044">#10044</a></p>



<a name="398509905"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/398509905" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#398509905">(Oct 25 2023 at 15:21)</a>:</h4>
<p>Feedback very welcome, of course!</p>



<a name="398852639"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/398852639" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Guido Schmutz <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#398852639">(Oct 27 2023 at 08:41)</a>:</h4>
<p><span class="user-mention" data-user-id="598112">@Philip Durbin</span> sorry a bit late, as you have figured it out with the S3 properties. </p>
<p>I have used the following way to specify the properties (just as environment variables on the container):</p>
<div class="codehilite"><pre><span></span><code>  dataverse:
    image: gdcc/dataverse:unstable
    container_name: dataverse
    hostname: dataverse
    user: payara
    labels:
      com.platys.name: dataverse
      com.platys.webui.title: Dataverse UI
      com.platys.webui.url: http://dataplatform:28294
      com.platys.restapi.title: Dataverse UI
      com.platys.restapi.url: http://dataplatform:28294/api/info/metrics/dataverses
    ports:
      - 28294:8080
      - 4848:4848
      - 9009:9009   # JDWP
      - 8686:8686   # JMX
    environment:
      - DATAVERSE_FQDN=${PUBLIC_IP}
      - _CT_DATAVERSE_SITEURL=http://${PUBLIC_IP}:28294
      - DATAVERSE_DB_HOST=dataverse-postgresql
      - DATAVERSE_DB_USER=dataverse
      - DATAVERSE_DB_PASSWORD=abc123!
      - DATAVERSE_MAIL_HOST=mailpit
      - DATAVERSE_MAIL_FROM=dataverse@localhost
      - _CT_DATAVERSE_SOLR_HOST=dataverse-solr
      - DATAVERSE_SOLR_PORT=8983
      - ENABLE_JMX=0
      - ENABLE_RELOAD=0
      - ENABLE_JDWP=1
      - dataverse_files_s3_type=s3
      - dataverse_files_s3_label=&quot;Object Storage&quot;
      - dataverse_files_s3_bucket__name=&quot;dataverse-bucket&quot;
      - dataverse_files_s3_custom__endpoint__url=http://${EADP_IP}:9000
      - dataverse_files_s3_custom__endpoint__region=&#39;us-east-1&#39;
      - dataverse_files_s3_path__style__access=True
      - dataverse_files_s3_access__key=${PLATYS_AWS_ACCESS_KEY:?PLATYS_AWS_ACCESS_KEY must be set either in .env or as an environment variable}
      - dataverse_files_s3_secret__key=${PLATYS_AWS_SECRET_ACCESS_KEY:?PLATYS_AWS_SECRET_ACCESS_KEY must be set either in .env or as an environment variable}
</code></pre></div>



<a name="398880097"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/398880097" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#398880097">(Oct 27 2023 at 11:32)</a>:</h4>
<p><span class="user-mention" data-user-id="656972">@Guido Schmutz</span> right, I'm able to configure a single file store like that, with environment variables, but when I tried to configure multiple stores, it didn't work. If you get a chance to try this, please let me know! Otherwise, I'll wait for a fix for <a href="https://github.com/IQSS/dataverse/issues/9998">#9998</a>.</p>



<a name="398893831"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/398893831" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Guido Schmutz <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#398893831">(Oct 27 2023 at 12:57)</a>:</h4>
<p>ok, I see, you configure multiple stores, challenge accepted ;-)  ... took me a while to figure it out, but now it works </p>
<div class="codehilite"><pre><span></span><code>  dataverse:
    image: gdcc/dataverse:unstable
    container_name: dataverse
    hostname: dataverse
    user: payara
    labels:
      com.platys.name: dataverse
      com.platys.webui.title: Dataverse UI
      com.platys.webui.url: http://dataplatform:28294
      com.platys.restapi.title: Dataverse UI
      com.platys.restapi.url: http://dataplatform:28294/api/info/metrics/dataverses
    ports:
      - 28294:8080
      - 4848:4848
      - 9009:9009   # JDWP
      - 8686:8686   # JMX
    environment:
      - DATAVERSE_FQDN=${PUBLIC_IP}
      - _CT_DATAVERSE_SITEURL=http://${PUBLIC_IP}:28294
      - DATAVERSE_DB_HOST=dataverse-postgresql
      - DATAVERSE_DB_USER=dataverse
      - DATAVERSE_DB_PASSWORD=abc123!
      - DATAVERSE_MAIL_HOST=mailpit
      - DATAVERSE_MAIL_FROM=dataverse@localhost
      - _CT_DATAVERSE_SOLR_HOST=dataverse-solr
      - DATAVERSE_SOLR_PORT=8983
      - ENABLE_JMX=0
      - ENABLE_RELOAD=0
      - ENABLE_JDWP=1
      - dataverse_files_storage__driver__id=s3
      - dataverse_files_file1_type=file
      - dataverse_files_file1_label=&quot;Local Filesystem&quot;
      - dataverse_files_file1_directory=${STORAGE_DIR}/store
      - dataverse_files_s3_type=s3
      - dataverse_files_s3_label=&quot;Object Storage&quot;
      - dataverse_files_s3_bucket__name=&quot;dataverse-bucket&quot;
      - dataverse_files_s3_custom__endpoint__url=http://${EADP_IP}:9000
      - dataverse_files_s3_custom__endpoint__region=&#39;us-east-1&#39;
      - dataverse_files_s3_path__style__access=True
      - dataverse_files_s3_access__key=${PLATYS_AWS_ACCESS_KEY:?PLATYS_AWS_ACCESS_KEY must be set either in .env or as an environment variable}
      - dataverse_files_s3_secret__key=${PLATYS_AWS_SECRET_ACCESS_KEY:?PLATYS_AWS_SECRET_ACCESS_KEY must be set either in .env or as an environment variable}
    volumes:
      - ./data-transfer:/data-transfer
    restart: unless-stopped
</code></pre></div>
<div class="codehilite"><pre><span></span><code>$ curl -s -X GET -H &#39;X-Dataverse-key: REDACTED&#39; &#39;http://192.168.116.137:28294/api/admin/dataverse/storageDrivers&#39; | jq
{
  &quot;status&quot;: &quot;OK&quot;,
  &quot;data&quot;: {
    &quot;Object Storage&quot;: &quot;s3&quot;,
    &quot;Local Filesystem&quot;: &quot;file1&quot;
  }
}
</code></pre></div>
<p>Guess it was the space in the label (- dataverse_files_s3c_label=Real S3) in your case, which caused an error.</p>



<a name="398894054"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/398894054" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#398894054">(Oct 27 2023 at 12:59)</a>:</h4>
<p>Ah, right. I caught that later, the space problem, in the context of the JVM_ARGS. I'll try it again. Thanks!</p>



<a name="400733361"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/400733361" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#400733361">(Nov 07 2023 at 12:53)</a>:</h4>
<p>I set up S3 testing at <a href="https://github.com/gdcc/api-test-runner/actions/workflows/s3.yml">https://github.com/gdcc/api-test-runner/actions/workflows/s3.yml</a></p>



<a name="400733421"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/400733421" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#400733421">(Nov 07 2023 at 12:53)</a>:</h4>
<p>After some fiddling, it seems to work fine.</p>



<a name="400733656"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/400733656" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#400733656">(Nov 07 2023 at 12:54)</a>:</h4>
<p>So my thought is that once we merge <a href="https://github.com/IQSS/dataverse/issues/10044">#10044</a>, we'll copy the config I added over to the "develop" and "manual" jobs. (And eventually the "alpha" job, once we make a release.)</p>



<a name="400967531"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/400967531" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#400967531">(Nov 08 2023 at 15:27)</a>:</h4>
<p><span class="user-mention" data-user-id="626369">@Don Sizemore</span> heads up that I just added test for direct download (and non-direct download): <a href="https://github.com/IQSS/dataverse/pull/10044/commits/c2d8ae54a98b850f6ac9f94fa799b36bf8acaa6c">https://github.com/IQSS/dataverse/pull/10044/commits/c2d8ae54a98b850f6ac9f94fa799b36bf8acaa6c</a></p>



<a name="400967588"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/400967588" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#400967588">(Nov 08 2023 at 15:27)</a>:</h4>
<p>Here's the change I made on the API test runner side: <a href="https://github.com/gdcc/api-test-runner/commit/02c815908480e571d28d8d47ccbc4456979b377e">https://github.com/gdcc/api-test-runner/commit/02c815908480e571d28d8d47ccbc4456979b377e</a></p>



<a name="400967671"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/400967671" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#400967671">(Nov 08 2023 at 15:28)</a>:</h4>
<p>I just kicked off <a href="https://github.com/gdcc/api-test-runner/actions/runs/6800385363">https://github.com/gdcc/api-test-runner/actions/runs/6800385363</a> to test it.</p>



<a name="406087617"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/406087617" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Don Sizemore <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#406087617">(Dec 05 2023 at 15:51)</a>:</h4>
<p><span class="user-mention silent" data-user-id="598112">Philip Durbin</span> <a href="#narrow/stream/375812-containers/topic/testing.20S3/near/400967588">said</a>:</p>
<blockquote>
<p>Here's the change I made on the API test runner side: <a href="https://github.com/gdcc/api-test-runner/commit/02c815908480e571d28d8d47ccbc4456979b377e">https://github.com/gdcc/api-test-runner/commit/02c815908480e571d28d8d47ccbc4456979b377e</a></p>
</blockquote>
<p>I can tell Dataverse-Ansible not to template ~dataverse/.aws/credentials (and config) though it gets severely ticked when I rename it. Is Dataverse preferring global AWS creds to datastore-defined credentials expected, and do we want to open an issue to change this order?</p>



<a name="406087752"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/406087752" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#406087752">(Dec 05 2023 at 15:51)</a>:</h4>
<p>Good questions. I'm not sure. <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="406087960"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/406087960" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Don Sizemore <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#406087960">(Dec 05 2023 at 15:52)</a>:</h4>
<p>maybe a question for tech hours this afternoon?</p>



<a name="406088004"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/406088004" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#406088004">(Dec 05 2023 at 15:52)</a>:</h4>
<p>yes, excellent idea</p>



<a name="406088120"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/406088120" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Don Sizemore <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#406088120">(Dec 05 2023 at 15:53)</a>:</h4>
<p>I mean, I _can_ nuke that file just for testing runs, but that won't address any installation with multiple datastores who expect / need a global credential file as well.</p>



<a name="406088157"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/406088157" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#406088157">(Dec 05 2023 at 15:53)</a>:</h4>
<p>right, it sure smells like a bug</p>



<a name="406088487"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/406088487" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Don Sizemore <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#406088487">(Dec 05 2023 at 15:55)</a>:</h4>
<p>ah. I remember now. Jim's PR corrects credentials preference when RBAC is involved. Won't affect conf file vs. jvm-option precedence.</p>



<a name="406088685"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/406088685" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#406088685">(Dec 05 2023 at 15:56)</a>:</h4>
<p>Meanwhile, following the tweaks I just made to the tests (changing the access and secret keys to match Jenkins), the <a href="https://github.com/gdcc/api-test-runner/actions/runs/7102749970">first manual run</a> on the API test runner failed but I'm hoping it's transient. I kicked off a <a href="https://github.com/gdcc/api-test-runner/actions/runs/7103204154">second run</a>.</p>



<a name="406109728"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/406109728" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#406109728">(Dec 05 2023 at 17:22)</a>:</h4>
<p>Bah, the second run failed with the same error:</p>
<p>Error:    S3AccessIT.setUp:66 Â» SdkClient Unable to execute HTTP request: Connect to s3.localhost.localstack.cloud:4566 [s3.localhost.localstack.cloud/127.0.0.1] failed: Connection refused</p>



<a name="406114315"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/406114315" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Don Sizemore <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#406114315">(Dec 05 2023 at 17:50)</a>:</h4>
<p>I left my instance up from this morning if you want to test anything further. If not, I'll kill it to save y'all $$$</p>



<a name="406122554"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/406122554" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Don Sizemore <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#406122554">(Dec 05 2023 at 18:38)</a>:</h4>
<p>sounds like we want Jim's PR merged and then everything should start to work (at least WRT S3 creds). Ima kill this morning's EC2 instance.</p>



<a name="406125100"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/406125100" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#406125100">(Dec 05 2023 at 18:54)</a>:</h4>
<p>That's fine. When do we merge the Ansible branch?</p>



<a name="406149528"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/406149528" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Don Sizemore <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#406149528">(Dec 05 2023 at 20:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="598112">Philip Durbin</span> <a href="#narrow/stream/375812-containers/topic/testing.20S3/near/406125100">said</a>:</p>
<blockquote>
<p>That's fine. When do we merge the Ansible branch?</p>
</blockquote>
<p>I'd say we merge Jim's PR, then merge that into your S3 testing branch, let me test manually once more, and we'll see if things run cleanly? (they should)</p>



<a name="406149651"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/406149651" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juan Pablo Tosca Villanueva <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#406149651">(Dec 05 2023 at 20:00)</a>:</h4>
<p><a href="/user_uploads/53090/j2-jHLug3fdZBYDywnjqPl2n/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/53090/j2-jHLug3fdZBYDywnjqPl2n/image.png" title="image.png"><img src="/user_uploads/53090/j2-jHLug3fdZBYDywnjqPl2n/image.png"></a></div>



<a name="406151275"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/406151275" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#406151275">(Dec 05 2023 at 20:10)</a>:</h4>
<p>Sounds good, and meanwhile, I'll try to figure out while I'm getting that "s3.localhost.localstack.cloud:4566... Connection refused" error, which JP points out is the same he saw when <a href="https://github.com/IQSS/dataverse/pull/10044#issuecomment-1836740149">not on VPN</a>. Makes no sense to me. <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="406334854"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/406334854" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#406334854">(Dec 06 2023 at 15:52)</a>:</h4>
<p>S3 priorities has been merged! <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span> <a href="https://github.com/IQSS/dataverse/issues/10004">#10004</a></p>



<a name="406335021"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/406335021" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#406335021">(Dec 06 2023 at 15:53)</a>:</h4>
<p>Meanwhile, I'm still looking at the connection refused error. It's when I list the buckets, which is optional, so I <a href="https://github.com/IQSS/dataverse/pull/10044/commits/a81ad72a0896073e043ee57848e571d7a3754a8a">commented that out</a> to see if/when LocalStack fails later. Here's the run: <a href="https://github.com/gdcc/api-test-runner/actions/runs/7116920717">https://github.com/gdcc/api-test-runner/actions/runs/7116920717</a></p>



<a name="406370047"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/406370047" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#406370047">(Dec 06 2023 at 19:15)</a>:</h4>
<p>Ok, I think I figured out the problem. I hope so. Re-running tests now.</p>



<a name="406370734"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/406370734" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#406370734">(Dec 06 2023 at 19:20)</a>:</h4>
<p>Phew, yes, passing now: <a href="https://github.com/gdcc/api-test-runner/actions/runs/7118949044">https://github.com/gdcc/api-test-runner/actions/runs/7118949044</a></p>



<a name="406370857"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/406370857" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#406370857">(Dec 06 2023 at 19:21)</a>:</h4>
<p>next up: Jenkins!</p>



<a name="406383901"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/406383901" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#406383901">(Dec 06 2023 at 20:41)</a>:</h4>
<p>I had confused myself with the api-test-runner. For now, until we merge, I set up a dedicated S3 job. Once we merge I'll put that extra config in the "develop" job. And once we release, into the "alpha" job.</p>



<a name="406383986"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/406383986" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#406383986">(Dec 06 2023 at 20:42)</a>:</h4>
<p>The config basically spins up LocalStack and MinIO and tells Dataverse to use them.</p>



<a name="406384012"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/406384012" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#406384012">(Dec 06 2023 at 20:42)</a>:</h4>
<p>docker compose stuff</p>



<a name="406384072"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/406384072" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#406384072">(Dec 06 2023 at 20:42)</a>:</h4>
<p>like I'm using locally, a slight variation on that</p>



<a name="406388406"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/406388406" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#406388406">(Dec 06 2023 at 21:03)</a>:</h4>
<p><span class="user-mention" data-user-id="626369">@Don Sizemore</span> I'm looking now at <a href="https://github.com/GlobalDataverseCommunityConsortium/dataverse-ansible/pull/337">https://github.com/GlobalDataverseCommunityConsortium/dataverse-ansible/pull/337</a> . Thanks!! <span aria-label="heart" class="emoji emoji-2764" role="img" title="heart">:heart:</span></p>



<a name="406388513"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/406388513" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#406388513">(Dec 06 2023 at 21:04)</a>:</h4>
<p>This is very exciting. So Docker-y!</p>



<a name="406389341"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/406389341" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juan Pablo Tosca Villanueva <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#406389341">(Dec 06 2023 at 21:08)</a>:</h4>
<p><a href="/user_uploads/53090/gjvqeu7QmCIdsrx-mT0QD7xo/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/53090/gjvqeu7QmCIdsrx-mT0QD7xo/image.png" title="image.png"><img src="/user_uploads/53090/gjvqeu7QmCIdsrx-mT0QD7xo/image.png"></a></div>



<a name="406389369"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/406389369" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juan Pablo Tosca Villanueva <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#406389369">(Dec 06 2023 at 21:09)</a>:</h4>
<p>Speaking about Doker, I broke their website this morning and I had to share their error page</p>



<a name="406389391"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/406389391" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juan Pablo Tosca Villanueva <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#406389391">(Dec 06 2023 at 21:09)</a>:</h4>
<p>We need that icon <span aria-label="laughter tears" class="emoji emoji-1f602" role="img" title="laughter tears">:laughter_tears:</span></p>



<a name="406389798"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/406389798" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#406389798">(Dec 06 2023 at 21:11)</a>:</h4>
<p><span class="user-mention" data-user-id="626369">@Don Sizemore</span> approved! Thank you!!</p>



<a name="406551255"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/406551255" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#406551255">(Dec 07 2023 at 14:16)</a>:</h4>
<p>All tests are passing! Including the new S3 tests! <a href="https://jenkins.dataverse.org/job/IQSS-Dataverse-Develop-PR/job/PR-10044/17/testReport/edu.harvard.iq.dataverse.api/S3AccessIT/">https://jenkins.dataverse.org/job/IQSS-Dataverse-Develop-PR/job/PR-10044/17/testReport/edu.harvard.iq.dataverse.api/S3AccessIT/</a></p>



<a name="406551334"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/406551334" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#406551334">(Dec 07 2023 at 14:16)</a>:</h4>
<p>And now I can see code coverage! 35% for S3AccessIO! <a href="https://jenkins.dataverse.org/job/IQSS-Dataverse-Develop-PR/job/PR-10044/17/execution/node/3/ws/target/coverage-it/edu.harvard.iq.dataverse.dataaccess/S3AccessIO.html">https://jenkins.dataverse.org/job/IQSS-Dataverse-Develop-PR/job/PR-10044/17/execution/node/3/ws/target/coverage-it/edu.harvard.iq.dataverse.dataaccess/S3AccessIO.html</a></p>



<a name="406551469"></a>
<h4><a href="https://dataverse.zulipchat.com#narrow/stream/375812-containers/topic/testing%20S3/near/406551469" class="zl"><img src="https://gdcc.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philip Durbin ðŸš€ <a href="https://gdcc.github.io/zulip-archive/stream/375812-containers/topic/testing.20S3.html#406551469">(Dec 07 2023 at 14:17)</a>:</h4>
<p>Could be better but I'm happy it's higher than what we had with only unit tests, 7%.</p>



<hr><p>Last updated: Mar 02 2026 at 13:56 UTC</p>
</html>